# CONTEXTO DO PROJETO REUNE (FRONTEND/CORE)
# Gerado automaticamente para análise de IA


============================================================
FILE PATH: .\components.json
============================================================
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.ts",
    "css": "src/index.css",
    "baseColor": "slate",
    "cssVariables": true,
    "prefix": ""
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  }
}


============================================================
FILE PATH: .\eslint-report.json
============================================================
[{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\providers\\base.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\providers\\groq.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\providers\\ollama.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\providers\\openai.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\providers\\together.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\schemas.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\llm\\toolsRouter.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1138,1141],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1138,1141],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { validateToolParams } from './schemas';\nimport type { ToolCall } from '@/types/tools';\nimport { churrascoProfile } from '@/profiles/churrasco';\nimport { estimateQuantityPerPerson, computeCostSplit } from '@/core/calc';\nimport {\n  items_replace_for_event,\n  participants_bulk_upsert,\n  distribution_bulk_upsert,\n  get_event_plan,\n  get_distribution_summary,\n} from '@/api/rpc';\nimport type { Item, Participant } from '@/types/domain';\n\ntype RunResult = { ok: boolean; data?: unknown; error?: string };\n\nfunction ensureOwner(userId: string, ownerId: string): boolean {\n  return String(userId) === String(ownerId);\n}\n\nexport async function runToolCall(userId: string, call: ToolCall): Promise<RunResult> {\n  const started = performance.now();\n  const name = call?.name as keyof typeof validateToolParams | string;\n  const args = call?.arguments ?? {};\n  const idempotencyKey: string | undefined = typeof (args as Record<string, unknown>)?.idempotencyKey === 'string'\n    ? (args as Record<string, unknown>).idempotencyKey as string\n    : undefined;\n\n  try {\n    // Validar parâmetros com Zod\n    const v = validateToolParams(name as any, args as unknown);\n    if (!v.ok) {\n      const duration_ms = Math.round(performance.now() - started);\n      console.debug('[toolsRouter] invalid_params', { tool: name, duration_ms, error: v.error });\n      return { ok: false, error: `invalid_params: ${v.error}` };\n    }\n\n    // ACL: conferir que userId é dono do evento\n    const evento_id = (v.data as { evento_id: string }).evento_id;\n    const plan = await get_event_plan(evento_id).catch((e) => {\n      const msg = e instanceof Error ? e.message : String(e);\n      return Promise.reject(new Error(msg.includes('42501') ? '403_not_authorized' : msg));\n    });\n    if (!ensureOwner(userId, plan.evento.usuario_id)) {\n      const duration_ms = Math.round(performance.now() - started);\n      console.debug('[toolsRouter] acl_forbidden', { tool: name, evento_id, duration_ms });\n      return { ok: false, error: 'forbidden' };\n    }\n\n    // Mapear tool → handler\n    switch (name) {\n      case 'generateItemList': {\n        const { tipo_evento, qtd_pessoas } = v.data as { tipo_evento: string; qtd_pessoas: number };\n        const people = qtd_pessoas || plan.evento.qtd_pessoas;\n\n        // Gerar itens a partir do perfil (churrasco como default)\n        const base = churrascoProfile.defaults?.suggestedItems || [];\n        const generated: Array<Partial<Item>> = base.map((s) => {\n          const per = estimateQuantityPerPerson(s.name);\n          const qty = Math.round(per * people * 100) / 100; // arredondar 2 casas\n          return {\n            nome_item: s.name,\n            quantidade: qty,\n            unidade: s.unit,\n            valor_estimado: s.estimated_cost ?? 0,\n            categoria: s.category || 'geral',\n            prioridade: s.priority || 'B',\n          };\n        });\n\n        const persisted = await items_replace_for_event(evento_id, generated as unknown as Item[], { idempotencyKey });\n        const finalPlan = await get_event_plan(evento_id);\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] ok generateItemList', { evento_id, count: persisted.length, duration_ms });\n        return { ok: true, data: { plan: finalPlan } };\n      }\n\n      case 'confirmItems': {\n        const { itens_editados } = v.data as { itens_editados?: Array<Partial<Item>> };\n        if (!Array.isArray(itens_editados) || itens_editados.length === 0) {\n          const duration_ms = Math.round(performance.now() - started);\n          console.debug('[toolsRouter] invalid confirmItems empty', { evento_id, duration_ms });\n          return { ok: false, error: 'invalid_itens_editados' };\n        }\n        const persisted = await items_replace_for_event(evento_id, itens_editados as unknown as Item[], { idempotencyKey });\n        const finalPlan = await get_event_plan(evento_id);\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] ok confirmItems', { evento_id, count: persisted.length, duration_ms });\n        return { ok: true, data: { plan: finalPlan } };\n      }\n\n      case 'computeCostSplit': {\n        // Obter plan, calcular rateio e persistir\n        const rows = computeCostSplit(plan.itens, plan.participantes);\n        const persisted = await distribution_bulk_upsert(evento_id, rows, { idempotencyKey });\n        const summary = await get_distribution_summary(evento_id);\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] ok computeCostSplit', { evento_id, rows: persisted.length, duration_ms });\n        return { ok: true, data: { summary } };\n      }\n\n      case 'addParticipants': {\n        const { participantes } = v.data as { participantes: Array<Partial<Participant>> };\n        const normalized: Participant[] = (participantes || []).map((p) => ({\n          id: (p as Record<string, unknown>).id as string | undefined,\n          evento_id: evento_id,\n          nome_participante: String((p as Record<string, unknown>).nome_participante ?? ''),\n          contato: ((p as Record<string, unknown>).contato as string | null | undefined) ?? null,\n          status_convite: ((p as Record<string, unknown>).status_convite as 'pendente' | 'confirmado' | 'recusado' | undefined) ?? 'pendente',\n          preferencias: ((p as Record<string, unknown>).preferencias as Record<string, unknown> | null | undefined) ?? null,\n          valor_responsavel: ((p as Record<string, unknown>).valor_responsavel as number | null | undefined) ?? null,\n        })) as unknown as Participant[];\n        const persisted = await participants_bulk_upsert(evento_id, normalized, { idempotencyKey });\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] ok addParticipants', { evento_id, count: persisted.length, duration_ms });\n        return { ok: true, data: { participantes: persisted } };\n      }\n\n      case 'getPlan': {\n        const plan2 = await get_event_plan(evento_id);\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] ok getPlan', { evento_id, duration_ms });\n        return { ok: true, data: { plan: plan2 } };\n      }\n\n      default: {\n        const duration_ms = Math.round(performance.now() - started);\n        console.debug('[toolsRouter] unknown_tool', { tool: name, duration_ms });\n        return { ok: false, error: 'unknown_tool' };\n      }\n    }\n  } catch (e) {\n    const duration_ms = Math.round(performance.now() - started);\n    const msg = e instanceof Error ? e.message : String(e);\n    const error = /403_not_authorized|forbidden/i.test(msg) ? 'forbidden' : msg;\n    console.debug('[toolsRouter] error', { tool: name, error, duration_ms });\n    return { ok: false, error };\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\api\\rpc.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ChatWidget.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\InviteGuestDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\accordion.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\alert-dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\alert.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\aspect-ratio.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\avatar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\badge.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":29,"column":17,"nodeType":"Identifier","messageId":"namedExport","endLine":29,"endColumn":30}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst badgeVariants = cva(\r\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\r\n        secondary: \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        destructive: \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\r\n        outline: \"text-foreground\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nexport interface BadgeProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}\r\n\r\nfunction Badge({ className, variant, ...props }: BadgeProps) {\r\n  return <div className={cn(badgeVariants({ variant }), className)} {...props} />;\r\n}\r\n\r\nexport { Badge, badgeVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\breadcrumb.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\button.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":48,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":48,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst buttonVariants = cva(\r\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 shadow-soft hover:shadow-floating hover:-translate-y-0.5\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\r\n        destructive: \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\r\n        outline: \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\r\n        secondary: \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\r\n        ghost: \"hover:bg-accent hover:text-accent-foreground shadow-none hover:shadow-none hover:translate-y-0\",\r\n        link: \"text-primary underline-offset-4 hover:underline shadow-none hover:shadow-none hover:translate-y-0\",\r\n        floating: \"bg-primary text-primary-foreground shadow-floating hover:shadow-card hover:-translate-y-1\",\r\n      },\r\n      size: {\r\n        default: \"h-11 px-6 py-3\",\r\n        sm: \"h-9 rounded-lg px-4\",\r\n        lg: \"h-12 rounded-xl px-8\",\r\n        icon: \"h-11 w-11\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nexport interface ButtonProps\r\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\r\n    VariantProps<typeof buttonVariants> {\r\n  asChild?: boolean;\r\n}\r\n\r\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\r\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\";\r\n    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;\r\n  },\r\n);\r\nButton.displayName = \"Button\";\r\n\r\nexport { Button, buttonVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\calendar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\carousel.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\chart.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\checkbox.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\collapsible.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\command.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":24,"column":11,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":24,"endColumn":29,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[733,784],"text":"type CommandDialogProps = DialogProps"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { type DialogProps } from \"@radix-ui/react-dialog\";\r\nimport { Command as CommandPrimitive } from \"cmdk\";\r\nimport { Search } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\r\n\r\nconst Command = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive\r\n    ref={ref}\r\n    className={cn(\r\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nCommand.displayName = CommandPrimitive.displayName;\r\n\r\ninterface CommandDialogProps extends DialogProps {}\r\n\r\nconst CommandDialog = ({ children, ...props }: CommandDialogProps) => {\r\n  return (\r\n    <Dialog {...props}>\r\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\r\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\r\n          {children}\r\n        </Command>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n};\r\n\r\nconst CommandInput = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Input>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\r\n>(({ className, ...props }, ref) => (\r\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\r\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\r\n    <CommandPrimitive.Input\r\n      ref={ref}\r\n      className={cn(\r\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\n\r\nCommandInput.displayName = CommandPrimitive.Input.displayName;\r\n\r\nconst CommandList = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandList.displayName = CommandPrimitive.List.displayName;\r\n\r\nconst CommandEmpty = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Empty>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\r\n>((props, ref) => <CommandPrimitive.Empty ref={ref} className=\"py-6 text-center text-sm\" {...props} />);\r\n\r\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName;\r\n\r\nconst CommandGroup = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Group>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Group\r\n    ref={ref}\r\n    className={cn(\r\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandGroup.displayName = CommandPrimitive.Group.displayName;\r\n\r\nconst CommandSeparator = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Separator>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Separator ref={ref} className={cn(\"-mx-1 h-px bg-border\", className)} {...props} />\r\n));\r\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName;\r\n\r\nconst CommandItem = React.forwardRef<\r\n  React.ElementRef<typeof CommandPrimitive.Item>,\r\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\r\n>(({ className, ...props }, ref) => (\r\n  <CommandPrimitive.Item\r\n    ref={ref}\r\n    className={cn(\r\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\n\r\nCommandItem.displayName = CommandPrimitive.Item.displayName;\r\n\r\nconst CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {\r\n  return <span className={cn(\"ml-auto text-xs tracking-widest text-muted-foreground\", className)} {...props} />;\r\n};\r\nCommandShortcut.displayName = \"CommandShortcut\";\r\n\r\nexport {\r\n  Command,\r\n  CommandDialog,\r\n  CommandInput,\r\n  CommandList,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandItem,\r\n  CommandShortcut,\r\n  CommandSeparator,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\context-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\drawer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\dropdown-menu.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\form.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":129,"column":10,"nodeType":"Identifier","messageId":"namedExport","endLine":129,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { Controller, ControllerProps, FieldPath, FieldValues, FormProvider, useFormContext } from \"react-hook-form\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Label } from \"@/components/ui/label\";\r\n\r\nconst Form = FormProvider;\r\n\r\ntype FormFieldContextValue<\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n> = {\r\n  name: TName;\r\n};\r\n\r\nconst FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);\r\n\r\nconst FormField = <\r\n  TFieldValues extends FieldValues = FieldValues,\r\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,\r\n>({\r\n  ...props\r\n}: ControllerProps<TFieldValues, TName>) => {\r\n  return (\r\n    <FormFieldContext.Provider value={{ name: props.name }}>\r\n      <Controller {...props} />\r\n    </FormFieldContext.Provider>\r\n  );\r\n};\r\n\r\nconst useFormField = () => {\r\n  const fieldContext = React.useContext(FormFieldContext);\r\n  const itemContext = React.useContext(FormItemContext);\r\n  const { getFieldState, formState } = useFormContext();\r\n\r\n  const fieldState = getFieldState(fieldContext.name, formState);\r\n\r\n  if (!fieldContext) {\r\n    throw new Error(\"useFormField should be used within <FormField>\");\r\n  }\r\n\r\n  const { id } = itemContext;\r\n\r\n  return {\r\n    id,\r\n    name: fieldContext.name,\r\n    formItemId: `${id}-form-item`,\r\n    formDescriptionId: `${id}-form-item-description`,\r\n    formMessageId: `${id}-form-item-message`,\r\n    ...fieldState,\r\n  };\r\n};\r\n\r\ntype FormItemContextValue = {\r\n  id: string;\r\n};\r\n\r\nconst FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);\r\n\r\nconst FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(\r\n  ({ className, ...props }, ref) => {\r\n    const id = React.useId();\r\n\r\n    return (\r\n      <FormItemContext.Provider value={{ id }}>\r\n        <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\r\n      </FormItemContext.Provider>\r\n    );\r\n  },\r\n);\r\nFormItem.displayName = \"FormItem\";\r\n\r\nconst FormLabel = React.forwardRef<\r\n  React.ElementRef<typeof LabelPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\r\n>(({ className, ...props }, ref) => {\r\n  const { error, formItemId } = useFormField();\r\n\r\n  return <Label ref={ref} className={cn(error && \"text-destructive\", className)} htmlFor={formItemId} {...props} />;\r\n});\r\nFormLabel.displayName = \"FormLabel\";\r\n\r\nconst FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(\r\n  ({ ...props }, ref) => {\r\n    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();\r\n\r\n    return (\r\n      <Slot\r\n        ref={ref}\r\n        id={formItemId}\r\n        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}\r\n        aria-invalid={!!error}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nFormControl.displayName = \"FormControl\";\r\n\r\nconst FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\r\n  ({ className, ...props }, ref) => {\r\n    const { formDescriptionId } = useFormField();\r\n\r\n    return <p ref={ref} id={formDescriptionId} className={cn(\"text-sm text-muted-foreground\", className)} {...props} />;\r\n  },\r\n);\r\nFormDescription.displayName = \"FormDescription\";\r\n\r\nconst FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(\r\n  ({ className, children, ...props }, ref) => {\r\n    const { error, formMessageId } = useFormField();\r\n    const body = error ? String(error?.message) : children;\r\n\r\n    if (!body) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <p ref={ref} id={formMessageId} className={cn(\"text-sm font-medium text-destructive\", className)} {...props}>\r\n        {body}\r\n      </p>\r\n    );\r\n  },\r\n);\r\nFormMessage.displayName = \"FormMessage\";\r\n\r\nexport { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\hover-card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\input-otp.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\menubar.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\navigation-menu.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":111,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":111,"endColumn":29}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\";\r\nimport { cva } from \"class-variance-authority\";\r\nimport { ChevronDown } from \"lucide-react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst NavigationMenu = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Root\r\n    ref={ref}\r\n    className={cn(\"relative z-10 flex max-w-max flex-1 items-center justify-center\", className)}\r\n    {...props}\r\n  >\r\n    {children}\r\n    <NavigationMenuViewport />\r\n  </NavigationMenuPrimitive.Root>\r\n));\r\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;\r\n\r\nconst NavigationMenuList = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.List\r\n    ref={ref}\r\n    className={cn(\"group flex flex-1 list-none items-center justify-center space-x-1\", className)}\r\n    {...props}\r\n  />\r\n));\r\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;\r\n\r\nconst NavigationMenuItem = NavigationMenuPrimitive.Item;\r\n\r\nconst navigationMenuTriggerStyle = cva(\r\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50\",\r\n);\r\n\r\nconst NavigationMenuTrigger = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\r\n>(({ className, children, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Trigger\r\n    ref={ref}\r\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\r\n    {...props}\r\n  >\r\n    {children}{\" \"}\r\n    <ChevronDown\r\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\r\n      aria-hidden=\"true\"\r\n    />\r\n  </NavigationMenuPrimitive.Trigger>\r\n));\r\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;\r\n\r\nconst NavigationMenuContent = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Content\r\n    ref={ref}\r\n    className={cn(\r\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  />\r\n));\r\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;\r\n\r\nconst NavigationMenuLink = NavigationMenuPrimitive.Link;\r\n\r\nconst NavigationMenuViewport = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\r\n>(({ className, ...props }, ref) => (\r\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\r\n    <NavigationMenuPrimitive.Viewport\r\n      className={cn(\r\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\r\n        className,\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  </div>\r\n));\r\nNavigationMenuViewport.displayName = NavigationMenuPrimitive.Viewport.displayName;\r\n\r\nconst NavigationMenuIndicator = React.forwardRef<\r\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\r\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\r\n>(({ className, ...props }, ref) => (\r\n  <NavigationMenuPrimitive.Indicator\r\n    ref={ref}\r\n    className={cn(\r\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\r\n      className,\r\n    )}\r\n    {...props}\r\n  >\r\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\r\n  </NavigationMenuPrimitive.Indicator>\r\n));\r\nNavigationMenuIndicator.displayName = NavigationMenuPrimitive.Indicator.displayName;\r\n\r\nexport {\r\n  navigationMenuTriggerStyle,\r\n  NavigationMenu,\r\n  NavigationMenuList,\r\n  NavigationMenuItem,\r\n  NavigationMenuContent,\r\n  NavigationMenuTrigger,\r\n  NavigationMenuLink,\r\n  NavigationMenuIndicator,\r\n  NavigationMenuViewport,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\pagination.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\popover.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\progress.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\radio-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\resizable.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\scroll-area.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\separator.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\sheet.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\sidebar.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":634,"column":3,"nodeType":"Identifier","messageId":"namedExport","endLine":634,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport { Slot } from \"@radix-ui/react-slot\";\r\nimport { VariantProps, cva } from \"class-variance-authority\";\r\nimport { PanelLeft } from \"lucide-react\";\r\n\r\nimport { useIsMobile } from \"@/hooks/use-mobile\";\r\nimport { cn } from \"@/lib/utils\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Separator } from \"@/components/ui/separator\";\r\nimport { Sheet, SheetContent } from \"@/components/ui/sheet\";\r\nimport { Skeleton } from \"@/components/ui/skeleton\";\r\nimport { Tooltip, TooltipContent, TooltipTrigger } from \"@/components/ui/tooltip\";\r\n\r\nconst SIDEBAR_COOKIE_NAME = \"sidebar:state\";\r\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\r\nconst SIDEBAR_WIDTH = \"16rem\";\r\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\r\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\r\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\r\n\r\ntype SidebarContext = {\r\n  state: \"expanded\" | \"collapsed\";\r\n  open: boolean;\r\n  setOpen: (open: boolean) => void;\r\n  openMobile: boolean;\r\n  setOpenMobile: (open: boolean) => void;\r\n  isMobile: boolean;\r\n  toggleSidebar: () => void;\r\n};\r\n\r\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\r\n\r\nfunction useSidebar() {\r\n  const context = React.useContext(SidebarContext);\r\n  if (!context) {\r\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\r\n  }\r\n\r\n  return context;\r\n}\r\n\r\nconst SidebarProvider = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    defaultOpen?: boolean;\r\n    open?: boolean;\r\n    onOpenChange?: (open: boolean) => void;\r\n  }\r\n>(({ defaultOpen = true, open: openProp, onOpenChange: setOpenProp, className, style, children, ...props }, ref) => {\r\n  const isMobile = useIsMobile();\r\n  const [openMobile, setOpenMobile] = React.useState(false);\r\n\r\n  // This is the internal state of the sidebar.\r\n  // We use openProp and setOpenProp for control from outside the component.\r\n  const [_open, _setOpen] = React.useState(defaultOpen);\r\n  const open = openProp ?? _open;\r\n  const setOpen = React.useCallback(\r\n    (value: boolean | ((value: boolean) => boolean)) => {\r\n      const openState = typeof value === \"function\" ? value(open) : value;\r\n      if (setOpenProp) {\r\n        setOpenProp(openState);\r\n      } else {\r\n        _setOpen(openState);\r\n      }\r\n\r\n      // This sets the cookie to keep the sidebar state.\r\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\r\n    },\r\n    [setOpenProp, open],\r\n  );\r\n\r\n  // Helper to toggle the sidebar.\r\n  const toggleSidebar = React.useCallback(() => {\r\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);\r\n  }, [isMobile, setOpen, setOpenMobile]);\r\n\r\n  // Adds a keyboard shortcut to toggle the sidebar.\r\n  React.useEffect(() => {\r\n    const handleKeyDown = (event: KeyboardEvent) => {\r\n      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {\r\n        event.preventDefault();\r\n        toggleSidebar();\r\n      }\r\n    };\r\n\r\n    window.addEventListener(\"keydown\", handleKeyDown);\r\n    return () => window.removeEventListener(\"keydown\", handleKeyDown);\r\n  }, [toggleSidebar]);\r\n\r\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\r\n  // This makes it easier to style the sidebar with Tailwind classes.\r\n  const state = open ? \"expanded\" : \"collapsed\";\r\n\r\n  const contextValue = React.useMemo<SidebarContext>(\r\n    () => ({\r\n      state,\r\n      open,\r\n      setOpen,\r\n      isMobile,\r\n      openMobile,\r\n      setOpenMobile,\r\n      toggleSidebar,\r\n    }),\r\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],\r\n  );\r\n\r\n  return (\r\n    <SidebarContext.Provider value={contextValue}>\r\n      <div\r\n        style={\r\n          {\r\n            \"--sidebar-width\": SIDEBAR_WIDTH,\r\n            \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\r\n            ...style,\r\n          } as React.CSSProperties\r\n        }\r\n        className={cn(\"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\", className)}\r\n        ref={ref}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </div>\r\n    </SidebarContext.Provider>\r\n  );\r\n});\r\nSidebarProvider.displayName = \"SidebarProvider\";\r\n\r\nconst Sidebar = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    side?: \"left\" | \"right\";\r\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\r\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\r\n  }\r\n>(({ side = \"left\", variant = \"sidebar\", collapsible = \"offcanvas\", className, children, ...props }, ref) => {\r\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\r\n\r\n  if (collapsible === \"none\") {\r\n    return (\r\n      <div\r\n        className={cn(\"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\", className)}\r\n        ref={ref}\r\n        {...props}\r\n      >\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (isMobile) {\r\n    return (\r\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\r\n        <SheetContent\r\n          data-sidebar=\"sidebar\"\r\n          data-mobile=\"true\"\r\n          className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\r\n          style={\r\n            {\r\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\r\n            } as React.CSSProperties\r\n          }\r\n          side={side}\r\n        >\r\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\r\n        </SheetContent>\r\n      </Sheet>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      className=\"group peer hidden text-sidebar-foreground md:block\"\r\n      data-state={state}\r\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\r\n      data-variant={variant}\r\n      data-side={side}\r\n    >\r\n      {/* This is what handles the sidebar gap on desktop */}\r\n      <div\r\n        className={cn(\r\n          \"relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\r\n          \"group-data-[collapsible=offcanvas]:w-0\",\r\n          \"group-data-[side=right]:rotate-180\",\r\n          variant === \"floating\" || variant === \"inset\"\r\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\r\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\r\n        )}\r\n      />\r\n      <div\r\n        className={cn(\r\n          \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\r\n          side === \"left\"\r\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\r\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\r\n          // Adjust the padding for floating and inset variants.\r\n          variant === \"floating\" || variant === \"inset\"\r\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\r\n            : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      >\r\n        <div\r\n          data-sidebar=\"sidebar\"\r\n          className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\r\n        >\r\n          {children}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\nSidebar.displayName = \"Sidebar\";\r\n\r\nconst SidebarTrigger = React.forwardRef<React.ElementRef<typeof Button>, React.ComponentProps<typeof Button>>(\r\n  ({ className, onClick, ...props }, ref) => {\r\n    const { toggleSidebar } = useSidebar();\r\n\r\n    return (\r\n      <Button\r\n        ref={ref}\r\n        data-sidebar=\"trigger\"\r\n        variant=\"ghost\"\r\n        size=\"icon\"\r\n        className={cn(\"h-7 w-7\", className)}\r\n        onClick={(event) => {\r\n          onClick?.(event);\r\n          toggleSidebar();\r\n        }}\r\n        {...props}\r\n      >\r\n        <PanelLeft />\r\n        <span className=\"sr-only\">Toggle Sidebar</span>\r\n      </Button>\r\n    );\r\n  },\r\n);\r\nSidebarTrigger.displayName = \"SidebarTrigger\";\r\n\r\nconst SidebarRail = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\">>(\r\n  ({ className, ...props }, ref) => {\r\n    const { toggleSidebar } = useSidebar();\r\n\r\n    return (\r\n      <button\r\n        ref={ref}\r\n        data-sidebar=\"rail\"\r\n        aria-label=\"Toggle Sidebar\"\r\n        tabIndex={-1}\r\n        onClick={toggleSidebar}\r\n        title=\"Toggle Sidebar\"\r\n        className={cn(\r\n          \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex\",\r\n          \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\r\n          \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\r\n          \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\r\n          \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\r\n          \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarRail.displayName = \"SidebarRail\";\r\n\r\nconst SidebarInset = React.forwardRef<HTMLDivElement, React.ComponentProps<\"main\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <main\r\n      ref={ref}\r\n      className={cn(\r\n        \"relative flex min-h-svh flex-1 flex-col bg-background\",\r\n        \"peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarInset.displayName = \"SidebarInset\";\r\n\r\nconst SidebarInput = React.forwardRef<React.ElementRef<typeof Input>, React.ComponentProps<typeof Input>>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <Input\r\n        ref={ref}\r\n        data-sidebar=\"input\"\r\n        className={cn(\r\n          \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarInput.displayName = \"SidebarInput\";\r\n\r\nconst SidebarHeader = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return <div ref={ref} data-sidebar=\"header\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\r\n});\r\nSidebarHeader.displayName = \"SidebarHeader\";\r\n\r\nconst SidebarFooter = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return <div ref={ref} data-sidebar=\"footer\" className={cn(\"flex flex-col gap-2 p-2\", className)} {...props} />;\r\n});\r\nSidebarFooter.displayName = \"SidebarFooter\";\r\n\r\nconst SidebarSeparator = React.forwardRef<React.ElementRef<typeof Separator>, React.ComponentProps<typeof Separator>>(\r\n  ({ className, ...props }, ref) => {\r\n    return (\r\n      <Separator\r\n        ref={ref}\r\n        data-sidebar=\"separator\"\r\n        className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarSeparator.displayName = \"SidebarSeparator\";\r\n\r\nconst SidebarContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"content\"\r\n      className={cn(\r\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarContent.displayName = \"SidebarContent\";\r\n\r\nconst SidebarGroup = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(({ className, ...props }, ref) => {\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"group\"\r\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarGroup.displayName = \"SidebarGroup\";\r\n\r\nconst SidebarGroupLabel = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\"> & { asChild?: boolean }>(\r\n  ({ className, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"div\";\r\n\r\n    return (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"group-label\"\r\n        className={cn(\r\n          \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n          \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\r\n\r\nconst SidebarGroupAction = React.forwardRef<HTMLButtonElement, React.ComponentProps<\"button\"> & { asChild?: boolean }>(\r\n  ({ className, asChild = false, ...props }, ref) => {\r\n    const Comp = asChild ? Slot : \"button\";\r\n\r\n    return (\r\n      <Comp\r\n        ref={ref}\r\n        data-sidebar=\"group-action\"\r\n        className={cn(\r\n          \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n          // Increases the hit area of the button on mobile.\r\n          \"after:absolute after:-inset-2 after:md:hidden\",\r\n          \"group-data-[collapsible=icon]:hidden\",\r\n          className,\r\n        )}\r\n        {...props}\r\n      />\r\n    );\r\n  },\r\n);\r\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\r\n\r\nconst SidebarGroupContent = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <div ref={ref} data-sidebar=\"group-content\" className={cn(\"w-full text-sm\", className)} {...props} />\r\n  ),\r\n);\r\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\r\n\r\nconst SidebarMenu = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(({ className, ...props }, ref) => (\r\n  <ul ref={ref} data-sidebar=\"menu\" className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)} {...props} />\r\n));\r\nSidebarMenu.displayName = \"SidebarMenu\";\r\n\r\nconst SidebarMenuItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ className, ...props }, ref) => (\r\n  <li ref={ref} data-sidebar=\"menu-item\" className={cn(\"group/menu-item relative\", className)} {...props} />\r\n));\r\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\r\n\r\nconst sidebarMenuButtonVariants = cva(\r\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\r\n        outline:\r\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\r\n      },\r\n      size: {\r\n        default: \"h-8 text-sm\",\r\n        sm: \"h-7 text-xs\",\r\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nconst SidebarMenuButton = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean;\r\n    isActive?: boolean;\r\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\r\n  } & VariantProps<typeof sidebarMenuButtonVariants>\r\n>(({ asChild = false, isActive = false, variant = \"default\", size = \"default\", tooltip, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\";\r\n  const { isMobile, state } = useSidebar();\r\n\r\n  const button = (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\r\n      {...props}\r\n    />\r\n  );\r\n\r\n  if (!tooltip) {\r\n    return button;\r\n  }\r\n\r\n  if (typeof tooltip === \"string\") {\r\n    tooltip = {\r\n      children: tooltip,\r\n    };\r\n  }\r\n\r\n  return (\r\n    <Tooltip>\r\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\r\n      <TooltipContent side=\"right\" align=\"center\" hidden={state !== \"collapsed\" || isMobile} {...tooltip} />\r\n    </Tooltip>\r\n  );\r\n});\r\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\r\n\r\nconst SidebarMenuAction = React.forwardRef<\r\n  HTMLButtonElement,\r\n  React.ComponentProps<\"button\"> & {\r\n    asChild?: boolean;\r\n    showOnHover?: boolean;\r\n  }\r\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"button\";\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-action\"\r\n      className={cn(\r\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\r\n        // Increases the hit area of the button on mobile.\r\n        \"after:absolute after:-inset-2 after:md:hidden\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        showOnHover &&\r\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\r\n\r\nconst SidebarMenuBadge = React.forwardRef<HTMLDivElement, React.ComponentProps<\"div\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-badge\"\r\n      className={cn(\r\n        \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\r\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\r\n        \"peer-data-[size=sm]/menu-button:top-1\",\r\n        \"peer-data-[size=default]/menu-button:top-1.5\",\r\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  ),\r\n);\r\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\r\n\r\nconst SidebarMenuSkeleton = React.forwardRef<\r\n  HTMLDivElement,\r\n  React.ComponentProps<\"div\"> & {\r\n    showIcon?: boolean;\r\n  }\r\n>(({ className, showIcon = false, ...props }, ref) => {\r\n  // Random width between 50 to 90%.\r\n  const width = React.useMemo(() => {\r\n    return `${Math.floor(Math.random() * 40) + 50}%`;\r\n  }, []);\r\n\r\n  return (\r\n    <div\r\n      ref={ref}\r\n      data-sidebar=\"menu-skeleton\"\r\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\r\n      {...props}\r\n    >\r\n      {showIcon && <Skeleton className=\"size-4 rounded-md\" data-sidebar=\"menu-skeleton-icon\" />}\r\n      <Skeleton\r\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\r\n        data-sidebar=\"menu-skeleton-text\"\r\n        style={\r\n          {\r\n            \"--skeleton-width\": width,\r\n          } as React.CSSProperties\r\n        }\r\n      />\r\n    </div>\r\n  );\r\n});\r\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\r\n\r\nconst SidebarMenuSub = React.forwardRef<HTMLUListElement, React.ComponentProps<\"ul\">>(\r\n  ({ className, ...props }, ref) => (\r\n    <ul\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub\"\r\n      className={cn(\r\n        \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  ),\r\n);\r\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\r\n\r\nconst SidebarMenuSubItem = React.forwardRef<HTMLLIElement, React.ComponentProps<\"li\">>(({ ...props }, ref) => (\r\n  <li ref={ref} {...props} />\r\n));\r\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\r\n\r\nconst SidebarMenuSubButton = React.forwardRef<\r\n  HTMLAnchorElement,\r\n  React.ComponentProps<\"a\"> & {\r\n    asChild?: boolean;\r\n    size?: \"sm\" | \"md\";\r\n    isActive?: boolean;\r\n  }\r\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\r\n  const Comp = asChild ? Slot : \"a\";\r\n\r\n  return (\r\n    <Comp\r\n      ref={ref}\r\n      data-sidebar=\"menu-sub-button\"\r\n      data-size={size}\r\n      data-active={isActive}\r\n      className={cn(\r\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\r\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\r\n        size === \"sm\" && \"text-xs\",\r\n        size === \"md\" && \"text-sm\",\r\n        \"group-data-[collapsible=icon]:hidden\",\r\n        className,\r\n      )}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\r\n\r\nexport {\r\n  Sidebar,\r\n  SidebarContent,\r\n  SidebarFooter,\r\n  SidebarGroup,\r\n  SidebarGroupAction,\r\n  SidebarGroupContent,\r\n  SidebarGroupLabel,\r\n  SidebarHeader,\r\n  SidebarInput,\r\n  SidebarInset,\r\n  SidebarMenu,\r\n  SidebarMenuAction,\r\n  SidebarMenuBadge,\r\n  SidebarMenuButton,\r\n  SidebarMenuItem,\r\n  SidebarMenuSkeleton,\r\n  SidebarMenuSub,\r\n  SidebarMenuSubButton,\r\n  SidebarMenuSubItem,\r\n  SidebarProvider,\r\n  SidebarRail,\r\n  SidebarSeparator,\r\n  SidebarTrigger,\r\n  useSidebar,\r\n};\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\skeleton.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\slider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\sonner.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":27,"column":19,"nodeType":"Identifier","messageId":"namedExport","endLine":27,"endColumn":24}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useTheme } from \"next-themes\";\r\nimport { Toaster as Sonner, toast } from \"sonner\";\r\n\r\ntype ToasterProps = React.ComponentProps<typeof Sonner>;\r\n\r\nconst Toaster = ({ ...props }: ToasterProps) => {\r\n  const { theme = \"system\" } = useTheme();\r\n\r\n  return (\r\n    <Sonner\r\n      theme={theme as ToasterProps[\"theme\"]}\r\n      className=\"toaster group\"\r\n      toastOptions={{\r\n        classNames: {\r\n          toast:\r\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\r\n          description: \"group-[.toast]:text-muted-foreground\",\r\n          actionButton: \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\r\n          cancelButton: \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\r\n        },\r\n      }}\r\n      {...props}\r\n    />\r\n  );\r\n};\r\n\r\nexport { Toaster, toast };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\table.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\tabs.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\textarea.tsx","messages":[{"ruleId":"@typescript-eslint/no-empty-object-type","severity":2,"message":"An interface declaring no members is equivalent to its supertype.","line":5,"column":18,"nodeType":"Identifier","messageId":"noEmptyInterfaceWithSuper","endLine":5,"endColumn":31,"suggestions":[{"messageId":"replaceEmptyInterfaceWithSuper","fix":{"range":[79,163],"text":"type TextareaProps = React.TextareaHTMLAttributes<HTMLTextAreaElement>"},"desc":"Replace empty interface with a type alias."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nexport interface TextareaProps extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\r\n\r\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(({ className, ...props }, ref) => {\r\n  return (\r\n    <textarea\r\n      className={cn(\r\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\r\n        className,\r\n      )}\r\n      ref={ref}\r\n      {...props}\r\n    />\r\n  );\r\n});\r\nTextarea.displayName = \"Textarea\";\r\n\r\nexport { Textarea };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\toggle-group.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\toggle.tsx","messages":[{"ruleId":"react-refresh/only-export-components","severity":1,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":37,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":37,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from \"react\";\r\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\";\r\nimport { cva, type VariantProps } from \"class-variance-authority\";\r\n\r\nimport { cn } from \"@/lib/utils\";\r\n\r\nconst toggleVariants = cva(\r\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground\",\r\n  {\r\n    variants: {\r\n      variant: {\r\n        default: \"bg-transparent\",\r\n        outline: \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\r\n      },\r\n      size: {\r\n        default: \"h-10 px-3\",\r\n        sm: \"h-9 px-2.5\",\r\n        lg: \"h-11 px-5\",\r\n      },\r\n    },\r\n    defaultVariants: {\r\n      variant: \"default\",\r\n      size: \"default\",\r\n    },\r\n  },\r\n);\r\n\r\nconst Toggle = React.forwardRef<\r\n  React.ElementRef<typeof TogglePrimitive.Root>,\r\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>\r\n>(({ className, variant, size, ...props }, ref) => (\r\n  <TogglePrimitive.Root ref={ref} className={cn(toggleVariants({ variant, size, className }))} {...props} />\r\n));\r\n\r\nToggle.displayName = TogglePrimitive.Root.displayName;\r\n\r\nexport { Toggle, toggleVariants };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\tooltip.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\components\\ui\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\core\\calc\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\core\\nlp\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\core\\orchestrator\\chatOrchestrator.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1388,1391],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1388,1391],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":34,"column":34,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":34,"endColumn":35,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1599,1600],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1599,1599],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\-.","line":35,"column":50,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":35,"endColumn":51,"suggestions":[{"messageId":"removeEscape","fix":{"range":[1670,1671],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[1670,1670],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":137,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":137,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6251,6254],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6251,6254],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":149,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":149,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6734,6737],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6734,6737],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":163,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":163,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7183,7186],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7183,7186],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { postLlmChat, LlmHttpError } from '@/api/llm/client';\nimport { estimateQuantityPerPerson } from '@/core/calc';\nimport { churrascoProfile } from '@/profiles/churrasco';\nimport type { ConversationState, EventStatus } from '@/types/domain';\n\ntype ChatInput = { text: string; userId: string; eventoId?: string };\ntype ChatContext = { idempotencyKey?: string };\n\ntype ToolCall = { name: string; arguments: Record<string, unknown> | unknown[] };\n\ntype ChatUiPayload = {\n  estado: EventStatus | string;\n  evento_id: string | null;\n  mensagem: string;\n  toolCalls: ToolCall[];\n  ctas: string[];\n};\n\nconst suggestNextActions = (state?: ConversationState): string[] => {\n  // Sugestões simples conforme estado atual\n  const rawCtx: Record<string, unknown> | undefined = state?.context as Record<string, unknown> | undefined;\n  const rawEstado = rawCtx ? rawCtx['estado'] : undefined;\n  const st = typeof rawEstado === 'string' ? rawEstado : 'collecting_core';\n  if (st === 'collecting_core') return ['adicionar_itens', 'definir_qtd_pessoas', 'confirmar_data_local'];\n  if (st === 'itens_pendentes_confirmacao') return ['confirmar_itens', 'distribuir_responsabilidades'];\n  if (st === 'distrib_pendente_confirmacao') return ['confirmar_distribuicao', 'ver_resumo_custos'];\n  return ['ajuda', 'ver_evento'];\n};\n\nconst isStructuredCta = (text: string): { action: string; args?: Record<string, any> } | null => {\n  const t = text.trim().toLowerCase();\n  // Exemplos básicos de CTA determinísticos\n  if (/^(criar|novo)\\s+evento/.test(t)) return { action: 'create_event' };\n  if (/^abrir\\s+evento\\s+([a-f0-9\\-]{6,})$/.test(t)) {\n    const m = t.match(/^abrir\\s+evento\\s+([a-f0-9\\-]{6,})$/);\n    return { action: 'open_event', args: { evento_id: m?.[1] } };\n  }\n  if (/^confirmar\\s+(itens|distribuicao)$/.test(t)) {\n    const kind = t.includes('distribuicao') ? 'distribution' : 'items';\n    return { action: `confirm_${kind}` };\n  }\n  return null;\n};\n\nconst isGreetingOrStatus = (text: string): boolean => {\n  const t = text.toLowerCase();\n  return /(ol[aá]|oi|bom\\s+dia|boa\\s+tarde|boa\\s+noite|tudo\\s+bem|como\\s+est[aá])/.test(t) || /(status|como\\s+est[aá]\\s+o\\s+evento)/.test(t);\n};\n\nconst tryParseEditableCommand = (text: string): ToolCall | null => {\n  const t = text.toLowerCase();\n  // Padrões: \"muda picanha para 1.5kg\" | \"altera bebidas para 20 L\"\n  const m = t.match(/\\b(muda|altera)\\s+(.+?)\\s+para\\s+([0-9.,]+)\\s*(kg|g|l|unid)?\\b/);\n  if (m) {\n    const item = m[2].trim();\n    const quantidadeRaw = m[3].replace(',', '.');\n    const quantidade = Number(quantidadeRaw);\n    const unidade = m[4] || 'unid';\n    if (!Number.isNaN(quantidade)) {\n      return { name: 'update_item_quantity', arguments: { item, quantidade, unidade } };\n    }\n  }\n  return null;\n};\n\nconst generateIdempotencyKey = (text: string): string => {\n  // Hash simples: conteúdo + timestamp curto (segundos)\n  const ts = Math.floor(Date.now() / 1000);\n  const base = `${text}:${ts}`;\n  let hash = 0;\n  for (let i = 0; i < base.length; i++) {\n    hash = (hash << 5) - hash + base.charCodeAt(i);\n    hash |= 0; // 32-bit\n  }\n  return `chat-${Math.abs(hash)}`;\n};\n\nconst fallbackHeuristic = (text: string, state?: ConversationState): ChatUiPayload => {\n  const t = text.toLowerCase();\n  const rawCtx: Record<string, unknown> | undefined = state?.context as Record<string, unknown> | undefined;\n  const prevTipo = typeof rawCtx?.['tipo_evento'] === 'string' ? (rawCtx?.['tipo_evento'] as string) : undefined;\n  const prevPessoas = typeof rawCtx?.['qtd_pessoas'] === 'number' ? (rawCtx?.['qtd_pessoas'] as number) : undefined;\n  const tipo = /(churrasco|pizza|feijoada|anivers[aá]rio|jantar)/.exec(t)?.[1] || prevTipo || 'evento';\n  // Detectar pessoas em várias formas: \"para 10\", \"10 pessoas\", \"são 10 pessoas\", \"10p\"\n  const m1 = /\\b(?:p\\/|para|pra)\\s*(\\d{1,3})\\b/.exec(t);\n  const m2 = /\\b(\\d{1,3})\\s*(pessoas|p|ppl)\\b/.exec(t);\n  const m3 = /\\b(s[aã]o|tem)\\s*(\\d{1,3})\\s*pessoas\\b/.exec(t);\n  const pessoas = m1 ? Number(m1[1]) : m2 ? Number(m2[1]) : m3 ? Number(m3[2]) : prevPessoas;\n\n  // Confirmações sem novos dados: ok, beleza, sim\n  const confirma = /(ok|beleza|sim|perfeito|isso)/.test(t);\n  const hasCore = Boolean(tipo && pessoas);\n  let mensagem = hasCore\n    ? `Entendi: ${tipo} para ${pessoas} pessoas. Posso sugerir itens e quantidades.`\n    : `Entendi: ${tipo}. Me diga quantas pessoas para sugerir itens.`;\n  if (confirma && hasCore) {\n    mensagem = `Ótimo! Vou sugerir itens e quantidades para ${tipo} de ${pessoas} pessoas.`;\n  }\n\n  const toolCalls: ToolCall[] = [];\n  if (tipo === 'churrasco') {\n    // Sugestões baseadas no perfil + quantidade por pessoa\n    const carnePer = estimateQuantityPerPerson('carne');\n    const bebidaPer = estimateQuantityPerPerson('bebida');\n    const carneTotal = pessoas ? carnePer * pessoas : churrascoProfile.defaults?.suggestedItems?.find((i) => i.id === 'carne')?.quantity || 500;\n    const bebidaTotal = pessoas ? bebidaPer * pessoas : churrascoProfile.defaults?.suggestedItems?.find((i) => i.id === 'bebidas')?.quantity || 20;\n    toolCalls.push(\n      { name: 'suggest_items', arguments: [\n        { nome_item: 'Carne', quantidade: carneTotal, unidade: 'g', prioridade: 'A' },\n        { nome_item: 'Bebidas', quantidade: bebidaTotal, unidade: 'L', prioridade: 'A' },\n      ] },\n    );\n  }\n\n  const rawEstado = rawCtx ? rawCtx['estado'] : undefined;\n  const estado = typeof rawEstado === 'string' ? rawEstado : 'collecting_core';\n  const eventoIdFromCtx = typeof rawCtx?.['eventoId'] === 'string' ? (rawCtx?.['eventoId'] as string) : null;\n  return {\n    estado,\n    evento_id: eventoIdFromCtx,\n    mensagem,\n    toolCalls,\n    ctas: suggestNextActions(state),\n  };\n};\n\nexport async function orchestrate(input: ChatInput, state?: ConversationState, ctx?: ChatContext): Promise<ChatUiPayload> {\n  // a) CTA/ação estruturada\n  const cta = isStructuredCta(input.text);\n  if (cta) {\n    const mensagem = cta.action === 'create_event'\n      ? 'Ok! Vou iniciar um rascunho de evento. Me diga o tipo e a quantidade de pessoas.'\n      : cta.action === 'open_event'\n        ? `Abrindo evento ${cta.args?.evento_id ?? input.eventoId ?? ''}.`\n        : 'Certo! Vou prosseguir com a confirmação.';\n    return {\n      estado: (state as any)?.estado ?? 'collecting_core',\n      evento_id: cta.args?.evento_id ?? input.eventoId ?? null,\n      mensagem,\n      toolCalls: cta.action !== 'create_event' ? [{ name: cta.action, arguments: cta.args ?? {} }] : [],\n      ctas: suggestNextActions(state),\n    };\n  }\n\n  // b) Greeting/status simples\n  if (isGreetingOrStatus(input.text)) {\n    const mensagem = 'Olá! Posso ajudar a planejar seu evento. Me diga o tipo e o número de pessoas.';\n    return {\n      estado: (state as any)?.estado ?? 'collecting_core',\n      evento_id: input.eventoId ?? null,\n      mensagem,\n      toolCalls: [],\n      ctas: suggestNextActions(state),\n    };\n  }\n\n  // c) Comando editável\n  const editCall = tryParseEditableCommand(input.text);\n  if (editCall) {\n    const { item, quantidade, unidade } = editCall.arguments || {};\n    const mensagem = `Ok, vou alterar \"${item}\" para ${quantidade} ${unidade}.`;\n    return {\n      estado: (state as any)?.estado ?? 'collecting_core',\n      evento_id: input.eventoId ?? null,\n      mensagem,\n      toolCalls: [editCall],\n      ctas: suggestNextActions(state),\n    };\n  }\n\n  // d) Caso contrário -> chamar postLlmChat com histórico quando disponível\n  const idem = ctx?.idempotencyKey ?? generateIdempotencyKey(input.text);\n  try {\n    const prior = (state?.history || []).map((m) => ({ role: m.role as 'user' | 'assistant' | 'system', content: m.content }));\n    const res = await postLlmChat({\n      messages: [...prior, { role: 'user', content: input.text }],\n      temperature: 0.2,\n      idempotencyKey: idem,\n    });\n    const rawCtx: Record<string, unknown> | undefined = state?.context as Record<string, unknown> | undefined;\n    const rawEstado = rawCtx ? rawCtx['estado'] : undefined;\n    const estado = typeof rawEstado === 'string' ? rawEstado : 'collecting_core';\n    const eventoIdFromCtx = typeof rawCtx?.['eventoId'] === 'string' ? (rawCtx?.['eventoId'] as string) : null;\n    return {\n      estado,\n      evento_id: eventoIdFromCtx ?? input.eventoId ?? null,\n      mensagem: res.content,\n      toolCalls: res.toolCalls ?? [],\n      ctas: suggestNextActions(state),\n    };\n  } catch (e) {\n    // e) Fallback: se /llm-chat falhar, usar heurística\n    if (e instanceof LlmHttpError) {\n      console.debug('[ChatOrchestrator] LLM falhou', { code: e.code, status: e.status, msg: e.message });\n    } else {\n      console.debug('[ChatOrchestrator] LLM falhou (erro desconhecido)');\n    }\n    return fallbackHeuristic(input.text, state);\n  }\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\core\\orchestrator\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\db\\lovableClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\db\\repositories\\events.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\db\\repositories\\items.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\db\\schema.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\hooks\\use-mobile.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\hooks\\useAuth.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\hooks\\useEvent.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'fetchEvent' and 'fetchOrganizers'. Either include them or remove the dependency array.","line":123,"column":6,"nodeType":"ArrayExpression","endLine":123,"endColumn":30,"suggestions":[{"desc":"Update the dependencies array to be: [eventId, eventIdNumber, fetchEvent, fetchOrganizers]","fix":{"range":[3313,3337],"text":"[eventId, eventIdNumber, fetchEvent, fetchOrganizers]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useAuth } from './useAuth';\r\n// Force TypeScript refresh\r\n\r\ninterface Event {\r\n  id: number;\r\n  title: string;\r\n  description: string | null;\r\n  event_date: string;\r\n  event_time: string;\r\n  location: string | null;\r\n  user_id: string;\r\n  max_attendees: number | null;\r\n  is_public: boolean | null;\r\n  status: string | null;\r\n}\r\n\r\ninterface EventOrganizer {\r\n  id: string;\r\n  user_id: string;\r\n  added_by: string;\r\n  added_at: string;\r\n}\r\n\r\nexport const useEvent = (eventId: string) => {\r\n  const eventIdNumber = parseInt(eventId);\r\n  const { user } = useAuth();\r\n  const [event, setEvent] = useState<Event | null>(null);\r\n  const [organizers, setOrganizers] = useState<EventOrganizer[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Verifica se o usuário atual é organizador do evento\r\n  const isOrganizer = () => {\r\n    if (!user || !event) return false;\r\n    \r\n    // É criador do evento\r\n    if (event.user_id === user.id) return true;\r\n    \r\n    // É co-organizador\r\n    return organizers.some(org => org.user_id === user.id);\r\n  };\r\n\r\n  // Busca dados do evento\r\n  const fetchEvent = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const { data, error } = await supabase\r\n        .from('table_reune')\r\n        .select('*')\r\n        .eq('id', eventIdNumber)\r\n        .single();\r\n\r\n      if (error) throw error;\r\n      setEvent(data);\r\n    } catch (err) {\r\n      setError(err instanceof Error ? err.message : 'Erro ao carregar evento');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Busca co-organizadores do evento\r\n  const fetchOrganizers = async () => {\r\n    try {\r\n      const { data, error } = await supabase\r\n        .from('event_organizers')\r\n        .select('*')\r\n        .eq('event_id', eventIdNumber);\r\n\r\n      if (error) throw error;\r\n      setOrganizers(data || []);\r\n    } catch (err) {\r\n      console.error('Erro ao buscar organizadores:', err);\r\n    }\r\n  };\r\n\r\n  // Adiciona co-organizador\r\n  const addOrganizer = async (userId: string) => {\r\n    if (!user) return { error: 'Usuário não autenticado' };\r\n\r\n    try {\r\n      const { error } = await supabase\r\n        .from('event_organizers')\r\n        .insert({\r\n          event_id: eventIdNumber,\r\n          user_id: userId,\r\n          added_by: user.id\r\n        });\r\n\r\n      if (error) throw error;\r\n      \r\n      await fetchOrganizers(); // Atualiza a lista\r\n      return { error: null };\r\n    } catch (err) {\r\n      return { error: err instanceof Error ? err.message : 'Erro ao adicionar organizador' };\r\n    }\r\n  };\r\n\r\n  // Remove co-organizador\r\n  const removeOrganizer = async (organizerId: string) => {\r\n    try {\r\n      const { error } = await supabase\r\n        .from('event_organizers')\r\n        .delete()\r\n        .eq('id', organizerId);\r\n\r\n      if (error) throw error;\r\n      \r\n      await fetchOrganizers(); // Atualiza a lista\r\n      return { error: null };\r\n    } catch (err) {\r\n      return { error: err instanceof Error ? err.message : 'Erro ao remover organizador' };\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (eventId && !isNaN(eventIdNumber)) {\r\n      fetchEvent();\r\n      fetchOrganizers();\r\n    }\r\n  }, [eventId, eventIdNumber]);\r\n\r\n  return {\r\n    event,\r\n    organizers,\r\n    loading,\r\n    error,\r\n    isOrganizer: isOrganizer(),\r\n    addOrganizer,\r\n    removeOrganizer,\r\n    refetch: () => {\r\n      fetchEvent();\r\n      fetchOrganizers();\r\n    }\r\n  };\r\n};","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\integrations\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\integrations\\supabase\\types.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\CreateEvent.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":21,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":24,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1901,1904],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1901,1904],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { ArrowLeft } from 'lucide-react';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { useToast } from '@/hooks/use-toast';\r\n// TS type refresh\r\n\r\ninterface CreateEventProps {\r\n  onBack: () => void;\r\n  onCreate: () => void;\r\n}\r\n\r\nconst CreateEvent = ({ onBack, onCreate }: CreateEventProps) => {\r\n  const { user } = useAuth();\r\n  const { toast } = useToast();\r\n  const [title, setTitle] = useState('');\r\n  const [date, setDate] = useState('');\r\n  const [time, setTime] = useState('');\r\n  const [location, setLocation] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    if (!user) {\r\n      toast({\r\n        title: \"Erro\",\r\n        description: \"Você precisa estar logado para criar um evento.\",\r\n        variant: \"destructive\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    setLoading(true);\r\n    \r\n    try {\r\n      const { error } = await supabase\r\n        .from('table_reune')\r\n        .insert({\r\n          title,\r\n          event_date: date,\r\n          event_time: time,\r\n          location,\r\n          description,\r\n          user_id: user.id,\r\n          is_public: true,\r\n          status: 'published'\r\n        });\r\n\r\n      if (error) throw error;\r\n\r\n      toast({\r\n        title: \"Evento criado com sucesso!\",\r\n        description: \"Seu evento foi publicado e já está disponível.\",\r\n      });\r\n\r\n      onCreate();\r\n    } catch (error: any) {\r\n      toast({\r\n        title: \"Erro ao criar evento\",\r\n        description: error.message || \"Ocorreu um erro. Tente novamente.\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      <header className=\"bg-card border-b px-4 py-6\">\r\n        <div className=\"max-w-2xl mx-auto flex items-center\">\r\n          <Button variant=\"ghost\" size=\"sm\" onClick={onBack} className=\"mr-4\">\r\n            <ArrowLeft className=\"w-4 h-4\" />\r\n          </Button>\r\n          <div>\r\n            <h1 className=\"text-xl font-semibold\">Criar Novo Evento</h1>\r\n            <p className=\"text-muted-foreground text-sm\">Preencha as informações do seu evento</p>\r\n          </div>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"max-w-2xl mx-auto p-4\">\r\n        <Card>\r\n          <CardHeader>\r\n            <CardTitle>Informações do Evento</CardTitle>\r\n            <CardDescription>\r\n              Adicione os detalhes principais do seu evento\r\n            </CardDescription>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n              <div>\r\n                <Label htmlFor=\"title\">Nome do Evento</Label>\r\n                <Input\r\n                  id=\"title\"\r\n                  type=\"text\"\r\n                  placeholder=\"Ex: Churrasco de Domingo\"\r\n                  value={title}\r\n                  onChange={(e) => setTitle(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <Label htmlFor=\"date\">Data</Label>\r\n                  <Input\r\n                    id=\"date\"\r\n                    type=\"date\"\r\n                    value={date}\r\n                    onChange={(e) => setDate(e.target.value)}\r\n                    required\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <Label htmlFor=\"time\">Horário</Label>\r\n                  <Input\r\n                    id=\"time\"\r\n                    type=\"time\"\r\n                    value={time}\r\n                    onChange={(e) => setTime(e.target.value)}\r\n                    required\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <Label htmlFor=\"location\">Endereço</Label>\r\n                <Input\r\n                  id=\"location\"\r\n                  type=\"text\"\r\n                  placeholder=\"Ex: Rua das Flores, 123 - Centro\"\r\n                  value={location}\r\n                  onChange={(e) => setLocation(e.target.value)}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <Label htmlFor=\"description\">Descrição (opcional)</Label>\r\n                <Textarea\r\n                  id=\"description\"\r\n                  placeholder=\"Adicione detalhes sobre o evento...\"\r\n                  value={description}\r\n                  onChange={(e) => setDescription(e.target.value)}\r\n                  rows={4}\r\n                />\r\n              </div>\r\n\r\n              <Button \r\n                type=\"submit\" \r\n                className=\"w-full\"\r\n                disabled={loading || !title || !date || !time || !location}\r\n              >\r\n                {loading ? 'Criando...' : 'Criar Evento'}\r\n              </Button>\r\n            </form>\r\n          </CardContent>\r\n        </Card>\r\n      </main>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreateEvent;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\Dashboard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchEvents'. Either include it or remove the dependency array.","line":122,"column":6,"nodeType":"ArrayExpression","endLine":122,"endColumn":16,"suggestions":[{"desc":"Update the dependencies array to be: [fetchEvents, user.id]","fix":{"range":[3758,3768],"text":"[fetchEvents, user.id]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Badge } from '@/components/ui/badge';\r\nimport { Plus, Calendar, Clock, MapPin, Users, LogOut, AlertTriangle } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport reUneLogo from '@/assets/reune-logo.png';\r\n// Refresh TS types\r\n\r\ninterface Event {\r\n  id: number;\r\n  title: string;\r\n  event_date: string;\r\n  event_time: string;\r\n  location: string | null;\r\n  description: string | null;\r\n  user_id: string;\r\n  is_public: boolean | null;\r\n  status: string | null;\r\n  created_at: string;\r\n  isOwner: boolean;\r\n  isConfirmed: boolean;\r\n}\r\n\r\ninterface DashboardProps {\r\n  userEmail: string;\r\n  onCreateEvent: () => void;\r\n  onViewEvent: (eventId: string) => void;\r\n  onLogout: () => void;\r\n}\r\n\r\nconst Dashboard = ({ userEmail, onCreateEvent, onViewEvent, onLogout }: DashboardProps) => {\r\n  const { user, devModeActive, disableDevMode } = useAuth();\r\n  const { toast } = useToast();\r\n  const isDevMode = import.meta.env.VITE_DEV_MODE === 'true';\r\n  const [events, setEvents] = useState<Event[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const handleLogout = async () => {\r\n    try {\r\n      if (devModeActive) {\r\n        // Modo dev: apenas desativa o modo dev\r\n        disableDevMode();\r\n        toast({\r\n          title: \"Modo DEV desativado!\",\r\n          description: \"Voltando ao login\",\r\n        });\r\n      } else {\r\n        // Modo normal: faz logout real do Supabase\r\n        const { error } = await supabase.auth.signOut();\r\n        if (error) throw error;\r\n        \r\n        toast({\r\n          title: \"Logout realizado com sucesso!\",\r\n          description: \"Até logo!\",\r\n        });\r\n      }\r\n      \r\n      onLogout();\r\n    } catch (error) {\r\n      const err = error as { message?: string };\r\n      toast({\r\n        title: \"Erro no logout\",\r\n        description: err?.message || \"Ocorreu um erro. Tente novamente.\",\r\n        variant: \"destructive\",\r\n      });\r\n    }\r\n  };\r\n\r\n  const fetchEvents = async () => {\r\n    if (!user) return;\r\n\r\n    try {\r\n      setLoading(true);\r\n      \r\n      // Busca eventos e confirmações\r\n      const { data: eventsData, error: eventsError } = await supabase\r\n        .from('table_reune')\r\n        .select('*')\r\n        .or(`user_id.eq.${user.id},is_public.eq.true`)\r\n        .order('event_date', { ascending: true });\r\n\r\n      if (eventsError) throw eventsError;\r\n\r\n      // Busca confirmações do usuário\r\n      const { data: confirmationsData, error: confirmationsError } = await supabase\r\n        .from('event_confirmations')\r\n        .select('event_id, presence_confirmed')\r\n        .eq('user_id', user.id);\r\n\r\n      if (confirmationsError) throw confirmationsError;\r\n\r\n      // Cria um mapa de confirmações\r\n      const confirmationsMap = new Map(\r\n        confirmationsData?.map(c => [c.event_id, c.presence_confirmed]) || []\r\n      );\r\n\r\n      const eventsWithStatus = eventsData.map(event => ({\r\n        ...event,\r\n        isOwner: event.user_id === user.id,\r\n        isConfirmed: confirmationsMap.get(event.id) === true\r\n      }));\r\n\r\n      setEvents(eventsWithStatus);\r\n    } catch (error) {\r\n      const err = error as { message?: string };\r\n      toast({\r\n        title: \"Erro ao carregar eventos\",\r\n        description: err?.message || \"Não foi possível carregar os eventos.\",\r\n        variant: \"destructive\",\r\n      });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchEvents();\r\n  }, [user?.id]);\r\n\r\n  const formatDate = (dateStr: string) => {\r\n    const date = new Date(dateStr);\r\n    return date.toLocaleDateString('pt-BR', {\r\n      day: 'numeric',\r\n      month: 'short'\r\n    });\r\n  };\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n        <div className=\"text-center\">\r\n          <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto\"></div>\r\n          <p className=\"mt-4 text-muted-foreground\">Carregando eventos...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  const cardColors = [\r\n    'bg-orange-light border-orange/20',\r\n    'bg-gold-light border-gold/20',\r\n    'bg-teal-light border-teal/20',\r\n    'bg-cyan-light border-cyan/20',\r\n    'bg-orange-light border-orange/30',\r\n    'bg-cyan-light border-cyan/30'\r\n  ];\r\n\r\n  const getCardColor = (index: number) => {\r\n    return cardColors[index % cardColors.length];\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background\">\r\n      {(isDevMode && devModeActive) && (\r\n        <div className=\"fixed top-4 right-4 bg-secondary/90 text-secondary-foreground px-3 py-2 rounded-lg flex items-center gap-2 text-sm font-medium z-50\">\r\n          <AlertTriangle className=\"w-4 h-4\" />\r\n          LOGADO COMO DEV\r\n        </div>\r\n      )}\r\n      <header className=\"bg-card/50 backdrop-blur-sm border-b border-border/50 px-6 py-8\">\r\n        <div className=\"max-w-6xl mx-auto flex justify-between items-center\">\r\n          <div className=\"flex items-center gap-4 animate-fade-in\">\r\n            <img src={reUneLogo} alt=\"ReUNE Logo\" className=\"h-12 w-auto\" />\r\n            <div>\r\n              <h1 className=\"text-3xl font-bold text-primary tracking-tight\">ReUNE</h1>\r\n              <p className=\"text-muted-foreground font-medium\">Olá, {userEmail}!</p>\r\n            </div>\r\n          </div>\r\n          <Button \r\n            variant=\"ghost\" \r\n            size=\"sm\" \r\n            onClick={handleLogout}\r\n            className=\"text-muted-foreground hover:text-foreground\"\r\n          >\r\n            <LogOut className=\"w-4 h-4 mr-2\" />\r\n            Sair\r\n          </Button>\r\n        </div>\r\n      </header>\r\n\r\n      <main className=\"max-w-6xl mx-auto p-6 animate-fade-in\">\r\n        <div className=\"mb-12\">\r\n          <h2 className=\"text-2xl font-semibold mb-6 text-foreground\">Meus Eventos</h2>\r\n          <div className=\"grid gap-6 md:grid-cols-2 lg:grid-cols-3\">\r\n            {events.filter(event => event.isOwner || event.isConfirmed).length === 0 ? (\r\n              <div className=\"col-span-full text-center py-12\">\r\n                <p className=\"text-muted-foreground mb-4\">Você ainda não tem eventos confirmados.</p>\r\n                <Button onClick={onCreateEvent} variant=\"outline\">\r\n                  <Plus className=\"w-4 h-4 mr-2\" />\r\n                  Criar Primeiro Evento\r\n                </Button>\r\n              </div>\r\n            ) : (\r\n              events.filter(event => event.isOwner || event.isConfirmed).map((event, index) => (\r\n                <Card \r\n                  key={event.id} \r\n                  className={cn(\r\n                    \"cursor-pointer group animate-scale-in\",\r\n                    getCardColor(index)\r\n                  )}\r\n                  onClick={() => onViewEvent(event.id.toString())}\r\n                  style={{ animationDelay: `${index * 100}ms` }}\r\n                >\r\n                  <CardHeader className=\"pb-4\">\r\n                    <div className=\"flex justify-between items-start\">\r\n                      <div>\r\n                        <p className=\"text-xs font-medium text-muted-foreground mb-1 uppercase tracking-wide\">Eventos</p>\r\n                        <CardTitle className=\"text-xl font-bold text-foreground group-hover:text-primary transition-colors\">\r\n                          {event.title}\r\n                        </CardTitle>\r\n                      </div>\r\n                      <Badge variant=\"secondary\" className=\"bg-white/80 text-foreground text-xs px-3 py-1\">\r\n                        {event.isOwner ? 'Organizador' : 'Confirmado'}\r\n                      </Badge>\r\n                    </div>\r\n                  </CardHeader>\r\n                  <CardContent>\r\n                    <div className=\"space-y-3\">\r\n                      <div className=\"flex items-center text-sm font-medium text-foreground/80\">\r\n                        <Calendar className=\"w-4 h-4 mr-3 text-primary\" />\r\n                        {formatDate(event.event_date)} • {event.event_time}\r\n                      </div>\r\n                      <div className=\"flex items-center text-sm text-foreground/70\">\r\n                        <MapPin className=\"w-4 h-4 mr-3 text-primary\" />\r\n                        {event.location || 'Local não informado'}\r\n                      </div>\r\n                    </div>\r\n                  </CardContent>\r\n                </Card>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"mb-12\">\r\n          <h2 className=\"text-2xl font-semibold mb-6 text-foreground\">Eventos Pendentes</h2>\r\n          <p className=\"text-sm text-muted-foreground mb-4\">Eventos aguardando sua confirmação</p>\r\n          <div className=\"flex flex-wrap gap-3\">\r\n            {events.filter(event => !event.isOwner && !event.isConfirmed).length === 0 ? (\r\n              <p className=\"text-muted-foreground text-sm\">Nenhum evento pendente.</p>\r\n            ) : (\r\n              events.filter(event => !event.isOwner && !event.isConfirmed).map((event, index) => (\r\n                <div\r\n                  key={event.id}\r\n                  onClick={() => onViewEvent(event.id.toString())}\r\n                  className={cn(\r\n                    \"px-6 py-4 rounded-xl cursor-pointer transition-all hover:scale-105 hover:shadow-lg\",\r\n                    \"border-2 flex items-center gap-3 animate-scale-in\",\r\n                    getCardColor(index + 3)\r\n                  )}\r\n                  style={{ animationDelay: `${(index + 3) * 100}ms` }}\r\n                >\r\n                  <div className=\"flex items-center gap-2\">\r\n                    <Calendar className=\"w-5 h-5 text-primary\" />\r\n                    <div>\r\n                      <p className=\"font-semibold text-foreground\">{event.title}</p>\r\n                      <p className=\"text-xs text-muted-foreground\">\r\n                        {formatDate(event.event_date)} • {event.event_time}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                  <Badge variant=\"secondary\" className=\"ml-2 text-xs\">\r\n                    Pendente\r\n                  </Badge>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n        </div>\r\n      </main>\r\n\r\n      {/* Floating Action Button */}\r\n      <Button\r\n        onClick={onCreateEvent}\r\n        variant=\"floating\"\r\n        size=\"lg\"\r\n        className=\"fixed bottom-8 right-8 rounded-full w-16 h-16 text-lg animate-scale-in\"\r\n        style={{ animationDelay: '600ms' }}\r\n      >\r\n        <Plus className=\"w-7 h-7\" />\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Dashboard;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\EventDetails.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\Index.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'isDevMode'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [user, loading, isDevMode]","fix":{"range":[1126,1141],"text":"[user, loading, isDevMode]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/hooks/useAuth';\r\nimport { supabase } from '@/integrations/supabase/client';\r\nimport Login from './Login';\r\nimport Dashboard from './Dashboard';\r\nimport CreateEvent from './CreateEvent';\r\nimport EventDetails from './EventDetails';\r\nimport ChatWidget from '@/components/ChatWidget';\r\n\r\ntype Screen = 'login' | 'dashboard' | 'createEvent' | 'eventDetails';\r\n\r\nconst Index = () => {\r\n  const { user, loading, enableDevMode } = useAuth();\r\n  const [currentScreen, setCurrentScreen] = useState<Screen>('login');\r\n  const [selectedEventId, setSelectedEventId] = useState<string>('');\r\n  \r\n  const isDevMode = import.meta.env.VITE_DEV_MODE === 'true';\r\n\r\n  useEffect(() => {\r\n    // Verifica se o modo dev está ativo no localStorage\r\n    const devModeFromStorage = isDevMode && localStorage.getItem('devModeActive') === 'true';\r\n    \r\n    if (devModeFromStorage) {\r\n      setCurrentScreen('dashboard');\r\n      return;\r\n    }\r\n    \r\n    if (user) {\r\n      setCurrentScreen('dashboard');\r\n    } else if (!loading) {\r\n      setCurrentScreen('login');\r\n    }\r\n  }, [user, loading]);\r\n\r\n  const handleLogin = () => {\r\n    setCurrentScreen('dashboard');\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    await supabase.auth.signOut();\r\n    setCurrentScreen('login');\r\n  };\r\n\r\n  const handleCreateEvent = () => {\r\n    setCurrentScreen('createEvent');\r\n  };\r\n\r\n  const handleViewEvent = (eventId: string) => {\r\n    setSelectedEventId(eventId);\r\n    setCurrentScreen('eventDetails');\r\n  };\r\n\r\n  const handleBackToDashboard = () => {\r\n    setCurrentScreen('dashboard');\r\n  };\r\n\r\n  const handleEventCreated = () => {\r\n    setCurrentScreen('dashboard');\r\n  };\r\n\r\n  const renderScreen = () => {\r\n    if (loading) {\r\n      return (\r\n        <div className=\"min-h-screen bg-background flex items-center justify-center\">\r\n          <div className=\"text-center\">\r\n            <div className=\"animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto\"></div>\r\n            <p className=\"mt-4 text-muted-foreground\">Carregando...</p>\r\n          </div>\r\n        </div>\r\n      );\r\n    }\r\n\r\n    if (!user && currentScreen !== 'login') {\r\n      // Verifica se o modo dev está ativo antes de forçar login\r\n      const devModeActive = isDevMode && localStorage.getItem('devModeActive') === 'true';\r\n      if (!devModeActive) {\r\n        return <Login onLogin={handleLogin} />;\r\n      }\r\n    }\r\n\r\n    switch (currentScreen) {\r\n      case 'login':\r\n        return <Login onLogin={handleLogin} />;\r\n      \r\n      case 'dashboard':\r\n        return (\r\n          <>\r\n            <Dashboard\r\n              userEmail={user?.email || ''}\r\n              onCreateEvent={handleCreateEvent}\r\n              onViewEvent={handleViewEvent}\r\n              onLogout={handleLogout}\r\n            />\r\n            <ChatWidget />\r\n          </>\r\n        );\r\n      \r\n      case 'createEvent':\r\n        return (\r\n          <>\r\n            <CreateEvent\r\n              onBack={handleBackToDashboard}\r\n              onCreate={handleEventCreated}\r\n            />\r\n            <ChatWidget />\r\n          </>\r\n        );\r\n      \r\n      case 'eventDetails':\r\n        return (\r\n          <>\r\n            <EventDetails\r\n              eventId={selectedEventId}\r\n              onBack={handleBackToDashboard}\r\n            />\r\n            <ChatWidget />\r\n          </>\r\n        );\r\n      \r\n      default:\r\n        return <Login onLogin={handleLogin} />;\r\n    }\r\n  };\r\n\r\n  return renderScreen();\r\n};\r\n\r\nexport default Index;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\Login.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'devCredentials.email' and 'devCredentials.password'. Either include them or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [devCredentials.email, devCredentials.password, isDevMode]","fix":{"range":[1179,1190],"text":"[devCredentials.email, devCredentials.password, isDevMode]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\pages\\NotFound.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\profiles\\churrasco.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\types\\domain.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\types\\llm.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\types\\tools.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\utils\\idempotency.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\supabase\\functions\\llm-chat\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\emanu\\Documents\\Projetos\\ReUNE LoVcloud\\reune-cloud\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]

============================================================
FILE PATH: .\eslint-summary.json
============================================================
{
  "summary": {
    "totalErrors": 10,
    "totalWarnings": 10,
    "totalFiles": 97,
    "filesWithIssues": 15
  },
  "byFile": [
    {
      "file": "src\\api\\llm\\toolsRouter.ts",
      "errors": 1,
      "warnings": 0,
      "messages": [
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 30,
          "column": 42,
          "message": "Unexpected any. Specify a different type."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\badge.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 29,
          "column": 17,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\button.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 48,
          "column": 18,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\command.tsx",
      "errors": 1,
      "warnings": 0,
      "messages": [
        {
          "rule": "@typescript-eslint/no-empty-object-type",
          "severity": 2,
          "line": 24,
          "column": 11,
          "message": "An interface declaring no members is equivalent to its supertype."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\form.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 129,
          "column": 10,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\navigation-menu.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 111,
          "column": 3,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\sidebar.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 634,
          "column": 3,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\sonner.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 27,
          "column": 19,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\textarea.tsx",
      "errors": 1,
      "warnings": 0,
      "messages": [
        {
          "rule": "@typescript-eslint/no-empty-object-type",
          "severity": 2,
          "line": 5,
          "column": 18,
          "message": "An interface declaring no members is equivalent to its supertype."
        }
      ]
    },
    {
      "file": "src\\components\\ui\\toggle.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-refresh/only-export-components",
          "severity": 1,
          "line": 37,
          "column": 18,
          "message": "Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components."
        }
      ]
    },
    {
      "file": "src\\core\\orchestrator\\chatOrchestrator.ts",
      "errors": 6,
      "warnings": 0,
      "messages": [
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 30,
          "column": 81,
          "message": "Unexpected any. Specify a different type."
        },
        {
          "rule": "no-useless-escape",
          "severity": 2,
          "line": 34,
          "column": 34,
          "message": "Unnecessary escape character: \\-."
        },
        {
          "rule": "no-useless-escape",
          "severity": 2,
          "line": 35,
          "column": 50,
          "message": "Unnecessary escape character: \\-."
        },
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 137,
          "column": 25,
          "message": "Unexpected any. Specify a different type."
        },
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 149,
          "column": 25,
          "message": "Unexpected any. Specify a different type."
        },
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 163,
          "column": 25,
          "message": "Unexpected any. Specify a different type."
        }
      ]
    },
    {
      "file": "src\\hooks\\useEvent.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-hooks/exhaustive-deps",
          "severity": 1,
          "line": 123,
          "column": 6,
          "message": "React Hook useEffect has missing dependencies: 'fetchEvent' and 'fetchOrganizers'. Either include them or remove the dependency array."
        }
      ]
    },
    {
      "file": "src\\pages\\CreateEvent.tsx",
      "errors": 1,
      "warnings": 0,
      "messages": [
        {
          "rule": "@typescript-eslint/no-explicit-any",
          "severity": 2,
          "line": 64,
          "column": 21,
          "message": "Unexpected any. Specify a different type."
        }
      ]
    },
    {
      "file": "src\\pages\\Dashboard.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-hooks/exhaustive-deps",
          "severity": 1,
          "line": 122,
          "column": 6,
          "message": "React Hook useEffect has a missing dependency: 'fetchEvents'. Either include it or remove the dependency array."
        }
      ]
    },
    {
      "file": "src\\pages\\Index.tsx",
      "errors": 0,
      "warnings": 1,
      "messages": [
        {
          "rule": "react-hooks/exhaustive-deps",
          "severity": 1,
          "line": 33,
          "column": 6,
          "message": "React Hook useEffect has a missing dependency: 'isDevMode'. Either include it or remove the dependency array."
        }
      ]
    }
  ],
  "byRule": [
    {
      "rule": "react-refresh/only-export-components",
      "count": 7,
      "errors": 0,
      "warnings": 7
    },
    {
      "rule": "@typescript-eslint/no-explicit-any",
      "count": 6,
      "errors": 6,
      "warnings": 0
    },
    {
      "rule": "react-hooks/exhaustive-deps",
      "count": 3,
      "errors": 0,
      "warnings": 3
    },
    {
      "rule": "@typescript-eslint/no-empty-object-type",
      "count": 2,
      "errors": 2,
      "warnings": 0
    },
    {
      "rule": "no-useless-escape",
      "count": 2,
      "errors": 2,
      "warnings": 0
    }
  ]
}

============================================================
FILE PATH: .\eslint.config.js
============================================================
import js from "@eslint/js";
import globals from "globals";
import reactHooks from "eslint-plugin-react-hooks";
import reactRefresh from "eslint-plugin-react-refresh";
import tseslint from "typescript-eslint";

export default tseslint.config(
  { ignores: ["dist"] },
  {
    extends: [js.configs.recommended, ...tseslint.configs.recommended],
    files: ["**/*.{ts,tsx}"],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
    plugins: {
      "react-hooks": reactHooks,
      "react-refresh": reactRefresh,
    },
    rules: {
      ...reactHooks.configs.recommended.rules,
      "react-refresh/only-export-components": ["warn", { allowConstantExport: true }],
      "@typescript-eslint/no-unused-vars": "off",
    },
  },
);


============================================================
FILE PATH: .\package.json
============================================================
{
  "name": "vite_react_shadcn_ts",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "test": "echo \"No tests configured\"",
    "build:dev": "vite build --mode development",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@hookform/resolvers": "^3.10.0",
    "@radix-ui/react-accordion": "^1.2.11",
    "@radix-ui/react-alert-dialog": "^1.1.14",
    "@radix-ui/react-aspect-ratio": "^1.1.7",
    "@radix-ui/react-avatar": "^1.1.10",
    "@radix-ui/react-checkbox": "^1.3.2",
    "@radix-ui/react-collapsible": "^1.1.11",
    "@radix-ui/react-context-menu": "^2.2.15",
    "@radix-ui/react-dialog": "^1.1.14",
    "@radix-ui/react-dropdown-menu": "^2.1.15",
    "@radix-ui/react-hover-card": "^1.1.14",
    "@radix-ui/react-label": "^2.1.7",
    "@radix-ui/react-menubar": "^1.1.15",
    "@radix-ui/react-navigation-menu": "^1.2.13",
    "@radix-ui/react-popover": "^1.1.14",
    "@radix-ui/react-progress": "^1.1.7",
    "@radix-ui/react-radio-group": "^1.3.7",
    "@radix-ui/react-scroll-area": "^1.2.9",
    "@radix-ui/react-select": "^2.2.5",
    "@radix-ui/react-separator": "^1.1.7",
    "@radix-ui/react-slider": "^1.3.5",
    "@radix-ui/react-slot": "^1.2.3",
    "@radix-ui/react-switch": "^1.2.5",
    "@radix-ui/react-tabs": "^1.1.12",
    "@radix-ui/react-toast": "^1.2.14",
    "@radix-ui/react-toggle": "^1.1.9",
    "@radix-ui/react-toggle-group": "^1.1.10",
    "@radix-ui/react-tooltip": "^1.2.7",
    "@supabase/supabase-js": "^2.58.0",
    "@tanstack/react-query": "^5.83.0",
    "@types/react-helmet": "^6.1.11",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^3.6.0",
    "embla-carousel-react": "^8.6.0",
    "framer-motion": "^12.23.24",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.462.0",
    "next-themes": "^0.3.0",
    "react": "^18.3.1",
    "react-day-picker": "^8.10.1",
    "react-dom": "^18.3.1",
    "react-helmet": "^6.1.0",
    "react-hook-form": "^7.61.1",
    "react-resizable-panels": "^2.1.9",
    "react-router-dom": "^6.30.1",
    "recharts": "^2.15.4",
    "sonner": "^1.7.4",
    "tailwind-merge": "^2.6.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^0.9.9",
    "zod": "^3.25.76"
  },
  "devDependencies": {
    "@eslint/js": "^9.32.0",
    "@tailwindcss/typography": "^0.5.16",
    "@types/node": "^22.16.5",
    "@types/react": "^18.3.23",
    "@types/react-dom": "^18.3.7",
    "@vitejs/plugin-react-swc": "^3.11.0",
    "autoprefixer": "^10.4.21",
    "baseline-browser-mapping": "^2.9.11",
    "eslint": "^9.32.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.20",
    "globals": "^15.15.0",
    "lovable-tagger": "^1.1.9",
    "postcss": "^8.5.6",
    "tailwindcss": "^3.4.17",
    "typescript": "^5.8.3",
    "typescript-eslint": "^8.38.0",
    "vite": "^5.4.19"
  }
}


============================================================
FILE PATH: .\postcss.config.js
============================================================
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};


============================================================
FILE PATH: .\tailwind.config.ts
============================================================
import type { Config } from "tailwindcss";
import animate from "tailwindcss-animate";

export default {
  darkMode: ["class"],
  content: ["./pages/**/*.{ts,tsx}", "./components/**/*.{ts,tsx}", "./app/**/*.{ts,tsx}", "./src/**/*.{ts,tsx}"],
  prefix: "",
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      },
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        sidebar: {
          DEFAULT: "hsl(var(--sidebar-background))",
          foreground: "hsl(var(--sidebar-foreground))",
          primary: "hsl(var(--sidebar-primary))",
          "primary-foreground": "hsl(var(--sidebar-primary-foreground))",
          accent: "hsl(var(--sidebar-accent))",
          "accent-foreground": "hsl(var(--sidebar-accent-foreground))",
          border: "hsl(var(--sidebar-border))",
          ring: "hsl(var(--sidebar-ring))",
        },
        // ReUNE Logo Colors
        orange: {
          DEFAULT: "hsl(var(--orange))",
          light: "hsl(var(--orange-light))",
        },
        gold: {
          DEFAULT: "hsl(var(--gold))",
          light: "hsl(var(--gold-light))",
        },
        teal: {
          DEFAULT: "hsl(var(--teal))",
          light: "hsl(var(--teal-light))",
        },
        cyan: {
          DEFAULT: "hsl(var(--cyan))",
          light: "hsl(var(--cyan-light))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
        xl: "1.5rem",
        "2xl": "2rem",
      },
      boxShadow: {
        'soft': '0 2px 10px -3px hsl(var(--shadow-soft) / 0.15)',
        'floating': 'var(--shadow-floating)',
        'card': 'var(--shadow-card)',
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
        "fade-in": {
          "0%": { opacity: "0", transform: "translateY(10px)" },
          "100%": { opacity: "1", transform: "translateY(0)" },
        },
        "scale-in": {
          "0%": { transform: "scale(0.95)", opacity: "0" },
          "100%": { transform: "scale(1)", opacity: "1" },
        },
        "hover-lift": {
          "0%": { transform: "translateY(0)" },
          "100%": { transform: "translateY(-2px)" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
        "fade-in": "fade-in 0.3s ease-out",
        "scale-in": "scale-in 0.2s ease-out",
        "hover-lift": "hover-lift 0.2s ease-out",
      },
    },
  },
  plugins: [animate],
} satisfies Config;


============================================================
FILE PATH: .\tsconfig.app.json
============================================================
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",

    /* Linting */
    "strict": false,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noImplicitAny": false,
    "noFallthroughCasesInSwitch": false,

    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"]
}


============================================================
FILE PATH: .\tsconfig.json
============================================================
{
  "files": [],
  "references": [{ "path": "./tsconfig.app.json" }, { "path": "./tsconfig.node.json" }],
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "noImplicitAny": false,
    "noUnusedParameters": false,
    "skipLibCheck": true,
    "allowJs": true,
    "noUnusedLocals": false,
    "strictNullChecks": false
  }
}


============================================================
FILE PATH: .\tsconfig.node.json
============================================================
{
  "compilerOptions": {
    "target": "ES2022",
    "lib": ["ES2023"],
    "module": "ESNext",
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "isolatedModules": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": false,
    "noUnusedParameters": false,
    "noFallthroughCasesInSwitch": true
  },
  "include": ["vite.config.ts"]
}


============================================================
FILE PATH: .\vite.config.ts
============================================================
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react-swc";
import path from "path";
import { componentTagger } from "lovable-tagger";

// https://vitejs.dev/config/
export default defineConfig(({ mode }) => ({
  server: {
    host: "::",
    port: 8080,
    proxy: {
      "/api/chat": {
        target: "https://studio--studio-3500643630-eaa37.us-central1.hosted.app",
        changeOrigin: true,
        secure: false,
      },
    },
  },
  plugins: [react(), mode === "development" && componentTagger()].filter(Boolean),
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
}));


============================================================
FILE PATH: .\.claude\settings.local.json
============================================================
{
  "permissions": {
    "allow": [
      "Bash(npm run build:*)",
      "Bash(git checkout:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Bash(npx supabase functions:*)",
      "Bash(npx supabase status)",
      "Bash(npx supabase login)",
      "Bash(git push:*)",
      "Bash(grep:*)",
      "Bash(ls:*)",
      "Bash(npx supabase link:*)",
      "Bash(npm run dev:*)",
      "Bash(npx supabase:*)"
    ],
    "deny": [],
    "ask": []
  }
}


============================================================
FILE PATH: .\scripts\migration\auth_users.json
============================================================
[
  {
    "id": "b1a44897-eeb0-4954-8a7e-92375f009776",
    "email": "dessarag@gmail.com",
    "created_at": "2025-10-24T00:39:06.309Z",
    "email_confirmed_at": "2025-10-24T00:39:06.318Z",
    "last_sign_in_at": "2025-10-28T18:01:28.738Z",
    "raw_user_meta_data": {
      "email": "dessarag@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "b1a44897-eeb0-4954-8a7e-92375f009776"
    }
  },
  {
    "id": "0dce73f1-a3ca-408e-80a6-f84acae109be",
    "email": "fernandomassuncao@hotmail.com",
    "created_at": "2025-10-24T21:27:35.245Z",
    "email_confirmed_at": "2025-10-24T21:27:35.280Z",
    "last_sign_in_at": "2025-10-24T21:27:35.288Z",
    "raw_user_meta_data": {
      "email": "fernandomassuncao@hotmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "0dce73f1-a3ca-408e-80a6-f84acae109be"
    }
  },
  {
    "id": "285d734d-916b-4d4d-9c9c-9e83ac26a19c",
    "email": "andreza.1gn@gmail.com",
    "created_at": "2025-10-24T22:03:20.976Z",
    "email_confirmed_at": "2025-10-24T22:03:21.072Z",
    "last_sign_in_at": "2025-10-24T22:03:21.094Z",
    "raw_user_meta_data": {
      "email": "andreza.1gn@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "285d734d-916b-4d4d-9c9c-9e83ac26a19c"
    }
  },
  {
    "id": "511d4831-6165-413c-abc1-0f4c3dd7fe75",
    "email": "nandadeg@gmail.com",
    "created_at": "2025-10-25T00:47:58.698Z",
    "email_confirmed_at": "2025-10-25T00:47:58.740Z",
    "last_sign_in_at": "2025-10-25T00:47:58.749Z",
    "raw_user_meta_data": {
      "email": "nandadeg@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "511d4831-6165-413c-abc1-0f4c3dd7fe75"
    }
  },
  {
    "id": "10561249-73cb-4307-afa3-db17f464e6e6",
    "email": "emanuel.adm10@gmail.com",
    "created_at": "2025-10-24T00:36:50.702Z",
    "email_confirmed_at": "2025-10-24T00:36:50.733Z",
    "last_sign_in_at": "2025-12-07T02:39:36.534Z",
    "raw_user_meta_data": {
      "email": "emanuel.adm10@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "10561249-73cb-4307-afa3-db17f464e6e6"
    }
  },
  {
    "id": "b306e191-88e4-4f7b-ac78-e55622b07c9b",
    "email": "majucosta94@gmail.com",
    "created_at": "2025-10-24T02:08:05.303Z",
    "email_confirmed_at": "2025-10-24T02:08:05.357Z",
    "last_sign_in_at": "2025-10-24T02:08:05.375Z",
    "raw_user_meta_data": {
      "email": "majucosta94@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "b306e191-88e4-4f7b-ac78-e55622b07c9b"
    }
  },
  {
    "id": "ce679c9e-0b29-4810-8f91-2d122deaaebe",
    "email": "rhenanfa@hotmail.com",
    "created_at": "2025-10-26T15:11:07.216Z",
    "email_confirmed_at": "2025-10-26T15:11:07.325Z",
    "last_sign_in_at": "2025-10-26T15:11:07.349Z",
    "raw_user_meta_data": {
      "email": "rhenanfa@hotmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "ce679c9e-0b29-4810-8f91-2d122deaaebe"
    }
  },
  {
    "id": "ec35e92c-250e-4d26-ba68-43caa19c53b0",
    "email": "teste@reune.com",
    "created_at": "2025-10-06T13:50:26.597Z",
    "email_confirmed_at": "2025-10-06T13:50:26.615Z",
    "last_sign_in_at": "2025-11-04T01:44:35.506Z",
    "raw_user_meta_data": {
      "email": "teste@reune.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "ec35e92c-250e-4d26-ba68-43caa19c53b0"
    }
  },
  {
    "id": "2958cc87-6526-4481-872f-777a6fe2db58",
    "email": "andf.pinheiro@gmail.com",
    "created_at": "2025-10-30T22:51:44.715Z",
    "email_confirmed_at": "2025-10-30T22:51:44.826Z",
    "last_sign_in_at": "2025-10-30T22:51:44.858Z",
    "raw_user_meta_data": {
      "email": "andf.pinheiro@gmail.com",
      "email_verified": true,
      "phone_verified": false,
      "sub": "2958cc87-6526-4481-872f-777a6fe2db58"
    }
  }
]


============================================================
FILE PATH: .\scripts\migration\profiles.json
============================================================
[
  {
    "id": "b1a44897-eeb0-4954-8a7e-92375f009776",
    "display_name": null,
    "username": null,
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": false,
    "founder_since": "2025-10-24T00:39:06.309Z",
    "premium_until": "2026-04-24",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": null,
    "created_at": "2025-10-24T00:39:06.309Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "0dce73f1-a3ca-408e-80a6-f84acae109be",
    "display_name": null,
    "username": null,
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": false,
    "founder_since": "2025-10-24T21:27:35.245Z",
    "premium_until": "2026-04-24",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": null,
    "created_at": "2025-10-24T21:27:35.245Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "285d734d-916b-4d4d-9c9c-9e83ac26a19c",
    "display_name": null,
    "username": null,
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": false,
    "founder_since": "2025-10-24T22:03:20.976Z",
    "premium_until": "2026-04-24",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": null,
    "created_at": "2025-10-24T22:03:20.976Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "511d4831-6165-413c-abc1-0f4c3dd7fe75",
    "display_name": null,
    "username": null,
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": false,
    "founder_since": "2025-10-25T00:47:58.698Z",
    "premium_until": "2026-04-25",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": null,
    "created_at": "2025-10-25T00:47:58.698Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "10561249-73cb-4307-afa3-db17f464e6e6",
    "display_name": "Emanuel de Assis Louzeiro Pinheiro JUnior",
    "username": "emanuel",
    "avatar_url": "https://tfrogqqqmgfgfybesglq.supabase.co/storage/v1/object/public/avatars/10561249-73cb-4307-afa3-db17f464e6e6/0.10010935586798131.png",
    "phone": null,
    "city": null,
    "state": "SP",
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": "Churrasco",
    "is_founder": true,
    "founder_member": true,
    "founder_since": "2025-12-07T13:35:07.348Z",
    "premium_until": "2026-06-07",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": true,
    "terms_accepted_at": "2025-10-25T00:54:13.265Z",
    "created_at": "2025-10-25T00:48:31.794Z",
    "updated_at": "2025-12-07T13:35:07.348Z"
  },
  {
    "id": "b306e191-88e4-4f7b-ac78-e55622b07c9b",
    "display_name": "J\u00falia Costa",
    "username": "julinha",
    "avatar_url": "https://tfrogqqqmgfgfybesglq.supabase.co/storage/v1/object/public/avatars/b306e191-88e4-4f7b-ac78-e55622b07c9b/0.521605595540665.jpeg",
    "phone": "91985788282",
    "city": "Bel\u00e9m",
    "state": "PA",
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": "Confraterniza\u00e7\u00e3o",
    "is_founder": true,
    "founder_member": true,
    "founder_since": "2025-10-25T03:12:13.441Z",
    "premium_until": "2026-04-25",
    "storage_multiplier": 3,
    "accept_notifications": true,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": "2025-10-25T03:16:34.468Z",
    "created_at": "2025-10-25T03:12:13.441Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "ce679c9e-0b29-4810-8f91-2d122deaaebe",
    "display_name": null,
    "username": null,
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": false,
    "founder_since": "2025-10-26T15:11:07.216Z",
    "premium_until": "2026-04-26",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": null,
    "created_at": "2025-10-26T15:11:07.216Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "ec35e92c-250e-4d26-ba68-43caa19c53b0",
    "display_name": "Teste Desenvolvedor",
    "username": "teste",
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": true,
    "founder_since": "2025-10-27T15:51:04.306Z",
    "premium_until": "2026-04-27",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": true,
    "terms_accepted_at": "2025-10-27T15:51:24.093Z",
    "created_at": "2025-10-27T15:51:04.306Z",
    "updated_at": "2025-12-07T15:12:10.846Z"
  },
  {
    "id": "2958cc87-6526-4481-872f-777a6fe2db58",
    "display_name": "Andr\u00e9",
    "username": "pinheiro",
    "avatar_url": null,
    "phone": null,
    "city": null,
    "state": null,
    "country": "Brasil",
    "bio": null,
    "language": "pt-BR",
    "favorite_event_type": null,
    "is_founder": true,
    "founder_member": true,
    "founder_since": "2025-12-07T13:35:07.348Z",
    "premium_until": "2026-06-07",
    "storage_multiplier": 3,
    "accept_notifications": false,
    "allow_search_by_username": true,
    "hide_profile_prompt": false,
    "terms_accepted_at": "2025-10-30T22:54:56.885Z",
    "created_at": "2025-10-30T22:54:26.536Z",
    "updated_at": "2025-12-07T13:35:07.348Z"
  }
]


============================================================
FILE PATH: .\scripts\migration\profiles_payload.json
============================================================
[ERRO AO LER ESTE ARQUIVO: 'utf-8' codec can't decode byte 0xfa in position 2872: invalid start byte]

============================================================
FILE PATH: .\src\App.css
============================================================
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}


============================================================
FILE PATH: .\src\App.tsx
============================================================
import { Toaster } from "@/components/ui/toaster";
import { Toaster as Sonner } from "@/components/ui/sonner";
import { TooltipProvider } from "@/components/ui/tooltip";
import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { BrowserRouter, Routes, Route } from "react-router-dom";
import LandingPage from "./pages/LandingPage";
import Index from "./pages/Index";
import Index2 from "./pages/Index2";
import NotFound from "./pages/NotFound";
import SecretSantaSetup from "./pages/SecretSantaSetup";
import SecretSantaParticipants from "./pages/SecretSantaParticipants";
import SecretSantaResults from "./pages/SecretSantaResults";
import SecretSantaMyResult from "./pages/SecretSantaMyResult";
import SecretSantaWishlist from "./pages/SecretSantaWishlist";
import SecretSantaAdmin from "./pages/SecretSantaAdmin";
import SecretSantaLanding from "./pages/SecretSantaLanding";
import MarketingScreenshots from "./pages/MarketingScreenshots";
import AcceptInvite from "./pages/AcceptInvite";
import ResetPassword from "./pages/ResetPassword";
import { EnableDevMode } from "./components/EnableDevMode";
import AdminDashboard from "./pages/AdminDashboard";
import PrivacyPolicy from "./pages/PrivacyPolicy";
import TermsOfService from "./pages/TermsOfService";

const queryClient = new QueryClient();

const App = () => {

  return (
    <QueryClientProvider client={queryClient}>
      <TooltipProvider>
        <Toaster />
        <Sonner />
        <BrowserRouter>
          <Routes>
            <Route path="/" element={<Index2 />} />
            <Route path="/old-landing" element={<LandingPage />} />
            <Route path="/app" element={<Index />} />
            <Route path="/reset-password" element={<ResetPassword />} />
            <Route path="/convite/:token" element={<AcceptInvite />} />
            <Route path="/admin" element={<AdminDashboard />} />

            {/* Secret Santa Routes */}
            <Route path="/amigo-secreto" element={<SecretSantaLanding />} />
            <Route path="/amigosecreto" element={<SecretSantaLanding />} />
            <Route path="/event/:id/secret-santa/setup" element={<SecretSantaSetup />} />
            <Route path="/event/:id/secret-santa/participants" element={<SecretSantaParticipants />} />
            <Route path="/event/:id/secret-santa/results" element={<SecretSantaResults />} />
            <Route path="/event/:id/secret-santa/my-result" element={<SecretSantaMyResult />} />
            <Route path="/event/:id/secret-santa/wishlist" element={<SecretSantaWishlist />} />
            <Route path="/event/:id/secret-santa/admin" element={<SecretSantaAdmin />} />

            {/* Utility Routes */}
            <Route path="/marketing-screenshots" element={<MarketingScreenshots />} />
            <Route path="/r3un3test4ndo" element={<EnableDevMode />} />

            {/* Legal Pages */}
            <Route path="/privacidade" element={<PrivacyPolicy />} />
            <Route path="/termos" element={<TermsOfService />} />

            <Route path="*" element={<NotFound />} />
          </Routes>
        </BrowserRouter>
      </TooltipProvider>
    </QueryClientProvider>
  );
};

export default App;


============================================================
FILE PATH: .\src\index.css
============================================================
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

@layer base {
  :root {
    /* ReUNE Brand Colors - Logo Palette */
    --background: 0 0% 100%;
    --foreground: 0 0% 20%;

    --card: 0 0% 100%;
    --card-foreground: 0 0% 20%;

    --popover: 0 0% 100%;
    --popover-foreground: 0 0% 20%;

    /* Laranja Vibrante - Energia, CTAs primários */
    --primary: 16 100% 57%;
    --primary-foreground: 0 0% 100%;

    /* Azul Petróleo/Teal - Confiança, base, profissionalismo */
    --secondary: 173 100% 24%;
    --secondary-foreground: 0 0% 100%;

    --muted: 0 0% 96%;
    --muted-foreground: 0 0% 45%;

    /* Azul Claro/Ciano - Modernidade, interatividade secundária */
    --accent: 187 100% 42%;
    --accent-foreground: 0 0% 100%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 0 0% 98%;

    --border: 0 0% 90%;
    --input: 0 0% 90%;
    --ring: 16 100% 57%;

    /* ReUNE Logo Extended Palette */
    --orange: 16 100% 57%;
    --orange-light: 16 100% 95%;
    --gold: 45 100% 51%;
    --gold-light: 45 100% 95%;
    --teal: 173 100% 24%;
    --teal-light: 173 100% 90%;
    --cyan: 187 100% 42%;
    --cyan-light: 187 100% 92%;

    /* Typography & Neutrals */
    --text-primary: 0 0% 20%;
    --text-secondary: 0 0% 45%;

    /* Gradients */
    --gradient-warm: linear-gradient(135deg, hsl(16 100% 57%), hsl(45 100% 51%));
    --gradient-cool: linear-gradient(135deg, hsl(173 100% 24%), hsl(187 100% 42%));

    /* Shadows and effects */
    --shadow-soft: 0 2px 10px -3px hsl(0 0% 0% / 0.1);
    --shadow-floating: 0 10px 30px -12px hsl(16 100% 57% / 0.25);
    --shadow-card: 0 4px 20px -8px hsl(0 0% 0% / 0.15);

    --radius: 1rem;

    --sidebar-background: 173 100% 24%;
    --sidebar-foreground: 0 0% 100%;
    --sidebar-primary: 16 100% 57%;
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 173 80% 30%;
    --sidebar-accent-foreground: 0 0% 100%;
    --sidebar-border: 173 80% 20%;
    --sidebar-ring: 16 100% 57%;
  }

  .dark {
    /* Dark theme base - cores aprimoradas para melhor destaque */
    --background: 230 10% 11%; /* #1A1B20 */
    --foreground: 0 0% 95%; /* #F2F2F2 */

    --card: 230 10% 13%;
    --card-foreground: 0 0% 95%;

    --popover: 230 10% 13%;
    --popover-foreground: 0 0% 95%;

    /* Keep brand accents, rely on foreground for legibility */
    --primary: var(--orange);
    --primary-foreground: 0 0% 100%;

    --secondary: var(--teal);
    --secondary-foreground: 0 0% 100%;

    --muted: 230 10% 16%;
    --muted-foreground: 0 0% 70%; /* #B3B3B3 */

    --accent: var(--cyan);
    --accent-foreground: 0 0% 100%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 0 0% 98%;

    --border: 230 10% 22%;
    --input: 230 10% 18%;
    --ring: var(--primary);

    /* Sidebar uses dark base */
    --sidebar-background: 230 10% 13%;
    --sidebar-foreground: 0 0% 95%;
    --sidebar-primary: var(--primary);
    --sidebar-primary-foreground: 0 0% 100%;
    --sidebar-accent: 230 10% 16%;
    --sidebar-accent-foreground: 0 0% 95%;
    --sidebar-border: 230 10% 16%;
    --sidebar-ring: var(--primary);

    /* Dark palette for logo-light variants (cards) - cores de destaque */
    --orange-light: 13 61% 20%; /* #522114 */
    --gold-light: 51 61% 20%;  /* #524914 */
    --teal-light: 174 61% 20%;  /* #14524C */
    --cyan-light: 186 61% 20%;  /* #144C52 */

    /* Tags no tema escuro */
    --tag-background: 0 0% 88%; /* #E0E0E0 */
    --tag-foreground: 230 10% 11%; /* #1A1B20 */
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
  }
}


============================================================
FILE PATH: .\src\main.tsx
============================================================
import { createRoot } from "react-dom/client";
import App from "./App.tsx";
import "./index.css";

createRoot(document.getElementById("root")!).render(<App />);


============================================================
FILE PATH: .\src\vite-env.d.ts
============================================================
/// <reference types="vite/client" />


============================================================
FILE PATH: .\src\api\rpc.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import type { Item, Participant, DistributionRow, Event } from '@/types/domain';

type Opts = { signal?: AbortSignal; idempotencyKey?: string };

async function participants_bulk_upsert(
  evento_id: string,
  participantes: Participant[],
  opts?: Opts,
): Promise<Participant[]> {
  const eventoId = String(evento_id);
  console.debug('[RPC] participants_bulk_upsert', { evento_id: eventoId, count: participantes.length });
  const { data, error } = await supabase.rpc('participants_bulk_upsert', {
    evento_id: eventoId,
    participantes: participantes as any // SDK serializa para JSONB
  });
  if (error) {
    console.error('[RPC] Erro em participants_bulk_upsert:', error);
    throw new Error(`Erro ao chamar participants_bulk_upsert: ${error.message}`);
  }
  return data as unknown as Participant[];
}

async function items_replace_for_event(evento_id: string, itens: Item[], opts?: Opts): Promise<Item[]> {
  const eventoId = String(evento_id);
  console.debug('[RPC] items_replace_for_event', { evento_id: eventoId, count: itens.length });

  // Validação preventiva: garantir que itens é array
  if (!Array.isArray(itens)) {
    throw new Error(`items_replace_for_event: payload não é array (recebido: ${typeof itens})`);
  }

  const { data, error } = await supabase.rpc('items_replace_for_event', {
    evento_id: eventoId,
    itens: itens as any // SDK serializa para JSONB
  });
  if (error) {
    console.error('[RPC] Erro em items_replace_for_event:', error);
    throw new Error(`Erro ao chamar items_replace_for_event: ${error.message}`);
  }
  return data as unknown as Item[];
}

async function distribution_bulk_upsert(
  evento_id: string,
  rows: DistributionRow[],
  opts?: Opts,
): Promise<DistributionRow[]> {
  const eventoId = String(evento_id);
  console.debug('[RPC] distribution_bulk_upsert', { evento_id: eventoId, count: rows.length });
  const { data, error } = await supabase.rpc('distribution_bulk_upsert', {
    evento_id: eventoId,
    rows: rows as any // SDK serializa para JSONB
  });
  if (error) {
    console.error('[RPC] Erro em distribution_bulk_upsert:', error);
    throw new Error(`Erro ao chamar distribution_bulk_upsert: ${error.message}`);
  }
  return data as unknown as DistributionRow[];
}

async function get_event_plan(evento_id: string, opts?: Opts): Promise<{
  evento: Event;
  itens: Item[];
  participantes: Participant[];
  distribuicao: DistributionRow[];
}> {
  const eventoId = String(evento_id);
  console.debug('[RPC] get_event_plan', { evento_id: eventoId });
  const { data, error } = await supabase.rpc('get_event_plan', { evento_id: eventoId });
  if (error) {
    console.error('[RPC] Erro em get_event_plan:', error);
    throw new Error(`Erro ao chamar get_event_plan: ${error.message}`);
  }
  return data as unknown as {
    evento: Event;
    itens: Item[];
    participantes: Participant[];
    distribuicao: DistributionRow[];
  };
}

async function get_distribution_summary(evento_id: string, opts?: Opts): Promise<{
  porParticipante: { participante_id: string; total: number }[];
  custoTotal: number;
}> {
  const eventoId = String(evento_id);
  console.debug('[RPC] get_distribution_summary', { evento_id: eventoId });
  const { data, error } = await supabase.rpc('get_distribution_summary', { evento_id: eventoId });
  if (error) {
    console.error('[RPC] Erro em get_distribution_summary:', error);
    throw new Error(`Erro ao chamar get_distribution_summary: ${error.message}`);
  }
  return data as unknown as {
    porParticipante: { participante_id: string; total: number }[];
    custoTotal: number;
  };
}

async function get_holiday_date_by_name(search_term: string): Promise<{ date: string; name: string } | null> {
  const { data, error } = await supabase.rpc('get_holiday_date_by_name', { search_term });

  if (error) {
    console.error('[RPC] Erro em get_holiday_date_by_name:', error);
    return null; // Falha silenciosa ou retorno nulo
  }

  if (data && Array.isArray(data) && data.length > 0) {
    return data[0] as { date: string; name: string };
  }

  return null;
}

export const rpc = {
  participants_bulk_upsert,
  items_replace_for_event,
  distribution_bulk_upsert,
  get_event_plan,
  get_distribution_summary,
  get_holiday_date_by_name,
};


============================================================
FILE PATH: .\src\api\llm\chat.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { LlmMessage, LlmChatResponse } from '@/types/llm';

/**
 * Chama a edge function de chat da LLM para obter sugestões.
 *
 * @param systemPrompt O prompt do sistema para guiar a LLM.
 * @param messages O histórico de mensagens da conversa.
 * @param temperature A temperatura para a geração da resposta.
 * @returns A resposta da LLM.
 */
export async function getLlmSuggestions(
  systemPrompt: string,
  messages: LlmMessage[],
  temperature = 0.3,
  idempotencyKeyPayload?: Record<string, any>
): Promise<LlmChatResponse | null> {
  console.log('[LLM] Iniciando getLlmSuggestions', { systemPrompt, messagesCount: messages.length, temperature });
  
  try {
    console.log('[LLM] Chamando edge function llm-chat');
    
    const { data, error } = await supabase.functions.invoke('llm-chat', {
      body: {
        systemPrompt,
        messages,
        temperature,
      },
    });

    if (error) {
      console.error('[LLM] Erro na edge function:', error);
      return null;
    }

    console.log('[LLM] Resposta recebida:', data);
    return data as LlmChatResponse;
  } catch (error) {
    console.error('[LLM] Erro ao chamar a função de chat da LLM:', error);
    if (error instanceof Error) {
      console.error('[LLM] Mensagem de erro:', error.message);
      console.error('[LLM] Stack trace:', error.stack);
    }
    return null;
  }
}

============================================================
FILE PATH: .\src\api\llm\middleware.ts
============================================================
type CacheEntry = { content: string; toolCalls?: Array<{ name: string; arguments: Record<string, unknown> | unknown[] }>; ts: number };

const cache = new Map<string, CacheEntry>();
const rateWindowMs = 60_000;
const rateLimitPerUser = 10;
const userHits = new Map<string, number[]>();

export function maskPII(text: string): string {
  // Simples: remove e-mails e telefones
  return text
    .replace(/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/gi, '[email]')
    .replace(/\b\+?\d{2,3}[\s-]?\d{3,5}[\s-]?\d{4,6}\b/g, '[phone]');
}

export function checkRateLimit(userId: string): { ok: boolean } {
  const now = Date.now();
  const arr = userHits.get(userId) || [];
  const recent = arr.filter((t) => now - t < rateWindowMs);
  recent.push(now);
  userHits.set(userId, recent);
  return { ok: recent.length <= rateLimitPerUser };
}

export function getIdempotent(key?: string): CacheEntry | undefined {
  if (!key) return undefined;
  const ent = cache.get(key);
  if (!ent) return undefined;
  if (Date.now() - ent.ts > 60_000) {
    cache.delete(key);
    return undefined;
  }
  return ent;
}

export function setIdempotent(key: string, value: CacheEntry) {
  cache.set(key, { ...value, ts: Date.now() });
}

============================================================
FILE PATH: .\src\api\llm\plannerSchemas.ts
============================================================
import { z } from 'zod';

const intentEnum = z.enum([
  'create_event',
  'update_event',
  'generate_items',
  'confirm_event',
  'small_talk',
  'unknown',
]);

const numericId = z.string().regex(/^\d+$/, 'evento_id deve ser numerico');

const baseEnvelope = z.object({
  intent: intentEnum,
  payload: z.record(z.any()).default({}),
  confidence: z.coerce.number().min(0).max(1).default(0),
}).passthrough();

const eventPayload = z.object({
  tipo_evento: z.string().min(1).optional(),
  categoria_evento: z.string().optional(),
  subtipo_evento: z.string().optional(),
  qtd_pessoas: z.coerce.number().int().positive().optional(),
  data_evento: z.string().optional(),
  menu: z.string().optional(),
  finalidade_evento: z.string().optional(),
  evento_id: numericId.optional(),
}).passthrough();

const createEventEnvelope = baseEnvelope.extend({
  intent: z.literal('create_event'),
  payload: eventPayload,
});

const generateItemsEnvelope = baseEnvelope.extend({
  intent: z.literal('generate_items'),
  payload: eventPayload,
});

const updateEventEnvelope = baseEnvelope.extend({
  intent: z.literal('update_event'),
  payload: eventPayload,
});

const confirmEventEnvelope = baseEnvelope.extend({
  intent: z.literal('confirm_event'),
  payload: eventPayload,
});

const smallTalkEnvelope = baseEnvelope.extend({
  intent: z.literal('small_talk'),
});

const unknownEnvelope = baseEnvelope.extend({
  intent: z.literal('unknown'),
});

export const plannerEnvelopeSchema = z.union([
  createEventEnvelope,
  generateItemsEnvelope,
  updateEventEnvelope,
  confirmEventEnvelope,
  smallTalkEnvelope,
  unknownEnvelope,
  baseEnvelope,
]);

export type PlannerEnvelope = z.infer<typeof plannerEnvelopeSchema>;


============================================================
FILE PATH: .\src\api\llm\schemas.ts
============================================================
import { z } from 'zod';

// Schemas Zod para validação de payloads das ferramentas
export const uuidStr = z.string().min(1);

export const generateItemListSchema = z.object({
  evento_id: uuidStr,
  tipo_evento: z.enum(['churrasco', 'piquenique', 'jantar']),
  qtd_pessoas: z.number().int().min(1),
  preferencias: z.record(z.any()).optional(),
});

// Alinhar ao domínio Item: todos os campos obrigatórios
const itemSchema = z.object({
  id: z.string().optional(),
  evento_id: z.string().optional(),
  nome_item: z.string().min(1),
  quantidade: z.number().min(0),
  unidade: z.string().min(1),
  valor_estimado: z.number().min(0),
  categoria: z.string().min(1),
  prioridade: z.enum(['A', 'B', 'C']),
});

export const confirmItemsSchema = z.object({
  evento_id: uuidStr,
  itens_editados: z.array(itemSchema),
});

export const computeCostSplitSchema = z.object({
  evento_id: uuidStr,
});

// Alinhar ao domínio Participant
const participantSchema = z.object({
  id: z.string().optional(),
  nome_participante: z.string().min(1),
  contato: z.string().optional().nullable(),
  status_convite: z.enum(['pendente', 'confirmado', 'recusado']).default('pendente'),
  preferencias: z.record(z.any()).optional().nullable(),
  valor_responsavel: z.number().optional().nullable(),
});

export const addParticipantsSchema = z.object({
  evento_id: uuidStr,
  participantes: z.array(participantSchema),
});

export const getPlanSchema = z.object({
  evento_id: uuidStr,
});

export const toolSchemas = {
  generateItemList: generateItemListSchema,
  confirmItems: confirmItemsSchema,
  computeCostSplit: computeCostSplitSchema,
  addParticipants: addParticipantsSchema,
  getPlan: getPlanSchema,
} as const;

export type ToolSchemaName = keyof typeof toolSchemas;

export function validateToolParams<T extends ToolSchemaName>(name: T, args: unknown) {
  const schema = toolSchemas[name];
  const parsed = schema.safeParse(args);
  if (!parsed.success) {
    const msg = parsed.error.issues.map((i) => `${i.path.join('.')}: ${i.message}`).join('; ');
    return { ok: false as const, error: msg };
  }
  return { ok: true as const, data: parsed.data };
}

============================================================
FILE PATH: .\src\api\llm\toolsRouter.ts
============================================================
import { validateToolParams } from './schemas';
import type { ToolSchemaName } from './schemas';
import type { ToolCall } from '@/types/tools';
import { churrascoProfile } from '@/profiles/churrasco';
import { estimateQuantityPerPerson, computeCostSplit } from '@/core/calc';
import { rpc } from '@/api/rpc';
import type { Item, Participant } from '@/types/domain';

type RunResult = { ok: boolean; data?: unknown; error?: string };

function ensureOwner(userId: string, ownerId: string): boolean {
  return String(userId) === String(ownerId);
}

export async function runToolCall(userId: string, call: ToolCall): Promise<RunResult> {
  const started = performance.now();
  const name = call?.name as ToolSchemaName;
  const args = call?.arguments ?? {};
  const idempotencyKey: string | undefined = typeof (args as Record<string, unknown>)?.idempotencyKey === 'string'
    ? (args as Record<string, unknown>).idempotencyKey as string
    : undefined;

  try {
    // Validar parâmetros com Zod
    const v = validateToolParams(name, args as unknown);
    if (!v.ok) {
      const duration_ms = Math.round(performance.now() - started);
      console.debug('[toolsRouter] invalid_params', { tool: name, duration_ms, error: v.error });
      return { ok: false, error: `invalid_params: ${v.error}` };
    }

    // ACL: conferir que userId é dono do evento
    const evento_id = (v.data as { evento_id: string }).evento_id;
    const plan = await rpc.get_event_plan(evento_id).catch((e) => {
      const msg = e instanceof Error ? e.message : String(e);
      return Promise.reject(new Error(msg.includes('42501') ? '403_not_authorized' : msg));
    });
    if (!ensureOwner(userId, plan.evento.usuario_id)) {
      const duration_ms = Math.round(performance.now() - started);
      console.debug('[toolsRouter] acl_forbidden', { tool: name, evento_id, duration_ms });
      return { ok: false, error: 'forbidden' };
    }

    // Mapear tool → handler
    switch (name) {
      case 'generateItemList': {
        const { tipo_evento, qtd_pessoas } = v.data as { tipo_evento: string; qtd_pessoas: number };
        const people = qtd_pessoas || plan.evento.qtd_pessoas;

        // Gerar itens a partir do perfil (churrasco como default)
        const base = churrascoProfile.estimate(people);
        const generated: Array<Partial<Item>> = base.map((s) => ({
          nome_item: s.nome_item,
          quantidade: s.quantidade,
          unidade: s.unidade,
          valor_estimado: s.valor_estimado ?? 0,
          categoria: s.categoria || 'geral',
          prioridade: s.prioridade || 'B',
        }));

        const persisted = await rpc.items_replace_for_event(evento_id, generated as unknown as Item[], { idempotencyKey });
        const finalPlan = await rpc.get_event_plan(evento_id);
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] ok generateItemList', { evento_id, count: persisted.length, duration_ms });
        return { ok: true, data: { plan: finalPlan } };
      }

      case 'confirmItems': {
        const { itens_editados } = v.data as { itens_editados?: Array<Partial<Item>> };
        if (!Array.isArray(itens_editados) || itens_editados.length === 0) {
          const duration_ms = Math.round(performance.now() - started);
          console.debug('[toolsRouter] invalid confirmItems empty', { evento_id, duration_ms });
          return { ok: false, error: 'invalid_itens_editados' };
        }
        const persisted = await rpc.items_replace_for_event(evento_id, itens_editados as unknown as Item[], { idempotencyKey });
        const finalPlan = await rpc.get_event_plan(evento_id);
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] ok confirmItems', { evento_id, count: persisted.length, duration_ms });
        return { ok: true, data: { plan: finalPlan } };
      }

      case 'computeCostSplit': {
        // Obter plan, calcular rateio e persistir
        const rows = computeCostSplit(plan.itens, plan.participantes);
        const persisted = await rpc.distribution_bulk_upsert(evento_id, rows, { idempotencyKey });
        const summary = await rpc.get_distribution_summary(evento_id);
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] ok computeCostSplit', { evento_id, rows: persisted.length, duration_ms });
        return { ok: true, data: { summary } };
      }

      case 'addParticipants': {
        const { participantes } = v.data as { participantes: Array<Partial<Participant>> };
        const normalized: Participant[] = (participantes || []).map((p) => ({
          id: (p as Record<string, unknown>).id as string | undefined,
          evento_id: evento_id,
          nome_participante: String((p as Record<string, unknown>).nome_participante ?? ''),
          contato: ((p as Record<string, unknown>).contato as string | null | undefined) ?? null,
          status_convite: ((p as Record<string, unknown>).status_convite as 'pendente' | 'confirmado' | 'recusado' | undefined) ?? 'pendente',
          preferencias: ((p as Record<string, unknown>).preferencias as Record<string, unknown> | null | undefined) ?? null,
          valor_responsavel: ((p as Record<string, unknown>).valor_responsavel as number | null | undefined) ?? null,
        })) as unknown as Participant[];
        const persisted = await rpc.participants_bulk_upsert(evento_id, normalized, { idempotencyKey });
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] ok addParticipants', { evento_id, count: persisted.length, duration_ms });
        return { ok: true, data: { participantes: persisted } };
      }

      case 'getPlan': {
        const plan2 = await rpc.get_event_plan(evento_id);
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] ok getPlan', { evento_id, duration_ms });
        return { ok: true, data: { plan: plan2 } };
      }

      default: {
        const duration_ms = Math.round(performance.now() - started);
        console.debug('[toolsRouter] unknown_tool', { tool: name, duration_ms });
        return { ok: false, error: 'unknown_tool' };
      }
    }
  } catch (e) {
    const duration_ms = Math.round(performance.now() - started);
    const msg = e instanceof Error ? e.message : String(e);
    const error = /403_not_authorized|forbidden/i.test(msg) ? 'forbidden' : msg;
    console.debug('[toolsRouter] error', { tool: name, error, duration_ms });
    return { ok: false, error };
  }
}

============================================================
FILE PATH: .\src\components\AccountDialog.tsx
============================================================
import { useState } from 'react';
import { User, MapPin, Shield } from 'lucide-react';
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Card, CardContent } from '@/components/ui/card';
import { ProfileForm } from './profile/ProfileForm';
import { AddressList } from './profile/AddressList';

interface AccountDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  userName?: string;
  userEmail: string;
}

export function AccountDialog({ open, onOpenChange, userName, userEmail }: AccountDialogProps) {
  const [activeTab, setActiveTab] = useState('profile');

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-3xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle className="text-2xl font-bold text-foreground">Minha Conta</DialogTitle>
        </DialogHeader>

        {/* Abas de navegação */}
        <Tabs value={activeTab} onValueChange={setActiveTab} className="w-full">
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="profile" className="flex items-center gap-2">
              <User className="w-4 h-4" />
              <span className="hidden sm:inline">Perfil</span>
            </TabsTrigger>
            <TabsTrigger value="addresses" className="flex items-center gap-2">
              <MapPin className="w-4 h-4" />
              <span className="hidden sm:inline">Endereços</span>
            </TabsTrigger>
            <TabsTrigger value="security" className="flex items-center gap-2">
              <Shield className="w-4 h-4" />
              <span className="hidden sm:inline">Segurança</span>
            </TabsTrigger>
          </TabsList>

          {/* Conteúdo: Perfil */}
          <TabsContent value="profile" className="mt-6">
            <ProfileForm />
          </TabsContent>

          {/* Conteúdo: Endereços */}
          <TabsContent value="addresses" className="mt-6">
            <AddressList />
          </TabsContent>

          {/* Conteúdo: Segurança */}
          <TabsContent value="security" className="mt-6">
            <Card>
              <CardContent className="pt-6">
                <p className="text-sm text-muted-foreground">
                  As configurações de segurança, incluindo alteração de senha, estão disponíveis na aba "Perfil".
                </p>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </DialogContent>
    </Dialog>
  );
}


============================================================
FILE PATH: .\src\components\BugReportButton.tsx
============================================================
import { useState } from 'react';
import { Button } from '@/components/ui/button';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
import { Textarea } from '@/components/ui/textarea';
import { Label } from '@/components/ui/label';
import { Input } from '@/components/ui/input';
import { Bug, Sparkles, Send } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from '@/hooks/useAuth';
import { Badge } from '@/components/ui/badge';

export function BugReportButton() {
  const [open, setOpen] = useState(false);
  const [title, setTitle] = useState('');
  const [description, setDescription] = useState('');
  const [loading, setLoading] = useState(false);
  const { toast } = useToast();
  const { user } = useAuth();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!user) {
      toast({
        title: "Erro",
        description: "Você precisa estar logado para reportar bugs.",
        variant: "destructive",
      });
      return;
    }

    if (!title.trim() || !description.trim()) {
      toast({
        title: "Campos obrigatórios",
        description: "Preencha o título e a descrição do bug.",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);

    try {
      // Save bug report to database
      const { error } = await supabase
        .from('bug_reports')
        .insert({
          user_id: user.id,
          title: title.trim(),
          description: description.trim(),
          status: 'pending',
          user_agent: navigator.userAgent,
          url: window.location.href,
        });

      if (error) throw error;

      toast({
        title: "Bug reportado com sucesso! 🎉",
        description: "Obrigado por nos ajudar a melhorar! Você receberá um bônus em breve.",
      });

      // Reset form and close dialog
      setTitle('');
      setDescription('');
      setOpen(false);
    } catch (error) {
      console.error('Error submitting bug report:', error);
      toast({
        title: "Erro ao reportar bug",
        description: "Não foi possível enviar o reporte. Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button
          size="lg"
          className="fixed bottom-6 left-6 z-50 h-14 px-6 shadow-2xl hover:scale-105 transition-all duration-300 bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 group"
        >
          <Bug className="w-5 h-5 mr-2 group-hover:rotate-12 transition-transform" />
          Reportar Bug
          <Badge variant="secondary" className="ml-2 bg-white/20 text-white border-0">
            <Sparkles className="w-3 h-3 mr-1" />
            Bônus
          </Badge>
        </Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-[500px]">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Bug className="w-5 h-5 text-primary" />
            Reportar Bug
          </DialogTitle>
          <DialogDescription>
            Encontrou algo estranho? Nos ajude a melhorar! Você receberá um bônus por cada bug válido reportado.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={handleSubmit} className="space-y-4 mt-4">
          <div>
            <Label htmlFor="bug-title">Título do Bug</Label>
            <Input
              id="bug-title"
              placeholder="Ex: Botão de criar evento não funciona"
              value={title}
              onChange={(e) => setTitle(e.target.value)}
              disabled={loading}
              maxLength={100}
            />
          </div>

          <div>
            <Label htmlFor="bug-description">Descrição Detalhada</Label>
            <Textarea
              id="bug-description"
              placeholder="Descreva o que aconteceu, o que você esperava que acontecesse, e os passos para reproduzir o problema..."
              value={description}
              onChange={(e) => setDescription(e.target.value)}
              disabled={loading}
              rows={6}
              maxLength={1000}
            />
            <p className="text-xs text-muted-foreground mt-1">
              {description.length}/1000 caracteres
            </p>
          </div>

          <div className="flex gap-3">
            <Button
              type="button"
              variant="outline"
              onClick={() => setOpen(false)}
              disabled={loading}
              className="flex-1"
            >
              Cancelar
            </Button>
            <Button
              type="submit"
              disabled={loading || !title.trim() || !description.trim()}
              className="flex-1"
            >
              {loading ? (
                'Enviando...'
              ) : (
                <>
                  <Send className="w-4 h-4 mr-2" />
                  Enviar Reporte
                </>
              )}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}


============================================================
FILE PATH: .\src\components\ChatWidget.tsx
============================================================
﻿import { useEffect, useMemo, useRef, useState } from 'react';
import { Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription } from '@/components/ui/sheet';
import { Button } from '@/components/ui/button';
import { Send, Minus, RotateCcw, Sparkles, Calendar } from 'lucide-react';
import { useAuth } from '@/hooks/useAuth';
import { Input } from '@/components/ui/input';
import { ScrollArea } from '@/components/ui/scroll-area';
import aiChatIcon from '@/assets/ai-chat-icon.png';
import { ContextManager } from '@/core/orchestrator/contextManager';
// 🔥 NOVO: Usando orquestrador simplificado com Groq
import { simpleOrchestrate } from '@/core/orchestrator/simpleOrchestrator';
// 🔄 Para voltar ao orquestrador antigo, descomente a linha abaixo e comente a linha acima:
// import { orchestrate } from '@/core/orchestrator/chatOrchestrator';
import { UUID } from '@/types/domain';
import { useToast } from '@/components/ui/use-toast';
import { EventsRepository, RecentEvent } from '@/db/repositories/events';
import { ConversationMessagesRepository } from '@/db/repositories/conversationMessages';

type ChatMessage = {
  role: 'user' | 'assistant';
  content: string;
  suggestedReplies?: string[];
  items?: Array<{
    nome_item: string;
    quantidade: number;
    unidade: string;
    valor_estimado: number;
    categoria: string;
  }>;
};



const SESSION_TIMEOUT_MS = 60 * 60 * 1000; // 1 hora de inatividade

export default function ChatWidget() {
  const { user, loading } = useAuth();
  const { toast } = useToast();
  const [open, setOpen] = useState(false);
  const [messages, setMessages] = useState<ChatMessage[]>([]);
  const [input, setInput] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const [eventoId, setEventoId] = useState<number | undefined>(undefined);
  const [hasGreeted, setHasGreeted] = useState(false);
  const [isLoadingHistory, setIsLoadingHistory] = useState(false);
  const [wasMinimized, setWasMinimized] = useState(false);
  
  // 🔥 NOVOS: Estados para Onboarding
  const [showOnboarding, setShowOnboarding] = useState(true);
  const [recentEvents, setRecentEvents] = useState<RecentEvent[]>([]);
  const [isLoadingEvents, setIsLoadingEvents] = useState(false);

  const scrollAreaRef = useRef<HTMLDivElement>(null);
  const endRef = useRef<HTMLDivElement>(null);
  const hasLoadedHistory = useRef(false);

  const contextManager = useMemo(() => new ContextManager(), []);
  const eventsRepository = useMemo(() => new EventsRepository(), []);
  const messagesRepository = useMemo(() => new ConversationMessagesRepository(), []);

  // 🔥 NOVA FUNÇÃO: Carregar eventos recentes para onboarding
  const loadRecentEvents = async () => {
    if (!user?.id) return;
    setIsLoadingEvents(true);
    try {
      const events = await eventsRepository.getRecentOpenEvents(user.id, 3);
      setRecentEvents(events);
    } catch (error) {
      console.error('[ChatWidget] Erro ao carregar eventos recentes:', error);
    } finally {
      setIsLoadingEvents(false);
    }
  };

  // 🔥 NOVA FUNÇÃO: Criar Novo Evento
  const handleCreateNewEvent = async () => {
    if (!user?.id) return;
    
    // Limpar contexto do banco
    await contextManager.clearUserContext(user.id);
    
    // Limpar estado local completo
    setEventoId(undefined);
    setMessages([]); // 🔥 Limpa histórico visual para tela limpa
    setHasGreeted(false);
    setShowOnboarding(false);
    setWasMinimized(false);
    hasLoadedHistory.current = false;
    
    // Carregar eventos para onboarding (caso queira editar depois)
    await loadRecentEvents();
  };

  // 🔥 NOVA FUNÇÃO: Editar Evento Existente
  const handleEditEvent = async (event: RecentEvent) => {
    if (!user?.id) return;
    
    // Setar o evento ID
    setEventoId(event.id);
    setShowOnboarding(false);
    
    // Carregar histórico de mensagens daquele evento
    try {
      const eventMessages = await messagesRepository.getByEventId(event.id);
      if (eventMessages.length > 0) {
        const formattedMessages: ChatMessage[] = eventMessages.map(msg => ({
          role: msg.role as 'user' | 'assistant',
          content: msg.content,
        }));
        setMessages(formattedMessages);
        setHasGreeted(true);
      } else {
        // Se não há histórico, mostrar saudação
        setMessages([{
          role: 'assistant',
          content: `Vou ajudar você a editar o evento "${event.title}". O que você gostaria de modificar?`
        }]);
        setHasGreeted(true);
      }
      
      // Atualizar contexto no banco com aquele evento_id
      await contextManager.updateContext(
        user.id,
        'collecting_core',
        {},
        [],
        0.5,
        undefined,
        event.id,
        undefined
      );
    } catch (error) {
      console.error('[ChatWidget] Erro ao carregar histórico do evento:', error);
      toast({
        title: "Erro ao carregar evento",
        description: "Não foi possível carregar o histórico deste evento.",
        variant: "destructive"
      });
    }
  };

  // 🔥 NOVA FUNÇÃO: Reset completo do chat
  const resetEverything = async () => {
    if (!user?.id) return;

    try {
      // Limpar contexto no backend
      await contextManager.clearUserContext(user.id);

      // Limpar estado local
      setEventoId(undefined);
      setMessages([]);
      setHasGreeted(false);
      setShowOnboarding(true);
      setWasMinimized(false);
      hasLoadedHistory.current = false;
    } catch (error) {
      console.error('[ChatWidget] Error during reset:', error);
      // Mesmo com erro, garantir estado limpo localmente
      setEventoId(undefined);
      setMessages([]);
      setHasGreeted(false);
      setShowOnboarding(true);
      setWasMinimized(false);
      hasLoadedHistory.current = false;
    }
  };

  // 🔥 MODIFICADO: Load history com validação de estado idle
  useEffect(() => {
    async function loadHistoryAndContext() {
      if (!open || !user?.id || hasLoadedHistory.current) return;

      setIsLoadingHistory(true);
      hasLoadedHistory.current = true;

      try {
        const { history, context } = await contextManager.loadUserContext(user.id);

        // 🔥 PATCH 1: Detectar se deve começar do zero
        const lastChatTime = localStorage.getItem(`reune_last_chat_${user.id}`);
        const isTimeout = lastChatTime ? (Date.now() - Number(lastChatTime) > SESSION_TIMEOUT_MS) : false;

        const isFinishedEvent = ['finalizado', 'criado', 'criado_sem_data'].includes(context.state || '');

        const shouldReset =
          (context.state === 'idle' && context.historyLength === 0 && !wasMinimized) ||
          isTimeout ||
          isFinishedEvent;

        if (shouldReset) {
          await resetEverything();
          setIsLoadingHistory(false);
          return;
        }

        // 🔥 PATCH 2: Só restaurar eventId se houver histórico OU estava minimizado
        if (context.evento_id && (context.historyLength > 0 || wasMinimized)) {
          setEventoId(Number(context.evento_id));
        } else if (context.evento_id) {
          // Ignorar evento_id sem histórico
        }

        // Restaurar histórico se existir
        if (history && history.length > 0) {
          const formattedMessages: ChatMessage[] = history.map(msg => ({
            role: msg.role as 'user' | 'assistant',
            content: msg.content,
          }));
          setMessages(formattedMessages);
          setShowOnboarding(false);
        } else if (!hasGreeted) {
          // Se não tem histórico, mostrar onboarding
          setShowOnboarding(true);
          await loadRecentEvents();
        }
      } catch (err) {
        console.error('[ChatWidget] Error loading context:', err);
        if (!hasGreeted) {
          setShowOnboarding(true);
          await loadRecentEvents();
        }
      } finally {
        setIsLoadingHistory(false);
      }
    }

    loadHistoryAndContext();
  }, [open, user?.id, contextManager, hasGreeted, wasMinimized]);

  // Auto-scroll to bottom
  useEffect(() => {
    if (endRef.current) {
      endRef.current.scrollIntoView({ behavior: 'smooth' });
    }
  }, [messages, open, isTyping]);

  async function sendMessage(text: string) {
    if (!user?.id || !text.trim() || isLoading) return;

    console.log('[ChatWidget] sendMessage', {
      userId: user.id,
      eventoId,
      text,
    });

    setIsLoading(true);
    setIsTyping(true);

    // Optimistic update
    setMessages(prev => [...prev, { role: 'user', content: text }]);
    setInput('');

    // Atualizar timestamp de atividade
    localStorage.setItem(`reune_last_chat_${user.id}`, Date.now().toString());

    try {
      const response = await simpleOrchestrate(
        text,
        user.id as UUID,
        eventoId as UUID | undefined
      );
      console.log('[ChatWidget] orchestrator response', {
        eventoId: response.evento_id,
        estado: response.estado,
        closeChat: response.closeChat,
        showItems: response.showItems,
        suggestedReplies: response.suggestedReplies,
      });

      // Update event ID if changed
      if (response.evento_id) {
        const newId = Number(response.evento_id);
        if (newId !== eventoId) {
          setEventoId(newId);
        }
      }

      // Extract items if available
      let items: ChatMessage['items'] = undefined;
      if (response.showItems && response.snapshot?.itens) {
        items = response.snapshot.itens.map((item: any) => ({
          nome_item: item.nome_item,
          quantidade: item.quantidade,
          unidade: item.unidade,
          valor_estimado: item.valor_estimado,
          categoria: item.categoria
        }));
      }

      const assistantMessage: ChatMessage = {
        role: 'assistant',
        content: response.mensagem,
        suggestedReplies: response.suggestedReplies,
        items: items
      };

      setIsTyping(false);
      setMessages(prev => [...prev, assistantMessage]);

      // 🔥 PATCH 3: Integração com closeChat do backend
      if (response.closeChat) {
        setTimeout(async () => {
          await handleClose();
          toast({
            title: response.toast || "Evento criado com sucesso!",
            description: "Atualizando dashboard...",
          });

          setTimeout(() => {
            window.location.reload();
          }, 1000);
        }, 1500);
      }

    } catch (error: any) {
      console.error('[ChatWidget] Error processing message:', error);
      setIsTyping(false);

      let errorMessage = 'Algo deu errado.';
      if (error.message) {
        errorMessage = error.message;
      }

      setMessages(prev => [
        ...prev,
        {
          role: 'assistant',
          content: `❌ ${errorMessage}`
        }
      ]);
    } finally {
      setIsLoading(false);
    }
  }

  function handleSuggestedReply(text: string) {
    console.log('[ChatWidget] suggested reply clicked', { text });
    sendMessage(text);
  }

  // 🔥 MODIFICADO: handleClose agora usa resetEverything
  const handleClose = async () => {
    if (!user?.id) return;

    setOpen(false);
    setWasMinimized(false);
    await resetEverything();
  };

  // 🔥 NOVO: handleMinimize - apenas fecha visualmente, mantém contexto
  const handleMinimize = () => {
    setOpen(false);
    setWasMinimized(true);
  };

  if (!user && !loading) return null;

  return (
    <>
      {/* Floating Button */}
      <div className="fixed bottom-6 right-6 z-50">
        <Button
          variant="ghost"
          size="lg"
          onClick={() => {
            setOpen(true);
          }}
          aria-label="Abrir chat"
          className="rounded-full p-0 w-16 h-16 overflow-hidden bg-transparent hover:bg-transparent border-0 shadow-none hover:scale-110 transition-transform"
        >
          <img src={aiChatIcon} alt="Chat IA" className="w-full h-full object-cover" />
        </Button>
      </div>

      <Sheet open={open} onOpenChange={setOpen}>
        <SheetContent side="right" className="w-[400px] flex flex-col border-l sm:max-w-sm p-0 gap-0" hideCloseButton={true}>
          <SheetHeader className="p-4 border-b">
            <div className="flex items-center justify-between">
              <SheetTitle className="flex items-center gap-2">
                <img src={aiChatIcon} alt="AI" className="w-6 h-6" />
                Assistente UNE.AI
              </SheetTitle>
              <div className="flex items-center gap-1">
                <Button
                  variant="ghost"
                  size="icon"
                  className="h-8 w-8"
                  onClick={handleMinimize}
                  title="Minimizar (mantém conversa)"
                >
                  <Minus className="w-4 h-4" />
                </Button>
                <Button
                  variant="ghost"
                  size="icon"
                  className="h-8 w-8 text-destructive hover:text-destructive hover:bg-destructive/10"
                  onClick={() => {
                    setShowOnboarding(true);
                    setMessages([]);
                    setHasGreeted(false);
                  }}
                  title="Voltar ao menu inicial"
                >
                  <RotateCcw className="w-4 h-4" />
                </Button>
              </div>
            </div>
            <SheetDescription>
              Planeje seu evento com inteligência artificial.
            </SheetDescription>
          </SheetHeader>

          <ScrollArea className="flex-1 p-4" ref={scrollAreaRef}>
            <div className="space-y-4 pb-4">
              {/* 🔥 TELA DE ONBOARDING */}
              {showOnboarding && (
                <div className="space-y-4">
                  <div className="text-center space-y-2">
                    <h2 className="text-lg font-semibold">O que você gostaria de fazer hoje?</h2>
                    <p className="text-sm text-muted-foreground">
                      Escolha uma opção abaixo para começar
                    </p>
                  </div>

                  {/* Botão: Criar Novo Evento */}
                  <Button
                    onClick={handleCreateNewEvent}
                    className="w-full h-auto py-4 gap-3 justify-start"
                    variant="outline"
                  >
                    <div className="bg-primary/10 p-2 rounded-full">
                      <Sparkles className="w-5 h-5 text-primary" />
                    </div>
                    <div className="text-left">
                      <div className="font-semibold">Criar Novo Evento</div>
                      <div className="text-xs text-muted-foreground">
                        Começar do zero com um novo evento
                      </div>
                    </div>
                  </Button>

                  {/* Botão: Editar Evento Existente */}
                  <Button
                    onClick={() => {
                      if (recentEvents.length === 0 && !isLoadingEvents) {
                        toast({
                          title: "Nenhum evento em aberto",
                          description: "Você não tem eventos pendentes. Crie um novo evento!",
                          variant: "default"
                        });
                      }
                    }}
                    className="w-full h-auto py-4 gap-3 justify-start"
                    variant="outline"
                    disabled={isLoadingEvents}
                  >
                    <div className="bg-primary/10 p-2 rounded-full">
                      <Calendar className="w-5 h-5 text-primary" />
                    </div>
                    <div className="text-left flex-1">
                      <div className="font-semibold">Editar Evento Existente</div>
                      <div className="text-xs text-muted-foreground">
                        {isLoadingEvents ? 'Carregando eventos...' : recentEvents.length > 0 ? `Continue um de seus ${recentEvents.length} eventos` : 'Nenhum evento em aberto'}
                      </div>
                    </div>
                  </Button>

                  {/* Lista de eventos recentes */}
                  {recentEvents.length > 0 && (
                    <div className="space-y-2 pt-2">
                      <div className="text-sm font-medium text-muted-foreground">Eventos em aberto:</div>
                      {recentEvents.map((event) => (
                        <Button
                          key={event.id}
                          onClick={() => handleEditEvent(event)}
                          variant="secondary"
                          className="w-full h-auto py-3 gap-3 justify-start"
                        >
                          <Calendar className="w-4 h-4" />
                          <div className="text-left flex-1">
                            <div className="font-medium text-sm">{event.title}</div>
                            <div className="text-xs text-muted-foreground">
                              {event.qtd_pessoas} pessoas • {event.event_date}
                            </div>
                          </div>
                        </Button>
                      ))}
                    </div>
                  )}
                </div>
              )}

              {/* MENSAGENS DO CHAT */}
              {!showOnboarding && messages.map((msg, index) => (
                <div
                  key={index}
                  className={`flex flex-col ${msg.role === 'user' ? 'items-end' : 'items-start'}`}
                >
                  <div
                    className={`p-3 rounded-xl max-w-[85%] ${msg.role === 'user'
                      ? 'bg-primary text-primary-foreground'
                      : 'bg-accent text-accent-foreground'
                      }`}
                  >
                    <p className="whitespace-pre-wrap">{msg.content}</p>

                    {msg.items && msg.items.length > 0 && (
                      <div className="mt-3 space-y-2 text-sm bg-background/10 p-2 rounded">
                        {msg.items.map((item, idx) => (
                          <div key={idx} className="flex justify-between border-b border-white/10 last:border-0 py-1">
                            <div>
                              <span>{item.nome_item}</span>
                              <div className="text-xs opacity-70">{item.categoria}</div>
                            </div>
                            <div className="text-right">
                              <span className="font-mono block">
                                {item.quantidade} {item.unidade}
                              </span>
                              <span className="text-xs opacity-70">
                                R$ {item.valor_estimado?.toFixed(2)}
                              </span>
                            </div>
                          </div>
                        ))}
                        <div className="pt-2 font-bold text-right border-t border-white/10">
                          Total: R$ {msg.items.reduce((sum, item) => sum + (item.valor_estimado || 0), 0).toFixed(2)}
                        </div>
                      </div>
                    )}
                  </div>

                  {msg.suggestedReplies && msg.suggestedReplies.length > 0 && (
                    <div className="mt-2 flex flex-wrap gap-2">
                      {msg.suggestedReplies.map((reply, idx) => (
                        <Button
                          key={idx}
                          variant="outline"
                          size="sm"
                          onClick={() => handleSuggestedReply(reply)}
                          className="text-xs"
                        >
                          {reply}
                        </Button>
                      ))}
                    </div>
                  )}
                </div>
              ))}

              {isTyping && !showOnboarding && (
                <div className="flex items-center gap-1 ml-2">
                  <div className="w-2 h-2 bg-primary/50 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                  <div className="w-2 h-2 bg-primary/50 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                  <div className="w-2 h-2 bg-primary/50 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
                </div>
              )}
              <div ref={endRef} />
            </div>
          </ScrollArea>

          <div className="p-4 border-t bg-background">
            <div className="flex items-center gap-2">
              <Input
                placeholder="Digite sua mensagem..."
                value={input}
                onChange={e => setInput(e.target.value)}
                onKeyDown={e => {
                  if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage(input);
                  }
                }}
                disabled={isLoading || showOnboarding}
              />
              <Button onClick={() => sendMessage(input)} disabled={isLoading || !input.trim() || showOnboarding}>
                <Send size={18} />
              </Button>
            </div>
          </div>
        </SheetContent>
      </Sheet>
    </>
  );
}


============================================================
FILE PATH: .\src\components\ConversationMetricsCard.tsx
============================================================
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { useConversationMetrics } from '@/hooks/useConversationMetrics';
import { TrendingUp, MessageSquare, CheckCircle, AlertCircle } from 'lucide-react';
import { Skeleton } from '@/components/ui/skeleton';

/**
 * Componente para exibir métricas de performance do UNE.AI
 * (Opcional - pode ser usado em dashboard ou configurações)
 */
export function ConversationMetricsCard() {
  const { metrics, loading } = useConversationMetrics();

  if (loading) {
    return (
      <Card>
        <CardHeader>
          <Skeleton className="h-6 w-48" />
          <Skeleton className="h-4 w-64 mt-2" />
        </CardHeader>
        <CardContent>
          <div className="space-y-4">
            <Skeleton className="h-16 w-full" />
            <Skeleton className="h-16 w-full" />
            <Skeleton className="h-16 w-full" />
          </div>
        </CardContent>
      </Card>
    );
  }

  if (!metrics) return null;

  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <TrendingUp className="w-5 h-5" />
          Métricas de Conversação
        </CardTitle>
        <CardDescription>
          Performance do assistente UNE.AI nas suas interações
        </CardDescription>
      </CardHeader>
      <CardContent className="space-y-4">
        {/* Resumo Geral */}
        <div className="grid grid-cols-2 gap-4">
          <div className="space-y-1">
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
              <MessageSquare className="w-4 h-4" />
              <span>Total de Interações</span>
            </div>
            <div className="text-2xl font-bold">{metrics.summary.total_interactions}</div>
          </div>

          <div className="space-y-1">
            <div className="flex items-center gap-2 text-sm text-muted-foreground">
              <CheckCircle className="w-4 h-4" />
              <span>Taxa de Sucesso</span>
            </div>
            <div className="text-2xl font-bold">
              {metrics.summary.success_rate.toFixed(1)}%
            </div>
          </div>
        </div>

        {/* Confiança Média */}
        <div className="space-y-2">
          <div className="flex justify-between items-center text-sm">
            <span className="text-muted-foreground">Confiança Média</span>
            <span className="font-medium">
              {(metrics.summary.avg_confidence * 100).toFixed(0)}%
            </span>
          </div>
          <div className="w-full bg-secondary rounded-full h-2">
            <div
              className="bg-primary rounded-full h-2 transition-all"
              style={{ width: `${metrics.summary.avg_confidence * 100}%` }}
            />
          </div>
        </div>

        {/* Feedback do Usuário */}
        {metrics.feedback.total > 0 && (
          <div className="space-y-2 pt-4 border-t">
            <div className="text-sm font-medium">Feedback do Usuário</div>
            <div className="flex gap-4 text-sm">
              <div className="flex items-center gap-2">
                <span className="text-green-600">👍</span>
                <span>{metrics.feedback.positive}</span>
              </div>
              <div className="flex items-center gap-2">
                <span className="text-red-600">👎</span>
                <span>{metrics.feedback.negative}</span>
              </div>
            </div>
          </div>
        )}

        {/* Erros Frequentes */}
        {metrics.frequent_errors.length > 0 && (
          <div className="space-y-2 pt-4 border-t">
            <div className="flex items-center gap-2 text-sm font-medium">
              <AlertCircle className="w-4 h-4" />
              <span>Padrões de Melhoria</span>
            </div>
            <div className="space-y-1 text-sm">
              {metrics.frequent_errors.slice(0, 3).map((error, idx) => (
                <div key={idx} className="flex justify-between items-center text-muted-foreground">
                  <span className="capitalize">{error.intent.replace(/_/g, ' ')}</span>
                  <span>{error.error_count} correções</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </CardContent>
    </Card>
  );
}


============================================================
FILE PATH: .\src\components\EnableDevMode.tsx
============================================================
import { useEffect } from "react";

export const EnableDevMode = () => {
    useEffect(() => {
        localStorage.setItem("reune_dev_mode", "true");
        // Force a reload to ensure the new route configuration is loaded
        window.location.href = "/";
    }, []);

    return (
        <div className="flex items-center justify-center min-h-screen bg-black text-white">
            <p>Ativando modo de teste...</p>
        </div>
    );
};


============================================================
FILE PATH: .\src\components\FounderBadge.tsx
============================================================
import { Trophy, Crown, Sparkles } from "lucide-react";
import { Badge } from "@/components/ui/badge";
import {
  Tooltip,
  TooltipContent,
  TooltipProvider,
  TooltipTrigger,
} from "@/components/ui/tooltip";

interface FounderBadgeProps {
  variant?: "default" | "compact" | "full";
  founderSince?: string;
  premiumUntil?: string;
  storageMultiplier?: number;
}

export function FounderBadge({
  variant = "default",
  founderSince,
  premiumUntil,
  storageMultiplier = 3,
}: FounderBadgeProps) {
  const isPremiumActive = premiumUntil && new Date(premiumUntil) >= new Date();

  if (variant === "compact") {
    return (
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger>
            <Badge
              variant="outline"
              className="bg-gradient-to-r from-amber-500/10 to-purple-500/10 border-amber-500/30 text-amber-600 dark:text-amber-400 hover:from-amber-500/20 hover:to-purple-500/20 transition-all cursor-help"
            >
              <Trophy className="w-3 h-3 mr-1" />
              Fundador
            </Badge>
          </TooltipTrigger>
          <TooltipContent side="bottom" className="max-w-xs">
            <div className="space-y-2">
              <p className="font-semibold flex items-center gap-1">
                <Trophy className="w-4 h-4 text-amber-500" />
                Membro Fundador
              </p>
              <p className="text-xs text-muted-foreground">
                Você faz parte dos primeiros membros do ReUNE!
              </p>
              <div className="space-y-1 text-xs">
                <p className="flex items-center gap-1">
                  <Crown className="w-3 h-3" />
                  Premium: {isPremiumActive ? `Até ${new Date(premiumUntil).toLocaleDateString('pt-BR')}` : 'Expirado'}
                </p>
                <p className="flex items-center gap-1">
                  <Sparkles className="w-3 h-3" />
                  Limites: {storageMultiplier}x maiores
                </p>
              </div>
            </div>
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>
    );
  }

  if (variant === "full") {
    return (
      <div className="bg-gradient-to-br from-amber-500/10 via-purple-500/10 to-pink-500/10 border border-amber-500/20 rounded-xl p-4">
        <div className="flex items-start gap-3">
          <div className="p-2 bg-gradient-to-br from-amber-500 to-purple-600 rounded-lg">
            <Trophy className="w-5 h-5 text-white" />
          </div>
          <div className="flex-1">
            <h3 className="font-semibold text-sm flex items-center gap-2">
              Membro Fundador
              <Badge variant="outline" className="text-xs border-amber-500/30 bg-amber-500/5">
                Exclusivo
              </Badge>
            </h3>
            <p className="text-xs text-muted-foreground mt-1">
              Você faz parte da primeira geração do ReUNE!
            </p>

            <div className="mt-3 space-y-2">
              <div className="flex items-center gap-2 text-xs">
                <div className="w-1.5 h-1.5 rounded-full bg-green-500"></div>
                <Crown className="w-3.5 h-3.5 text-amber-500" />
                <span>
                  {isPremiumActive ? (
                    <>Premium grátis até <strong>{new Date(premiumUntil).toLocaleDateString('pt-BR')}</strong></>
                  ) : (
                    'Premium expirado'
                  )}
                </span>
              </div>
              <div className="flex items-center gap-2 text-xs">
                <div className="w-1.5 h-1.5 rounded-full bg-purple-500"></div>
                <Sparkles className="w-3.5 h-3.5 text-purple-500" />
                <span>Limites <strong>{storageMultiplier}x maiores</strong> permanentemente</span>
              </div>
            </div>

            {founderSince && (
              <p className="text-xs text-muted-foreground mt-3 pt-3 border-t border-border/50">
                Membro desde {new Date(founderSince).toLocaleDateString('pt-BR')}
              </p>
            )}
          </div>
        </div>
      </div>
    );
  }

  // Variant "default"
  return (
    <Badge
      variant="outline"
      className="bg-gradient-to-r from-amber-500/10 to-purple-500/10 border-amber-500/30 text-amber-600 dark:text-amber-400 px-3 py-1"
    >
      <Trophy className="w-3.5 h-3.5 mr-1.5" />
      Membro Fundador
    </Badge>
  );
}


============================================================
FILE PATH: .\src\components\InviteGuestDialog.tsx
============================================================
import { useState } from 'react';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Checkbox } from '@/components/ui/checkbox';
import { Plus } from 'lucide-react';
import { useToast } from '@/hooks/use-toast';

interface InviteGuestDialogProps {
  onInvite: (email: string, name: string, isOrganizer: boolean) => Promise<{error: string | null}>;
}

export const InviteGuestDialog = ({ onInvite }: InviteGuestDialogProps) => {
  const [open, setOpen] = useState(false);
  const [email, setEmail] = useState('');
  const [name, setName] = useState('');
  const [isOrganizer, setIsOrganizer] = useState(false);
  const [loading, setLoading] = useState(false);
  const { toast } = useToast();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email.trim() || !name.trim()) {
      toast({
        title: "Erro",
        description: "Nome e email são obrigatórios",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);
    const result = await onInvite(email.trim(), name.trim(), isOrganizer);
    
    if (result.error) {
      toast({
        title: "Erro ao enviar convite",
        description: result.error,
        variant: "destructive",
      });
    } else {
      toast({
        title: "Convite enviado!",
        description: `${name} foi convidado(a) ${isOrganizer ? 'como organizador(a)' : 'para o evento'}.`,
      });
      
      // Reset form
      setEmail('');
      setName('');
      setIsOrganizer(false);
      setOpen(false);
    }
    
    setLoading(false);
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button>
          <Plus className="w-4 h-4 mr-2" />
          Convidar Pessoa
        </Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>Convidar Nova Pessoa</DialogTitle>
          <DialogDescription>
            Adicione o nome e email da pessoa que você deseja convidar.
          </DialogDescription>
        </DialogHeader>
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="space-y-2">
            <Label htmlFor="name">Nome</Label>
            <Input
              id="name"
              placeholder="Nome da pessoa"
              value={name}
              onChange={(e) => setName(e.target.value)}
              required
            />
          </div>
          <div className="space-y-2">
            <Label htmlFor="email">Email</Label>
            <Input
              id="email"
              type="email"
              placeholder="email@exemplo.com"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>
          <div className="flex items-center space-x-2">
            <Checkbox 
              id="organizer" 
              checked={isOrganizer}
              onCheckedChange={(checked) => setIsOrganizer(checked as boolean)}
            />
            <Label 
              htmlFor="organizer" 
              className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
            >
              Convidar como organizador (poderá adicionar e remover pessoas)
            </Label>
          </div>
          <div className="flex justify-end space-x-2">
            <Button 
              type="button" 
              variant="outline" 
              onClick={() => setOpen(false)}
            >
              Cancelar
            </Button>
            <Button type="submit" disabled={loading}>
              {loading ? 'Enviando...' : 'Enviar Convite'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
};

============================================================
FILE PATH: .\src\components\ProfilePromptDialog.tsx
============================================================
import { useState } from "react";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import { Label } from "@/components/ui/label";
import { User } from "lucide-react";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";

interface ProfilePromptDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onNavigateToProfile: () => void;
}

export const ProfilePromptDialog = ({
  open,
  onOpenChange,
  onNavigateToProfile,
}: ProfilePromptDialogProps) => {
  const [dontAskAgain, setDontAskAgain] = useState(false);
  const [saving, setSaving] = useState(false);
  const { toast } = useToast();

  const handleDismiss = async () => {
    if (dontAskAgain) {
      await savePreference();
    }
    onOpenChange(false);
  };

  const handleGoToProfile = async () => {
    if (dontAskAgain) {
      await savePreference();
    }
    onOpenChange(false);
    onNavigateToProfile();
  };

  const savePreference = async () => {
    try {
      setSaving(true);
      const { data: { user } } = await supabase.auth.getUser();
      
      if (!user) {
        throw new Error("Usuário não autenticado");
      }

      const { error } = await supabase
        .from("profiles")
        .update({ hide_profile_prompt: true })
        .eq("id", user.id);

      if (error) throw error;
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao salvar preferência",
        description: err?.message || "Não foi possível salvar sua preferência.",
        variant: "destructive",
      });
    } finally {
      setSaving(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <div className="flex items-center gap-3 mb-2">
            <div className="bg-primary/10 p-3 rounded-full">
              <User className="w-6 h-6 text-primary" />
            </div>
            <DialogTitle className="text-xl">Complete seu perfil!</DialogTitle>
          </div>
          <DialogDescription className="text-base pt-2">
            Agora ficou mais fácil atualizar seus dados de perfil. Quer completar suas informações? É rapidinho 🙂
          </DialogDescription>
        </DialogHeader>

        <div className="flex items-start space-x-2 py-4">
          <Checkbox
            id="dont-ask-again"
            checked={dontAskAgain}
            onCheckedChange={(checked) => setDontAskAgain(checked as boolean)}
          />
          <Label
            htmlFor="dont-ask-again"
            className="text-sm font-normal leading-relaxed cursor-pointer"
          >
            Não perguntar novamente
          </Label>
        </div>

        <DialogFooter className="flex-col sm:flex-row gap-2">
          <Button
            type="button"
            variant="outline"
            onClick={handleDismiss}
            disabled={saving}
            className="w-full sm:w-auto"
          >
            Agora não
          </Button>
          <Button
            type="button"
            onClick={handleGoToProfile}
            disabled={saving}
            className="w-full sm:w-auto"
          >
            {saving ? "Salvando..." : "Cadastrar perfil"}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
};


============================================================
FILE PATH: .\src\components\admin\AdminHeader.tsx
============================================================
import { motion } from "framer-motion";
import { Button } from "@/components/ui/button";
import { LogOut, Settings } from "lucide-react";

interface AdminHeaderProps {
  title: string;
  subtitle?: string;
  onLogout: () => void;
}

export default function AdminHeader({ title, subtitle, onLogout }: AdminHeaderProps) {
  return (
    <motion.header
      initial={{ y: -100 }}
      animate={{ y: 0 }}
      className="fixed top-20 left-1/2 -translate-x-1/2 z-40 w-full max-w-7xl px-4"
    >
      <div className="rounded-3xl bg-card/80 backdrop-blur-xl border border-border/50 shadow-2xl px-6 py-4">
        <div className="flex items-center justify-between">
          {/* Logo & Title */}
          <div className="flex items-center gap-4">
            <div className="relative">
              <div className="absolute inset-0 bg-gradient-to-r from-amber-500 to-purple-500 rounded-full blur-xl opacity-30 animate-pulse" />
              <div className="relative w-10 h-10 rounded-full bg-gradient-to-r from-amber-500 to-purple-500 flex items-center justify-center">
                <Settings className="w-5 h-5 text-white" />
              </div>
            </div>

            <div>
              <h1 className="text-xl font-bold bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
                {title}
              </h1>
              {subtitle && (
                <p className="text-sm text-muted-foreground">{subtitle}</p>
              )}
            </div>
          </div>

          {/* Actions */}
          <div className="flex items-center gap-3">
            <Button
              variant="outline"
              size="sm"
              onClick={onLogout}
              className="gap-2 hover:bg-background/80"
            >
              <LogOut className="w-4 h-4" />
              Sair
            </Button>
          </div>
        </div>
      </div>
    </motion.header>
  );
}


============================================================
FILE PATH: .\src\components\admin\EmailLogViewer.tsx
============================================================
import { useState, useEffect } from "react";
import { EmailLog } from "@/types/admin";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Input } from "@/components/ui/input";
import { CheckCircle2, XCircle, Clock, RefreshCw, Loader2 } from "lucide-react";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { toast } from "sonner";
import { supabase } from "@/integrations/supabase/client";

interface EmailLogViewerProps {
  password: string;
}

export default function EmailLogViewer({ password }: EmailLogViewerProps) {
  const [logs, setLogs] = useState<EmailLog[]>([]);
  const [loading, setLoading] = useState(false);
  const [statusFilter, setStatusFilter] = useState<string>("all");
  const [emailFilter, setEmailFilter] = useState("");

  useEffect(() => {
    fetchLogs();
  }, []);

  const fetchLogs = async () => {
    setLoading(true);
    try {
      const { data, error } = await supabase.functions.invoke('get-email-logs', {
        body: {
          password,
          filters: statusFilter !== 'all' ? { status: statusFilter } : {},
          limit: 100
        }
      });

      if (error) {
        throw new Error(error.message);
      }

      setLogs(data.logs || []);
    } catch (error: any) {
      toast.error('Erro ao carregar logs');
    } finally {
      setLoading(false);
    }
  };

  const filteredLogs = logs.filter(log =>
    emailFilter ? log.lead_email.toLowerCase().includes(emailFilter.toLowerCase()) : true
  );

  const getStatusBadge = (status: string) => {
    switch (status) {
      case 'success':
        return <Badge className="bg-green-500/10 text-green-600 border-green-500/20"><CheckCircle2 className="w-3 h-3 mr-1" />Sucesso</Badge>;
      case 'failed':
        return <Badge className="bg-red-500/10 text-red-600 border-red-500/20"><XCircle className="w-3 h-3 mr-1" />Falhou</Badge>;
      case 'pending':
        return <Badge className="bg-amber-500/10 text-amber-600 border-amber-500/20"><Clock className="w-3 h-3 mr-1" />Pendente</Badge>;
      default:
        return <Badge variant="outline">{status}</Badge>;
    }
  };

  return (
    <div className="space-y-4">
      {/* Filters */}
      <div className="flex items-center gap-3">
        <Input
          placeholder="Filtrar por e-mail..."
          value={emailFilter}
          onChange={(e) => setEmailFilter(e.target.value)}
          className="max-w-xs"
        />
        <Select value={statusFilter} onValueChange={setStatusFilter}>
          <SelectTrigger className="w-40">
            <SelectValue />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">Todos</SelectItem>
            <SelectItem value="success">Sucesso</SelectItem>
            <SelectItem value="failed">Falhou</SelectItem>
            <SelectItem value="pending">Pendente</SelectItem>
          </SelectContent>
        </Select>
        <Button size="sm" variant="outline" onClick={fetchLogs} disabled={loading}>
          {loading ? <Loader2 className="w-4 h-4 animate-spin" /> : <RefreshCw className="w-4 h-4" />}
        </Button>
      </div>

      {/* Table */}
      <div className="rounded-2xl border border-border/50 bg-card/50 backdrop-blur-sm overflow-hidden">
        <Table>
          <TableHeader>
            <TableRow className="bg-muted/50">
              <TableHead>Data</TableHead>
              <TableHead>E-mail</TableHead>
              <TableHead>Template</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Erro</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {loading ? (
              <TableRow>
                <TableCell colSpan={5} className="text-center py-8">
                  <Loader2 className="w-6 h-6 animate-spin mx-auto" />
                </TableCell>
              </TableRow>
            ) : filteredLogs.length === 0 ? (
              <TableRow>
                <TableCell colSpan={5} className="text-center py-8 text-muted-foreground">
                  Nenhum log encontrado
                </TableCell>
              </TableRow>
            ) : (
              filteredLogs.map((log) => (
                <TableRow key={log.id} className="hover:bg-muted/50">
                  <TableCell className="text-xs">
                    {format(new Date(log.sent_at), "dd/MM/yyyy HH:mm:ss", { locale: ptBR })}
                  </TableCell>
                  <TableCell className="font-medium">{log.lead_email}</TableCell>
                  <TableCell>
                    <Badge variant="outline" className="text-xs">{log.template_name}</Badge>
                  </TableCell>
                  <TableCell>{getStatusBadge(log.status)}</TableCell>
                  <TableCell className="text-xs text-muted-foreground max-w-[200px] truncate">
                    {log.error_message || '-'}
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\components\admin\EmailTemplateEditor.tsx
============================================================
import { useState } from "react";
import { EmailTemplate } from "@/types/admin";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Badge } from "@/components/ui/badge";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Edit, Trash2, Plus, Save, X, Eye } from "lucide-react";
import { toast } from "sonner";
import { motion } from "framer-motion";

interface EmailTemplateEditorProps {
  templates: EmailTemplate[];
  password: string;
  onUpdate: () => void;
}

export default function EmailTemplateEditor({ templates, password, onUpdate }: EmailTemplateEditorProps) {
  const [editingTemplate, setEditingTemplate] = useState<EmailTemplate | null>(null);
  const [viewingTemplate, setViewingTemplate] = useState<EmailTemplate | null>(null);
  const [formData, setFormData] = useState({
    name: "",
    subject: "",
    description: "",
    html_content: "",
    variables: [] as string[],
    is_active: true
  });

  const handleEdit = (template: EmailTemplate) => {
    setEditingTemplate(template);
    setFormData({
      name: template.name,
      subject: template.subject,
      description: template.description || "",
      html_content: template.html_content,
      variables: template.variables,
      is_active: template.is_active
    });
  };

  const handleSave = async () => {
    if (!formData.name || !formData.subject || !formData.html_content) {
      toast.error("Preencha todos os campos obrigatórios");
      return;
    }

    try {
      const url = editingTemplate?.id
        ? `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/email-templates/${editingTemplate.id}`
        : `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/email-templates`;

      const method = editingTemplate?.id ? 'PUT' : 'POST';

      const response = await fetch(url, {
        method,
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY}`,
          'apikey': import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY
        },
        body: JSON.stringify({ ...formData, password }),
      });

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Erro ao salvar template');
      }

      toast.success(`Template ${editingTemplate?.id ? 'atualizado' : 'criado'} com sucesso!`);
      setEditingTemplate(null);
      setFormData({ name: "", subject: "", description: "", html_content: "", variables: [], is_active: true });
      onUpdate();

    } catch (error: any) {
      toast.error(error.message || 'Erro ao salvar template');
    }
  };

  const handleDelete = async (templateId: string) => {
    if (!confirm('Tem certeza que deseja deletar este template?')) return;

    try {
      const response = await fetch(
        `${import.meta.env.VITE_SUPABASE_URL}/functions/v1/email-templates/${templateId}?password=${password}`,
        {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY}`,
            'apikey': import.meta.env.VITE_SUPABASE_PUBLISHABLE_KEY
          }
        }
      );

      const data = await response.json();

      if (!response.ok || !data.success) {
        throw new Error(data.error || 'Erro ao deletar template');
      }

      toast.success('Template deletado com sucesso!');
      onUpdate();

    } catch (error: any) {
      toast.error(error.message || 'Erro ao deletar template');
    }
  };

  if (editingTemplate !== null) {
    return (
      <div className="space-y-4">
        <div className="flex items-center justify-between">
          <h3 className="text-lg font-semibold">
            {editingTemplate?.id ? 'Editar Template' : 'Novo Template'}
          </h3>
          <Button variant="ghost" size="sm" onClick={() => setEditingTemplate(null)}>
            <X className="w-4 h-4" />
          </Button>
        </div>

        <div className="grid gap-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <Label>Nome (slug)</Label>
              <Input
                value={formData.name}
                onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                placeholder="boas_vindas"
                disabled={!!editingTemplate?.id}
              />
            </div>
            <div>
              <Label>Assunto</Label>
              <Input
                value={formData.subject}
                onChange={(e) => setFormData({ ...formData, subject: e.target.value })}
                placeholder="Bem-vindo ao ReUNE!"
              />
            </div>
          </div>

          <div>
            <Label>Descrição</Label>
            <Input
              value={formData.description}
              onChange={(e) => setFormData({ ...formData, description: e.target.value })}
              placeholder="Template de boas-vindas para novos leads"
            />
          </div>

          <div>
            <Label>HTML do Template</Label>
            <Textarea
              value={formData.html_content}
              onChange={(e) => setFormData({ ...formData, html_content: e.target.value })}
              placeholder="<html>...</html>"
              className="font-mono text-xs h-64"
            />
            <p className="text-xs text-muted-foreground mt-1">
              Use variáveis com: {'{'}nome{'}'}, {'{'}email{'}'}, etc.
            </p>
          </div>

          <div className="flex gap-2">
            <Button onClick={handleSave} className="bg-gradient-to-r from-amber-500 to-purple-500">
              <Save className="w-4 h-4 mr-2" />
              Salvar
            </Button>
            <Button variant="outline" onClick={() => setEditingTemplate(null)}>
              Cancelar
            </Button>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">Templates</h3>
        <Button
          size="sm"
          onClick={() => {
            setEditingTemplate({} as EmailTemplate);
            setFormData({ name: "", subject: "", description: "", html_content: "", variables: [], is_active: true });
          }}
          className="bg-gradient-to-r from-amber-500 to-purple-500"
        >
          <Plus className="w-4 h-4 mr-2" />
          Novo Template
        </Button>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {templates.map((template, index) => (
          <motion.div
            key={template.id}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.05 }}
          >
            <Card className="hover:shadow-lg transition-shadow">
              <CardHeader>
                <div className="flex items-start justify-between">
                  <div>
                    <CardTitle className="text-base">{template.subject}</CardTitle>
                    <CardDescription className="text-xs mt-1">{template.description}</CardDescription>
                  </div>
                  <Badge variant={template.is_active ? "default" : "secondary"} className="text-xs">
                    {template.is_active ? "Ativo" : "Inativo"}
                  </Badge>
                </div>
              </CardHeader>
              <CardContent>
                <div className="flex items-center gap-2">
                  <Button size="sm" variant="secondary" onClick={() => setViewingTemplate(template)}>
                    <Eye className="w-3 h-3 mr-1" />
                    Visualizar
                  </Button>
                  <Button size="sm" variant="outline" onClick={() => handleEdit(template)}>
                    <Edit className="w-3 h-3 mr-1" />
                    Editar
                  </Button>
                  <Button size="sm" variant="ghost" onClick={() => handleDelete(template.id)}>
                    <Trash2 className="w-3 h-3 mr-1" />
                    Deletar
                  </Button>
                </div>
              </CardContent>
            </Card>
          </motion.div>
        ))}
      </div>

      {/* Preview Modal */}
      <Dialog open={!!viewingTemplate} onOpenChange={(open) => !open && setViewingTemplate(null)}>
        <DialogContent className="max-w-4xl max-h-[80vh] overflow-auto">
          <DialogHeader>
            <DialogTitle>Preview: {viewingTemplate?.subject}</DialogTitle>
          </DialogHeader>
          <div className="space-y-4">
            <div className="grid grid-cols-2 gap-4 text-sm">
              <div>
                <span className="font-semibold">Nome:</span> {viewingTemplate?.name}
              </div>
              <div>
                <span className="font-semibold">Status:</span>{' '}
                <Badge variant={viewingTemplate?.is_active ? "default" : "secondary"}>
                  {viewingTemplate?.is_active ? "Ativo" : "Inativo"}
                </Badge>
              </div>
            </div>
            {viewingTemplate?.description && (
              <div className="text-sm">
                <span className="font-semibold">Descrição:</span> {viewingTemplate.description}
              </div>
            )}
            <div className="border rounded-lg p-4 bg-white">
              <div
                dangerouslySetInnerHTML={{ __html: viewingTemplate?.html_content || '' }}
                className="prose max-w-none"
              />
            </div>
          </div>
        </DialogContent>
      </Dialog>
    </div>
  );
}


============================================================
FILE PATH: .\src\components\admin\LeadTable.tsx
============================================================
import { useState } from "react";
import { Lead, RegisteredUser } from "@/types/admin";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { Checkbox } from "@/components/ui/checkbox";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Mail, CheckCircle2, XCircle, Clock, Trophy, Crown } from "lucide-react";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";

interface LeadTableProps {
  leads: (Lead | RegisteredUser)[];
  selectedLeads: string[];
  onSelectLead: (leadId: string) => void;
  onSelectAll: (selected: boolean) => void;
  onSendEmail: (leadIds: string[]) => void;
  onViewLogs: (leadId: string) => void;
}

// Type guard para verificar se é Lead ou RegisteredUser
const isLead = (item: Lead | RegisteredUser): item is Lead => {
  return 'origin' in item;
};

const isRegisteredUser = (item: Lead | RegisteredUser): item is RegisteredUser => {
  return 'is_founder' in item;
};

export default function LeadTable({
  leads,
  selectedLeads,
  onSelectLead,
  onSelectAll,
  onSendEmail,
  onViewLogs
}: LeadTableProps) {
  const allSelected = leads.length > 0 && selectedLeads.length === leads.length;

  return (
    <div className="space-y-4">
      {/* Actions Bar */}
      {selectedLeads.length > 0 && (
        <div className="flex items-center gap-3 p-4 bg-gradient-to-r from-amber-500/10 to-purple-500/10 border border-amber-500/20 rounded-xl">
          <span className="text-sm font-medium">
            {selectedLeads.length} lead(s) selecionado(s)
          </span>
          <Button
            size="sm"
            onClick={() => onSendEmail(selectedLeads)}
            className="bg-gradient-to-r from-amber-500 to-purple-500 hover:from-amber-600 hover:to-purple-600"
          >
            <Mail className="w-4 h-4 mr-2" />
            Enviar E-mail
          </Button>
        </div>
      )}

      {/* Table */}
      <div className="rounded-2xl border border-border/50 bg-card/50 backdrop-blur-sm overflow-hidden">
        <Table>
          <TableHeader>
            <TableRow className="bg-muted/50">
              <TableHead className="w-12">
                <Checkbox
                  checked={allSelected}
                  onCheckedChange={(checked) => onSelectAll(checked as boolean)}
                />
              </TableHead>
              <TableHead>Nome</TableHead>
              <TableHead>Email</TableHead>
              <TableHead>Status</TableHead>
              <TableHead>Info</TableHead>
              <TableHead>Cadastro</TableHead>
              <TableHead className="text-right">Ações</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {leads.length === 0 ? (
              <TableRow>
                <TableCell colSpan={7} className="text-center py-8 text-muted-foreground">
                  Nenhum lead encontrado
                </TableCell>
              </TableRow>
            ) : (
              leads.map((item) => (
                <TableRow
                  key={item.id}
                  className="hover:bg-muted/50 transition-colors"
                >
                  <TableCell>
                    <Checkbox
                      checked={selectedLeads.includes(item.id)}
                      onCheckedChange={() => onSelectLead(item.id)}
                    />
                  </TableCell>
                  <TableCell className="font-medium">
                    {item.name || <span className="text-muted-foreground italic">Sem nome</span>}
                  </TableCell>
                  <TableCell>{item.email}</TableCell>
                  <TableCell>
                    {isLead(item) ? (
                      // Waitlist - Mostrar origem
                      <Badge variant="outline" className="text-xs">
                        {item.origin}
                      </Badge>
                    ) : (
                      // User - Mostrar se tem boas-vindas enviado
                      isRegisteredUser(item) && item.is_founder ? (
                        <Badge variant="outline" className="text-xs bg-gradient-to-r from-amber-500/10 to-purple-500/10 border-amber-500/30">
                          <Trophy className="w-3 h-3 mr-1" />
                          Fundador
                        </Badge>
                      ) : (
                        <Badge variant="outline" className="text-xs">
                          Usuário
                        </Badge>
                      )
                    )}
                  </TableCell>
                  <TableCell>
                    {isLead(item) ? (
                      // Waitlist - Mostrar status de boas-vindas
                      item.welcome_email_sent ? (
                        <div className="flex items-center gap-2 text-green-600">
                          <CheckCircle2 className="w-4 h-4" />
                          <span className="text-xs">
                            {item.welcome_email_sent_at &&
                              format(new Date(item.welcome_email_sent_at), "dd/MM/yy", { locale: ptBR })
                            }
                          </span>
                        </div>
                      ) : (
                        <div className="flex items-center gap-2 text-amber-600">
                          <XCircle className="w-4 h-4" />
                          <span className="text-xs">Não enviado</span>
                        </div>
                      )
                    ) : (
                      // User - Mostrar status de email E info de premium/founder
                      isRegisteredUser(item) ? (
                        <div className="flex flex-col gap-1">
                          {/* Status de email enviado */}
                          {item.welcome_email_sent ? (
                            <div className="flex items-center gap-2 text-green-600">
                              <CheckCircle2 className="w-3 h-3" />
                              <span className="text-xs">
                                {item.welcome_email_sent_at &&
                                  format(new Date(item.welcome_email_sent_at), "dd/MM/yy", { locale: ptBR })
                                }
                              </span>
                            </div>
                          ) : (
                            <div className="flex items-center gap-2 text-amber-600">
                              <XCircle className="w-3 h-3" />
                              <span className="text-xs">Sem emails</span>
                            </div>
                          )}
                          {/* Info de Premium (se for founder) */}
                          {item.is_founder && item.premium_until && (
                            <div className="flex items-center gap-2 text-purple-600">
                              <Crown className="w-3 h-3" />
                              <span className="text-xs">
                                Premium até {format(new Date(item.premium_until), "dd/MM/yy", { locale: ptBR })}
                              </span>
                            </div>
                          )}
                        </div>
                      ) : (
                        <span className="text-xs text-muted-foreground">-</span>
                      )
                    )}
                  </TableCell>
                  <TableCell className="text-xs text-muted-foreground">
                    {format(new Date(item.created_at), "dd/MM/yyyy HH:mm", { locale: ptBR })}
                  </TableCell>
                  <TableCell className="text-right">
                    <div className="flex items-center justify-end gap-2">
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => onSendEmail([item.id])}
                        className="h-8 px-2"
                      >
                        <Mail className="w-4 h-4" />
                      </Button>
                      <Button
                        size="sm"
                        variant="ghost"
                        onClick={() => onViewLogs(item.id)}
                        className="h-8 px-2"
                      >
                        <Clock className="w-4 h-4" />
                      </Button>
                    </div>
                  </TableCell>
                </TableRow>
              ))
            )}
          </TableBody>
        </Table>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\components\admin\SendEmailModal.tsx
============================================================
import { useState } from "react";
import { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Input } from "@/components/ui/input";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { EmailTemplate } from "@/types/admin";
import { Mail, Loader2 } from "lucide-react";
import { toast } from "sonner";
import { supabase } from "@/integrations/supabase/client";

interface SendEmailModalProps {
  open: boolean;
  onClose: () => void;
  templates: EmailTemplate[];
  leadIds: string[];
  leadCount: number;
  password: string;
}

export default function SendEmailModal({
  open,
  onClose,
  templates,
  leadIds,
  leadCount,
  password
}: SendEmailModalProps) {
  const [selectedTemplate, setSelectedTemplate] = useState<string>("");
  const [variables, setVariables] = useState<Record<string, string>>({});
  const [loading, setLoading] = useState(false);

  const template = templates.find(t => t.name === selectedTemplate);
  const templateVariables = template?.variables || [];

  const handleSend = async () => {
    if (!selectedTemplate) {
      toast.error("Selecione um template");
      return;
    }

    setLoading(true);

    try {
      const { data, error } = await supabase.functions.invoke('send-admin-email', {
        body: {
          lead_ids: leadIds,
          template_name: selectedTemplate,
          variables,
          password
        }
      });

      if (error || !data.success) {
        throw new Error(error?.message || data.error || 'Erro ao enviar e-mails');
      }

      toast.success(data.message || `E-mails enviados com sucesso!`);
      onClose();

      // Recarregar dados após 1 segundo
      setTimeout(() => window.location.reload(), 1000);

    } catch (error: any) {
      console.error('Erro:', error);
      toast.error(error.message || 'Erro ao enviar e-mails');
    } finally {
      setLoading(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={(open) => !open && onClose()}>
      <DialogContent className="sm:max-w-[500px]">
        <DialogHeader>
          <DialogTitle className="text-xl font-bold bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
            Enviar E-mail
          </DialogTitle>
          <DialogDescription>
            Enviar e-mail para {leadCount} lead(s) selecionado(s)
          </DialogDescription>
        </DialogHeader>

        <div className="space-y-4 py-4">
          {/* Template Selector */}
          <div className="space-y-2">
            <Label>Template</Label>
            <Select value={selectedTemplate} onValueChange={setSelectedTemplate}>
              <SelectTrigger className="h-12">
                <SelectValue placeholder="Selecione um template" />
              </SelectTrigger>
              <SelectContent>
                {templates.filter(t => t.is_active).map((template) => (
                  <SelectItem key={template.id} value={template.name}>
                    <div>
                      <div className="font-medium">{template.subject}</div>
                      {template.description && (
                        <div className="text-xs text-muted-foreground">{template.description}</div>
                      )}
                    </div>
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          {/* Variables */}
          {template && templateVariables.length > 0 && (
            <div className="space-y-3 p-4 bg-muted/50 rounded-xl">
              <Label className="text-sm font-medium">Variáveis do Template</Label>
              <p className="text-xs text-muted-foreground">
                As variáveis {'{'}nome{'}'} e {'{'}email{'}'} são preenchidas automaticamente.
              </p>

              {templateVariables
                .filter(v => v !== 'nome' && v !== 'email')
                .map((variable) => (
                  <div key={variable} className="space-y-1">
                    <Label className="text-xs">{variable}</Label>
                    <Input
                      placeholder={`Valor para {${variable}}`}
                      value={variables[variable] || ''}
                      onChange={(e) => setVariables({ ...variables, [variable]: e.target.value })}
                      className="h-10"
                    />
                  </div>
                ))}
            </div>
          )}
        </div>

        <DialogFooter>
          <Button
            variant="outline"
            onClick={onClose}
            disabled={loading}
          >
            Cancelar
          </Button>
          <Button
            onClick={handleSend}
            disabled={!selectedTemplate || loading}
            className="bg-gradient-to-r from-amber-500 to-purple-500 hover:from-amber-600 hover:to-purple-600"
          >
            {loading ? (
              <>
                <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                Enviando...
              </>
            ) : (
              <>
                <Mail className="w-4 h-4 mr-2" />
                Enviar {leadCount > 1 ? `(${leadCount})` : ''}
              </>
            )}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}


============================================================
FILE PATH: .\src\components\events\AddressSelector.tsx
============================================================
import { useState } from 'react';
import { MapPin, Home, ChevronDown } from 'lucide-react';
import { Button } from '@/components/ui/button';
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu';
import { useAddresses, Address } from '@/hooks/useAddresses';
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';

interface AddressSelectorProps {
  onAddressSelect: (address: Address) => void;
  disabled?: boolean;
}

export function AddressSelector({ onAddressSelect, disabled }: AddressSelectorProps) {
  const { addresses, loading } = useAddresses();
  const [open, setOpen] = useState(false);

  const primaryAddress = addresses.find(addr => addr.is_primary);
  const hasAddresses = addresses.length > 0;

  const formatAddress = (address: Address) => {
    return `${address.street}, ${address.number}${address.complement ? ', ' + address.complement : ''}, ${address.neighborhood}, ${address.city}/${address.state}`;
  };

  const handleSelectAddress = (address: Address) => {
    onAddressSelect(address);
    setOpen(false);
  };

  if (loading) {
    return (
      <Button variant="outline" disabled className="w-full">
        <MapPin className="h-4 w-4 mr-2" />
        Carregando endereços...
      </Button>
    );
  }

  if (!hasAddresses) {
    return (
      <TooltipProvider>
        <Tooltip>
          <TooltipTrigger asChild>
            <div className="w-full">
              <Button variant="outline" disabled className="w-full">
                <Home className="h-4 w-4 mr-2" />
                Usar meu endereço
              </Button>
            </div>
          </TooltipTrigger>
          <TooltipContent>
            <p className="text-sm">
              Você ainda não cadastrou nenhum endereço.<br />
              Vá em Minha Conta → Endereços para adicionar.
            </p>
          </TooltipContent>
        </Tooltip>
      </TooltipProvider>
    );
  }

  // Se tem apenas um endereço, usar diretamente
  if (addresses.length === 1) {
    return (
      <Button 
        variant="outline" 
        onClick={() => handleSelectAddress(addresses[0])}
        disabled={disabled}
        className="w-full"
      >
        <Home className="h-4 w-4 mr-2" />
        Usar meu endereço: {addresses[0].nickname}
      </Button>
    );
  }

  // Se tem vários endereços, mostrar dropdown
  return (
    <DropdownMenu open={open} onOpenChange={setOpen}>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" disabled={disabled} className="w-full justify-between">
          <span className="flex items-center">
            <Home className="h-4 w-4 mr-2" />
            Usar meu endereço
          </span>
          <ChevronDown className="h-4 w-4 ml-2" />
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="start" className="w-[400px] max-h-[300px] overflow-y-auto">
        {primaryAddress && (
          <>
            <DropdownMenuItem 
              onClick={() => handleSelectAddress(primaryAddress)}
              className="flex flex-col items-start py-3"
            >
              <div className="flex items-center gap-2 font-medium">
                <MapPin className="h-4 w-4" />
                {primaryAddress.nickname}
                <span className="text-xs bg-primary/10 text-primary px-2 py-0.5 rounded">
                  Principal
                </span>
              </div>
              <span className="text-xs text-muted-foreground mt-1">
                {formatAddress(primaryAddress)}
              </span>
            </DropdownMenuItem>
            {addresses.filter(a => !a.is_primary).length > 0 && (
              <div className="px-2 py-1.5 text-xs font-semibold text-muted-foreground">
                Outros endereços
              </div>
            )}
          </>
        )}
        {addresses
          .filter(addr => !addr.is_primary)
          .map((address) => (
            <DropdownMenuItem 
              key={address.id}
              onClick={() => handleSelectAddress(address)}
              className="flex flex-col items-start py-3"
            >
              <div className="flex items-center gap-2 font-medium">
                <MapPin className="h-4 w-4" />
                {address.nickname}
              </div>
              <span className="text-xs text-muted-foreground mt-1">
                {formatAddress(address)}
              </span>
            </DropdownMenuItem>
          ))}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}


============================================================
FILE PATH: .\src\components\events\EventInviteSelector.tsx
============================================================
import { useState, useEffect } from "react";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { X, CheckCircle2, Clock, UserCheck } from "lucide-react";
import { supabase } from "@/integrations/supabase/client";
import { cn } from "@/lib/utils";
import { UserInviteSearch } from "./UserInviteSearch";

export interface Invitee {
  id: string;
  name: string;
  email?: string;
  user_id?: string;
  username?: string;
  avatar_url?: string;
  status: "convidado" | "pendente" | "confirmado" | "convite_email";
  isFriend: boolean;
}

interface EventInviteSelectorProps {
  selectedInvitees: Invitee[];
  onInviteesChange: (invitees: Invitee[]) => void;
}

interface Friend {
  friend_id: string;
  display_name: string;
  avatar_url?: string;
  username?: string | null;
}

export const EventInviteSelector = ({
  selectedInvitees,
  onInviteesChange,
}: EventInviteSelectorProps) => {
  const [friends, setFriends] = useState<Friend[]>([]);

  useEffect(() => {
    fetchFriends();
  }, []);

  const fetchFriends = async () => {
    try {
      const { data, error } = await supabase.rpc("get_friends");
      if (error) throw error;
      setFriends(data || []);
    } catch (error) {
      console.error("Erro ao buscar amigos:", error);
    }
  };

  const handleUserInvited = async (user: Invitee) => {
    onInviteesChange([...selectedInvitees, user]);
    return { error: null };
  };

  const removeInvitee = (inviteeId: string) => {
    onInviteesChange(selectedInvitees.filter((inv) => inv.id !== inviteeId));
  };

  const getStatusBadge = (status: Invitee["status"]) => {
    switch (status) {
      case "convidado":
        return (
          <Badge variant="secondary" className="gap-1">
            <UserCheck className="w-3 h-3" />
            Convidado
          </Badge>
        );
      case "pendente":
        return (
          <Badge variant="outline" className="gap-1 border-yellow-500 text-yellow-700 dark:text-yellow-400">
            <Clock className="w-3 h-3" />
            Pendente
          </Badge>
        );
      case "confirmado":
        return (
          <Badge variant="default" className="gap-1">
            <CheckCircle2 className="w-3 h-3" />
            Confirmado
          </Badge>
        );
      case "convite_email":
        return (
          <Badge variant="outline" className="gap-1">
            <Clock className="w-3 h-3" />
            Por e-mail
          </Badge>
        );
    }
  };

  return (
    <div className="space-y-4">
      <UserInviteSearch
        onUserInvited={handleUserInvited}
        excludeUserIds={selectedInvitees.map((inv) => inv.id)}
        friends={friends}
      />

      {/* Lista de convidados */}
      {selectedInvitees.length > 0 && (
        <div className="space-y-2">
          <Label>Pessoas Convidadas ({selectedInvitees.length})</Label>
          <div className="space-y-2 max-h-64 overflow-y-auto border rounded-md p-3">
            {selectedInvitees.map((invitee) => (
              <div
                key={invitee.id}
                className={cn(
                  "flex items-center gap-3 p-2 rounded-md border",
                  invitee.status === "pendente" && "bg-yellow-50 dark:bg-yellow-950/20"
                )}
              >
                <Avatar className="h-9 w-9">
                  <AvatarImage src={invitee.avatar_url} />
                  <AvatarFallback className="bg-primary/10 text-primary text-xs">
                    {invitee.name.charAt(0)}
                  </AvatarFallback>
                </Avatar>
                <div className="flex-1 min-w-0">
                  <p className="font-medium text-sm truncate">{invitee.name}</p>
                  <p className="text-xs text-muted-foreground truncate">
                    {invitee.username ? `@${invitee.username}` : invitee.email || "Usuario"}
                  </p>
                </div>
                {getStatusBadge(invitee.status)}
                <Button
                  variant="ghost"
                  size="sm"
                  onClick={() => removeInvitee(invitee.id)}
                  className="h-8 w-8 p-0 hover:bg-destructive/10 hover:text-destructive"
                >
                  <X className="h-4 w-4" />
                </Button>
              </div>
            ))}
          </div>
          {selectedInvitees.some((inv) => inv.status === "pendente" || inv.status === "convite_email") && (
            <div className="space-y-1">
              {selectedInvitees.some((inv) => inv.status === "pendente") && (
                <p className="text-xs text-yellow-700 dark:text-yellow-400 flex items-center gap-1">
                  <Clock className="w-3 h-3" />
                  Convites pendentes aguardam ação do convidado
                </p>
              )}
              {selectedInvitees.some((inv) => inv.status === "convite_email") && (
                <p className="text-xs text-muted-foreground flex items-center gap-1">
                  <Clock className="w-3 h-3" />
                  Convites por e-mail serão enviados para não-usuários
                </p>
              )}
            </div>
          )}
        </div>
      )}
    </div>
  );
};


============================================================
FILE PATH: .\src\components\events\OrganizerInviteDialog.tsx
============================================================
import { useState, ReactNode } from "react";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Plus } from "lucide-react";
import { UserInviteSearch } from "./UserInviteSearch";

interface OrganizerInviteDialogProps {
  onInvite: (
    userId: string | null,
    email: string | null,
    name: string,
    isOrganizer: boolean
  ) => Promise<{ error: string | null }>;
  excludeUserIds: string[];
  friends: { friend_id: string }[];
  isOrganizer?: boolean;
  triggerLabel?: ReactNode;
}

export const OrganizerInviteDialog = ({
  onInvite,
  excludeUserIds,
  friends,
  isOrganizer = false,
  triggerLabel = "Convidar Pessoa",
}: OrganizerInviteDialogProps) => {
  const [open, setOpen] = useState(false);

  const handleUserInvited = async (user: {
    id: string;
    user_id?: string;
    name: string;
    email?: string;
    username?: string;
    avatar_url?: string;
    status: "convidado" | "pendente" | "convite_email";
    isFriend: boolean;
  }) => {
    const result = await onInvite(user.user_id || null, user.email || null, user.name, isOrganizer);

    if (!result.error) {
      setOpen(false);
    }

    return result;
  };

  return (
    <Dialog open={open} onOpenChange={setOpen}>
      <DialogTrigger asChild>
        <Button>
          <Plus className="w-4 h-4 mr-2" />
          {triggerLabel}
        </Button>
      </DialogTrigger>
      <DialogContent className="sm:max-w-md">
        <DialogHeader>
          <DialogTitle>
            {isOrganizer ? "Convidar Organizador" : "Convidar Participante"}
          </DialogTitle>
          <DialogDescription>
            Busque por usuário ou email para enviar o convite.
          </DialogDescription>
        </DialogHeader>

        <UserInviteSearch
          onUserInvited={handleUserInvited}
          excludeUserIds={excludeUserIds}
          friends={friends}
        />
      </DialogContent>
    </Dialog>
  );
};


============================================================
FILE PATH: .\src\components\events\UserInviteSearch.tsx
============================================================
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Badge } from "@/components/ui/badge";
import { Alert, AlertDescription } from "@/components/ui/alert";
import { Search, UserPlus, Mail, AlertCircle } from "lucide-react";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";
import { cn } from "@/lib/utils";

interface UserInviteSearchProps {
  onUserInvited: (user: {
    id: string;
    user_id?: string;
    name: string;
    email?: string;
    username?: string;
    avatar_url?: string;
    status: "convidado" | "pendente" | "convite_email";
    isFriend: boolean;
  }) => Promise<{ error: string | null }>;
  excludeUserIds: string[];
  friends: { friend_id: string }[];
}

export const UserInviteSearch = ({
  onUserInvited,
  excludeUserIds,
  friends,
}: UserInviteSearchProps) => {
  const [searchInput, setSearchInput] = useState("");
  const [searchResult, setSearchResult] = useState<{
    id: string;
    display_name?: string | null;
    username?: string | null;
    avatar_url?: string | null;
    email?: string | null;
    identifier?: string;
    isNonUser?: boolean;
  } | null>(null);
  const [searching, setSearching] = useState(false);
  const [notFound, setNotFound] = useState(false);
  const { toast } = useToast();

  const isFriend = (userId: string) => {
    return friends.some((f) => f.friend_id === userId);
  };

  const handleSearch = async () => {
    if (!searchInput.trim()) return;

    setSearching(true);
    setNotFound(false);
    setSearchResult(null);

    try {
      const query = searchInput.trim();
      const identifier = query;
      
      // Usar a função RPC para buscar usuário (funciona para email ou username)
      const { data, error } = await supabase.rpc('search_user_by_identifier', {
        _identifier: query
      });

      if (error) throw error;

      if (data && data.length > 0) {
        const user = data[0];
        setSearchResult({
          id: user.id,
          display_name: user.display_name,
          username: user.username,
          avatar_url: user.avatar_url,
          email: query.includes("@") ? query : null,
          identifier,
          isNonUser: false
        });
      } else {
        // Se não encontrou e parece ser email, é um email não cadastrado
        const isEmail = query.includes("@");
        if (isEmail) {
          setSearchResult({
            id: `email_${query}`,
            email: query,
            display_name: query.split("@")[0],
            identifier,
            isNonUser: true,
          });
        } else {
          setNotFound(true);
        }
      }
    } catch (error) {
      console.error("Erro ao buscar:", error);
      setNotFound(true);
    } finally {
      setSearching(false);
    }
  };

  const handleInvite = async () => {
    if (!searchResult) return;

    // Se for email não cadastrado
    if (searchResult.isNonUser) {
      const result = await onUserInvited({
        id: searchResult.id,
        name: searchResult.display_name,
        email: searchResult.email,
        status: "convite_email",
        isFriend: false,
      });

      if (!result.error) {
        toast({
          title: "Convite por e-mail",
          description: `Um e-mail de convite será enviado para ${searchResult.email}`,
        });

        setSearchInput("");
        setSearchResult(null);
      }
      return;
    }

    // Se já está na lista
    if (excludeUserIds.includes(searchResult.id)) {
      toast({
        title: "Já convidado",
        description: "Esta pessoa já está na lista de convidados.",
        variant: "destructive",
      });
      return;
    }

    const userIsFriend = isFriend(searchResult.id);

    // Se não é amigo, pedir para adicionar primeiro
    if (!userIsFriend) {
      toast({
        title: "Adicione como amigo primeiro",
        description: "Para convidar esta pessoa, você precisa adicioná-la como amigo.",
        variant: "destructive",
      });
      return;
    }

    // Se é amigo, adicionar
    const result = await onUserInvited({
      id: searchResult.id,
      user_id: searchResult.id,
      name: searchResult.display_name || searchResult.username || searchResult.email?.split("@")[0] || "Usuario",
      email: searchResult.email || undefined,
      username: searchResult.username,
      avatar_url: searchResult.avatar_url,
      status: "convidado",
      isFriend: true,
    });

    if (!result.error) {
      toast({
        title: "Convidado adicionado",
        description: `${searchResult.display_name} foi adicionado à lista.`,
      });

      setSearchInput("");
      setSearchResult(null);
    }
  };

  const handleAddFriend = async () => {
    if (!searchResult || searchResult.isNonUser) return;

    try {
      const identifier = searchResult.identifier || searchResult.username || searchResult.email;
      if (!identifier) {
        throw new Error("Identificador invÇ­lido para enviar pedido.");
      }

      // Criar pedido de amizade
      const { error } = await supabase.rpc("send_friend_request", {
        _receiver_identifier: identifier,
      });

      if (error) throw error;

      toast({
        title: "Pedido enviado",
        description: "Convite de amizade enviado com sucesso!",
      });

      setSearchInput("");
      setSearchResult(null);
    } catch (error) {
      console.error("Erro ao enviar pedido:", error);
      toast({
        title: "Erro",
        description: "Não foi possível enviar o pedido de amizade.",
        variant: "destructive",
      });
    }
  };

  return (
    <div className="space-y-4">
      <div className="space-y-2">
        <Label>Buscar pessoa para convidar</Label>
        <div className="flex gap-2">
          <Input
            placeholder="Digite username completo ou email completo"
            value={searchInput}
            onChange={(e) => setSearchInput(e.target.value)}
            onKeyDown={(e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                handleSearch();
              }
            }}
            className="flex-1"
          />
          <Button
            onClick={handleSearch}
            disabled={searching || !searchInput.trim()}
            variant="secondary"
          >
            <Search className="w-4 h-4" />
          </Button>
        </div>
        <p className="text-xs text-muted-foreground">
          Digite o username completo (@usuario) ou email completo (email@exemplo.com)
        </p>
      </div>

      {searching && (
        <Alert>
          <AlertDescription>Buscando...</AlertDescription>
        </Alert>
      )}

      {notFound && (
        <Alert variant="destructive">
          <AlertCircle className="h-4 w-4" />
          <AlertDescription>
            Usuário não encontrado. Verifique se digitou corretamente.
          </AlertDescription>
        </Alert>
      )}

      {searchResult && (
        <div className="border rounded-lg p-4 space-y-3">
          <div className="flex items-center gap-3">
            {!searchResult.isNonUser ? (
              <>
                <Avatar className="h-10 w-10 shrink-0">
                  <AvatarImage src={searchResult.avatar_url} />
                  <AvatarFallback className="bg-primary/10 text-primary">
                    {(searchResult.display_name || searchResult.username || searchResult.email || "U").charAt(0)}
                  </AvatarFallback>
                </Avatar>
                <div className="flex-1 min-w-0">
                  <p className="font-medium truncate">
                    {searchResult.display_name || searchResult.username || searchResult.email?.split("@")[0] || "Usuario"}
                  </p>
                  <p className="text-sm text-muted-foreground truncate">
                    {searchResult.username ? `@${searchResult.username}` : "Usuario cadastrado"}
                  </p>
                </div>
                {!isFriend(searchResult.id) && (
                  <Badge variant="outline" className="shrink-0 border-yellow-500 text-yellow-700 dark:text-yellow-400 whitespace-nowrap">
                    Não é amigo
                  </Badge>
                )}
                {isFriend(searchResult.id) && (
                  <Badge variant="secondary" className="shrink-0 whitespace-nowrap">Amigo</Badge>
                )}
              </>
            ) : (
              <>
                <div className="h-10 w-10 shrink-0 rounded-full bg-muted flex items-center justify-center">
                  <Mail className="h-5 w-5 text-muted-foreground" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="font-medium truncate">{searchResult.email}</p>
                  <p className="text-sm text-muted-foreground">Não é usuário do app</p>
                </div>
                <Badge variant="outline" className="shrink-0 whitespace-nowrap">Convite por e-mail</Badge>
              </>
            )}
          </div>

          <div className="flex gap-2">
            {searchResult.isNonUser ? (
              <Button onClick={handleInvite} className="flex-1" size="sm">
                <Mail className="w-4 h-4 mr-2" />
                Enviar Convite por E-mail
              </Button>
            ) : isFriend(searchResult.id) ? (
              <Button onClick={handleInvite} className="flex-1" size="sm">
                <UserPlus className="w-4 h-4 mr-2" />
                Adicionar ao Evento
              </Button>
            ) : (
              <Button onClick={handleAddFriend} className="flex-1" size="sm" variant="secondary">
                <UserPlus className="w-4 h-4 mr-2" />
                Adicionar como Amigo Primeiro
              </Button>
            )}
          </div>
        </div>
      )}
    </div>
  );
};


============================================================
FILE PATH: .\src\components\friends\FriendCard.tsx
============================================================
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { UserMinus } from "lucide-react";

interface FriendCardProps {
  friendId: string;
  displayName: string;
  username?: string;
  avatarUrl?: string;
  email?: string;
  onRemove: () => void;
  loading?: boolean;
}

export const FriendCard = ({
  displayName,
  username,
  avatarUrl,
  email,
  onRemove,
  loading,
}: FriendCardProps) => {
  const getInitials = () => {
    if (displayName) {
      return displayName.charAt(0).toUpperCase();
    }
    if (username) {
      return username.charAt(0).toUpperCase();
    }
    if (email) {
      return email.charAt(0).toUpperCase();
    }
    return "U";
  };

  return (
    <Card className="overflow-hidden hover:shadow-md transition-shadow">
      <CardContent className="p-4">
        <div className="flex items-center gap-4">
          <Avatar className="h-12 w-12">
            <AvatarImage src={avatarUrl || undefined} alt={displayName} />
            <AvatarFallback className="bg-primary/10 text-primary">
              {getInitials()}
            </AvatarFallback>
          </Avatar>

          <div className="flex-1 min-w-0">
            <p className="font-semibold text-foreground truncate">
              {displayName}
            </p>
            {username && (
              <p className="text-sm text-muted-foreground truncate">
                @{username}
              </p>
            )}
          </div>

          <Button
            variant="ghost"
            size="sm"
            onClick={onRemove}
            disabled={loading}
            className="hover:bg-destructive/10 hover:text-destructive"
          >
            <UserMinus className="w-4 h-4" />
          </Button>
        </div>
      </CardContent>
    </Card>
  );
};


============================================================
FILE PATH: .\src\components\friends\FriendRequestCard.tsx
============================================================
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { Check, X } from "lucide-react";

interface FriendRequestCardProps {
  requestId: string;
  senderId: string;
  senderName: string;
  senderAvatar?: string;
  createdAt: string;
  onAccept: () => void;
  onReject: () => void;
  loading?: boolean;
}

export const FriendRequestCard = ({
  senderName,
  senderAvatar,
  createdAt,
  onAccept,
  onReject,
  loading,
}: FriendRequestCardProps) => {
  const getInitials = () => {
    return senderName.charAt(0).toUpperCase();
  };

  const formatDate = (dateStr: string) => {
    const date = new Date(dateStr);
    const now = new Date();
    const diffMs = now.getTime() - date.getTime();
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);

    if (diffMins < 1) return "agora";
    if (diffMins < 60) return `há ${diffMins}min`;
    if (diffHours < 24) return `há ${diffHours}h`;
    if (diffDays < 7) return `há ${diffDays}d`;
    return date.toLocaleDateString("pt-BR");
  };

  return (
    <Card className="overflow-hidden border-l-4 border-l-primary">
      <CardContent className="p-4">
        <div className="flex items-center gap-4">
          <Avatar className="h-12 w-12">
            <AvatarImage src={senderAvatar || undefined} alt={senderName} />
            <AvatarFallback className="bg-primary/10 text-primary">
              {getInitials()}
            </AvatarFallback>
          </Avatar>

          <div className="flex-1 min-w-0">
            <p className="font-semibold text-foreground truncate">
              {senderName}
            </p>
            <p className="text-xs text-muted-foreground">
              {formatDate(createdAt)}
            </p>
          </div>

          <div className="flex gap-2">
            <Button
              variant="default"
              size="sm"
              onClick={onAccept}
              disabled={loading}
            >
              <Check className="w-4 h-4" />
            </Button>
            <Button
              variant="outline"
              size="sm"
              onClick={onReject}
              disabled={loading}
              className="hover:bg-destructive/10 hover:text-destructive"
            >
              <X className="w-4 h-4" />
            </Button>
          </div>
        </div>
      </CardContent>
    </Card>
  );
};


============================================================
FILE PATH: .\src\components\friends\FriendsDialog.tsx
============================================================
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Users, Search, UserPlus, Loader2 } from "lucide-react";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";
import { useAuth } from "@/hooks/useAuth";
import { UserSearchCard } from "./UserSearchCard";
import { FriendCard } from "./FriendCard";
import { FriendRequestCard } from "./FriendRequestCard";

interface Friend {
  friend_id: string;
  display_name: string;
  avatar_url?: string;
  username?: string | null;
}

interface FriendRequest {
  request_id: string;
  sender_id: string;
  sender_name: string;
  sender_avatar?: string;
  created_at: string;
}

interface SearchResult {
  id: string;
  display_name: string;
  username: string;
  avatar_url?: string;
  email: string;
}

export const FriendsDialog = () => {
  const [open, setOpen] = useState(false);
  const [searchTerm, setSearchTerm] = useState("");
  const [searching, setSearching] = useState(false);
  const [searchResult, setSearchResult] = useState<SearchResult | null>(null);
  const [friends, setFriends] = useState<Friend[]>([]);
  const [pendingRequests, setPendingRequests] = useState<FriendRequest[]>([]);
  const [loading, setLoading] = useState(false);
  const [actionLoading, setActionLoading] = useState<string | null>(null);
  const { toast } = useToast();
  const { user } = useAuth();

  // Buscar amigos ao abrir o dialog
  useEffect(() => {
    if (open) {
      fetchFriends();
      fetchPendingRequests();
    }
  }, [open]);

  const fetchFriends = async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase.rpc("get_friends");

      if (error) throw error;

      setFriends(data || []);
    } catch (error) {
      const err = error as { message?: string };
      console.error("Erro ao buscar amigos:", err);
    } finally {
      setLoading(false);
    }
  };

  const fetchPendingRequests = async () => {
    try {
      const { data, error } = await supabase.rpc("get_pending_friend_requests");

      if (error) throw error;

      setPendingRequests(data || []);
    } catch (error) {
      const err = error as { message?: string };
      console.error("Erro ao buscar solicitações:", err);
    }
  };

  const searchUser = async () => {
    if (!searchTerm.trim()) {
      setSearchResult(null);
      return;
    }

    try {
      setSearching(true);
      setSearchResult(null);

      const normalizedSearch = searchTerm.trim().toLowerCase();
      const isEmail = normalizedSearch.includes("@") && normalizedSearch.includes(".");

      if (isEmail) {
        // Para email, apenas validar formato e permitir envio
        // A função RPC fará a busca real
        toast({
          title: "Busca por email",
          description: "Enviaremos a solicitação para este email se ele existir.",
        });

        setSearchResult({
          id: "", // Não temos o ID ainda
          display_name: normalizedSearch,
          username: "",
          avatar_url: undefined,
          email: normalizedSearch,
        });
      } else {
        // Buscar por username (remover @ se houver)
        const usernameSearch = normalizedSearch.replace(/^@/, "");

        const { data, error } = await supabase
          .from("profiles")
          .select("id, display_name, username, avatar_url")
          .ilike("username", usernameSearch)
          .limit(1)
          .maybeSingle();

        if (error) throw error;

        if (!data) {
          toast({
            title: "Usuário não encontrado",
            description: "Não existe um usuário com esse nome de usuário.",
            variant: "destructive",
          });
          return;
        }

        setSearchResult({
          ...data,
          email: data.username, // Usar username como identificador
        });
      }
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro na busca",
        description: err?.message || "Não foi possível buscar o usuário.",
        variant: "destructive",
      });
    } finally {
      setSearching(false);
    }
  };

  const handleSendRequest = async (identifier: string) => {
    if (!user) return;

    try {
      setActionLoading(identifier);

      const { data, error } = await supabase.rpc("send_friend_request", {
        _receiver_identifier: identifier,
      });

      if (error) throw error;

      toast({
        title: "Solicitação enviada!",
        description: "Aguarde a aceitação do seu amigo.",
      });

      setSearchResult(null);
      setSearchTerm("");
      fetchFriends();
    } catch (error) {
      const err = error as { message?: string; error_description?: string };
      const errorMessage = err.message || err.error_description || "Erro desconhecido";

      console.error("Erro detalhado ao enviar solicitação:", error);

      // Tenta usar a mensagem direta do backend se parecer uma mensagem amigável de erro
      if (errorMessage !== "Erro desconhecido" &&
        (errorMessage.includes("já existe") ||
          errorMessage.includes("pendente") ||
          errorMessage.includes("encontrado") ||
          errorMessage.includes("auto") ||
          errorMessage.includes("amigos"))) {
        toast({
          title: "Atenção",
          description: errorMessage,
          variant: "destructive",
        });
      } else {
        // Fallback para mensagens específicas mapeadas
        if (errorMessage.includes("já são amigos")) {
          toast({
            title: "Vocês já são amigos",
            description: "Esta pessoa já está na sua lista de amigos.",
            variant: "destructive",
          });
        } else if (errorMessage.includes("Usuário não encontrado")) {
          toast({
            title: "Usuário não encontrado",
            description: "Não foi possível encontrar este usuário.",
            variant: "destructive",
          });
        } else {
          toast({
            title: "Não foi possível enviar",
            description: errorMessage || "Tente novamente mais tarde.",
            variant: "destructive",
          });
        }
      }
    } finally {
      setActionLoading(null);
    }
  };

  const handleAcceptRequest = async (requestId: string) => {
    try {
      setActionLoading(requestId);

      const { error } = await supabase.rpc("respond_to_friend_request", {
        _request_id: requestId,
        _accept: true,
      });

      if (error) throw error;

      toast({
        title: "Amizade aceita!",
        description: "Vocês agora são amigos.",
      });

      fetchFriends();
      fetchPendingRequests();
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao aceitar solicitação",
        description: err?.message || "Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setActionLoading(null);
    }
  };

  const handleRejectRequest = async (requestId: string) => {
    try {
      setActionLoading(requestId);

      const { error } = await supabase.rpc("respond_to_friend_request", {
        _request_id: requestId,
        _accept: false,
      });

      if (error) throw error;

      toast({
        title: "Solicitação recusada",
        description: "A solicitação foi removida.",
      });

      fetchPendingRequests();
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao recusar solicitação",
        description: err?.message || "Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setActionLoading(null);
    }
  };

  const handleRemoveFriend = async (friendId: string) => {
    if (!confirm("Deseja remover este amigo? Esta ação não pode ser desfeita.")) {
      return;
    }

    try {
      setActionLoading(friendId);

      // Deletar amizade usando filtro apropriado
      const { error } = await supabase
        .from("friendships")
        .delete()
        .or(`and(user_id_1.eq.${user?.id},user_id_2.eq.${friendId}),and(user_id_1.eq.${friendId},user_id_2.eq.${user?.id})`);

      if (error) throw error;

      toast({
        title: "Amigo removido",
        description: "A amizade foi desfeita.",
      });

      fetchFriends();
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao remover amigo",
        description: err?.message || "Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setActionLoading(null);
    }
  };

  const isFriend = (userId: string) => {
    return friends.some((f) => f.friend_id === userId);
  };

  const hasPendingRequest = () => {
    // Placeholder - pode ser implementado se necessário
    return false;
  };

  return (
    <Dialog open={open} onOpenChange={setOpen} >
      <DialogTrigger asChild>
        <Button variant="outline" size="default">
          <Users className="w-4 h-4 mr-2" />
          Amigos
        </Button>
      </DialogTrigger>
      <DialogContent className="max-w-2xl max-h-[85vh] overflow-hidden flex flex-col">
        <DialogHeader>
          <DialogTitle>Gerenciar Amigos</DialogTitle>
          <DialogDescription>
            Adicione amigos para facilitar a criação de eventos em grupo
          </DialogDescription>
        </DialogHeader>

        <Tabs defaultValue="search" className="flex-1 flex flex-col overflow-hidden">
          <TabsList className="grid w-full grid-cols-3">
            <TabsTrigger value="search">
              <Search className="w-4 h-4 mr-2" />
              Buscar
            </TabsTrigger>
            <TabsTrigger value="friends">
              <Users className="w-4 h-4 mr-2" />
              Amigos ({friends.length})
            </TabsTrigger>
            <TabsTrigger value="requests">
              <UserPlus className="w-4 h-4 mr-2" />
              Solicitações ({pendingRequests.length})
            </TabsTrigger>
          </TabsList>

          <TabsContent value="search" className="flex-1 overflow-y-auto space-y-4 mt-4">
            <div className="space-y-2">
              <Label htmlFor="search">Buscar por nome de usuário ou e-mail</Label>
              <div className="flex gap-2">
                <Input
                  id="search"
                  placeholder="Digite @usuario ou email@exemplo.com"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  onKeyDown={(e) => {
                    if (e.key === "Enter") {
                      searchUser();
                    }
                  }}
                />
                <Button onClick={searchUser} disabled={searching || !searchTerm.trim()}>
                  {searching ? (
                    <Loader2 className="w-4 h-4 animate-spin" />
                  ) : (
                    <Search className="w-4 h-4" />
                  )}
                </Button>
              </div>
              <p className="text-xs text-muted-foreground">
                Digite o nome de usuário (sem @) ou o e-mail completo
              </p>
            </div>

            {searchResult && (
              <div className="mt-4">
                <h3 className="text-sm font-semibold mb-3">Resultado da busca</h3>
                <UserSearchCard
                  userId={searchResult.id}
                  displayName={searchResult.display_name}
                  username={searchResult.username}
                  avatarUrl={searchResult.avatar_url}
                  email={searchResult.email}
                  isFriend={isFriend(searchResult.id)}
                  hasPendingRequest={hasPendingRequest()}
                  onSendRequest={() => handleSendRequest(searchResult.username || searchResult.email)}
                  loading={actionLoading === (searchResult.username || searchResult.email)}
                />
              </div>
            )}

            {!searchResult && !searching && searchTerm.trim() === "" && (
              <div className="text-center py-8 text-muted-foreground">
                <Search className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>Digite um nome de usuário ou e-mail para buscar</p>
              </div>
            )}
          </TabsContent>

          <TabsContent value="friends" className="flex-1 overflow-y-auto space-y-3 mt-4">
            {loading ? (
              <div className="flex items-center justify-center py-8">
                <Loader2 className="w-8 h-8 animate-spin text-primary" />
              </div>
            ) : friends.length === 0 ? (
              <div className="text-center py-8 text-muted-foreground">
                <Users className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>Você ainda não tem amigos adicionados.</p>
                <p className="text-sm mt-1">Use a busca para encontrar pessoas!</p>
              </div>
            ) : (
              friends.map((friend) => (
                <FriendCard
                  key={friend.friend_id}
                  friendId={friend.friend_id}
                  displayName={friend.display_name}
                  avatarUrl={friend.avatar_url}
                  username={friend.username || undefined}
                  onRemove={() => handleRemoveFriend(friend.friend_id)}
                  loading={actionLoading === friend.friend_id}
                />
              ))
            )}
          </TabsContent>

          <TabsContent value="requests" className="flex-1 overflow-y-auto space-y-3 mt-4">
            {loading ? (
              <div className="flex items-center justify-center py-8">
                <Loader2 className="w-8 h-8 animate-spin text-primary" />
              </div>
            ) : pendingRequests.length === 0 ? (
              <div className="text-center py-8 text-muted-foreground">
                <UserPlus className="w-12 h-12 mx-auto mb-3 opacity-50" />
                <p>Nenhuma solicitação pendente.</p>
              </div>
            ) : (
              pendingRequests.map((request) => (
                <FriendRequestCard
                  key={request.request_id}
                  requestId={request.request_id}
                  senderId={request.sender_id}
                  senderName={request.sender_name}
                  senderAvatar={request.sender_avatar}
                  createdAt={request.created_at}
                  onAccept={() => handleAcceptRequest(request.request_id)}
                  onReject={() => handleRejectRequest(request.request_id)}
                  loading={actionLoading === request.request_id}
                />
              ))
            )}
          </TabsContent>
        </Tabs>
      </DialogContent>
    </Dialog >
  );
};


============================================================
FILE PATH: .\src\components\friends\FriendSelector.tsx
============================================================
import { useState, useEffect } from "react";
import { useQuery } from "@tanstack/react-query";
import { supabase } from "@/integrations/supabase/client";
import { Check, Users } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import {
  Command,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
} from "@/components/ui/command";
import {
  Popover,
  PopoverContent,
  PopoverTrigger,
} from "@/components/ui/popover";

interface Friend {
  friend_id: string;
  display_name: string;
  avatar_url: string | null;
  username?: string | null;
}

interface FriendSelectorProps {
  selectedFriends: string[];
  onSelectionChange: (friendIds: string[]) => void;
}

export function FriendSelector({ selectedFriends, onSelectionChange }: FriendSelectorProps) {
  const [open, setOpen] = useState(false);
  const [search, setSearch] = useState("");

  const { data: friends = [], isLoading } = useQuery({
    queryKey: ['friends', search],
    queryFn: async () => {
      const { data, error } = await supabase.rpc('get_friends', {
        _search: search || null
      });
      if (error) throw error;
      return data as Friend[];
    },
  });

  const toggleFriend = (friendId: string) => {
    if (selectedFriends.includes(friendId)) {
      onSelectionChange(selectedFriends.filter(id => id !== friendId));
    } else {
      onSelectionChange([...selectedFriends, friendId]);
    }
  };

  const selectedFriendNames = friends
    .filter(f => selectedFriends.includes(f.friend_id))
    .map(f => f.display_name)
    .join(", ");

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <Button
          variant="outline"
          role="combobox"
          aria-expanded={open}
          className="w-full justify-between"
        >
          {selectedFriends.length > 0 ? (
            <span className="truncate">{selectedFriendNames}</span>
          ) : (
            "Selecione amigos para convidar"
          )}
          <Users className="ml-2 h-4 w-4 shrink-0 opacity-50" />
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-full p-0" align="start">
        <Command>
          <CommandInput
            placeholder="Buscar amigos..."
            value={search}
            onValueChange={setSearch}
          />
          <CommandEmpty>
            {isLoading ? "Carregando..." : "Nenhum amigo encontrado."}
          </CommandEmpty>
          <CommandGroup>
            {friends.map((friend) => (
              <CommandItem
                key={friend.friend_id}
                onSelect={() => toggleFriend(friend.friend_id)}
              >
                <Check
                  className={cn(
                    "mr-2 h-4 w-4",
                    selectedFriends.includes(friend.friend_id) ? "opacity-100" : "opacity-0"
                  )}
                />
                <div className="flex items-center gap-2 flex-1">
                  <div className="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center">
                    {friend.avatar_url ? (
                      <img src={friend.avatar_url} alt="" className="w-full h-full rounded-full object-cover" />
                    ) : (
                      <Users className="h-4 w-4 text-primary" />
                    )}
                  </div>
                  <div className="flex-1 min-w-0">
                    <p className="font-medium truncate">{friend.display_name}</p>
                    <p className="text-xs text-muted-foreground truncate">
                      {friend.username ? `@${friend.username}` : ""}
                    </p>
                  </div>
                </div>
              </CommandItem>
            ))}
          </CommandGroup>
        </Command>
      </PopoverContent>
    </Popover>
  );
}


============================================================
FILE PATH: .\src\components\friends\UserSearchCard.tsx
============================================================
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Button } from "@/components/ui/button";
import { Card, CardContent } from "@/components/ui/card";
import { UserPlus, Check } from "lucide-react";

interface UserSearchCardProps {
  userId: string;
  displayName: string;
  username: string;
  avatarUrl?: string;
  email: string;
  isFriend: boolean;
  hasPendingRequest: boolean;
  onSendRequest: () => void;
  loading?: boolean;
}

export const UserSearchCard = ({
  displayName,
  username,
  avatarUrl,
  email,
  isFriend,
  hasPendingRequest,
  onSendRequest,
  loading,
}: UserSearchCardProps) => {
  const getInitials = () => {
    if (displayName) {
      return displayName.charAt(0).toUpperCase();
    }
    return email.charAt(0).toUpperCase();
  };

  return (
    <Card className="overflow-hidden">
      <CardContent className="p-4">
        <div className="flex items-center gap-4">
          <Avatar className="h-12 w-12">
            <AvatarImage src={avatarUrl} alt={displayName || email} />
            <AvatarFallback className="bg-primary/10 text-primary">
              {getInitials()}
            </AvatarFallback>
          </Avatar>

          <div className="flex-1 min-w-0">
            <p className="font-semibold text-foreground truncate">
              {displayName || "Usuário"}
            </p>
            <p className="text-sm text-muted-foreground truncate">
              @{username || email.split("@")[0]}
            </p>
          </div>

          <div>
            {isFriend ? (
              <Button variant="outline" size="sm" disabled>
                <Check className="w-4 h-4 mr-2" />
                Amigos
              </Button>
            ) : hasPendingRequest ? (
              <Button variant="outline" size="sm" disabled>
                Pendente
              </Button>
            ) : (
              <Button
                variant="default"
                size="sm"
                onClick={onSendRequest}
                disabled={loading}
              >
                <UserPlus className="w-4 h-4 mr-2" />
                {loading ? "Enviando..." : "Adicionar"}
              </Button>
            )}
          </div>
        </div>
      </CardContent>
    </Card>
  );
};


============================================================
FILE PATH: .\src\components\landing\Benefits.tsx
============================================================
import { Brain, CheckCircle, DollarSign, FileText, Smartphone } from "lucide-react";

const benefits = [
  {
    icon: Brain,
    title: "Lista inteligente (IA)",
    description: "A UNE.AI entende o tipo de evento e sugere tudo o que você precisa.",
  },
  {
    icon: CheckCircle,
    title: "RSVP inteligente",
    description: "Acompanhe confirmações e lembretes automáticos.",
  },
  {
    icon: DollarSign,
    title: "Divisão de custos",
    description: "O ReUNE estima valores por pessoa em segundos.",
  },
  {
    icon: FileText,
    title: "Templates prontos",
    description: "Crie eventos com listas sugeridas (churrasco, jantar, aniversário…).",
  },
  {
    icon: Smartphone,
    title: "Funciona em qualquer lugar",
    description: "Use no navegador de qualquer dispositivo.",
  },
];

export const Benefits = () => {
  return (
    <section className="py-24 px-4">
      <div className="container max-w-7xl mx-auto">
        <div className="text-center space-y-4 mb-16">
          <h2 className="text-4xl md:text-5xl font-bold">Por que usar o ReUNE</h2>
          <p className="text-xl text-muted-foreground">
            Inteligência, praticidade e colaboração em um só lugar.
          </p>
        </div>

        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-6">
          {benefits.map((benefit, index) => (
            <div
              key={index}
              className="group bg-card rounded-2xl p-6 shadow-soft hover:shadow-card transition-all duration-300 hover:-translate-y-1 animate-fade-in flex flex-col items-center text-center"
              style={{ animationDelay: `${index * 50}ms` }}
            >
              <div
                className="w-16 h-16 rounded-lg flex items-center justify-center mb-5 group-hover:scale-110 transition-transform mx-auto"
                style={{
                  background: 'linear-gradient(135deg, hsl(173 100% 24%), hsl(187 100% 42%))'
                }}
              >
                <benefit.icon className="w-10 h-10 text-white" />
              </div>

              <h3 className="text-xl font-semibold mb-2">{benefit.title}</h3>
              <p className="text-muted-foreground text-sm leading-relaxed">
                {benefit.description}
              </p>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\Demo.tsx
============================================================
import { useRef, useState } from "react";
import { Play } from "lucide-react";
import videoPromo from "@/assets/video_promo.mp4";

export const Demo = () => {
  const videoRef = useRef<HTMLVideoElement>(null);
  const [isPlaying, setIsPlaying] = useState(false);

  const handlePlayClick = () => {
    if (videoRef.current) {
      if (isPlaying) {
        videoRef.current.pause();
      } else {
        videoRef.current.play();
      }
      setIsPlaying(!isPlaying);
    }
  };

  return (
    <section id="demo" className="py-24 px-4 bg-muted/30">
      <div className="container max-w-5xl mx-auto">
        <div className="text-center space-y-4 mb-12">
          <h2 className="text-4xl md:text-5xl font-bold">Por que o ReUNE?</h2>
          <p className="text-xl text-muted-foreground">
            Veja como organização e IA podem transformar sua experiência de eventos.
          </p>
        </div>

        <div
          className="relative rounded-3xl overflow-hidden shadow-floating bg-black aspect-video flex items-center justify-center group cursor-pointer"
          onClick={handlePlayClick}
        >
          <video
            ref={videoRef}
            src={videoPromo}
            className="w-full h-full object-cover"
            onEnded={() => setIsPlaying(false)}
            onPause={() => setIsPlaying(false)}
            onPlay={() => setIsPlaying(true)}
          />

          {!isPlaying && (
            <div className="absolute inset-0 bg-black/40 flex items-center justify-center transition-colors group-hover:bg-black/50">
              <div className="relative z-10 flex flex-col items-center gap-4">
                <div className="w-20 h-20 rounded-full bg-white/90 flex items-center justify-center group-hover:scale-110 transition-transform shadow-lg">
                  <Play className="w-10 h-10 text-primary ml-1" />
                </div>
                <span className="text-white text-lg font-medium">
                  Demonstração
                </span>
              </div>
            </div>
          )}
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\FAQ.tsx
============================================================
import {
  Accordion,
  AccordionContent,
  AccordionItem,
  AccordionTrigger,
} from "@/components/ui/accordion";

const faqs = [
  {
    question: "O ReUNE é gratuito?",
    answer: "Sim! Você pode usar gratuitamente e criar quantos eventos quiser.",
  },
  {
    question: "O que a IA faz exatamente?",
    answer: "A UNE.AI ajuda a montar a lista de itens, quantidades e lembretes automáticos baseado no tipo de evento que você criar.",
  },
  {
    question: "Preciso baixar algum aplicativo?",
    answer: "Não. O ReUNE funciona diretamente no navegador do seu celular ou computador, sem ocupar espaço.",
  },
  {
    question: "Meus dados são seguros?",
    answer: "Sim. Seguimos padrões LGPD e não compartilhamos informações pessoais com terceiros.",
  },
  {
    question: "Posso usar no WhatsApp?",
    answer: "Sim. É possível compartilhar convites e listas diretamente pelo WhatsApp com seus convidados.",
  },
  {
    question: "Há versão para empresas?",
    answer: "Está em desenvolvimento e será lançada em breve com recursos adicionais para eventos corporativos.",
  },
];

export const FAQ = () => {
  return (
    <section className="py-24 px-4 bg-muted/30">
      <div className="container max-w-4xl mx-auto">
        <div className="text-center space-y-4 mb-16">
          <h2 className="text-4xl md:text-5xl font-bold">Perguntas frequentes</h2>
        </div>

        <Accordion type="single" collapsible className="space-y-4">
          {faqs.map((faq, index) => (
            <AccordionItem
              key={index}
              value={`item-${index}`}
              className="bg-card rounded-2xl px-6 shadow-soft border-0"
            >
              <AccordionTrigger className="text-left hover:no-underline py-6">
                <span className="text-lg font-semibold">{faq.question}</span>
              </AccordionTrigger>
              <AccordionContent className="text-muted-foreground pb-6">
                {faq.answer}
              </AccordionContent>
            </AccordionItem>
          ))}
        </Accordion>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\FinalCTA.tsx
============================================================
import { Button } from "@/components/ui/button";
import { ArrowRight } from "lucide-react";
import { useNavigate } from "react-router-dom";

export const FinalCTA = () => {
  const navigate = useNavigate();

  return (
    <>
      <section className="py-24 px-4">
        <div className="container max-w-4xl mx-auto">
          <div className="relative rounded-3xl overflow-hidden">
            {/* Background with gradient */}
            <div className="absolute inset-0 bg-gradient-to-br from-orange via-primary to-gold opacity-90" />
            
            {/* Content */}
            <div className="relative z-10 text-center py-20 px-6 text-white">
              <h2 className="text-4xl md:text-5xl font-bold mb-4">
                Pronto para o seu próximo evento?
              </h2>
              <p className="text-xl mb-8 opacity-90">
                Comece grátis agora e veja como a IA simplifica tudo.
              </p>
              
              <Button
  size="lg"
  onClick={() => navigate("/app")}
  className="bg-white text-gray-900 hover:bg-white/90 dark:bg-gray-900 dark:text-white shadow-floating group"
>
  Começar agora — grátis
  <ArrowRight className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
</Button>
</div>
          

            {/* Decorative elements */}
            <div className="absolute top-4 left-4 w-20 h-20 bg-white/10 rounded-full blur-2xl" />
            <div className="absolute bottom-4 right-4 w-32 h-32 bg-white/10 rounded-full blur-3xl" />
          </div>
        </div>
      </section>

      {/* Sticky mobile CTA */}
      <div className="fixed bottom-0 left-0 right-0 p-4 bg-background/95 backdrop-blur-lg border-t lg:hidden z-50">
        <Button
          size="lg"
          onClick={() => navigate("/app")}
          className="w-full group"
        >
          Começar agora — grátis
          <ArrowRight className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
        </Button>
      </div>
    </>
  );
};


============================================================
FILE PATH: .\src\components\landing\Footer.tsx
============================================================
import { Instagram, Youtube } from "lucide-react";

export const Footer = () => {
  const currentYear = new Date().getFullYear();

  return (
    <footer className="bg-muted/30 py-12 px-4">
      <div className="container max-w-7xl mx-auto">
        <div className="grid md:grid-cols-4 gap-8 mb-12">
          {/* Brand */}
          <div className="space-y-4">
            <h3 className="font-semibold mb-4">ReUNE</h3>
            <p className="text-sm text-muted-foreground">Organize eventos sem caos, com ajuda de IA.</p>
          </div>

          {/* Legal */}
          <div>
            <h4 className="font-semibold mb-4">Legal</h4>
            <ul className="space-y-2 text-sm">
              <li>
                <a href="/termos" className="text-muted-foreground hover:text-foreground transition-colors">
                  Termos de Uso
                </a>
              </li>
              <li>
                <a href="/privacidade" className="text-muted-foreground hover:text-foreground transition-colors">
                  Política de Privacidade
                </a>
              </li>
            </ul>
          </div>

          {/* Links */}
          <div>
            <h4 className="font-semibold mb-4">Recursos</h4>
            <ul className="space-y-2 text-sm">
              <li>
                <a href="/status" className="text-muted-foreground hover:text-foreground transition-colors">
                  Status do Sistema
                </a>
              </li>
              <li>
                <a href="/changelog" className="text-muted-foreground hover:text-foreground transition-colors">
                  Changelog
                </a>
              </li>
              <li>
                <a href="/presskit" className="text-muted-foreground hover:text-foreground transition-colors">
                  Press Kit
                </a>
              </li>
            </ul>
          </div>

          {/* Contact & Social */}
          <div>
            <h4 className="font-semibold mb-4">Contato</h4>
            <ul className="space-y-2 text-sm mb-4">
              <li>
                <a
                  href="mailto:contato@reuneapp.com.br"
                  className="text-muted-foreground hover:text-foreground transition-colors"
                >
                  contato@reuneapp.com.br
                </a>
              </li>
            </ul>

            <div className="flex gap-3">
              <a
                href="https://instagram.com"
                target="_blank"
                rel="noopener noreferrer"
                className="w-9 h-9 rounded-lg bg-card hover:bg-primary/10 flex items-center justify-center transition-colors"
              >
                <Instagram className="w-5 h-5" />
              </a>
              <a
                href="https://youtube.com"
                target="_blank"
                rel="noopener noreferrer"
                className="w-9 h-9 rounded-lg bg-card hover:bg-primary/10 flex items-center justify-center transition-colors"
              >
                <Youtube className="w-5 h-5" />
              </a>
            </div>
          </div>
        </div>

        {/* Bottom bar */}
        <div className="pt-8 border-t space-y-3">
          {/* Continuous Improvement Badge */}
          <div className="flex items-center justify-center gap-2 text-sm">
            <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-primary/10 text-primary">
              <span className="relative flex h-2 w-2">
                <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                <span className="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
              </span>
              <span className="font-medium">Em constante evolução</span>
            </div>
            <span className="text-muted-foreground">
              Nossa IA está sendo aprimorada continuamente
            </span>
          </div>

          <div className="text-center text-sm text-muted-foreground">
            © {currentYear} ReUNE. Todos os direitos reservados.
          </div>
        </div>
      </div>
    </footer>
  );
};


============================================================
FILE PATH: .\src\components\landing\Hero.tsx
============================================================
import { Button } from "@/components/ui/button";
import { ArrowRight, Sparkles, Star } from "lucide-react";
import { useNavigate } from "react-router-dom";
import mockup4k from "@/assets/mockup4k.mp4";

export const Hero = () => {
  const navigate = useNavigate();

  const scrollToDemo = () => {
    document.getElementById("demo")?.scrollIntoView({ behavior: "smooth" });
  };

  return (
    <section className="relative min-h-screen flex items-center justify-center overflow-hidden px-4 py-20">
      {/* Background gradient */}
      <div className="absolute inset-0 bg-gradient-to-br from-orange/5 via-background to-cyan/5" />

      <div className="container max-w-7xl mx-auto relative z-10">
        <div className="grid lg:grid-cols-2 gap-12 items-center">
          {/* Content */}
          <div className="text-center lg:text-left space-y-8 animate-fade-in">
            {/* Enhanced AI Badge - More prominent */}
            <div className="inline-flex items-center gap-2 px-5 py-3 rounded-full bg-gradient-to-r from-orange-500/20 to-amber-500/20 border-2 border-orange-500/30 text-orange-600 dark:text-orange-400 text-base font-semibold shadow-lg hover:shadow-orange-500/30 hover:scale-105 transition-all duration-300 group">
              <Sparkles className="w-5 h-5 animate-pulse group-hover:rotate-12 transition-transform" />
              <span>Powered by UNE.AI</span>
              <div className="w-2 h-2 rounded-full bg-orange-500 animate-pulse" />
            </div>

            {/*<h1 className="text-5xl md:text-6xl lg:text-7xl font-bold leading-tight">
              Organize eventos{" "}
              <span className="bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 bg-clip-text text-transparent">
                sem caos
              </span>{" "}
              — com ajuda de IA.
            </h1>*/}

            <h1 className="text-5xl md:text-6xl lg:text-7xl font-bold leading-tight">
              Reúna pessoas,{" "}
              <span className="bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 bg-clip-text text-transparent">
                não problemas
              </span>
              .
            </h1>


            <p className="text-xl text-muted-foreground max-w-2xl">
              O ReUNE distribui tarefas, confirma presenças e estima custos automaticamente.
            </p>

            {/* CTAs */}
            <div className="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
              <Button size="lg" onClick={() => navigate("/app")} className="group">
                Entrar no ReUNE
                <ArrowRight className="w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform" />
              </Button>
              <Button size="lg" variant="outline" onClick={scrollToDemo}>
                Ver na prática (30s)
              </Button>
            </div>

            {/* Social proof - Enhanced AI emphasis */}
            <div className="flex items-center gap-6 justify-center lg:justify-start text-sm">
              <span className="flex items-center gap-2 px-3 py-1.5 rounded-lg bg-primary/10 text-primary font-medium">
                <Star className="w-4 h-4 fill-primary" />
                Inteligência Artificial UNE.AI
              </span>
            </div>

            {/* PWA Badge */}
            {/* <div className="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-muted text-xs">
              📱 Instale no celular em 2 toques
            </div> */}
          </div>

          {/* Visual */}
          <div className="relative animate-scale-in">
            <div className="relative">
              <video
                src={mockup4k}
                autoPlay
                muted
                playsInline
                preload="auto"
                onEnded={(e) => {
                  const v = e.currentTarget;
                  v.pause();
                  try {
                    v.currentTime = v.duration;
                  } catch { }
                }}
                className="w-full max-w-md mx-auto rounded-2xl drop-shadow-2xl"
              />
            </div>

            {/* Floating AI badge */}
            <div className="absolute -top-4 -right-4 bg-primary text-primary-foreground px-4 py-2 rounded-full shadow-floating animate-pulse">
              <Sparkles className="w-5 h-5" />
            </div>
          </div>
        </div>
      </div>

      {/* Scroll indicator */}
      <div className="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
        <div className="w-6 h-10 rounded-full border-2 border-muted-foreground/30 flex items-start justify-center p-2">
          <div className="w-1 h-3 bg-primary rounded-full" />
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\HowItWorks.tsx
============================================================
import { Calendar, Sparkles, Users, ListTodo, CheckCircle2, Share2 } from "lucide-react";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { motion, AnimatePresence } from "framer-motion";

const stepsWithAI = [
  {
    number: "01",
    icon: Sparkles,
    title: "Descreva seu evento",
    description: "Diga para a IA o que você quer: 'Churrasco para 20 pessoas no sábado à tarde'.",
  },
  {
    number: "02",
    icon: Calendar,
    title: "IA cria tudo",
    description: "A IA define data, local, cria a lista de compras e calcula quantidades ideais.",
  },
  {
    number: "03",
    icon: Users,
    title: "Convide e confirme",
    description: "Receba o link pronto para enviar aos convidados e gerenciar confirmações.",
  },
];

const stepsWithoutAI = [
  {
    number: "01",
    icon: ListTodo,
    title: "Monte sua lista",
    description: "Crie sua lista de itens manualmente, com total controle do que precisa.",
  },
  {
    number: "02",
    icon: Share2,
    title: "Compartilhe",
    description: "Envie o convite personalizado para seus amigos via WhatsApp.",
  },
  {
    number: "03",
    icon: CheckCircle2,
    title: "Gerencie tudo",
    description: "Acompanhe confirmações e quem ficou responsável por cada item em tempo real.",
  },
];

export const HowItWorks = () => {
  return (
    <section className="py-24 px-4 bg-muted/30">
      <div className="container max-w-7xl mx-auto">
        <div className="text-center space-y-4 mb-12">
          <h2 className="text-4xl md:text-5xl font-bold">Como funciona</h2>
          <p className="text-xl text-muted-foreground">
            Escolha como você prefere organizar seu evento
          </p>
        </div>

        <Tabs defaultValue="with-ai" className="w-full">
          <div className="flex justify-center mb-12">
            <TabsList className="grid w-full max-w-[400px] grid-cols-2 h-14 p-1 bg-background/50 backdrop-blur-sm border shadow-sm rounded-full">
              <TabsTrigger
                value="with-ai"
                className="rounded-full h-full data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg data-[state=active]:shadow-primary/30 transition-all duration-300 group"
              >
                <Sparkles className="w-4 h-4 mr-2 group-data-[state=active]:animate-pulse group-hover:rotate-12 transition-transform" />
                Com IA
              </TabsTrigger>
              <TabsTrigger
                value="without-ai"
                className="rounded-full h-full data-[state=active]:bg-primary data-[state=active]:text-primary-foreground data-[state=active]:shadow-lg data-[state=active]:shadow-primary/30 transition-all duration-300 group"
              >
                <ListTodo className="w-4 h-4 mr-2 group-hover:scale-110 transition-transform" />
                Manual
              </TabsTrigger>
            </TabsList>
          </div>

          <TabsContent value="with-ai" className="mt-0">
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.4, ease: "easeOut" }}
              className="grid md:grid-cols-3 gap-8"
            >
              {stepsWithAI.map((step, index) => (
                <motion.div
                  key={index}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.4, delay: index * 0.1 }}
                  className="relative group"
                >
                  <div className="bg-card rounded-2xl p-8 shadow-soft hover:shadow-card transition-all duration-300 hover:-translate-y-2 h-full border border-border/50">
                    <div className="absolute top-4 right-4 text-6xl font-bold text-muted-foreground/5">
                      {step.number}
                    </div>

                    <div className="relative z-10 space-y-4">
                      <div className="w-14 h-14 rounded-xl bg-gradient-warm flex items-center justify-center shadow-lg shadow-primary/20 group-hover:scale-110 transition-transform duration-300">
                        <step.icon className="w-7 h-7 text-white" />
                      </div>

                      <h3 className="text-2xl font-semibold">{step.title}</h3>
                      <p className="text-muted-foreground leading-relaxed">{step.description}</p>
                    </div>
                  </div>

                  {/* Connector line (desktop only) */}
                  {index < stepsWithAI.length - 1 && (
                    <div className="hidden md:block absolute top-1/2 -right-4 w-8 h-0.5 bg-gradient-to-r from-primary/30 to-transparent" />
                  )}
                </motion.div>
              ))}
            </motion.div>
          </TabsContent>

          <TabsContent value="without-ai" className="mt-0">
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.4, ease: "easeOut" }}
              className="grid md:grid-cols-3 gap-8"
            >
              {stepsWithoutAI.map((step, index) => (
                <motion.div
                  key={index}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.4, delay: index * 0.1 }}
                  className="relative group"
                >
                  <div className="bg-card rounded-2xl p-8 shadow-soft hover:shadow-card transition-all duration-300 hover:-translate-y-2 h-full border border-border/50">
                    <div className="absolute top-4 right-4 text-6xl font-bold text-muted-foreground/5">
                      {step.number}
                    </div>

                    <div className="relative z-10 space-y-4">
                      <div className="w-14 h-14 rounded-xl bg-secondary flex items-center justify-center shadow-lg shadow-secondary/20 group-hover:scale-110 transition-transform duration-300">
                        <step.icon className="w-7 h-7 text-secondary-foreground" />
                      </div>

                      <h3 className="text-2xl font-semibold">{step.title}</h3>
                      <p className="text-muted-foreground leading-relaxed">{step.description}</p>
                    </div>
                  </div>

                  {/* Connector line (desktop only) */}
                  {index < stepsWithoutAI.length - 1 && (
                    <div className="hidden md:block absolute top-1/2 -right-4 w-8 h-0.5 bg-gradient-to-r from-secondary/30 to-transparent" />
                  )}
                </motion.div>
              ))}
            </motion.div>
          </TabsContent>
        </Tabs>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\Integrations.tsx
============================================================
import { Button } from "@/components/ui/button";
import {
  MessageCircle,
  Calendar,
  ShoppingCart,
  Car,
  Music,
  Store,
  Mail,
  MapPin
} from "lucide-react";
import { useToast } from "@/hooks/use-toast";

const integrations = [
  { name: "WhatsApp", icon: MessageCircle },
  { name: "Google Calendar", icon: Calendar },
  { name: "iFood", icon: ShoppingCart },
  { name: "Uber", icon: Car },
  { name: "Spotify", icon: Music },
  { name: "Negócios Locais", icon: Store },
  { name: "Gmail", icon: Mail },
  { name: "Google Maps", icon: MapPin },
];

export const Integrations = () => {
  const { toast } = useToast();

  const handleRoadmapClick = () => {
    toast({
      title: "Em breve",
      description: "Em breve estará disponível",
    });
  };

  return (
    <section className="py-24 px-4 bg-gradient-to-b from-background to-secondary/20">
      <div className="container max-w-7xl mx-auto">
        <div className="text-center space-y-4 mb-12">
          <h2 className="text-4xl md:text-5xl font-bold">
            Conectado ao seu mundo
          </h2>
          <p className="text-xl text-muted-foreground max-w-2xl mx-auto">
            O ReUNE foi desenhado para trabalhar em harmonia com os apps que você já ama.
          </p>
        </div>

        <div className="relative max-w-4xl mx-auto">
          {/* Glassmorphism Container */}
          <div className="relative overflow-hidden rounded-3xl border border-white/20 bg-white/5 backdrop-blur-xl p-8 md:p-12 text-center shadow-2xl">

            <div className="absolute inset-0 bg-gradient-to-r from-primary/10 via-transparent to-primary/10 opacity-50" />

            <div className="relative z-10 flex flex-col items-center gap-8">
              <div className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-primary/10 text-primary text-sm font-medium border border-primary/20">
                <span className="relative flex h-2 w-2">
                  <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-primary opacity-75"></span>
                  <span className="relative inline-flex rounded-full h-2 w-2 bg-primary"></span>
                </span>
                Em breve
              </div>

              <h3 className="text-2xl font-semibold">
                Um ecossistema completo de integrações
              </h3>

              <div className="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 w-full max-w-3xl">
                {integrations.map((item, index) => (
                  <div
                    key={index}
                    className="group flex flex-col items-center gap-3"
                  >
                    <div className="w-16 h-16 rounded-2xl bg-background border border-border shadow-sm flex items-center justify-center transition-all duration-300 group-hover:scale-110 group-hover:border-primary/50 group-hover:shadow-md">
                      <item.icon className="w-8 h-8 text-muted-foreground group-hover:text-primary transition-colors" />
                    </div>
                    <span className="text-xs font-medium text-muted-foreground group-hover:text-foreground transition-colors">
                      {item.name}
                    </span>
                  </div>
                ))}
              </div>

              <p className="text-sm text-muted-foreground max-w-lg">
                Estamos trabalhando duro para trazer essas conexões. Você poderá chamar transporte, pedir comida e criar playlists sem sair do evento.
              </p>
            </div>
          </div>
        </div>

        <div className="text-center mt-12">
          <Button variant="outline" className="gap-2" onClick={handleRoadmapClick}>
            Ver roadmap completo
          </Button>
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\Templates.tsx
============================================================
import { Button } from "@/components/ui/button";
import { ArrowRight, Beef, Cake, Users, Utensils } from "lucide-react";
import { useNavigate } from "react-router-dom";

const templates = [
  {
    icon: Beef,
    title: "Churrasco de amigos",
    description: "Lista completa para o churrasco perfeito",
    slug: "churrasco",
  },
  {
    icon: Utensils,
    title: "Jantar em família",
    description: "Tudo para uma refeição especial",
    slug: "jantar",
  },
  {
    icon: Cake,
    title: "Aniversário simples",
    description: "Celebre sem estresse",
    slug: "aniversario",
  },
  {
    icon: Users,
    title: "Reunião de equipe",
    description: "Coffee break e snacks profissionais",
    slug: "reuniao",
  },
];

export const Templates = () => {
  const navigate = useNavigate();

  return (
    <section className="py-24 px-4">
      <div className="container max-w-7xl mx-auto">
        <div className="text-center space-y-4 mb-16">
          <h2 className="text-4xl md:text-5xl font-bold">Inspire-se com modelos prontos</h2>
          <p className="text-xl text-muted-foreground">
            Use templates criados pela IA e comece seu evento em segundos.
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
          {templates.map((template, index) => (
            <div
              key={index}
              className="group bg-card rounded-2xl p-6 shadow-soft hover:shadow-card transition-all duration-300 hover:-translate-y-2 animate-fade-in text-center flex flex-col items-center"
              style={{ animationDelay: `${index * 75}ms` }}
            >
              <div 
                className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform mx-auto"
                style={{
                  background: 'linear-gradient(135deg, hsl(16 100% 57%), hsl(45 100% 51%))'
                }}
              >
                <template.icon className="w-8 h-8 text-white" />
              </div>
              
              <h3 className="text-xl font-semibold mb-2 text-center">{template.title}</h3>
              <p className="text-muted-foreground text-sm mb-6 text-center flex-1">
                {template.description}
              </p>

              <Button
                variant="ghost"
                className="w-full group/btn"
                onClick={() => navigate(`/app?template=${template.slug}`)}
              >
                Usar no ReUNE
                <ArrowRight className="w-4 h-4 ml-2 group-hover/btn:translate-x-1 transition-transform" />
              </Button>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\Testimonials.tsx
============================================================
import { Star } from "lucide-react";

const testimonials = [
  {
    name: "Juliana S.",
    location: "São Paulo",
    avatar: "👩‍💼",
    text: "Antes era um caos combinar o que cada um levava. Agora o ReUNE faz tudo!",
    rating: 5,
  },
  {
    name: "Lucas R.",
    location: "Belo Horizonte",
    avatar: "👨‍💻",
    text: "A IA sugere até quantidades. Economizamos e nunca falta nada.",
    rating: 5,
  },
  {
    name: "Carla T.",
    location: "Curitiba",
    avatar: "👩‍🎨",
    text: "Os lembretes automáticos salvaram meu churrasco.",
    rating: 5,
  },
];

export const Testimonials = () => {
  return (
    <section className="py-24 px-4 bg-muted/30">
      <div className="container max-w-7xl mx-auto">
        <div className="text-center space-y-4 mb-16">
          <h2 className="text-4xl md:text-5xl font-bold">
            Histórias de quem já usa o ReUNE
          </h2>
        </div>

        <div className="grid md:grid-cols-3 gap-8 mb-12">
          {testimonials.map((testimonial, index) => (
            <div
              key={index}
              className="bg-card rounded-2xl p-8 shadow-soft hover:shadow-card transition-all duration-300 animate-fade-in"
              style={{ animationDelay: `${index * 100}ms` }}
            >
              <div className="flex gap-1 mb-4">
                {[...Array(testimonial.rating)].map((_, i) => (
                  <Star key={i} className="w-5 h-5 fill-gold text-gold" />
                ))}
              </div>

              <p className="text-lg mb-6 leading-relaxed">"{testimonial.text}"</p>

              <div className="flex items-center gap-3">
                <div className="w-12 h-12 rounded-full bg-gradient-warm flex items-center justify-center text-2xl">
                  {testimonial.avatar}
                </div>
                <div>
                  <div className="font-semibold">{testimonial.name}</div>
                  <div className="text-sm text-muted-foreground">
                    {testimonial.location}
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>

        <div className="text-center text-muted-foreground">
          {/*<p className="text-lg">
            Mais de <span className="font-semibold text-foreground">1.000 eventos</span> organizados com sucesso
          </p>*/}
        </div>
      </div>
    </section>
  );
};


============================================================
FILE PATH: .\src\components\landing\ThemeToggle.tsx
============================================================
import { Moon, Sun } from "lucide-react";
import { Button } from "@/components/ui/button";
import { useEffect, useState } from "react";
import { cn } from "@/lib/utils";

type ThemeToggleProps = {
  className?: string;
};

export const ThemeToggle = ({ className }: ThemeToggleProps) => {
  const [theme, setTheme] = useState<"light" | "dark">("light");

  useEffect(() => {
    const savedTheme = localStorage.getItem("theme") as "light" | "dark" | null;
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const initialTheme = savedTheme || (prefersDark ? "dark" : "light");
    
    setTheme(initialTheme);
    document.documentElement.classList.toggle("dark", initialTheme === "dark");
  }, []);

  const toggleTheme = () => {
    const newTheme = theme === "light" ? "dark" : "light";
    setTheme(newTheme);
    localStorage.setItem("theme", newTheme);
    document.documentElement.classList.toggle("dark", newTheme === "dark");
  };

  const containerClass = className ?? "fixed bottom-4 left-4 z-50";

  return (
    <div className={containerClass}>
      <Button
        aria-label="Alternar tema"
        variant="outline"
        size="icon"
        onClick={toggleTheme}
        className="rounded-full shadow-floating"
      >
        {theme === "light" ? (
          <Moon className="w-5 h-5" />
        ) : (
          <Sun className="w-5 h-5" />
        )}
      </Button>
    </div>
  );
};


============================================================
FILE PATH: .\src\components\notifications\NotificationBell.tsx
============================================================
import { useState, useEffect } from "react";
import { Bell } from "lucide-react";
import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { Badge } from "@/components/ui/badge";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";
import { useToast } from "@/hooks/use-toast";
import { useNavigate } from "react-router-dom";

interface Notification {
  id: string;
  type: string;
  title: string;
  message: string;
  read: boolean;
  created_at: string;
  metadata: any;
}

export function NotificationBell() {
  const { user } = useAuth();
  const { toast } = useToast();
  const navigate = useNavigate();
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [unreadCount, setUnreadCount] = useState(0);

  useEffect(() => {
    if (!user) return;

    fetchNotifications();

    // Subscribe to realtime notifications
    const channel = supabase
      .channel('notifications')
      .on(
        'postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table: 'notifications',
          filter: `user_id=eq.${user.id}`
        },
        (payload) => {
          setNotifications(prev => [payload.new as Notification, ...prev]);
          setUnreadCount(prev => prev + 1);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [user]);

  const fetchNotifications = async () => {
    if (!user) return;

    const { data, error } = await supabase
      .from('notifications')
      .select('*')
      .eq('user_id', user.id)
      .order('created_at', { ascending: false })
      .limit(10);

    if (error) {
      console.error('Error fetching notifications:', error);
      return;
    }

    setNotifications(data || []);
    setUnreadCount(data?.filter(n => !n.read).length || 0);
  };

  const markAsRead = async (notificationId: string) => {
    await supabase
      .from('notifications')
      .update({ read: true })
      .eq('id', notificationId);

    setNotifications(prev =>
      prev.map(n => n.id === notificationId ? { ...n, read: true } : n)
    );
    setUnreadCount(prev => Math.max(0, prev - 1));
  };

  const handleNotificationClick = async (notification: Notification) => {
    await markAsRead(notification.id);

    // Handle different notification types
    switch (notification.type) {
      case 'friend_request':
        // Open friends dialog
        break;
      case 'friend_request_accepted':
        toast({
          title: notification.title,
          description: notification.message,
        });
        break;
      case 'event_invite':
        if (notification.metadata?.event_id) {
          navigate(`/event/${notification.metadata.event_id}`);
        }
        break;
      default:
        break;
    }
  };

  const formatTime = (dateStr: string) => {
    const date = new Date(dateStr);
    const now = new Date();
    const diff = now.getTime() - date.getTime();
    const minutes = Math.floor(diff / 60000);
    const hours = Math.floor(minutes / 60);
    const days = Math.floor(hours / 24);

    if (days > 0) return `${days}d atrás`;
    if (hours > 0) return `${hours}h atrás`;
    if (minutes > 0) return `${minutes}min atrás`;
    return 'Agora';
  };

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="ghost" size="sm" className="relative">
          <Bell className="h-5 w-5" />
          {unreadCount > 0 && (
            <Badge 
              variant="destructive" 
              className="absolute -top-1 -right-1 h-5 w-5 flex items-center justify-center p-0 text-xs"
            >
              {unreadCount}
            </Badge>
          )}
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-80">
        <DropdownMenuLabel>Notificações</DropdownMenuLabel>
        <DropdownMenuSeparator />
        {notifications.length === 0 ? (
          <div className="p-4 text-center text-sm text-muted-foreground">
            Nenhuma notificação
          </div>
        ) : (
          notifications.map((notification) => (
            <DropdownMenuItem
              key={notification.id}
              className="flex flex-col items-start p-3 cursor-pointer"
              onClick={() => handleNotificationClick(notification)}
            >
              <div className="flex justify-between w-full mb-1">
                <span className={`font-medium text-sm ${!notification.read ? 'text-primary' : ''}`}>
                  {notification.title}
                </span>
                <span className="text-xs text-muted-foreground">
                  {formatTime(notification.created_at)}
                </span>
              </div>
              <p className="text-xs text-muted-foreground">
                {notification.message}
              </p>
            </DropdownMenuItem>
          ))
        )}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}


============================================================
FILE PATH: .\src\components\profile\AddressCard.tsx
============================================================
import { MapPin, Star, Edit, Trash2 } from 'lucide-react';
import { Card, CardContent } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from '@/components/ui/alert-dialog';
import { Badge } from '@/components/ui/badge';
import { Address } from '@/hooks/useAddresses';

interface AddressCardProps {
  address: Address;
  onEdit: (address: Address) => void;
  onDelete: (id: string) => void;
  onSetPrimary: (id: string) => void;
}

export function AddressCard({
  address,
  onEdit,
  onDelete,
  onSetPrimary,
}: AddressCardProps) {
  const fullAddress = [
    `${address.street}, ${address.number}`,
    address.complement,
    address.neighborhood,
    `${address.city}/${address.state}`,
    address.zip_code,
  ]
    .filter(Boolean)
    .join(' • ');

  return (
    <Card className="relative">
      <CardContent className="p-4">
        <div className="flex items-start justify-between gap-4">
          <div className="flex-1 space-y-2">
            <div className="flex items-center gap-2">
              <MapPin className="h-4 w-4 text-muted-foreground" />
              <h3 className="font-semibold">{address.nickname}</h3>
              {address.is_primary && (
                <Badge variant="secondary" className="gap-1">
                  <Star className="h-3 w-3 fill-current" />
                  Principal
                </Badge>
              )}
            </div>
            <p className="text-sm text-muted-foreground">{fullAddress}</p>
          </div>

          <div className="flex gap-2">
            {!address.is_primary && (
              <Button
                variant="ghost"
                size="sm"
                onClick={() => onSetPrimary(address.id)}
                title="Definir como principal"
              >
                <Star className="h-4 w-4" />
              </Button>
            )}
            <Button
              variant="ghost"
              size="sm"
              onClick={() => onEdit(address)}
            >
              <Edit className="h-4 w-4" />
            </Button>
            <AlertDialog>
              <AlertDialogTrigger asChild>
                <Button variant="ghost" size="sm">
                  <Trash2 className="h-4 w-4" />
                </Button>
              </AlertDialogTrigger>
              <AlertDialogContent>
                <AlertDialogHeader>
                  <AlertDialogTitle>Confirmar exclusão</AlertDialogTitle>
                  <AlertDialogDescription>
                    Tem certeza que deseja excluir o endereço "{address.nickname}"?
                    Esta ação não pode ser desfeita.
                  </AlertDialogDescription>
                </AlertDialogHeader>
                <AlertDialogFooter>
                  <AlertDialogCancel>Cancelar</AlertDialogCancel>
                  <AlertDialogAction onClick={() => onDelete(address.id)}>
                    Excluir
                  </AlertDialogAction>
                </AlertDialogFooter>
              </AlertDialogContent>
            </AlertDialog>
          </div>
        </div>
      </CardContent>
    </Card>
  );
}


============================================================
FILE PATH: .\src\components\profile\AddressFormDialog.tsx
============================================================
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import * as z from 'zod';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import {
  Form,
  FormControl,
  FormField,
  FormItem,
  FormLabel,
  FormMessage,
} from '@/components/ui/form';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Checkbox } from '@/components/ui/checkbox';
import { Address } from '@/hooks/useAddresses';

const ESTADOS_BRASILEIROS = [
  'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA',
  'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN',
  'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
];

const addressSchema = z.object({
  nickname: z.string().min(1, 'Apelido é obrigatório').max(50),
  street: z.string().min(1, 'Endereço é obrigatório'),
  number: z.string().min(1, 'Número é obrigatório'),
  complement: z.string().optional(),
  neighborhood: z.string().min(1, 'Bairro é obrigatório'),
  city: z.string().min(1, 'Cidade é obrigatória'),
  state: z.string().min(2, 'Estado é obrigatório'),
  zip_code: z.string().regex(/^\d{5}-?\d{3}$/, 'CEP inválido'),
  country: z.string().default('Brasil'),
  is_primary: z.boolean().default(false),
});

type AddressFormData = z.infer<typeof addressSchema>;

interface AddressFormDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onSubmit: (data: AddressFormData) => Promise<void>;
  address?: Address | null;
}

export function AddressFormDialog({
  open,
  onOpenChange,
  onSubmit,
  address,
}: AddressFormDialogProps) {
  const [isSubmitting, setIsSubmitting] = useState(false);

  const form = useForm<AddressFormData>({
    resolver: zodResolver(addressSchema),
    defaultValues: {
      nickname: '',
      street: '',
      number: '',
      complement: '',
      neighborhood: '',
      city: '',
      state: '',
      zip_code: '',
      country: 'Brasil',
      is_primary: false,
    },
  });

  // Preencher formulário quando editando
  useEffect(() => {
    if (address) {
      form.reset({
        nickname: address.nickname,
        street: address.street,
        number: address.number,
        complement: address.complement || '',
        neighborhood: address.neighborhood,
        city: address.city,
        state: address.state,
        zip_code: address.zip_code,
        country: address.country,
        is_primary: address.is_primary,
      });
    } else {
      form.reset({
        nickname: '',
        street: '',
        number: '',
        complement: '',
        neighborhood: '',
        city: '',
        state: '',
        zip_code: '',
        country: 'Brasil',
        is_primary: false,
      });
    }
  }, [address, form]);

  const handleSubmit = async (data: AddressFormData) => {
    setIsSubmitting(true);
    try {
      await onSubmit(data);
      onOpenChange(false);
      form.reset();
    } finally {
      setIsSubmitting(false);
    }
  };

  // Formatar CEP automaticamente
  const formatCEP = (value: string) => {
    const numbers = value.replace(/\D/g, '');
    if (numbers.length <= 5) return numbers;
    return `${numbers.slice(0, 5)}-${numbers.slice(5, 8)}`;
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="max-w-2xl max-h-[90vh] overflow-y-auto">
        <DialogHeader>
          <DialogTitle>
            {address ? 'Editar Endereço' : 'Novo Endereço'}
          </DialogTitle>
          <DialogDescription>
            Preencha as informações do endereço abaixo.
          </DialogDescription>
        </DialogHeader>

        <Form {...form}>
          <form onSubmit={form.handleSubmit(handleSubmit)} className="space-y-4">
            <FormField
              control={form.control}
              name="nickname"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Apelido *</FormLabel>
                  <FormControl>
                    <Input placeholder="Ex: Casa, Trabalho, Chácara" {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <FormField
                control={form.control}
                name="street"
                render={({ field }) => (
                  <FormItem className="md:col-span-2">
                    <FormLabel>Endereço *</FormLabel>
                    <FormControl>
                      <Input placeholder="Rua, Avenida..." {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="number"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Número *</FormLabel>
                    <FormControl>
                      <Input placeholder="123" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </div>

            <FormField
              control={form.control}
              name="complement"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>Complemento</FormLabel>
                  <FormControl>
                    <Input placeholder="Apto, Bloco, etc." {...field} />
                  </FormControl>
                  <FormMessage />
                </FormItem>
              )}
            />

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormField
                control={form.control}
                name="neighborhood"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Bairro *</FormLabel>
                    <FormControl>
                      <Input placeholder="Nome do bairro" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="city"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Cidade *</FormLabel>
                    <FormControl>
                      <Input placeholder="Nome da cidade" {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
              <FormField
                control={form.control}
                name="state"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>Estado *</FormLabel>
                    <Select onValueChange={field.onChange} value={field.value}>
                      <FormControl>
                        <SelectTrigger>
                          <SelectValue placeholder="UF" />
                        </SelectTrigger>
                      </FormControl>
                      <SelectContent>
                        {ESTADOS_BRASILEIROS.map((estado) => (
                          <SelectItem key={estado} value={estado}>
                            {estado}
                          </SelectItem>
                        ))}
                      </SelectContent>
                    </Select>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="zip_code"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>CEP *</FormLabel>
                    <FormControl>
                      <Input
                        placeholder="00000-000"
                        {...field}
                        onChange={(e) => {
                          const formatted = formatCEP(e.target.value);
                          field.onChange(formatted);
                        }}
                        maxLength={9}
                      />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />

              <FormField
                control={form.control}
                name="country"
                render={({ field }) => (
                  <FormItem>
                    <FormLabel>País</FormLabel>
                    <FormControl>
                      <Input {...field} />
                    </FormControl>
                    <FormMessage />
                  </FormItem>
                )}
              />
            </div>

            <FormField
              control={form.control}
              name="is_primary"
              render={({ field }) => (
                <FormItem className="flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4">
                  <FormControl>
                    <Checkbox
                      checked={field.value}
                      onCheckedChange={field.onChange}
                    />
                  </FormControl>
                  <div className="space-y-1 leading-none">
                    <FormLabel>
                      Definir como endereço principal
                    </FormLabel>
                    <p className="text-sm text-muted-foreground">
                      Este endereço será sugerido automaticamente ao criar eventos.
                    </p>
                  </div>
                </FormItem>
              )}
            />

            <div className="flex gap-3 justify-end pt-4">
              <Button
                type="button"
                variant="outline"
                onClick={() => onOpenChange(false)}
                disabled={isSubmitting}
              >
                Cancelar
              </Button>
              <Button type="submit" disabled={isSubmitting}>
                {isSubmitting ? 'Salvando...' : 'Salvar Endereço'}
              </Button>
            </div>
          </form>
        </Form>
      </DialogContent>
    </Dialog>
  );
}


============================================================
FILE PATH: .\src\components\profile\AddressList.tsx
============================================================
import { useState } from 'react';
import { Plus } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { AddressCard } from './AddressCard';
import { AddressFormDialog } from './AddressFormDialog';
import { useAddresses, Address } from '@/hooks/useAddresses';

export function AddressList() {
  const { addresses, loading, addAddress, updateAddress, deleteAddress, setPrimaryAddress } = useAddresses();
  const [dialogOpen, setDialogOpen] = useState(false);
  const [editingAddress, setEditingAddress] = useState<Address | null>(null);

  const handleEdit = (address: Address) => {
    setEditingAddress(address);
    setDialogOpen(true);
  };

  const handleAddNew = () => {
    setEditingAddress(null);
    setDialogOpen(true);
  };

  const handleSubmit = async (data: Omit<Address, 'id' | 'user_id' | 'created_at' | 'updated_at'>) => {
    if (editingAddress) {
      await updateAddress(editingAddress.id, data);
    } else {
      await addAddress(data);
    }
  };

  const handleDelete = async (id: string) => {
    await deleteAddress(id);
  };

  const handleSetPrimary = async (id: string) => {
    await setPrimaryAddress(id);
  };

  if (loading) {
    return (
      <div className="flex items-center justify-center py-8">
        <p className="text-muted-foreground">Carregando endereços...</p>
      </div>
    );
  }

  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div>
          <h3 className="text-lg font-semibold">Meus Endereços</h3>
          <p className="text-sm text-muted-foreground">
            Gerencie seus endereços para usar em eventos
          </p>
        </div>
        <Button onClick={handleAddNew}>
          <Plus className="h-4 w-4 mr-2" />
          Adicionar Endereço
        </Button>
      </div>

      {addresses.length === 0 ? (
        <div className="text-center py-12 border-2 border-dashed rounded-lg">
          <MapPin className="h-12 w-12 mx-auto text-muted-foreground mb-4" />
          <p className="text-muted-foreground mb-4">
            Você ainda não tem endereços cadastrados
          </p>
          <Button onClick={handleAddNew} variant="outline">
            <Plus className="h-4 w-4 mr-2" />
            Adicionar Primeiro Endereço
          </Button>
        </div>
      ) : (
        <div className="space-y-3">
          {addresses.map((address) => (
            <AddressCard
              key={address.id}
              address={address}
              onEdit={handleEdit}
              onDelete={handleDelete}
              onSetPrimary={handleSetPrimary}
            />
          ))}
        </div>
      )}

      <AddressFormDialog
        open={dialogOpen}
        onOpenChange={setDialogOpen}
        onSubmit={handleSubmit}
        address={editingAddress}
      />
    </div>
  );
}

function MapPin(props: React.SVGProps<SVGSVGElement>) {
  return (
    <svg
      {...props}
      xmlns="http://www.w3.org/2000/svg"
      width="24"
      height="24"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      strokeWidth="2"
      strokeLinecap="round"
      strokeLinejoin="round"
    >
      <path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" />
      <circle cx="12" cy="10" r="3" />
    </svg>
  );
}


============================================================
FILE PATH: .\src\components\profile\ChangePasswordDialog.tsx
============================================================
import { useState } from 'react';
import { z } from 'zod';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from '@/components/ui/dialog';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Lock } from 'lucide-react';

interface ChangePasswordDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}

const passwordSchema = z.object({
  currentPassword: z.string().min(6, 'Senha deve ter no mínimo 6 caracteres'),
  newPassword: z.string().min(6, 'Senha deve ter no mínimo 6 caracteres'),
  confirmPassword: z.string().min(6, 'Senha deve ter no mínimo 6 caracteres'),
}).refine((data) => data.newPassword === data.confirmPassword, {
  message: "As senhas não coincidem",
  path: ["confirmPassword"],
});

type PasswordFormData = z.infer<typeof passwordSchema>;

export function ChangePasswordDialog({ open, onOpenChange }: ChangePasswordDialogProps) {
  const { toast } = useToast();
  const [loading, setLoading] = useState(false);

  const {
    register,
    handleSubmit,
    reset,
    formState: { errors },
  } = useForm<PasswordFormData>({
    resolver: zodResolver(passwordSchema),
  });

  const onSubmit = async (data: PasswordFormData) => {
    setLoading(true);

    try {
      // Atualizar senha
      const { error } = await supabase.auth.updateUser({
        password: data.newPassword,
      });

      if (error) throw error;

      toast({
        title: "Senha alterada!",
        description: "Sua senha foi atualizada com sucesso.",
      });

      reset();
      onOpenChange(false);
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao alterar senha",
        description: err?.message || "Não foi possível alterar a senha.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <Dialog open={open} onOpenChange={onOpenChange}>
      <DialogContent className="sm:max-w-[425px]">
        <DialogHeader>
          <DialogTitle className="flex items-center gap-2">
            <Lock className="w-5 h-5 text-primary" />
            Alterar Senha
          </DialogTitle>
          <DialogDescription>
            Digite sua senha atual e escolha uma nova senha segura.
          </DialogDescription>
        </DialogHeader>

        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4 mt-4">
          <div className="space-y-2">
            <Label htmlFor="currentPassword">Senha Atual</Label>
            <Input
              id="currentPassword"
              type="password"
              {...register('currentPassword')}
              disabled={loading}
            />
            {errors.currentPassword && (
              <p className="text-sm text-destructive">{errors.currentPassword.message}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="newPassword">Nova Senha</Label>
            <Input
              id="newPassword"
              type="password"
              {...register('newPassword')}
              disabled={loading}
            />
            {errors.newPassword && (
              <p className="text-sm text-destructive">{errors.newPassword.message}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="confirmPassword">Confirmar Nova Senha</Label>
            <Input
              id="confirmPassword"
              type="password"
              {...register('confirmPassword')}
              disabled={loading}
            />
            {errors.confirmPassword && (
              <p className="text-sm text-destructive">{errors.confirmPassword.message}</p>
            )}
          </div>

          <div className="flex justify-end gap-2 pt-4">
            <Button
              type="button"
              variant="outline"
              onClick={() => onOpenChange(false)}
              disabled={loading}
            >
              Cancelar
            </Button>
            <Button type="submit" disabled={loading}>
              {loading ? 'Salvando...' : 'Alterar Senha'}
            </Button>
          </div>
        </form>
      </DialogContent>
    </Dialog>
  );
}


============================================================
FILE PATH: .\src\components\profile\ProfileForm.tsx
============================================================
import { useState, useEffect, useRef, useCallback } from 'react';
import { z } from 'zod';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { useProfile } from '@/hooks/useProfile';
import { useAuth } from '@/hooks/useAuth';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Checkbox } from '@/components/ui/checkbox';
import { Progress } from '@/components/ui/progress';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from '@/components/ui/select';
import { Card, CardContent } from '@/components/ui/card';
import { Separator } from '@/components/ui/separator';
import { Camera, Check, X, Lock } from 'lucide-react';
import { ChangePasswordDialog } from './ChangePasswordDialog';

const profileSchema = z.object({
  display_name: z.string().min(3, 'Nome deve ter no mínimo 3 caracteres').max(100),
  username: z.string()
    .min(3, 'Username deve ter no mínimo 3 caracteres')
    .max(20, 'Username deve ter no máximo 20 caracteres')
    .regex(/^[a-z0-9]+$/, 'Apenas letras minúsculas e números são permitidos'),
  phone: z.string().optional(),
  city: z.string().optional(),
  state: z.string().optional(),
  country: z.string().optional(),
  favorite_event_type: z.string().optional(),
  language: z.string().optional(),
  bio: z.string().max(500, 'Bio deve ter no máximo 500 caracteres').optional(),
  allow_search_by_username: z.boolean(),
  accept_notifications: z.boolean(),
  terms_accepted: z.boolean(),
});

type ProfileFormData = z.infer<typeof profileSchema>;

const EVENT_TYPES = [
  'Churrasco',
  'Pizza',
  'Jantar',
  'Almoço',
  'Lanche',
  'Confraternização',
  'Aniversário',
  'Reunião',
  'Outro',
];

const BRAZILIAN_STATES = [
  'AC', 'AL', 'AP', 'AM', 'BA', 'CE', 'DF', 'ES', 'GO', 'MA',
  'MT', 'MS', 'MG', 'PA', 'PB', 'PR', 'PE', 'PI', 'RJ', 'RN',
  'RS', 'RO', 'RR', 'SC', 'SP', 'SE', 'TO'
];

export function ProfileForm() {
  const { user } = useAuth();
  const { profile, loading, completion, updateProfile, uploadAvatar, checkUsernameAvailable } = useProfile();
  const [saving, setSaving] = useState(false);
  const [usernameAvailable, setUsernameAvailable] = useState<boolean | null>(null);
  const [checkingUsername, setCheckingUsername] = useState(false);
  const [avatarPreview, setAvatarPreview] = useState<string | null>(null);
  const [passwordDialogOpen, setPasswordDialogOpen] = useState(false);
  const fileInputRef = useRef<HTMLInputElement>(null);

  const {
    register,
    handleSubmit,
    watch,
    setValue,
    formState: { errors },
  } = useForm<ProfileFormData>({
    resolver: zodResolver(profileSchema),
    defaultValues: {
      allow_search_by_username: true,
      accept_notifications: false,
      terms_accepted: false,
      country: 'Brasil',
      language: 'pt-BR',
    },
  });

  const watchedUsername = watch('username');
  const termsAccepted = watch('terms_accepted');
  
  // Verificar se o usuário já aceitou os termos anteriormente
  const alreadyAcceptedTerms = !!profile?.terms_accepted_at;
  
  // Verificar se o username já foi definido (não pode ser alterado)
  const usernameAlreadySet = !!profile?.username;

  // Ref para controlar a última requisição e evitar race conditions
  const lastUsernameCheckRef = useRef<string>('');
  const checkTimeoutRef = useRef<NodeJS.Timeout>();

  // Carregar dados do perfil no formulário quando o profile for carregado
  useEffect(() => {
    if (profile) {
      setValue('display_name', profile.display_name || '');
      setValue('username', profile.username || '');
      setValue('phone', profile.phone || '');
      setValue('city', profile.city || '');
      setValue('state', profile.state || '');
      setValue('country', profile.country || 'Brasil');
      setValue('favorite_event_type', profile.favorite_event_type || '');
      setValue('language', profile.language || 'pt-BR');
      setValue('bio', profile.bio || '');
      setValue('allow_search_by_username', profile.allow_search_by_username ?? true);
      setValue('accept_notifications', profile.accept_notifications ?? false);
      setValue('terms_accepted', !!profile.terms_accepted_at);
      
      // Carregar avatar se existir
      if (profile.avatar_url) {
        setAvatarPreview(profile.avatar_url);
      }
    }
  }, [profile, setValue]);

  // Verificar disponibilidade de username com debounce e controle de race condition
  const verifyUsernameAvailability = useCallback(async (username: string) => {
    // Normalizar username
    const normalizedUsername = username.toLowerCase().replace(/[^a-z0-9]/g, '');
    
    // Validações básicas
    if (!normalizedUsername || normalizedUsername.length < 3) {
      setUsernameAvailable(null);
      setCheckingUsername(false);
      return;
    }

    // Se é o username atual, não precisa verificar
    if (normalizedUsername === profile?.username) {
      setUsernameAvailable(true);
      setCheckingUsername(false);
      return;
    }

    // Marcar como verificando
    setCheckingUsername(true);
    
    // Guardar qual username estamos verificando
    lastUsernameCheckRef.current = normalizedUsername;

    try {
      const available = await checkUsernameAvailable(normalizedUsername);
      
      // Apenas atualizar se esta ainda é a última verificação solicitada
      if (lastUsernameCheckRef.current === normalizedUsername) {
        setUsernameAvailable(available);
        setCheckingUsername(false);
      }
    } catch (error) {
      // Apenas atualizar se esta ainda é a última verificação solicitada
      if (lastUsernameCheckRef.current === normalizedUsername) {
        setUsernameAvailable(false);
        setCheckingUsername(false);
      }
    }
  }, [profile?.username, checkUsernameAvailable]);

  // Efeito com debounce para verificar username
  useEffect(() => {
    // Limpar timeout anterior
    if (checkTimeoutRef.current) {
      clearTimeout(checkTimeoutRef.current);
    }

    // Se não há username, limpar estado
    if (!watchedUsername) {
      setUsernameAvailable(null);
      setCheckingUsername(false);
      return;
    }

    // Configurar novo timeout (debounce de 500ms)
    checkTimeoutRef.current = setTimeout(() => {
      verifyUsernameAvailability(watchedUsername);
    }, 500);

    // Cleanup
    return () => {
      if (checkTimeoutRef.current) {
        clearTimeout(checkTimeoutRef.current);
      }
    };
  }, [watchedUsername, verifyUsernameAvailability]);

  const handleAvatarChange = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    // Validar tamanho (max 2MB)
    if (file.size > 2 * 1024 * 1024) {
      alert('A imagem deve ter no máximo 2MB');
      return;
    }

    // Preview local
    const reader = new FileReader();
    reader.onloadend = () => {
      setAvatarPreview(reader.result as string);
    };
    reader.readAsDataURL(file);

    // Upload e atualizar perfil
    const result = await uploadAvatar(file);
    if (result.success && result.url) {
      setAvatarPreview(result.url);
    }
  };

  const onSubmit = async (data: ProfileFormData) => {
    // Validar se termos foram aceitos (apenas se ainda não foram)
    if (!alreadyAcceptedTerms && !data.terms_accepted) {
      return;
    }

    setSaving(true);

    const updates = {
      display_name: data.display_name,
      username: data.username.toLowerCase(),
      phone: data.phone || null,
      city: data.city || null,
      state: data.state || null,
      country: data.country || null,
      favorite_event_type: data.favorite_event_type || null,
      language: data.language || null,
      bio: data.bio || null,
      allow_search_by_username: data.allow_search_by_username,
      accept_notifications: data.accept_notifications,
      terms_accepted_at: data.terms_accepted && !profile?.terms_accepted_at ? new Date().toISOString() : profile?.terms_accepted_at,
    };

    await updateProfile(updates);
    setSaving(false);
  };

  if (loading) {
    return (
      <div className="flex justify-center py-8">
        <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div>
      </div>
    );
  }

  const getInitials = () => {
    if (profile?.display_name) {
      const names = profile.display_name.split(' ');
      return names.length > 1
        ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase()
        : profile.display_name.substring(0, 2).toUpperCase();
    }
    return user?.email?.substring(0, 2).toUpperCase() || 'U';
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      {/* Progresso do perfil */}
      <Card>
        <CardContent className="pt-6">
          <div className="space-y-2">
            <div className="flex justify-between items-center">
              <Label>Completude do Perfil</Label>
              <span className="text-sm font-medium text-primary">{completion}%</span>
            </div>
            <Progress value={completion} className="h-2" />
            <p className="text-xs text-muted-foreground">
              Complete seu perfil para aproveitar todas as funcionalidades
            </p>
          </div>
        </CardContent>
      </Card>

      {/* Foto de perfil */}
      <Card>
        <CardContent className="pt-6">
          <div className="flex items-center gap-4">
            <Avatar className="h-20 w-20 border-2 border-primary">
              <AvatarImage src={avatarPreview || undefined} />
              <AvatarFallback className="bg-primary/10 text-primary text-2xl">
                {getInitials()}
              </AvatarFallback>
            </Avatar>
            <div className="flex-1">
              <Label>Foto de Perfil</Label>
              <p className="text-sm text-muted-foreground mb-2">
                PNG, JPG ou JPEG (max 2MB)
              </p>
              <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                onChange={handleAvatarChange}
                className="hidden"
              />
              <Button
                type="button"
                variant="outline"
                size="sm"
                onClick={() => fileInputRef.current?.click()}
              >
                <Camera className="w-4 h-4 mr-2" />
                Alterar Foto
              </Button>
            </div>
          </div>
        </CardContent>
      </Card>

      {/* Identificação */}
      <Card>
        <CardContent className="pt-6 space-y-4">
          <h3 className="font-semibold text-foreground">Identificação</h3>
          
          <div className="space-y-2">
            <Label htmlFor="display_name">Nome Completo *</Label>
            <Input
              id="display_name"
              {...register('display_name')}
              disabled={saving}
            />
            {errors.display_name && (
              <p className="text-sm text-destructive">{errors.display_name.message}</p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="username">Nome de Usuário *</Label>
            <div className="relative">
              <Input
                id="username"
                {...register('username')}
                disabled={saving || usernameAlreadySet}
                className="pr-10"
                onChange={(e) => {
                  // Normalizar: apenas letras minúsculas e números
                  e.target.value = e.target.value.toLowerCase().replace(/[^a-z0-9]/g, '');
                  register('username').onChange(e);
                }}
              />
              {!usernameAlreadySet && checkingUsername && (
                <div className="absolute right-3 top-1/2 -translate-y-1/2">
                  <div className="animate-spin rounded-full h-4 w-4 border-b-2 border-primary"></div>
                </div>
              )}
              {!usernameAlreadySet && !checkingUsername && usernameAvailable !== null && watchedUsername && watchedUsername.length >= 3 && (
                <div className="absolute right-3 top-1/2 -translate-y-1/2">
                  {usernameAvailable ? (
                    <Check className="w-4 h-4 text-green-500" />
                  ) : (
                    <X className="w-4 h-4 text-destructive" />
                  )}
                </div>
              )}
            </div>
            {errors.username && (
              <p className="text-sm text-destructive">{errors.username.message}</p>
            )}
            {!usernameAlreadySet && !checkingUsername && usernameAvailable === false && watchedUsername && watchedUsername.length >= 3 && (
              <p className="text-sm text-destructive">Este username já está em uso</p>
            )}
            {!usernameAlreadySet && !checkingUsername && usernameAvailable === true && watchedUsername && watchedUsername.length >= 3 && (
              <p className="text-sm text-green-600">Username disponível!</p>
            )}
            {usernameAlreadySet ? (
              <p className="text-xs text-muted-foreground">
                Seu nome de usuário não pode ser alterado após o cadastro
              </p>
            ) : (
              <p className="text-xs text-muted-foreground">
                Apenas letras (a-z) e números (0-9), 3-20 caracteres
              </p>
            )}
          </div>

          <div className="space-y-2">
            <Label htmlFor="bio">Bio</Label>
            <Textarea
              id="bio"
              {...register('bio')}
              disabled={saving}
              rows={3}
              placeholder="Conte um pouco sobre você..."
            />
            {errors.bio && (
              <p className="text-sm text-destructive">{errors.bio.message}</p>
            )}
          </div>
        </CardContent>
      </Card>

      {/* Contato e Segurança */}
      <Card>
        <CardContent className="pt-6 space-y-4">
          <h3 className="font-semibold text-foreground">Contato e Segurança</h3>

          <div className="space-y-2">
            <Label htmlFor="phone">Telefone</Label>
            <Input
              id="phone"
              type="tel"
              {...register('phone')}
              disabled={saving}
              placeholder="(00) 00000-0000"
            />
          </div>

          <Separator />

          <div className="space-y-2">
            <Label>E-mail</Label>
            <Input value={user?.email || ''} disabled className="bg-muted" />
            <p className="text-xs text-muted-foreground">
              O e-mail não pode ser alterado
            </p>
          </div>

          <Button
            type="button"
            variant="outline"
            onClick={() => setPasswordDialogOpen(true)}
            className="w-full"
          >
            <Lock className="w-4 h-4 mr-2" />
            Alterar Senha
          </Button>

          <div className="flex items-center space-x-2">
            <Checkbox
              id="accept_notifications"
              checked={watch('accept_notifications')}
              onCheckedChange={(checked) => setValue('accept_notifications', checked as boolean)}
            />
            <Label htmlFor="accept_notifications" className="text-sm font-normal cursor-pointer">
              Aceito receber notificações por e-mail ou WhatsApp
            </Label>
          </div>
        </CardContent>
      </Card>

      {/* Localização e Preferências */}
      <Card>
        <CardContent className="pt-6 space-y-4">
          <h3 className="font-semibold text-foreground">Localização e Preferências</h3>

          <div className="grid grid-cols-2 gap-4">
            <div className="space-y-2">
              <Label htmlFor="city">Cidade</Label>
              <Input
                id="city"
                {...register('city')}
                disabled={saving}
                placeholder="São Paulo"
              />
            </div>

            <div className="space-y-2">
              <Label htmlFor="state">Estado</Label>
              <Select
                value={watch('state') || ''}
                onValueChange={(value) => setValue('state', value)}
              >
                <SelectTrigger>
                  <SelectValue placeholder="Selecione" />
                </SelectTrigger>
                <SelectContent>
                  {BRAZILIAN_STATES.map((state) => (
                    <SelectItem key={state} value={state}>
                      {state}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>
          </div>

          <div className="space-y-2">
            <Label htmlFor="country">País</Label>
            <Input
              id="country"
              {...register('country')}
              disabled={saving}
            />
          </div>

          <div className="space-y-2">
            <Label htmlFor="favorite_event_type">Tipo de Evento Favorito</Label>
            <Select
              value={watch('favorite_event_type') || ''}
              onValueChange={(value) => setValue('favorite_event_type', value)}
            >
              <SelectTrigger>
                <SelectValue placeholder="Selecione seu favorito" />
              </SelectTrigger>
              <SelectContent>
                {EVENT_TYPES.map((type) => (
                  <SelectItem key={type} value={type}>
                    {type}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>

          <div className="space-y-2">
            <Label htmlFor="language">Idioma</Label>
            <Select
              value={watch('language') || 'pt-BR'}
              onValueChange={(value) => setValue('language', value)}
            >
              <SelectTrigger>
                <SelectValue />
              </SelectTrigger>
              <SelectContent>
                <SelectItem value="pt-BR">Português (Brasil)</SelectItem>
                <SelectItem value="en">English</SelectItem>
                <SelectItem value="es">Español</SelectItem>
              </SelectContent>
            </Select>
          </div>

          <div className="flex items-center space-x-2">
            <Checkbox
              id="allow_search_by_username"
              checked={watch('allow_search_by_username')}
              onCheckedChange={(checked) => setValue('allow_search_by_username', checked as boolean)}
            />
            <Label htmlFor="allow_search_by_username" className="text-sm font-normal cursor-pointer">
              Permitir que outros me encontrem por nome de usuário
            </Label>
          </div>
        </CardContent>
      </Card>

      {/* Termos e Condições */}
      <Card>
        <CardContent className="pt-6 space-y-4">
          <div className="flex items-start space-x-2">
            <Checkbox
              id="terms_accepted"
              checked={alreadyAcceptedTerms || watch('terms_accepted')}
              onCheckedChange={(checked) => setValue('terms_accepted', checked as boolean)}
              disabled={alreadyAcceptedTerms}
            />
            <Label 
              htmlFor="terms_accepted" 
              className={`text-sm font-normal leading-relaxed ${alreadyAcceptedTerms ? 'cursor-default' : 'cursor-pointer'}`}
            >
              Li e aceito os{' '}
              <a href="#" className="text-primary hover:underline">
                Termos de Uso
              </a>{' '}
              e a{' '}
              <a href="#" className="text-primary hover:underline">
                Política de Privacidade
              </a>
            </Label>
          </div>
          {!alreadyAcceptedTerms && !termsAccepted && (
            <p className="text-sm text-muted-foreground">
              * Você deve aceitar os termos para salvar seu perfil pela primeira vez
            </p>
          )}
          {alreadyAcceptedTerms && (
            <p className="text-xs text-muted-foreground">
              ✓ Você já aceitou os Termos de Uso e a Política de Privacidade em {new Date(profile.terms_accepted_at).toLocaleDateString('pt-BR')}
            </p>
          )}
        </CardContent>
      </Card>

      {/* Botão de Salvar */}
      <div className="flex justify-end gap-2">
        <Button
          type="submit"
          disabled={saving || (!alreadyAcceptedTerms && !termsAccepted) || (usernameAvailable === false)}
          size="lg"
        >
          {saving ? 'Salvando...' : 'Salvar Alterações'}
        </Button>
      </div>

      {/* Modal de alteração de senha */}
      <ChangePasswordDialog
        open={passwordDialogOpen}
        onOpenChange={setPasswordDialogOpen}
      />
    </form>
  );
}


============================================================
FILE PATH: .\src\components\ui\accordion.tsx
============================================================
import * as React from "react";
import * as AccordionPrimitive from "@radix-ui/react-accordion";
import { ChevronDown } from "lucide-react";

import { cn } from "@/lib/utils";

const Accordion = AccordionPrimitive.Root;

const AccordionItem = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>
>(({ className, ...props }, ref) => (
  <AccordionPrimitive.Item ref={ref} className={cn("border-b", className)} {...props} />
));
AccordionItem.displayName = "AccordionItem";

const AccordionTrigger = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Header className="flex">
    <AccordionPrimitive.Trigger
      ref={ref}
      className={cn(
        "flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronDown className="h-4 w-4 shrink-0 transition-transform duration-200" />
    </AccordionPrimitive.Trigger>
  </AccordionPrimitive.Header>
));
AccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName;

const AccordionContent = React.forwardRef<
  React.ElementRef<typeof AccordionPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <AccordionPrimitive.Content
    ref={ref}
    className="overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down"
    {...props}
  >
    <div className={cn("pb-4 pt-0", className)}>{children}</div>
  </AccordionPrimitive.Content>
));

AccordionContent.displayName = AccordionPrimitive.Content.displayName;

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };


============================================================
FILE PATH: .\src\components\ui\alert-dialog.tsx
============================================================
import * as React from "react";
import * as AlertDialogPrimitive from "@radix-ui/react-alert-dialog";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button-variants";

const AlertDialog = AlertDialogPrimitive.Root;

const AlertDialogTrigger = AlertDialogPrimitive.Trigger;

const AlertDialogPortal = AlertDialogPrimitive.Portal;

const AlertDialogOverlay = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className,
    )}
    {...props}
    ref={ref}
  />
));
AlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName;

const AlertDialogContent = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>
>(({ className, ...props }, ref) => (
  <AlertDialogPortal>
    <AlertDialogOverlay />
    <AlertDialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className,
      )}
      {...props}
    />
  </AlertDialogPortal>
));
AlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName;

const AlertDialogHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col space-y-2 text-center sm:text-left", className)} {...props} />
);
AlertDialogHeader.displayName = "AlertDialogHeader";

const AlertDialogFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)} {...props} />
);
AlertDialogFooter.displayName = "AlertDialogFooter";

const AlertDialogTitle = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Title ref={ref} className={cn("text-lg font-semibold", className)} {...props} />
));
AlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName;

const AlertDialogDescription = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Description ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
));
AlertDialogDescription.displayName = AlertDialogPrimitive.Description.displayName;

const AlertDialogAction = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Action>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Action ref={ref} className={cn(buttonVariants(), className)} {...props} />
));
AlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName;

const AlertDialogCancel = React.forwardRef<
  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,
  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>
>(({ className, ...props }, ref) => (
  <AlertDialogPrimitive.Cancel
    ref={ref}
    className={cn(buttonVariants({ variant: "outline" }), "mt-2 sm:mt-0", className)}
    {...props}
  />
));
AlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName;

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};


============================================================
FILE PATH: .\src\components\ui\alert.tsx
============================================================
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive: "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div ref={ref} role="alert" className={cn(alertVariants({ variant }), className)} {...props} />
));
Alert.displayName = "Alert";

const AlertTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h5 ref={ref} className={cn("mb-1 font-medium leading-none tracking-tight", className)} {...props} />
  ),
);
AlertTitle.displayName = "AlertTitle";

const AlertDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("text-sm [&_p]:leading-relaxed", className)} {...props} />
  ),
);
AlertDescription.displayName = "AlertDescription";

export { Alert, AlertTitle, AlertDescription };


============================================================
FILE PATH: .\src\components\ui\aspect-ratio.tsx
============================================================
import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio";

const AspectRatio = AspectRatioPrimitive.Root;

export { AspectRatio };


============================================================
FILE PATH: .\src\components\ui\avatar.tsx
============================================================
import * as React from "react";
import * as AvatarPrimitive from "@radix-ui/react-avatar";

import { cn } from "@/lib/utils";

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full", className)}
    {...props}
  />
));
Avatar.displayName = AvatarPrimitive.Root.displayName;

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image ref={ref} className={cn("aspect-square h-full w-full", className)} {...props} />
));
AvatarImage.displayName = AvatarPrimitive.Image.displayName;

const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn("flex h-full w-full items-center justify-center rounded-full bg-muted", className)}
    {...props}
  />
));
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName;

export { Avatar, AvatarImage, AvatarFallback };


============================================================
FILE PATH: .\src\components\ui\badge-variants.ts
============================================================
import { cva } from "class-variance-authority";

export const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary: "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive: "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

============================================================
FILE PATH: .\src\components\ui\badge.tsx
============================================================
import * as React from "react";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

import { badgeVariants } from "./badge-variants";

export interface BadgeProps extends React.HTMLAttributes<HTMLDivElement>, VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return <div className={cn(badgeVariants({ variant }), className)} {...props} />;
}

export { Badge };


============================================================
FILE PATH: .\src\components\ui\breadcrumb.tsx
============================================================
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { ChevronRight, MoreHorizontal } from "lucide-react";

import { cn } from "@/lib/utils";

const Breadcrumb = React.forwardRef<
  HTMLElement,
  React.ComponentPropsWithoutRef<"nav"> & {
    separator?: React.ReactNode;
  }
>(({ ...props }, ref) => <nav ref={ref} aria-label="breadcrumb" {...props} />);
Breadcrumb.displayName = "Breadcrumb";

const BreadcrumbList = React.forwardRef<HTMLOListElement, React.ComponentPropsWithoutRef<"ol">>(
  ({ className, ...props }, ref) => (
    <ol
      ref={ref}
      className={cn(
        "flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5",
        className,
      )}
      {...props}
    />
  ),
);
BreadcrumbList.displayName = "BreadcrumbList";

const BreadcrumbItem = React.forwardRef<HTMLLIElement, React.ComponentPropsWithoutRef<"li">>(
  ({ className, ...props }, ref) => (
    <li ref={ref} className={cn("inline-flex items-center gap-1.5", className)} {...props} />
  ),
);
BreadcrumbItem.displayName = "BreadcrumbItem";

const BreadcrumbLink = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentPropsWithoutRef<"a"> & {
    asChild?: boolean;
  }
>(({ asChild, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a";

  return <Comp ref={ref} className={cn("transition-colors hover:text-foreground", className)} {...props} />;
});
BreadcrumbLink.displayName = "BreadcrumbLink";

const BreadcrumbPage = React.forwardRef<HTMLSpanElement, React.ComponentPropsWithoutRef<"span">>(
  ({ className, ...props }, ref) => (
    <span
      ref={ref}
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("font-normal text-foreground", className)}
      {...props}
    />
  ),
);
BreadcrumbPage.displayName = "BreadcrumbPage";

const BreadcrumbSeparator = ({ children, className, ...props }: React.ComponentProps<"li">) => (
  <li role="presentation" aria-hidden="true" className={cn("[&>svg]:size-3.5", className)} {...props}>
    {children ?? <ChevronRight />}
  </li>
);
BreadcrumbSeparator.displayName = "BreadcrumbSeparator";

const BreadcrumbEllipsis = ({ className, ...props }: React.ComponentProps<"span">) => (
  <span
    role="presentation"
    aria-hidden="true"
    className={cn("flex h-9 w-9 items-center justify-center", className)}
    {...props}
  >
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More</span>
  </span>
);
BreadcrumbEllipsis.displayName = "BreadcrumbElipssis";

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};


============================================================
FILE PATH: .\src\components\ui\button-variants.ts
============================================================
import { cva } from "class-variance-authority";

export const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-xl text-sm font-medium ring-offset-background transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 shadow-soft hover:shadow-floating hover:-translate-y-0.5",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline: "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground shadow-none hover:shadow-none hover:translate-y-0",
        link: "text-primary underline-offset-4 hover:underline shadow-none hover:shadow-none hover:translate-y-0",
        floating: "bg-primary text-primary-foreground shadow-floating hover:shadow-card hover:-translate-y-1",
      },
      size: {
        default: "h-11 px-6 py-3",
        sm: "h-9 rounded-lg px-4",
        lg: "h-12 rounded-xl px-8",
        icon: "h-11 w-11",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

============================================================
FILE PATH: .\src\components\ui\button.tsx
============================================================
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

import { buttonVariants } from "./button-variants";

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  asChild?: boolean;
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";
    return <Comp className={cn(buttonVariants({ variant, size, className }))} ref={ref} {...props} />;
  },
);
Button.displayName = "Button";

export { Button };


============================================================
FILE PATH: .\src\components\ui\calendar.tsx
============================================================
import * as React from "react";
import { ChevronLeft, ChevronRight } from "lucide-react";
import { DayPicker } from "react-day-picker";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button-variants";

export type CalendarProps = React.ComponentProps<typeof DayPicker>;

function Calendar({ className, classNames, showOutsideDays = true, ...props }: CalendarProps) {
  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn("p-3", className)}
      classNames={{
        months: "flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",
        month: "space-y-4",
        caption: "flex justify-center pt-1 relative items-center",
        caption_label: "text-sm font-medium",
        nav: "space-x-1 flex items-center",
        nav_button: cn(
          buttonVariants({ variant: "outline" }),
          "h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100",
        ),
        nav_button_previous: "absolute left-1",
        nav_button_next: "absolute right-1",
        table: "w-full border-collapse space-y-1",
        head_row: "flex",
        head_cell: "text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",
        row: "flex w-full mt-2",
        cell: "h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",
        day: cn(buttonVariants({ variant: "ghost" }), "h-9 w-9 p-0 font-normal aria-selected:opacity-100"),
        day_range_end: "day-range-end",
        day_selected:
          "bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",
        day_today: "bg-accent text-accent-foreground",
        day_outside:
          "day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",
        day_disabled: "text-muted-foreground opacity-50",
        day_range_middle: "aria-selected:bg-accent aria-selected:text-accent-foreground",
        day_hidden: "invisible",
        ...classNames,
      }}
      components={{
        IconLeft: ({ ..._props }) => <ChevronLeft className="h-4 w-4" />,
        IconRight: ({ ..._props }) => <ChevronRight className="h-4 w-4" />,
      }}
      {...props}
    />
  );
}
Calendar.displayName = "Calendar";

export { Calendar };


============================================================
FILE PATH: .\src\components\ui\card.tsx
============================================================
import * as React from "react";

import { cn } from "@/lib/utils";

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(({ className, ...props }, ref) => (
  <div ref={ref} className={cn("rounded-2xl border bg-card text-card-foreground shadow-soft transition-all duration-200 hover:shadow-card hover:-translate-y-1", className)} {...props} />
));
Card.displayName = "Card";

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  ),
);
CardHeader.displayName = "CardHeader";

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3 ref={ref} className={cn("text-2xl font-semibold leading-none tracking-tight", className)} {...props} />
  ),
);
CardTitle.displayName = "CardTitle";

const CardDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => (
    <p ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
  ),
);
CardDescription.displayName = "CardDescription";

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />,
);
CardContent.displayName = "CardContent";

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex items-center p-6 pt-0", className)} {...props} />
  ),
);
CardFooter.displayName = "CardFooter";

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };


============================================================
FILE PATH: .\src\components\ui\carousel.tsx
============================================================
import * as React from "react";
import useEmblaCarousel, { type UseEmblaCarouselType } from "embla-carousel-react";
import { ArrowLeft, ArrowRight } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

const Carousel = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement> & CarouselProps>(
  ({ orientation = "horizontal", opts, setApi, plugins, className, children, ...props }, ref) => {
    const [carouselRef, api] = useEmblaCarousel(
      {
        ...opts,
        axis: orientation === "horizontal" ? "x" : "y",
      },
      plugins,
    );
    const [canScrollPrev, setCanScrollPrev] = React.useState(false);
    const [canScrollNext, setCanScrollNext] = React.useState(false);

    const onSelect = React.useCallback((api: CarouselApi) => {
      if (!api) {
        return;
      }

      setCanScrollPrev(api.canScrollPrev());
      setCanScrollNext(api.canScrollNext());
    }, []);

    const scrollPrev = React.useCallback(() => {
      api?.scrollPrev();
    }, [api]);

    const scrollNext = React.useCallback(() => {
      api?.scrollNext();
    }, [api]);

    const handleKeyDown = React.useCallback(
      (event: React.KeyboardEvent<HTMLDivElement>) => {
        if (event.key === "ArrowLeft") {
          event.preventDefault();
          scrollPrev();
        } else if (event.key === "ArrowRight") {
          event.preventDefault();
          scrollNext();
        }
      },
      [scrollPrev, scrollNext],
    );

    React.useEffect(() => {
      if (!api || !setApi) {
        return;
      }

      setApi(api);
    }, [api, setApi]);

    React.useEffect(() => {
      if (!api) {
        return;
      }

      onSelect(api);
      api.on("reInit", onSelect);
      api.on("select", onSelect);

      return () => {
        api?.off("select", onSelect);
      };
    }, [api, onSelect]);

    return (
      <CarouselContext.Provider
        value={{
          carouselRef,
          api: api,
          opts,
          orientation: orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
          scrollPrev,
          scrollNext,
          canScrollPrev,
          canScrollNext,
        }}
      >
        <div
          ref={ref}
          onKeyDownCapture={handleKeyDown}
          className={cn("relative", className)}
          role="region"
          aria-roledescription="carousel"
          {...props}
        >
          {children}
        </div>
      </CarouselContext.Provider>
    );
  },
);
Carousel.displayName = "Carousel";

const CarouselContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => {
    const { carouselRef, orientation } = useCarousel();

    return (
      <div ref={carouselRef} className="overflow-hidden">
        <div
          ref={ref}
          className={cn("flex", orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col", className)}
          {...props}
        />
      </div>
    );
  },
);
CarouselContent.displayName = "CarouselContent";

const CarouselItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => {
    const { orientation } = useCarousel();

    return (
      <div
        ref={ref}
        role="group"
        aria-roledescription="slide"
        className={cn("min-w-0 shrink-0 grow-0 basis-full", orientation === "horizontal" ? "pl-4" : "pt-4", className)}
        {...props}
      />
    );
  },
);
CarouselItem.displayName = "CarouselItem";

const CarouselPrevious = React.forwardRef<HTMLButtonElement, React.ComponentProps<typeof Button>>(
  ({ className, variant = "outline", size = "icon", ...props }, ref) => {
    const { orientation, scrollPrev, canScrollPrev } = useCarousel();

    return (
      <Button
        ref={ref}
        variant={variant}
        size={size}
        className={cn(
          "absolute h-8 w-8 rounded-full",
          orientation === "horizontal"
            ? "-left-12 top-1/2 -translate-y-1/2"
            : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
          className,
        )}
        disabled={!canScrollPrev}
        onClick={scrollPrev}
        {...props}
      >
        <ArrowLeft className="h-4 w-4" />
        <span className="sr-only">Previous slide</span>
      </Button>
    );
  },
);
CarouselPrevious.displayName = "CarouselPrevious";

const CarouselNext = React.forwardRef<HTMLButtonElement, React.ComponentProps<typeof Button>>(
  ({ className, variant = "outline", size = "icon", ...props }, ref) => {
    const { orientation, scrollNext, canScrollNext } = useCarousel();

    return (
      <Button
        ref={ref}
        variant={variant}
        size={size}
        className={cn(
          "absolute h-8 w-8 rounded-full",
          orientation === "horizontal"
            ? "-right-12 top-1/2 -translate-y-1/2"
            : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
          className,
        )}
        disabled={!canScrollNext}
        onClick={scrollNext}
        {...props}
      >
        <ArrowRight className="h-4 w-4" />
        <span className="sr-only">Next slide</span>
      </Button>
    );
  },
);
CarouselNext.displayName = "CarouselNext";

export { type CarouselApi, Carousel, CarouselContent, CarouselItem, CarouselPrevious, CarouselNext };


============================================================
FILE PATH: .\src\components\ui\chart.tsx
============================================================
import * as React from "react";
import * as RechartsPrimitive from "recharts";

import { cn } from "@/lib/utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & ({ color?: string; theme?: never } | { color?: never; theme: Record<keyof typeof THEMES, string> });
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

const ChartContainer = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    config: ChartConfig;
    children: React.ComponentProps<typeof RechartsPrimitive.ResponsiveContainer>["children"];
  }
>(({ id, className, children, config, ...props }, ref) => {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-chart={chartId}
        ref={ref}
        className={cn(
          "flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>{children}</RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
});
ChartContainer.displayName = "Chart";

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(([_, config]) => config.theme || config.color);

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color = itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

const ChartTooltipContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
    React.ComponentProps<"div"> & {
      hideLabel?: boolean;
      hideIndicator?: boolean;
      indicator?: "line" | "dot" | "dashed";
      nameKey?: string;
      labelKey?: string;
    }
>(
  (
    {
      active,
      payload,
      className,
      indicator = "dot",
      hideLabel = false,
      hideIndicator = false,
      label,
      labelFormatter,
      labelClassName,
      formatter,
      color,
      nameKey,
      labelKey,
    },
    ref,
  ) => {
    const { config } = useChart();

    const tooltipLabel = React.useMemo(() => {
      if (hideLabel || !payload?.length) {
        return null;
      }

      const [item] = payload;
      const key = `${labelKey || item.dataKey || item.name || "value"}`;
      const itemConfig = getPayloadConfigFromPayload(config, item, key);
      const value =
        !labelKey && typeof label === "string"
          ? config[label as keyof typeof config]?.label || label
          : itemConfig?.label;

      if (labelFormatter) {
        return <div className={cn("font-medium", labelClassName)}>{labelFormatter(value, payload)}</div>;
      }

      if (!value) {
        return null;
      }

      return <div className={cn("font-medium", labelClassName)}>{value}</div>;
    }, [label, labelFormatter, payload, hideLabel, labelClassName, config, labelKey]);

    if (!active || !payload?.length) {
      return null;
    }

    const nestLabel = payload.length === 1 && indicator !== "dot";

    return (
      <div
        ref={ref}
        className={cn(
          "grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl",
          className,
        )}
      >
        {!nestLabel ? tooltipLabel : null}
        <div className="grid gap-1.5">
          {payload.map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`;
            const itemConfig = getPayloadConfigFromPayload(config, item, key);
            const indicatorColor = color || item.payload.fill || item.color;

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground",
                  indicator === "dot" && "items-center",
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn("shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]", {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent": indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          })}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center",
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">{itemConfig?.label || item.name}</span>
                      </div>
                      {item.value && (
                        <span className="font-mono font-medium tabular-nums text-foreground">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            );
          })}
        </div>
      </div>
    );
  },
);
ChartTooltipContent.displayName = "ChartTooltip";

const ChartLegend = RechartsPrimitive.Legend;

const ChartLegendContent = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> &
    Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
      hideIcon?: boolean;
      nameKey?: string;
    }
>(({ className, hideIcon = false, payload, verticalAlign = "bottom", nameKey }, ref) => {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div
      ref={ref}
      className={cn("flex items-center justify-center gap-4", verticalAlign === "top" ? "pb-3" : "pt-3", className)}
    >
      {payload.map((item) => {
        const key = `${nameKey || item.dataKey || "value"}`;
        const itemConfig = getPayloadConfigFromPayload(config, item, key);

        return (
          <div
            key={item.value}
            className={cn("flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground")}
          >
            {itemConfig?.icon && !hideIcon ? (
              <itemConfig.icon />
            ) : (
              <div
                className="h-2 w-2 shrink-0 rounded-[2px]"
                style={{
                  backgroundColor: item.color,
                }}
              />
            )}
            {itemConfig?.label}
          </div>
        );
      })}
    </div>
  );
});
ChartLegendContent.displayName = "ChartLegend";

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(config: ChartConfig, payload: unknown, key: string) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload && typeof payload.payload === "object" && payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (key in payload && typeof payload[key as keyof typeof payload] === "string") {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[key as keyof typeof payloadPayload] as string;
  }

  return configLabelKey in config ? config[configLabelKey] : config[key as keyof typeof config];
}

export { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle };


============================================================
FILE PATH: .\src\components\ui\checkbox.tsx
============================================================
import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { Check } from "lucide-react";

import { cn } from "@/lib/utils";

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
      className,
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator className={cn("flex items-center justify-center text-current")}>
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
));
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };


============================================================
FILE PATH: .\src\components\ui\collapsible.tsx
============================================================
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible";

const Collapsible = CollapsiblePrimitive.Root;

const CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger;

const CollapsibleContent = CollapsiblePrimitive.CollapsibleContent;

export { Collapsible, CollapsibleTrigger, CollapsibleContent };


============================================================
FILE PATH: .\src\components\ui\command.tsx
============================================================
import * as React from "react";
import { type DialogProps } from "@radix-ui/react-dialog";
import { Command as CommandPrimitive } from "cmdk";
import { Search } from "lucide-react";

import { cn } from "@/lib/utils";
import { Dialog, DialogContent } from "@/components/ui/dialog";

const Command = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive>
>(({ className, ...props }, ref) => (
  <CommandPrimitive
    ref={ref}
    className={cn(
      "flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",
      className,
    )}
    {...props}
  />
));
Command.displayName = CommandPrimitive.displayName;

const CommandDialog = ({ children, ...props }: DialogProps) => {
  return (
    <Dialog {...props}>
      <DialogContent className="overflow-hidden p-0 shadow-lg">
        <Command className="[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
};

const CommandInput = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Input>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>
>(({ className, ...props }, ref) => (
  <div className="flex items-center border-b px-3" cmdk-input-wrapper="">
    <Search className="mr-2 h-4 w-4 shrink-0 opacity-50" />
    <CommandPrimitive.Input
      ref={ref}
      className={cn(
        "flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    />
  </div>
));

CommandInput.displayName = CommandPrimitive.Input.displayName;

const CommandList = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.List
    ref={ref}
    className={cn("max-h-[300px] overflow-y-auto overflow-x-hidden", className)}
    {...props}
  />
));

CommandList.displayName = CommandPrimitive.List.displayName;

const CommandEmpty = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Empty>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>
>((props, ref) => <CommandPrimitive.Empty ref={ref} className="py-6 text-center text-sm" {...props} />);

CommandEmpty.displayName = CommandPrimitive.Empty.displayName;

const CommandGroup = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Group>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Group
    ref={ref}
    className={cn(
      "overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",
      className,
    )}
    {...props}
  />
));

CommandGroup.displayName = CommandPrimitive.Group.displayName;

const CommandSeparator = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Separator ref={ref} className={cn("-mx-1 h-px bg-border", className)} {...props} />
));
CommandSeparator.displayName = CommandPrimitive.Separator.displayName;

const CommandItem = React.forwardRef<
  React.ElementRef<typeof CommandPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>
>(({ className, ...props }, ref) => (
  <CommandPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",
      className,
    )}
    {...props}
  />
));

CommandItem.displayName = CommandPrimitive.Item.displayName;

const CommandShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {
  return <span className={cn("ml-auto text-xs tracking-widest text-muted-foreground", className)} {...props} />;
};
CommandShortcut.displayName = "CommandShortcut";

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};


============================================================
FILE PATH: .\src\components\ui\context-menu.tsx
============================================================
import * as React from "react";
import * as ContextMenuPrimitive from "@radix-ui/react-context-menu";
import { Check, ChevronRight, Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const ContextMenu = ContextMenuPrimitive.Root;

const ContextMenuTrigger = ContextMenuPrimitive.Trigger;

const ContextMenuGroup = ContextMenuPrimitive.Group;

const ContextMenuPortal = ContextMenuPrimitive.Portal;

const ContextMenuSub = ContextMenuPrimitive.Sub;

const ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup;

const ContextMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <ContextMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent data-[state=open]:text-accent-foreground focus:bg-accent focus:text-accent-foreground",
      inset && "pl-8",
      className,
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </ContextMenuPrimitive.SubTrigger>
));
ContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName;

const ContextMenuSubContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
ContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName;

const ContextMenuContent = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Portal>
    <ContextMenuPrimitive.Content
      ref={ref}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className,
      )}
      {...props}
    />
  </ContextMenuPrimitive.Portal>
));
ContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName;

const ContextMenuItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
ContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName;

const ContextMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <ContextMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.CheckboxItem>
));
ContextMenuCheckboxItem.displayName = ContextMenuPrimitive.CheckboxItem.displayName;

const ContextMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <ContextMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <ContextMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </ContextMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </ContextMenuPrimitive.RadioItem>
));
ContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName;

const ContextMenuLabel = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <ContextMenuPrimitive.Label
    ref={ref}
    className={cn("px-2 py-1.5 text-sm font-semibold text-foreground", inset && "pl-8", className)}
    {...props}
  />
));
ContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName;

const ContextMenuSeparator = React.forwardRef<
  React.ElementRef<typeof ContextMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <ContextMenuPrimitive.Separator ref={ref} className={cn("-mx-1 my-1 h-px bg-border", className)} {...props} />
));
ContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName;

const ContextMenuShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {
  return <span className={cn("ml-auto text-xs tracking-widest text-muted-foreground", className)} {...props} />;
};
ContextMenuShortcut.displayName = "ContextMenuShortcut";

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};


============================================================
FILE PATH: .\src\components\ui\date-picker.tsx
============================================================
import * as React from "react";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { Calendar as CalendarIcon } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Calendar } from "@/components/ui/calendar";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";

interface DatePickerProps {
  value?: Date;
  onChange?: (date: Date | undefined) => void;
  placeholder?: string;
  disabled?: boolean;
  className?: string;
}

export function DatePicker({
  value,
  onChange,
  placeholder = "Selecione uma data",
  disabled = false,
  className
}: DatePickerProps) {
  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button
          variant="outline"
          className={cn(
            "w-full justify-start text-left font-normal",
            !value && "text-muted-foreground",
            className
          )}
          disabled={disabled}
        >
          <CalendarIcon className="mr-2 h-4 w-4" />
          {value ? format(value, "dd 'de' MMMM 'de' yyyy", { locale: ptBR }) : <span>{placeholder}</span>}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-auto p-0" align="start">
        <Calendar
          mode="single"
          selected={value}
          onSelect={onChange}
          initialFocus
          locale={ptBR}
          disabled={(date) => date < new Date(new Date().setHours(0, 0, 0, 0))}
        />
      </PopoverContent>
    </Popover>
  );
}


============================================================
FILE PATH: .\src\components\ui\dialog.tsx
============================================================
import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { X } from "lucide-react";

import { cn } from "@/lib/utils";

const Dialog = DialogPrimitive.Root;

const DialogTrigger = DialogPrimitive.Trigger;

const DialogPortal = DialogPrimitive.Portal;

const DialogClose = DialogPrimitive.Close;

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className,
    )}
    {...props}
  />
));
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName;

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className,
      )}
      {...props}
    >
      {children}
      <DialogPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-accent data-[state=open]:text-muted-foreground hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none">
        <X className="h-4 w-4" />
        <span className="sr-only">Close</span>
      </DialogPrimitive.Close>
    </DialogPrimitive.Content>
  </DialogPortal>
));
DialogContent.displayName = DialogPrimitive.Content.displayName;

const DialogHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col space-y-1.5 text-center sm:text-left", className)} {...props} />
);
DialogHeader.displayName = "DialogHeader";

const DialogFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)} {...props} />
);
DialogFooter.displayName = "DialogFooter";

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold leading-none tracking-tight", className)}
    {...props}
  />
));
DialogTitle.displayName = DialogPrimitive.Title.displayName;

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
));
DialogDescription.displayName = DialogPrimitive.Description.displayName;

export {
  Dialog,
  DialogPortal,
  DialogOverlay,
  DialogClose,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
};


============================================================
FILE PATH: .\src\components\ui\drawer.tsx
============================================================
import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul";

import { cn } from "@/lib/utils";

const Drawer = ({ shouldScaleBackground = true, ...props }: React.ComponentProps<typeof DrawerPrimitive.Root>) => (
  <DrawerPrimitive.Root shouldScaleBackground={shouldScaleBackground} {...props} />
);
Drawer.displayName = "Drawer";

const DrawerTrigger = DrawerPrimitive.Trigger;

const DrawerPortal = DrawerPrimitive.Portal;

const DrawerClose = DrawerPrimitive.Close;

const DrawerOverlay = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Overlay ref={ref} className={cn("fixed inset-0 z-50 bg-black/80", className)} {...props} />
));
DrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName;

const DrawerContent = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>
>(({ className, children, ...props }, ref) => (
  <DrawerPortal>
    <DrawerOverlay />
    <DrawerPrimitive.Content
      ref={ref}
      className={cn(
        "fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background",
        className,
      )}
      {...props}
    >
      <div className="mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted" />
      {children}
    </DrawerPrimitive.Content>
  </DrawerPortal>
));
DrawerContent.displayName = "DrawerContent";

const DrawerHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("grid gap-1.5 p-4 text-center sm:text-left", className)} {...props} />
);
DrawerHeader.displayName = "DrawerHeader";

const DrawerFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />
);
DrawerFooter.displayName = "DrawerFooter";

const DrawerTitle = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold leading-none tracking-tight", className)}
    {...props}
  />
));
DrawerTitle.displayName = DrawerPrimitive.Title.displayName;

const DrawerDescription = React.forwardRef<
  React.ElementRef<typeof DrawerPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DrawerPrimitive.Description ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
));
DrawerDescription.displayName = DrawerPrimitive.Description.displayName;

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};


============================================================
FILE PATH: .\src\components\ui\dropdown-menu.tsx
============================================================
import * as React from "react";
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu";
import { Check, ChevronRight, Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const DropdownMenu = DropdownMenuPrimitive.Root;

const DropdownMenuTrigger = DropdownMenuPrimitive.Trigger;

const DropdownMenuGroup = DropdownMenuPrimitive.Group;

const DropdownMenuPortal = DropdownMenuPrimitive.Portal;

const DropdownMenuSub = DropdownMenuPrimitive.Sub;

const DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup;

const DropdownMenuSubTrigger = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <DropdownMenuPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent focus:bg-accent",
      inset && "pl-8",
      className,
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </DropdownMenuPrimitive.SubTrigger>
));
DropdownMenuSubTrigger.displayName = DropdownMenuPrimitive.SubTrigger.displayName;

const DropdownMenuSubContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
DropdownMenuSubContent.displayName = DropdownMenuPrimitive.SubContent.displayName;

const DropdownMenuContent = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <DropdownMenuPrimitive.Portal>
    <DropdownMenuPrimitive.Content
      ref={ref}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className,
      )}
      {...props}
    />
  </DropdownMenuPrimitive.Portal>
));
DropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName;

const DropdownMenuItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
DropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName;

const DropdownMenuCheckboxItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <DropdownMenuPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.CheckboxItem>
));
DropdownMenuCheckboxItem.displayName = DropdownMenuPrimitive.CheckboxItem.displayName;

const DropdownMenuRadioItem = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <DropdownMenuPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <DropdownMenuPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </DropdownMenuPrimitive.ItemIndicator>
    </span>
    {children}
  </DropdownMenuPrimitive.RadioItem>
));
DropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName;

const DropdownMenuLabel = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <DropdownMenuPrimitive.Label
    ref={ref}
    className={cn("px-2 py-1.5 text-sm font-semibold", inset && "pl-8", className)}
    {...props}
  />
));
DropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName;

const DropdownMenuSeparator = React.forwardRef<
  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <DropdownMenuPrimitive.Separator ref={ref} className={cn("-mx-1 my-1 h-px bg-muted", className)} {...props} />
));
DropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName;

const DropdownMenuShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {
  return <span className={cn("ml-auto text-xs tracking-widest opacity-60", className)} {...props} />;
};
DropdownMenuShortcut.displayName = "DropdownMenuShortcut";

export {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuGroup,
  DropdownMenuPortal,
  DropdownMenuSub,
  DropdownMenuSubContent,
  DropdownMenuSubTrigger,
  DropdownMenuRadioGroup,
};


============================================================
FILE PATH: .\src\components\ui\form-utils.tsx
============================================================
import * as React from "react";
import { FieldPath, FieldValues, useFormContext } from "react-hook-form";

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

export const FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);

type FormItemContextValue = {
  id: string;
};

export const FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);

export const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState, formState } = useFormContext();

  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

============================================================
FILE PATH: .\src\components\ui\form.tsx
============================================================
import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { Slot } from "@radix-ui/react-slot";
import { Controller, ControllerProps, FieldPath, FieldValues, FormProvider } from "react-hook-form";

import { cn } from "@/lib/utils";
import { Label } from "@/components/ui/label";

const Form = FormProvider;

import { FormFieldContext, FormItemContext, useFormField } from "./form-utils";

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

// useFormField agora vem de ./form-utils

// FormItemContext agora vem de ./form-utils

const FormItem = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => {
    const id = React.useId();

    return (
      <FormItemContext.Provider value={{ id }}>
        <div ref={ref} className={cn("space-y-2", className)} {...props} />
      </FormItemContext.Provider>
    );
  },
);
FormItem.displayName = "FormItem";

const FormLabel = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>
>(({ className, ...props }, ref) => {
  const { error, formItemId } = useFormField();

  return <Label ref={ref} className={cn(error && "text-destructive", className)} htmlFor={formItemId} {...props} />;
});
FormLabel.displayName = "FormLabel";

const FormControl = React.forwardRef<React.ElementRef<typeof Slot>, React.ComponentPropsWithoutRef<typeof Slot>>(
  ({ ...props }, ref) => {
    const { error, formItemId, formDescriptionId, formMessageId } = useFormField();

    return (
      <Slot
        ref={ref}
        id={formItemId}
        aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}
        aria-invalid={!!error}
        {...props}
      />
    );
  },
);
FormControl.displayName = "FormControl";

const FormDescription = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, ...props }, ref) => {
    const { formDescriptionId } = useFormField();

    return <p ref={ref} id={formDescriptionId} className={cn("text-sm text-muted-foreground", className)} {...props} />;
  },
);
FormDescription.displayName = "FormDescription";

const FormMessage = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLParagraphElement>>(
  ({ className, children, ...props }, ref) => {
    const { error, formMessageId } = useFormField();
    const body = error ? String(error?.message) : children;

    if (!body) {
      return null;
    }

    return (
      <p ref={ref} id={formMessageId} className={cn("text-sm font-medium text-destructive", className)} {...props}>
        {body}
      </p>
    );
  },
);
FormMessage.displayName = "FormMessage";

export { Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };


============================================================
FILE PATH: .\src\components\ui\hover-card.tsx
============================================================
import * as React from "react";
import * as HoverCardPrimitive from "@radix-ui/react-hover-card";

import { cn } from "@/lib/utils";

const HoverCard = HoverCardPrimitive.Root;

const HoverCardTrigger = HoverCardPrimitive.Trigger;

const HoverCardContent = React.forwardRef<
  React.ElementRef<typeof HoverCardPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <HoverCardPrimitive.Content
    ref={ref}
    align={align}
    sideOffset={sideOffset}
    className={cn(
      "z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
HoverCardContent.displayName = HoverCardPrimitive.Content.displayName;

export { HoverCard, HoverCardTrigger, HoverCardContent };


============================================================
FILE PATH: .\src\components\ui\input-otp.tsx
============================================================
import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp";
import { Dot } from "lucide-react";

import { cn } from "@/lib/utils";

const InputOTP = React.forwardRef<React.ElementRef<typeof OTPInput>, React.ComponentPropsWithoutRef<typeof OTPInput>>(
  ({ className, containerClassName, ...props }, ref) => (
    <OTPInput
      ref={ref}
      containerClassName={cn("flex items-center gap-2 has-[:disabled]:opacity-50", containerClassName)}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  ),
);
InputOTP.displayName = "InputOTP";

const InputOTPGroup = React.forwardRef<React.ElementRef<"div">, React.ComponentPropsWithoutRef<"div">>(
  ({ className, ...props }, ref) => <div ref={ref} className={cn("flex items-center", className)} {...props} />,
);
InputOTPGroup.displayName = "InputOTPGroup";

const InputOTPSlot = React.forwardRef<
  React.ElementRef<"div">,
  React.ComponentPropsWithoutRef<"div"> & { index: number }
>(({ index, className, ...props }, ref) => {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index];

  return (
    <div
      ref={ref}
      className={cn(
        "relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md",
        isActive && "z-10 ring-2 ring-ring ring-offset-background",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink h-4 w-px bg-foreground duration-1000" />
        </div>
      )}
    </div>
  );
});
InputOTPSlot.displayName = "InputOTPSlot";

const InputOTPSeparator = React.forwardRef<React.ElementRef<"div">, React.ComponentPropsWithoutRef<"div">>(
  ({ ...props }, ref) => (
    <div ref={ref} role="separator" {...props}>
      <Dot />
    </div>
  ),
);
InputOTPSeparator.displayName = "InputOTPSeparator";

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };


============================================================
FILE PATH: .\src\components\ui\input.tsx
============================================================
import * as React from "react";

import { cn } from "@/lib/utils";

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className,
        )}
        ref={ref}
        {...props}
      />
    );
  },
);
Input.displayName = "Input";

export { Input };


============================================================
FILE PATH: .\src\components\ui\label.tsx
============================================================
import * as React from "react";
import * as LabelPrimitive from "@radix-ui/react-label";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const labelVariants = cva("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70");

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> & VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root ref={ref} className={cn(labelVariants(), className)} {...props} />
));
Label.displayName = LabelPrimitive.Root.displayName;

export { Label };


============================================================
FILE PATH: .\src\components\ui\menubar.tsx
============================================================
import * as React from "react";
import * as MenubarPrimitive from "@radix-ui/react-menubar";
import { Check, ChevronRight, Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const MenubarMenu = MenubarPrimitive.Menu;

const MenubarGroup = MenubarPrimitive.Group;

const MenubarPortal = MenubarPrimitive.Portal;

const MenubarSub = MenubarPrimitive.Sub;

const MenubarRadioGroup = MenubarPrimitive.RadioGroup;

const Menubar = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Root
    ref={ref}
    className={cn("flex h-10 items-center space-x-1 rounded-md border bg-background p-1", className)}
    {...props}
  />
));
Menubar.displayName = MenubarPrimitive.Root.displayName;

const MenubarTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none data-[state=open]:bg-accent data-[state=open]:text-accent-foreground focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    {...props}
  />
));
MenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName;

const MenubarSubTrigger = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {
    inset?: boolean;
  }
>(({ className, inset, children, ...props }, ref) => (
  <MenubarPrimitive.SubTrigger
    ref={ref}
    className={cn(
      "flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[state=open]:bg-accent data-[state=open]:text-accent-foreground focus:bg-accent focus:text-accent-foreground",
      inset && "pl-8",
      className,
    )}
    {...props}
  >
    {children}
    <ChevronRight className="ml-auto h-4 w-4" />
  </MenubarPrimitive.SubTrigger>
));
MenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName;

const MenubarSubContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.SubContent>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.SubContent
    ref={ref}
    className={cn(
      "z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
MenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName;

const MenubarContent = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>
>(({ className, align = "start", alignOffset = -4, sideOffset = 8, ...props }, ref) => (
  <MenubarPrimitive.Portal>
    <MenubarPrimitive.Content
      ref={ref}
      align={align}
      alignOffset={alignOffset}
      sideOffset={sideOffset}
      className={cn(
        "z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className,
      )}
      {...props}
    />
  </MenubarPrimitive.Portal>
));
MenubarContent.displayName = MenubarPrimitive.Content.displayName;

const MenubarItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      inset && "pl-8",
      className,
    )}
    {...props}
  />
));
MenubarItem.displayName = MenubarPrimitive.Item.displayName;

const MenubarCheckboxItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>
>(({ className, children, checked, ...props }, ref) => (
  <MenubarPrimitive.CheckboxItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    checked={checked}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.CheckboxItem>
));
MenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName;

const MenubarRadioItem = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.RadioItem>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>
>(({ className, children, ...props }, ref) => (
  <MenubarPrimitive.RadioItem
    ref={ref}
    className={cn(
      "relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <MenubarPrimitive.ItemIndicator>
        <Circle className="h-2 w-2 fill-current" />
      </MenubarPrimitive.ItemIndicator>
    </span>
    {children}
  </MenubarPrimitive.RadioItem>
));
MenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName;

const MenubarLabel = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {
    inset?: boolean;
  }
>(({ className, inset, ...props }, ref) => (
  <MenubarPrimitive.Label
    ref={ref}
    className={cn("px-2 py-1.5 text-sm font-semibold", inset && "pl-8", className)}
    {...props}
  />
));
MenubarLabel.displayName = MenubarPrimitive.Label.displayName;

const MenubarSeparator = React.forwardRef<
  React.ElementRef<typeof MenubarPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <MenubarPrimitive.Separator ref={ref} className={cn("-mx-1 my-1 h-px bg-muted", className)} {...props} />
));
MenubarSeparator.displayName = MenubarPrimitive.Separator.displayName;

const MenubarShortcut = ({ className, ...props }: React.HTMLAttributes<HTMLSpanElement>) => {
  return <span className={cn("ml-auto text-xs tracking-widest text-muted-foreground", className)} {...props} />;
};
MenubarShortcut.displayname = "MenubarShortcut";

export {
  Menubar,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarItem,
  MenubarSeparator,
  MenubarLabel,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarPortal,
  MenubarSubContent,
  MenubarSubTrigger,
  MenubarGroup,
  MenubarSub,
  MenubarShortcut,
};


============================================================
FILE PATH: .\src\components\ui\navigation-menu-style.ts
============================================================
import { cva } from "class-variance-authority";

export const navigationMenuTriggerStyle = cva(
  "group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[active]:bg-accent/50 data-[state=open]:bg-accent/50",
);

============================================================
FILE PATH: .\src\components\ui\navigation-menu.tsx
============================================================
import * as React from "react";
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu";
import { cva } from "class-variance-authority";
import { navigationMenuTriggerStyle } from "@/components/ui/navigation-menu-style";
import { ChevronDown } from "lucide-react";

import { cn } from "@/lib/utils";

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn("relative z-10 flex max-w-max flex-1 items-center justify-center", className)}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
));
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName;

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn("group flex flex-1 list-none items-center justify-center space-x-1", className)}
    {...props}
  />
));
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName;

const NavigationMenuItem = NavigationMenuPrimitive.Item;

// moved to navigation-menu-style.ts

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
));
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName;

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto",
      className,
    )}
    {...props}
  />
));
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName;

const NavigationMenuLink = NavigationMenuPrimitive.Link;

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className,
      )}
      ref={ref}
      {...props}
    />
  </div>
));
NavigationMenuViewport.displayName = NavigationMenuPrimitive.Viewport.displayName;

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className,
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
));
NavigationMenuIndicator.displayName = NavigationMenuPrimitive.Indicator.displayName;

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
};


============================================================
FILE PATH: .\src\components\ui\pagination.tsx
============================================================
import * as React from "react";
import { ChevronLeft, ChevronRight, MoreHorizontal } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { buttonVariants } from "@/components/ui/button-variants";

const Pagination = ({ className, ...props }: React.ComponentProps<"nav">) => (
  <nav
    role="navigation"
    aria-label="pagination"
    className={cn("mx-auto flex w-full justify-center", className)}
    {...props}
  />
);
Pagination.displayName = "Pagination";

const PaginationContent = React.forwardRef<HTMLUListElement, React.ComponentProps<"ul">>(
  ({ className, ...props }, ref) => (
    <ul ref={ref} className={cn("flex flex-row items-center gap-1", className)} {...props} />
  ),
);
PaginationContent.displayName = "PaginationContent";

const PaginationItem = React.forwardRef<HTMLLIElement, React.ComponentProps<"li">>(({ className, ...props }, ref) => (
  <li ref={ref} className={cn("", className)} {...props} />
));
PaginationItem.displayName = "PaginationItem";

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

const PaginationLink = ({ className, isActive, size = "icon", ...props }: PaginationLinkProps) => (
  <a
    aria-current={isActive ? "page" : undefined}
    className={cn(
      buttonVariants({
        variant: isActive ? "outline" : "ghost",
        size,
      }),
      className,
    )}
    {...props}
  />
);
PaginationLink.displayName = "PaginationLink";

const PaginationPrevious = ({ className, ...props }: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink aria-label="Go to previous page" size="default" className={cn("gap-1 pl-2.5", className)} {...props}>
    <ChevronLeft className="h-4 w-4" />
    <span>Previous</span>
  </PaginationLink>
);
PaginationPrevious.displayName = "PaginationPrevious";

const PaginationNext = ({ className, ...props }: React.ComponentProps<typeof PaginationLink>) => (
  <PaginationLink aria-label="Go to next page" size="default" className={cn("gap-1 pr-2.5", className)} {...props}>
    <span>Next</span>
    <ChevronRight className="h-4 w-4" />
  </PaginationLink>
);
PaginationNext.displayName = "PaginationNext";

const PaginationEllipsis = ({ className, ...props }: React.ComponentProps<"span">) => (
  <span aria-hidden className={cn("flex h-9 w-9 items-center justify-center", className)} {...props}>
    <MoreHorizontal className="h-4 w-4" />
    <span className="sr-only">More pages</span>
  </span>
);
PaginationEllipsis.displayName = "PaginationEllipsis";

export {
  Pagination,
  PaginationContent,
  PaginationEllipsis,
  PaginationItem,
  PaginationLink,
  PaginationNext,
  PaginationPrevious,
};


============================================================
FILE PATH: .\src\components\ui\popover.tsx
============================================================
import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover";

import { cn } from "@/lib/utils";

const Popover = PopoverPrimitive.Root;

const PopoverTrigger = PopoverPrimitive.Trigger;

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className,
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
));
PopoverContent.displayName = PopoverPrimitive.Content.displayName;

export { Popover, PopoverTrigger, PopoverContent };


============================================================
FILE PATH: .\src\components\ui\progress.tsx
============================================================
import * as React from "react";
import * as ProgressPrimitive from "@radix-ui/react-progress";

import { cn } from "@/lib/utils";

const Progress = React.forwardRef<
  React.ElementRef<typeof ProgressPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>
>(({ className, value, ...props }, ref) => (
  <ProgressPrimitive.Root
    ref={ref}
    className={cn("relative h-4 w-full overflow-hidden rounded-full bg-secondary", className)}
    {...props}
  >
    <ProgressPrimitive.Indicator
      className="h-full w-full flex-1 bg-primary transition-all"
      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
    />
  </ProgressPrimitive.Root>
));
Progress.displayName = ProgressPrimitive.Root.displayName;

export { Progress };


============================================================
FILE PATH: .\src\components\ui\radio-group.tsx
============================================================
import * as React from "react";
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group";
import { Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return <RadioGroupPrimitive.Root className={cn("grid gap-2", className)} {...props} ref={ref} />;
});
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName;

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
});
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName;

export { RadioGroup, RadioGroupItem };


============================================================
FILE PATH: .\src\components\ui\resizable.tsx
============================================================
import { GripVertical } from "lucide-react";
import * as ResizablePrimitive from "react-resizable-panels";

import { cn } from "@/lib/utils";

const ResizablePanelGroup = ({ className, ...props }: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (
  <ResizablePrimitive.PanelGroup
    className={cn("flex h-full w-full data-[panel-group-direction=vertical]:flex-col", className)}
    {...props}
  />
);

const ResizablePanel = ResizablePrimitive.Panel;

const ResizableHandle = ({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) => (
  <ResizablePrimitive.PanelResizeHandle
    className={cn(
      "relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 [&[data-panel-group-direction=vertical]>div]:rotate-90",
      className,
    )}
    {...props}
  >
    {withHandle && (
      <div className="z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border">
        <GripVertical className="h-2.5 w-2.5" />
      </div>
    )}
  </ResizablePrimitive.PanelResizeHandle>
);

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };


============================================================
FILE PATH: .\src\components\ui\scroll-area.tsx
============================================================
import * as React from "react";
import * as ScrollAreaPrimitive from "@radix-ui/react-scroll-area";

import { cn } from "@/lib/utils";

const ScrollArea = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <ScrollAreaPrimitive.Root ref={ref} className={cn("relative overflow-hidden", className)} {...props}>
    <ScrollAreaPrimitive.Viewport className="h-full w-full rounded-[inherit]">{children}</ScrollAreaPrimitive.Viewport>
    <ScrollBar />
    <ScrollAreaPrimitive.Corner />
  </ScrollAreaPrimitive.Root>
));
ScrollArea.displayName = ScrollAreaPrimitive.Root.displayName;

const ScrollBar = React.forwardRef<
  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,
  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>
>(({ className, orientation = "vertical", ...props }, ref) => (
  <ScrollAreaPrimitive.ScrollAreaScrollbar
    ref={ref}
    orientation={orientation}
    className={cn(
      "flex touch-none select-none transition-colors",
      orientation === "vertical" && "h-full w-2.5 border-l border-l-transparent p-[1px]",
      orientation === "horizontal" && "h-2.5 flex-col border-t border-t-transparent p-[1px]",
      className,
    )}
    {...props}
  >
    <ScrollAreaPrimitive.ScrollAreaThumb className="relative flex-1 rounded-full bg-border" />
  </ScrollAreaPrimitive.ScrollAreaScrollbar>
));
ScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName;

export { ScrollArea, ScrollBar };


============================================================
FILE PATH: .\src\components\ui\select.tsx
============================================================
import * as React from "react";
import * as SelectPrimitive from "@radix-ui/react-select";
import { Check, ChevronDown, ChevronUp } from "lucide-react";

import { cn } from "@/lib/utils";

const Select = SelectPrimitive.Root;

const SelectGroup = SelectPrimitive.Group;

const SelectValue = SelectPrimitive.Value;

const SelectTrigger = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Trigger
    ref={ref}
    className={cn(
      "flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",
      className,
    )}
    {...props}
  >
    {children}
    <SelectPrimitive.Icon asChild>
      <ChevronDown className="h-4 w-4 opacity-50" />
    </SelectPrimitive.Icon>
  </SelectPrimitive.Trigger>
));
SelectTrigger.displayName = SelectPrimitive.Trigger.displayName;

const SelectScrollUpButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollUpButton
    ref={ref}
    className={cn("flex cursor-default items-center justify-center py-1", className)}
    {...props}
  >
    <ChevronUp className="h-4 w-4" />
  </SelectPrimitive.ScrollUpButton>
));
SelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName;

const SelectScrollDownButton = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.ScrollDownButton
    ref={ref}
    className={cn("flex cursor-default items-center justify-center py-1", className)}
    {...props}
  >
    <ChevronDown className="h-4 w-4" />
  </SelectPrimitive.ScrollDownButton>
));
SelectScrollDownButton.displayName = SelectPrimitive.ScrollDownButton.displayName;

const SelectContent = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>
>(({ className, children, position = "popper", ...props }, ref) => (
  <SelectPrimitive.Portal>
    <SelectPrimitive.Content
      ref={ref}
      className={cn(
        "relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        position === "popper" &&
          "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
        className,
      )}
      position={position}
      {...props}
    >
      <SelectScrollUpButton />
      <SelectPrimitive.Viewport
        className={cn(
          "p-1",
          position === "popper" &&
            "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]",
        )}
      >
        {children}
      </SelectPrimitive.Viewport>
      <SelectScrollDownButton />
    </SelectPrimitive.Content>
  </SelectPrimitive.Portal>
));
SelectContent.displayName = SelectPrimitive.Content.displayName;

const SelectLabel = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Label>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Label ref={ref} className={cn("py-1.5 pl-8 pr-2 text-sm font-semibold", className)} {...props} />
));
SelectLabel.displayName = SelectPrimitive.Label.displayName;

const SelectItem = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>
>(({ className, children, ...props }, ref) => (
  <SelectPrimitive.Item
    ref={ref}
    className={cn(
      "relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 focus:bg-accent focus:text-accent-foreground",
      className,
    )}
    {...props}
  >
    <span className="absolute left-2 flex h-3.5 w-3.5 items-center justify-center">
      <SelectPrimitive.ItemIndicator>
        <Check className="h-4 w-4" />
      </SelectPrimitive.ItemIndicator>
    </span>

    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
  </SelectPrimitive.Item>
));
SelectItem.displayName = SelectPrimitive.Item.displayName;

const SelectSeparator = React.forwardRef<
  React.ElementRef<typeof SelectPrimitive.Separator>,
  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>
>(({ className, ...props }, ref) => (
  <SelectPrimitive.Separator ref={ref} className={cn("-mx-1 my-1 h-px bg-muted", className)} {...props} />
));
SelectSeparator.displayName = SelectPrimitive.Separator.displayName;

export {
  Select,
  SelectGroup,
  SelectValue,
  SelectTrigger,
  SelectContent,
  SelectLabel,
  SelectItem,
  SelectSeparator,
  SelectScrollUpButton,
  SelectScrollDownButton,
};


============================================================
FILE PATH: .\src\components\ui\separator.tsx
============================================================
import * as React from "react";
import * as SeparatorPrimitive from "@radix-ui/react-separator";

import { cn } from "@/lib/utils";

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(({ className, orientation = "horizontal", decorative = true, ...props }, ref) => (
  <SeparatorPrimitive.Root
    ref={ref}
    decorative={decorative}
    orientation={orientation}
    className={cn("shrink-0 bg-border", orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]", className)}
    {...props}
  />
));
Separator.displayName = SeparatorPrimitive.Root.displayName;

export { Separator };


============================================================
FILE PATH: .\src\components\ui\sheet.tsx
============================================================
import * as SheetPrimitive from "@radix-ui/react-dialog";
import { cva, type VariantProps } from "class-variance-authority";
import { X } from "lucide-react";
import * as React from "react";

import { cn } from "@/lib/utils";

const Sheet = SheetPrimitive.Root;

const SheetTrigger = SheetPrimitive.Trigger;

const SheetClose = SheetPrimitive.Close;

const SheetPortal = SheetPrimitive.Portal;

const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className,
    )}
    {...props}
    ref={ref}
  />
));
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName;

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  },
);

interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
  VariantProps<typeof sheetVariants> {
  hideCloseButton?: boolean;
}

const SheetContent = React.forwardRef<React.ElementRef<typeof SheetPrimitive.Content>, SheetContentProps>(
  ({ side = "right", className, children, hideCloseButton, ...props }, ref) => (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content ref={ref} className={cn(sheetVariants({ side }), className)} {...props}>
        {children}
        {!hideCloseButton && (
          <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity data-[state=open]:bg-secondary hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none">
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </SheetPrimitive.Close>
        )}
      </SheetPrimitive.Content>
    </SheetPortal>
  ),
);
SheetContent.displayName = SheetPrimitive.Content.displayName;

const SheetHeader = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col space-y-2 text-center sm:text-left", className)} {...props} />
);
SheetHeader.displayName = "SheetHeader";

const SheetFooter = ({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) => (
  <div className={cn("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2", className)} {...props} />
);
SheetFooter.displayName = "SheetFooter";

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title ref={ref} className={cn("text-lg font-semibold text-foreground", className)} {...props} />
));
SheetTitle.displayName = SheetPrimitive.Title.displayName;

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
));
SheetDescription.displayName = SheetPrimitive.Description.displayName;

export {
  Sheet,
  SheetClose,
  SheetContent,
  SheetDescription,
  SheetFooter,
  SheetHeader,
  SheetOverlay,
  SheetPortal,
  SheetTitle,
  SheetTrigger,
};


============================================================
FILE PATH: .\src\components\ui\sidebar-utils.tsx
============================================================
import * as React from "react";

export const SIDEBAR_COOKIE_NAME = "sidebar:state";
export const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
export const SIDEBAR_WIDTH = "16rem";
export const SIDEBAR_WIDTH_MOBILE = "18rem";
export const SIDEBAR_WIDTH_ICON = "3rem";
export const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContext = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

export const SidebarContext = React.createContext<SidebarContext | null>(null);

export function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

============================================================
FILE PATH: .\src\components\ui\sidebar.tsx
============================================================
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { VariantProps, cva } from "class-variance-authority";
import { PanelLeft } from "lucide-react";

import { useIsMobile } from "@/hooks/use-mobile";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Separator } from "@/components/ui/separator";
import { Sheet, SheetContent } from "@/components/ui/sheet";
import { Skeleton } from "@/components/ui/skeleton";
import { Tooltip, TooltipContent, TooltipTrigger } from "@/components/ui/tooltip";
import {
  SIDEBAR_COOKIE_NAME,
  SIDEBAR_COOKIE_MAX_AGE,
  SIDEBAR_WIDTH,
  SIDEBAR_WIDTH_MOBILE,
  SIDEBAR_WIDTH_ICON,
  SIDEBAR_KEYBOARD_SHORTCUT,
  SidebarContext,
  useSidebar,
} from "./sidebar-utils";

const SidebarProvider = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    defaultOpen?: boolean;
    open?: boolean;
    onOpenChange?: (open: boolean) => void;
  }
>(({ defaultOpen = true, open: openProp, onOpenChange: setOpenProp, className, style, children, ...props }, ref) => {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<typeof SidebarContext extends React.Context<infer T> ? T : never>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <div
        style={
          {
            "--sidebar-width": SIDEBAR_WIDTH,
            "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
            ...style,
          } as React.CSSProperties
        }
        className={cn("group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar", className)}
        ref={ref}
        {...props}
      >
        {children}
      </div>
    </SidebarContext.Provider>
  );
});
SidebarProvider.displayName = "SidebarProvider";

const Sidebar = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    side?: "left" | "right";
    variant?: "sidebar" | "floating" | "inset";
    collapsible?: "offcanvas" | "icon" | "none";
  }
>(({ side = "left", variant = "sidebar", collapsible = "offcanvas", className, children, ...props }, ref) => {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        className={cn("flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground", className)}
        ref={ref}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-mobile="true"
          className="w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      ref={ref}
      className="group peer hidden text-sidebar-foreground md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        className={cn(
          "relative h-svh w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]"
            : "group-data-[collapsible=icon]:w-[--sidebar-width-icon]",
        )}
      />
      <div
        className={cn(
          "fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]"
            : "group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          className="flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow"
        >
          {children}
        </div>
      </div>
    </div>
  );
});
Sidebar.displayName = "Sidebar";

const SidebarTrigger = React.forwardRef<React.ElementRef<typeof Button>, React.ComponentProps<typeof Button>>(
  ({ className, onClick, ...props }, ref) => {
    const { toggleSidebar } = useSidebar();

    return (
      <Button
        ref={ref}
        data-sidebar="trigger"
        variant="ghost"
        size="icon"
        className={cn("h-7 w-7", className)}
        onClick={(event) => {
          onClick?.(event);
          toggleSidebar();
        }}
        {...props}
      >
        <PanelLeft />
        <span className="sr-only">Toggle Sidebar</span>
      </Button>
    );
  },
);
SidebarTrigger.displayName = "SidebarTrigger";

const SidebarRail = React.forwardRef<HTMLButtonElement, React.ComponentProps<"button">>(
  ({ className, ...props }, ref) => {
    const { toggleSidebar } = useSidebar();

    return (
      <button
        ref={ref}
        data-sidebar="rail"
        aria-label="Toggle Sidebar"
        tabIndex={-1}
        onClick={toggleSidebar}
        title="Toggle Sidebar"
        className={cn(
          "absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 hover:after:bg-sidebar-border sm:flex",
          "[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize",
          "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
          "group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar",
          "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
          "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
          className,
        )}
        {...props}
      />
    );
  },
);
SidebarRail.displayName = "SidebarRail";

const SidebarInset = React.forwardRef<HTMLDivElement, React.ComponentProps<"main">>(({ className, ...props }, ref) => {
  return (
    <main
      ref={ref}
      className={cn(
        "relative flex min-h-svh flex-1 flex-col bg-background",
        "peer-data-[variant=inset]:min-h-[calc(100svh-theme(spacing.4))] md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow",
        className,
      )}
      {...props}
    />
  );
});
SidebarInset.displayName = "SidebarInset";

const SidebarInput = React.forwardRef<React.ElementRef<typeof Input>, React.ComponentProps<typeof Input>>(
  ({ className, ...props }, ref) => {
    return (
      <Input
        ref={ref}
        data-sidebar="input"
        className={cn(
          "h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring",
          className,
        )}
        {...props}
      />
    );
  },
);
SidebarInput.displayName = "SidebarInput";

const SidebarHeader = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(({ className, ...props }, ref) => {
  return <div ref={ref} data-sidebar="header" className={cn("flex flex-col gap-2 p-2", className)} {...props} />;
});
SidebarHeader.displayName = "SidebarHeader";

const SidebarFooter = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(({ className, ...props }, ref) => {
  return <div ref={ref} data-sidebar="footer" className={cn("flex flex-col gap-2 p-2", className)} {...props} />;
});
SidebarFooter.displayName = "SidebarFooter";

const SidebarSeparator = React.forwardRef<React.ElementRef<typeof Separator>, React.ComponentProps<typeof Separator>>(
  ({ className, ...props }, ref) => {
    return (
      <Separator
        ref={ref}
        data-sidebar="separator"
        className={cn("mx-2 w-auto bg-sidebar-border", className)}
        {...props}
      />
    );
  },
);
SidebarSeparator.displayName = "SidebarSeparator";

const SidebarContent = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
});
SidebarContent.displayName = "SidebarContent";

const SidebarGroup = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(({ className, ...props }, ref) => {
  return (
    <div
      ref={ref}
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
});
SidebarGroup.displayName = "SidebarGroup";

const SidebarGroupLabel = React.forwardRef<HTMLDivElement, React.ComponentProps<"div"> & { asChild?: boolean }>(
  ({ className, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "div";

    return (
      <Comp
        ref={ref}
        data-sidebar="group-label"
        className={cn(
          "flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opa] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
          "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
          className,
        )}
        {...props}
      />
    );
  },
);
SidebarGroupLabel.displayName = "SidebarGroupLabel";

const SidebarGroupAction = React.forwardRef<HTMLButtonElement, React.ComponentProps<"button"> & { asChild?: boolean }>(
  ({ className, asChild = false, ...props }, ref) => {
    const Comp = asChild ? Slot : "button";

    return (
      <Comp
        ref={ref}
        data-sidebar="group-action"
        className={cn(
          "absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
          // Increases the hit area of the button on mobile.
          "after:absolute after:-inset-2 after:md:hidden",
          "group-data-[collapsible=icon]:hidden",
          className,
        )}
        {...props}
      />
    );
  },
);
SidebarGroupAction.displayName = "SidebarGroupAction";

const SidebarGroupContent = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(
  ({ className, ...props }, ref) => (
    <div ref={ref} data-sidebar="group-content" className={cn("w-full text-sm", className)} {...props} />
  ),
);
SidebarGroupContent.displayName = "SidebarGroupContent";

const SidebarMenu = React.forwardRef<HTMLUListElement, React.ComponentProps<"ul">>(({ className, ...props }, ref) => (
  <ul ref={ref} data-sidebar="menu" className={cn("flex w-full min-w-0 flex-col gap-1", className)} {...props} />
));
SidebarMenu.displayName = "SidebarMenu";

const SidebarMenuItem = React.forwardRef<HTMLLIElement, React.ComponentProps<"li">>(({ className, ...props }, ref) => (
  <li ref={ref} data-sidebar="menu-item" className={cn("group/menu-item relative", className)} {...props} />
));
SidebarMenuItem.displayName = "SidebarMenuItem";

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:!p-0",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

const SidebarMenuButton = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean;
    isActive?: boolean;
    tooltip?: string | React.ComponentProps<typeof TooltipContent>;
  } & VariantProps<typeof sidebarMenuButtonVariants>
>(({ asChild = false, isActive = false, variant = "default", size = "default", tooltip, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      ref={ref}
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent side="right" align="center" hidden={state !== "collapsed" || isMobile} {...tooltip} />
    </Tooltip>
  );
});
SidebarMenuButton.displayName = "SidebarMenuButton";

const SidebarMenuAction = React.forwardRef<
  HTMLButtonElement,
  React.ComponentProps<"button"> & {
    asChild?: boolean;
    showOnHover?: boolean;
  }
>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-action"
      className={cn(
        "absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform peer-hover/menu-button:text-sidebar-accent-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 after:md:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0",
        className,
      )}
      {...props}
    />
  );
});
SidebarMenuAction.displayName = "SidebarMenuAction";

const SidebarMenuBadge = React.forwardRef<HTMLDivElement, React.ComponentProps<"div">>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      data-sidebar="menu-badge"
      className={cn(
        "pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  ),
);
SidebarMenuBadge.displayName = "SidebarMenuBadge";

const SidebarMenuSkeleton = React.forwardRef<
  HTMLDivElement,
  React.ComponentProps<"div"> & {
    showIcon?: boolean;
  }
>(({ className, showIcon = false, ...props }, ref) => {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      ref={ref}
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && <Skeleton className="size-4 rounded-md" data-sidebar="menu-skeleton-icon" />}
      <Skeleton
        className="h-4 max-w-[--skeleton-width] flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
});
SidebarMenuSkeleton.displayName = "SidebarMenuSkeleton";

const SidebarMenuSub = React.forwardRef<HTMLUListElement, React.ComponentProps<"ul">>(
  ({ className, ...props }, ref) => (
    <ul
      ref={ref}
      data-sidebar="menu-sub"
      className={cn(
        "mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  ),
);
SidebarMenuSub.displayName = "SidebarMenuSub";

const SidebarMenuSubItem = React.forwardRef<HTMLLIElement, React.ComponentProps<"li">>(({ ...props }, ref) => (
  <li ref={ref} {...props} />
));
SidebarMenuSubItem.displayName = "SidebarMenuSubItem";

const SidebarMenuSubButton = React.forwardRef<
  HTMLAnchorElement,
  React.ComponentProps<"a"> & {
    asChild?: boolean;
    size?: "sm" | "md";
    isActive?: boolean;
  }
>(({ asChild = false, size = "md", isActive, className, ...props }, ref) => {
  const Comp = asChild ? Slot : "a";

  return (
    <Comp
      ref={ref}
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring aria-disabled:pointer-events-none aria-disabled:opacity-50 hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
});
SidebarMenuSubButton.displayName = "SidebarMenuSubButton";

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
};


============================================================
FILE PATH: .\src\components\ui\skeleton.tsx
============================================================
import { cn } from "@/lib/utils";

function Skeleton({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return <div className={cn("animate-pulse rounded-md bg-muted", className)} {...props} />;
}

export { Skeleton };


============================================================
FILE PATH: .\src\components\ui\slider.tsx
============================================================
import * as React from "react";
import * as SliderPrimitive from "@radix-ui/react-slider";

import { cn } from "@/lib/utils";

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn("relative flex w-full touch-none select-none items-center", className)}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-2 w-full grow overflow-hidden rounded-full bg-secondary">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
));
Slider.displayName = SliderPrimitive.Root.displayName;

export { Slider };


============================================================
FILE PATH: .\src\components\ui\sonner.tsx
============================================================
import { useTheme } from "next-themes";
import { Toaster as Sonner } from "sonner";

type ToasterProps = React.ComponentProps<typeof Sonner>;

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      toastOptions={{
        classNames: {
          toast:
            "group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",
          description: "group-[.toast]:text-muted-foreground",
          actionButton: "group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",
          cancelButton: "group-[.toast]:bg-muted group-[.toast]:text-muted-foreground",
        },
      }}
      {...props}
    />
  );
};

export { Toaster };


============================================================
FILE PATH: .\src\components\ui\switch.tsx
============================================================
import * as React from "react";
import * as SwitchPrimitives from "@radix-ui/react-switch";

import { cn } from "@/lib/utils";

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",
      className,
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0",
      )}
    />
  </SwitchPrimitives.Root>
));
Switch.displayName = SwitchPrimitives.Root.displayName;

export { Switch };


============================================================
FILE PATH: .\src\components\ui\table.tsx
============================================================
import * as React from "react";

import { cn } from "@/lib/utils";

const Table = React.forwardRef<HTMLTableElement, React.HTMLAttributes<HTMLTableElement>>(
  ({ className, ...props }, ref) => (
    <div className="relative w-full overflow-auto">
      <table ref={ref} className={cn("w-full caption-bottom text-sm", className)} {...props} />
    </div>
  ),
);
Table.displayName = "Table";

const TableHeader = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(
  ({ className, ...props }, ref) => <thead ref={ref} className={cn("[&_tr]:border-b", className)} {...props} />,
);
TableHeader.displayName = "TableHeader";

const TableBody = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(
  ({ className, ...props }, ref) => (
    <tbody ref={ref} className={cn("[&_tr:last-child]:border-0", className)} {...props} />
  ),
);
TableBody.displayName = "TableBody";

const TableFooter = React.forwardRef<HTMLTableSectionElement, React.HTMLAttributes<HTMLTableSectionElement>>(
  ({ className, ...props }, ref) => (
    <tfoot ref={ref} className={cn("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0", className)} {...props} />
  ),
);
TableFooter.displayName = "TableFooter";

const TableRow = React.forwardRef<HTMLTableRowElement, React.HTMLAttributes<HTMLTableRowElement>>(
  ({ className, ...props }, ref) => (
    <tr
      ref={ref}
      className={cn("border-b transition-colors data-[state=selected]:bg-muted hover:bg-muted/50", className)}
      {...props}
    />
  ),
);
TableRow.displayName = "TableRow";

const TableHead = React.forwardRef<HTMLTableCellElement, React.ThHTMLAttributes<HTMLTableCellElement>>(
  ({ className, ...props }, ref) => (
    <th
      ref={ref}
      className={cn(
        "h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",
        className,
      )}
      {...props}
    />
  ),
);
TableHead.displayName = "TableHead";

const TableCell = React.forwardRef<HTMLTableCellElement, React.TdHTMLAttributes<HTMLTableCellElement>>(
  ({ className, ...props }, ref) => (
    <td ref={ref} className={cn("p-4 align-middle [&:has([role=checkbox])]:pr-0", className)} {...props} />
  ),
);
TableCell.displayName = "TableCell";

const TableCaption = React.forwardRef<HTMLTableCaptionElement, React.HTMLAttributes<HTMLTableCaptionElement>>(
  ({ className, ...props }, ref) => (
    <caption ref={ref} className={cn("mt-4 text-sm text-muted-foreground", className)} {...props} />
  ),
);
TableCaption.displayName = "TableCaption";

export { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption };


============================================================
FILE PATH: .\src\components\ui\tabs.tsx
============================================================
import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs";

import { cn } from "@/lib/utils";

const Tabs = TabsPrimitive.Root;

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",
      className,
    )}
    {...props}
  />
));
TabsList.displayName = TabsPrimitive.List.displayName;

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
      className,
    )}
    {...props}
  />
));
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName;

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className,
    )}
    {...props}
  />
));
TabsContent.displayName = TabsPrimitive.Content.displayName;

export { Tabs, TabsList, TabsTrigger, TabsContent };


============================================================
FILE PATH: .\src\components\ui\textarea.tsx
============================================================
import * as React from "react";

import { cn } from "@/lib/utils";

const Textarea = React.forwardRef<HTMLTextAreaElement, React.TextareaHTMLAttributes<HTMLTextAreaElement>>(
  ({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      ref={ref}
      {...props}
    />
  );
});
Textarea.displayName = "Textarea";

export { Textarea };


============================================================
FILE PATH: .\src\components\ui\time-picker.tsx
============================================================
import * as React from "react";
import { Clock } from "lucide-react";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";

interface TimePickerProps {
  value?: string;
  onChange?: (time: string) => void;
  placeholder?: string;
  disabled?: boolean;
  className?: string;
}

type HourRange = "0-11" | "12-23";

const HOURS = [12, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11];
const MINUTES = Array.from({ length: 12 }, (_, i) => i * 5);

const padTime = (value: number) => value.toString().padStart(2, "0");

const to12Hour = (hour24: number) => {
  const normalized = hour24 % 12;
  return normalized === 0 ? 12 : normalized;
};

const to24Hour = (hour12: number, range: HourRange) => {
  if (range === "12-23") {
    return hour12 === 12 ? 12 : hour12 + 12;
  }
  return hour12 === 12 ? 0 : hour12;
};

const getClockPosition = (index: number, total: number, radius = 42) => {
  const angle = (index / total) * Math.PI * 2 - Math.PI / 2;
  return {
    left: `${50 + Math.cos(angle) * radius}%`,
    top: `${50 + Math.sin(angle) * radius}%`,
  };
};

const ClockFace = () => (
  <svg
    className="absolute inset-0 h-full w-full text-muted-foreground/40"
    viewBox="0 0 100 100"
    aria-hidden="true"
  >
    <circle cx="50" cy="50" r="48" fill="none" stroke="currentColor" strokeWidth="0.8" />
    {Array.from({ length: 12 }, (_, i) => {
      const angle = (i / 12) * Math.PI * 2 - Math.PI / 2;
      const x1 = 50 + Math.cos(angle) * 40;
      const y1 = 50 + Math.sin(angle) * 40;
      const x2 = 50 + Math.cos(angle) * 46;
      const y2 = 50 + Math.sin(angle) * 46;
      return (
        <line
          key={i}
          x1={x1}
          y1={y1}
          x2={x2}
          y2={y2}
          stroke="currentColor"
          strokeWidth="1.2"
        />
      );
    })}
    <circle cx="50" cy="50" r="1.6" fill="currentColor" />
  </svg>
);

export function TimePicker({
  value,
  onChange,
  placeholder = "Selecione um horario",
  disabled = false,
  className
}: TimePickerProps) {
  const [open, setOpen] = React.useState(false);
  const [mode, setMode] = React.useState<"hour" | "minute">("hour");
  const [hourRange, setHourRange] = React.useState<HourRange>("0-11");

  const [hourValue, minuteValue] = value?.split(":") ?? [];
  const parsedHour = hourValue ? Number.parseInt(hourValue, 10) : null;
  const parsedMinute = minuteValue ? Number.parseInt(minuteValue, 10) : null;

  const selectedHour12 = parsedHour !== null && !Number.isNaN(parsedHour) ? to12Hour(parsedHour) : null;
  const selectedMinute = parsedMinute !== null && !Number.isNaN(parsedMinute) ? parsedMinute : null;
  const safeMinute = parsedMinute !== null && !Number.isNaN(parsedMinute) ? parsedMinute : 0;

  const displayTime = parsedHour !== null && !Number.isNaN(parsedHour)
    ? `${padTime(parsedHour)}:${padTime(safeMinute)}`
    : "--:--";

  React.useEffect(() => {
    if (parsedHour !== null && !Number.isNaN(parsedHour)) {
      setHourRange(parsedHour >= 12 ? "12-23" : "0-11");
    }
  }, [parsedHour]);

  React.useEffect(() => {
    if (!open) {
      setMode("hour");
    }
  }, [open]);

  const handleRangeChange = (nextRange: HourRange) => {
    setHourRange(nextRange);
    if (parsedHour !== null && !Number.isNaN(parsedHour)) {
      const hour12 = to12Hour(parsedHour);
      const nextHour = to24Hour(hour12, nextRange);
      const minute = safeMinute;
      onChange?.(`${padTime(nextHour)}:${padTime(minute)}`);
    }
  };

  const handleHourSelect = (hour12: number) => {
    const nextHour = to24Hour(hour12, hourRange);
    const minute = selectedMinute ?? 0;
    onChange?.(`${padTime(nextHour)}:${padTime(minute)}`);
    // setMode("minute"); // Removido para evitar confusão do usuário
  };

  const handleMinuteSelect = (minute: number) => {
    const nextHour = parsedHour !== null && !Number.isNaN(parsedHour)
      ? parsedHour
      : to24Hour(selectedHour12 ?? 12, hourRange);
    onChange?.(`${padTime(nextHour)}:${padTime(minute)}`);
    setOpen(false);
  };

  const dialItems = mode === "hour" ? HOURS : MINUTES;

  return (
    <Popover open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <Button
          variant="outline"
          className={cn(
            "w-full justify-start text-left font-normal",
            !value && "text-muted-foreground",
            className
          )}
          disabled={disabled}
        >
          <Clock className="mr-2 h-4 w-4" />
          {value || <span>{placeholder}</span>}
        </Button>
      </PopoverTrigger>
      <PopoverContent className="w-[340px] p-4" align="start">
        <div className="flex items-center justify-between gap-3">
          <div>
            <div className="text-xs uppercase tracking-widest text-muted-foreground">Horario</div>
            <div className="text-lg font-semibold tabular-nums">{displayTime}</div>
          </div>
          <div className="flex items-center rounded-full border border-border/60 bg-background/70 p-1 shadow-sm">
            <Button
              type="button"
              size="sm"
              variant={mode === "hour" ? "default" : "ghost"}
              onClick={() => setMode("hour")}
              className="rounded-full px-3 shadow-none hover:shadow-none hover:translate-y-0"
            >
              Horas
            </Button>
            <Button
              type="button"
              size="sm"
              variant={mode === "minute" ? "default" : "ghost"}
              onClick={() => setMode("minute")}
              className="rounded-full px-3 shadow-none hover:shadow-none hover:translate-y-0"
            >
              Minutos
            </Button>
          </div>
        </div>

        <div className="mt-4 flex justify-center">
          <div className="relative h-64 w-64 rounded-full bg-gradient-to-br from-background to-muted/30 shadow-inner ring-1 ring-border/60">
            <ClockFace />
            {dialItems.map((item, index) => {
              const label = mode === "hour" ? String(to24Hour(item, hourRange)) : padTime(item);
              const isSelected = mode === "hour"
                ? selectedHour12 === item
                : selectedMinute === item;
              const position = getClockPosition(index, dialItems.length);
              return (
                <button
                  key={label}
                  type="button"
                  onClick={() => (mode === "hour" ? handleHourSelect(item) : handleMinuteSelect(item))}
                  className={cn(
                    "absolute flex h-9 w-9 -translate-x-1/2 -translate-y-1/2 items-center justify-center rounded-full text-sm font-semibold transition-all",
                    "bg-background/90 text-foreground shadow-sm ring-1 ring-border/40 hover:bg-primary/10 hover:text-primary",
                    isSelected && "bg-primary text-primary-foreground ring-primary/60 shadow-md"
                  )}
                  style={position}
                >
                  {label}
                </button>
              );
            })}
            <div className="absolute left-1/2 top-1/2 flex -translate-x-1/2 -translate-y-1/2 flex-col items-center rounded-full bg-background/80 px-4 py-2 text-center shadow-sm ring-1 ring-border/50">
              <div className="text-[10px] uppercase tracking-[0.2em] text-muted-foreground">
                {mode === "hour" ? "Hora" : "Min"}
              </div>
              <div className="text-base font-semibold tabular-nums">{displayTime}</div>
            </div>
          </div>
        </div>

        <div className="mt-4 flex items-center justify-center gap-2">
          <Button
            type="button"
            size="sm"
            variant={hourRange === "0-11" ? "default" : "outline"}
            onClick={() => handleRangeChange("0-11")}
            className="min-w-[80px] shadow-none hover:shadow-none hover:translate-y-0"
          >
            0-11
          </Button>
          <Button
            type="button"
            size="sm"
            variant={hourRange === "12-23" ? "default" : "outline"}
            onClick={() => handleRangeChange("12-23")}
            className="min-w-[80px] shadow-none hover:shadow-none hover:translate-y-0"
          >
            12-23
          </Button>
        </div>
      </PopoverContent>
    </Popover>
  );
}


============================================================
FILE PATH: .\src\components\ui\toast.tsx
============================================================
import * as React from "react";
import * as ToastPrimitives from "@radix-ui/react-toast";
import { cva, type VariantProps } from "class-variance-authority";
import { X } from "lucide-react";

import { cn } from "@/lib/utils";

const ToastProvider = ToastPrimitives.Provider;

const ToastViewport = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Viewport>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Viewport
    ref={ref}
    className={cn(
      "fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",
      className,
    )}
    {...props}
  />
));
ToastViewport.displayName = ToastPrimitives.Viewport.displayName;

const toastVariants = cva(
  "group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",
  {
    variants: {
      variant: {
        default: "border bg-background text-foreground",
        destructive: "destructive group border-destructive bg-destructive text-destructive-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

const Toast = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> & VariantProps<typeof toastVariants>
>(({ className, variant, ...props }, ref) => {
  return <ToastPrimitives.Root ref={ref} className={cn(toastVariants({ variant }), className)} {...props} />;
});
Toast.displayName = ToastPrimitives.Root.displayName;

const ToastAction = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Action>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Action
    ref={ref}
    className={cn(
      "inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors group-[.destructive]:border-muted/40 hover:bg-secondary group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 group-[.destructive]:focus:ring-destructive disabled:pointer-events-none disabled:opacity-50",
      className,
    )}
    {...props}
  />
));
ToastAction.displayName = ToastPrimitives.Action.displayName;

const ToastClose = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Close>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Close
    ref={ref}
    className={cn(
      "absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity group-hover:opacity-100 group-[.destructive]:text-red-300 hover:text-foreground group-[.destructive]:hover:text-red-50 focus:opacity-100 focus:outline-none focus:ring-2 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",
      className,
    )}
    toast-close=""
    {...props}
  >
    <X className="h-4 w-4" />
  </ToastPrimitives.Close>
));
ToastClose.displayName = ToastPrimitives.Close.displayName;

const ToastTitle = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Title>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Title ref={ref} className={cn("text-sm font-semibold", className)} {...props} />
));
ToastTitle.displayName = ToastPrimitives.Title.displayName;

const ToastDescription = React.forwardRef<
  React.ElementRef<typeof ToastPrimitives.Description>,
  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>
>(({ className, ...props }, ref) => (
  <ToastPrimitives.Description ref={ref} className={cn("text-sm opacity-90", className)} {...props} />
));
ToastDescription.displayName = ToastPrimitives.Description.displayName;

type ToastProps = React.ComponentPropsWithoutRef<typeof Toast>;

type ToastActionElement = React.ReactElement<typeof ToastAction>;

export {
  type ToastProps,
  type ToastActionElement,
  ToastProvider,
  ToastViewport,
  Toast,
  ToastTitle,
  ToastDescription,
  ToastClose,
  ToastAction,
};


============================================================
FILE PATH: .\src\components\ui\toaster.tsx
============================================================
import { useToast } from "@/hooks/use-toast";
import { Toast, ToastClose, ToastDescription, ToastProvider, ToastTitle, ToastViewport } from "@/components/ui/toast";

export function Toaster() {
  const { toasts } = useToast();

  return (
    <ToastProvider>
      {toasts.map(function ({ id, title, description, action, ...props }) {
        return (
          <Toast key={id} {...props}>
            <div className="grid gap-1">
              {title && <ToastTitle>{title}</ToastTitle>}
              {description && <ToastDescription>{description}</ToastDescription>}
            </div>
            {action}
            <ToastClose />
          </Toast>
        );
      })}
      <ToastViewport />
    </ToastProvider>
  );
}


============================================================
FILE PATH: .\src\components\ui\toggle-group.tsx
============================================================
import * as React from "react";
import * as ToggleGroupPrimitive from "@radix-ui/react-toggle-group";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { toggleVariants } from "@/components/ui/toggle-variants";

const ToggleGroupContext = React.createContext<VariantProps<typeof toggleVariants>>({
  size: "default",
  variant: "default",
});

const ToggleGroup = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> & VariantProps<typeof toggleVariants>
>(({ className, variant, size, children, ...props }, ref) => (
  <ToggleGroupPrimitive.Root ref={ref} className={cn("flex items-center justify-center gap-1", className)} {...props}>
    <ToggleGroupContext.Provider value={{ variant, size }}>{children}</ToggleGroupContext.Provider>
  </ToggleGroupPrimitive.Root>
));

ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName;

const ToggleGroupItem = React.forwardRef<
  React.ElementRef<typeof ToggleGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> & VariantProps<typeof toggleVariants>
>(({ className, children, variant, size, ...props }, ref) => {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      ref={ref}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
});

ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName;

export { ToggleGroup, ToggleGroupItem };


============================================================
FILE PATH: .\src\components\ui\toggle-variants.ts
============================================================
import { cva } from "class-variance-authority";

export const toggleVariants = cva(
  "inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border border-input bg-transparent hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-10 px-3",
        sm: "h-9 px-2.5",
        lg: "h-11 px-5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

============================================================
FILE PATH: .\src\components\ui\toggle.tsx
============================================================
import * as React from "react";
import * as TogglePrimitive from "@radix-ui/react-toggle";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { toggleVariants } from "@/components/ui/toggle-variants";

const Toggle = React.forwardRef<
  React.ElementRef<typeof TogglePrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>
>(({ className, variant, size, ...props }, ref) => (
  <TogglePrimitive.Root ref={ref} className={cn(toggleVariants({ variant, size, className }))} {...props} />
));

Toggle.displayName = TogglePrimitive.Root.displayName;

export { Toggle, toggleVariants };


============================================================
FILE PATH: .\src\components\ui\tooltip.tsx
============================================================
import * as React from "react";
import * as TooltipPrimitive from "@radix-ui/react-tooltip";

import { cn } from "@/lib/utils";

const TooltipProvider = TooltipPrimitive.Provider;

const Tooltip = TooltipPrimitive.Root;

const TooltipTrigger = TooltipPrimitive.Trigger;

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
      className,
    )}
    {...props}
  />
));
TooltipContent.displayName = TooltipPrimitive.Content.displayName;

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };


============================================================
FILE PATH: .\src\components\ui\use-toast.ts
============================================================
import { useToast, toast } from "@/hooks/use-toast";

export { useToast, toast };


============================================================
FILE PATH: .\src\core\calc\index.ts
============================================================
import type { Item, Participant, DistributionRow } from '@/types/domain';

// Heurística simples por tipo de item
export const estimateQuantityPerPerson = (item: string): number => {
  const lower = item.toLowerCase();
  if (lower.includes('carne')) return 0.4; // kg por pessoa
  if (lower.includes('bebida')) return 1; // litros por pessoa
  return 1; // unidade por pessoa como default
};

// Divisão de custos simples: rateio igual entre participantes não recusados
export function computeCostSplit(items: Item[], participants: Participant[]): DistributionRow[] {
  const activeParticipants = participants.filter((p) => p.status_convite !== 'recusado');
  const baseParticipants = activeParticipants.length > 0 ? activeParticipants : participants;

  const rows: DistributionRow[] = [];
  for (const item of items) {
    const perCost = Number(item.valor_estimado || 0) / Math.max(1, baseParticipants.length);
    const perQty = Number(item.quantidade || 0) / Math.max(1, baseParticipants.length);
    for (const p of baseParticipants) {
      rows.push({
        id: crypto.randomUUID(),
        item_id: item.id,
        participante_id: p.id,
        quantidade_atribuida: Number.isFinite(perQty) ? perQty : 0,
        valor_rateado: Number.isFinite(perCost) ? perCost : 0,
        observacoes: null,
      });
    }
  }
  return rows;
}

============================================================
FILE PATH: .\src\core\nlp\date-parser.ts
============================================================
/**
 * Converte diferentes formatos de data para ISO (YYYY-MM-DD)
 */
export function parseToIsoDate(dateStr: string): string | null {
  if (!dateStr) return null;

  const normalized = dateStr.trim().toLowerCase();

  // Formato ISO já (YYYY-MM-DD)
  const isoMatch = normalized.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if (isoMatch) return dateStr;

  // Formato brasileiro: dd/mm/yyyy ou dd/mm/yy
  const brMatch = normalized.match(/^(\d{1,2})\/(\d{1,2})(?:\/(\d{2,4}))?$/);
  if (brMatch) {
    let day = parseInt(brMatch[1], 10);
    let month = parseInt(brMatch[2], 10);
    let year = brMatch[3];

    if (!year) {
      year = new Date().getFullYear().toString();
    } else if (year.length === 2) {
      year = '20' + year;
    }

    // Criar usando componentes locais para evitar shift de timezone
    const localDate = new Date(parseInt(year), month - 1, day);
    const isoYear = localDate.getFullYear();
    const isoMonth = String(localDate.getMonth() + 1).padStart(2, '0');
    const isoDay = String(localDate.getDate()).padStart(2, '0');

    return `${isoYear}-${isoMonth}-${isoDay}`;
  }

  const monthsMap: Record<string, string> = {
    'janeiro': '01', 'fevereiro': '02', 'março': '03', 'abril': '04', 'maio': '05', 'junho': '06',
    'julho': '07', 'agosto': '08', 'setembro': '09', 'outubro': '10', 'novembro': '11', 'dezembro': '12'
  };

  const textMatch = normalized.match(/(?:dia\s+)?(\d{1,2})\s+de\s+(\w+)(?:\s+de\s+(\d{4}))?/);
  if (textMatch) {
    const day = textMatch[1].padStart(2, '0');
    const month = monthsMap[textMatch[2]];
    const year = textMatch[3] || new Date().getFullYear().toString();
    if (month) return `${year}-${month}-${day}`;
  }

  return null;
}

export function isValidFutureDate(isoDate: string): boolean {
  try {
    // Forçar meio-dia (T12:00:00) para evitar que o fuso horário mude o dia no parse
    const date = new Date(isoDate + 'T12:00:00');
    if (isNaN(date.getTime())) return false;

    const today = new Date();
    today.setHours(0, 0, 0, 0); // Comparação puramente de calendário
    return date >= today;
  } catch {
    return false;
  }
}

============================================================
FILE PATH: .\src\core\nlp\event-type-parser.ts
============================================================
const eventTypes: Record<string, string> = {
  churrasco: 'churrasco',
  pizza: 'pizza',
  feijoada: 'feijoada',
  aniversario: 'aniversário',
  jantar: 'jantar',
};

export function parseEventType(text: string): string | null {
  const t = text.toLowerCase().trim();

  for (const keyword in eventTypes) {
    if (t.includes(keyword)) {
      return eventTypes[keyword];
    }
  }

  return null;
}

============================================================
FILE PATH: .\src\core\nlp\index.ts
============================================================
// Placeholder para módulo NLP do UNE.Ai
// Aqui podem entrar tokenização, intents, entidades, etc.

export const detectIntent = (text: string): string => {
  const t = text.toLowerCase();
  if (t.includes('churrasco')) return 'create_bbq_event';
  if (t.includes('evento')) return 'create_event';
  return 'unknown';
};

============================================================
FILE PATH: .\src\core\nlp\normalize.ts
============================================================
export const normalize = (s: string) =>
  s.normalize("NFD").replace(/\p{Diacritic}/gu, "").toLowerCase();

============================================================
FILE PATH: .\src\core\nlp\number-parser.ts
============================================================
const numberWords: Record<string, number> = {
  um: 1,
  uma: 1,
  dois: 2,
  duas: 2,
  três: 3,
  quatro: 4,
  cinco: 5,
  seis: 6,
  sete: 7,
  oito: 8,
  nove: 9,
  dez: 10,
  onze: 11,
  doze: 12,
  treze: 13,
  catorze: 14,
  quinze: 15,
  dezesseis: 16,
  dezessete: 17,
  dezoito: 18,
  dezenove: 19,
  vinte: 20,
  trinta: 30,
  quarenta: 40,
  cinquenta: 50,
  sessenta: 60,
  setenta: 70,
  oitenta: 80,
  noventa: 90,
  cem: 100,
};

export function parseNumber(text: string): number | null {
  const t = text.toLowerCase().trim();

  // 1. Tenta encontrar um número por extenso
  const words = t.split(/\s+/);
  for (const word of words) {
    if (numberWords[word]) {
      return numberWords[word];
    }
  }

  // 2. Tenta encontrar um número em formato de texto (ex: "10 pessoas")
  const match = t.match(/\b(\d+)\b/);
  if (match) {
    return parseInt(match[1], 10);
  }

  return null;
}

============================================================
FILE PATH: .\src\core\nlp\ptNumbers.ts
============================================================
import { normalize } from "./normalize" ;

const UNITS: Record<string, number > = {
  "zero":0,"um":1,"uma":1,"dois":2,"duas":2,"tres":3,"quatro":4,"cinco":5 ,
  "seis":6,"sete":7,"oito":8,"nove":9,"dez":10,"onze":11,"doze":12,"treze":13 ,
  "quatorze":14,"catorze":14,"quinze":15,"dezesseis":16,"dezessete":17,"dezoito":18,"dezenove":19 
};
const TENS: Record<string, number > = {
  "vinte":20,"trinta":30,"quarenta":40,"cinquenta":50 
};

export function parsePeopleCount(text: string): number | undefined  {
  const t = normalize (text);

  // 1) dígitos soltos (ex.: "10", "10p") 
  const m = t.match(/\b(\d{1,3})\b/ ); 
  if (m) return Math.max(1, parseInt(m[1], 10 )); 

  // 2) por extenso até 59 (ex.: "vinte e tres pessoas", "dez") 
  const tokens = t.split(/\s+/ ); 
  let total = 0, acc = 0 ; 
  for (let i=0;i<tokens.length ;i++){
    const  w = tokens[i]; 
    if (w in UNITS) acc += UNITS [w]; 
    else if (w in TENS) acc += TENS [w]; 
    else if (w === "e" || w.startsWith("pesso")) continue ; 
    else if (acc>0) { total = acc; acc = 0 ; } 
  } 
  total = total || acc; 
  return total > 0 ? total : undefined ; 
}

============================================================
FILE PATH: .\src\core\orchestrator\analyzeMessage.ts
============================================================
// src/core/orchestrator/analyzeMessage.ts
import { getLlmSuggestions } from "@/api/llm/chat";
import { LlmMessage } from "@/types/llm";
import { z } from "zod";
import { parseToIsoDate } from "@/core/nlp/date-parser";

export interface MessageAnalysis {
  intencao:
  | "criar_evento"
  | "definir_menu"
  | "confirmar_evento"
  | "mostrar_itens"
  | "editar_evento"
  | "adicionar_participantes"
  | "encerrar_conversa"
  | "reiniciar_conversa"
  | "out_of_domain"
  | "desconhecida";
  categoria_evento?: string | null;
  subtipo_evento?: string | null;
  finalidade_evento?: string | null;
  menu?: string | null;
  qtd_pessoas?: number | null;
  data_evento?: string | null;
  hora_evento?: string | null;
  inclui_bebidas?: boolean | null;
  inclui_entradas?: boolean | null;
  nivel_confianca: number;
}

// 🔹 Validação leve com Zod para garantir formato coerente
const MessageAnalysisSchema = z.object({
  intencao: z.string(),
  categoria_evento: z.string().nullable().optional(),
  subtipo_evento: z.string().nullable().optional(),
  finalidade_evento: z.string().nullable().optional(),
  menu: z.string().nullable().optional(),
  qtd_pessoas: z.number().nullable().optional(),
  data_evento: z.string().nullable().optional(),
  hora_evento: z.string().nullable().optional(),
  inclui_bebidas: z.boolean().nullable().optional(),
  inclui_entradas: z.boolean().nullable().optional(),
  nivel_confianca: z.number().min(0).max(1).default(0.5)
});

const normalize = (s?: string | null) => (s ? s.trim().toLowerCase() : null);

export async function analyzeMessage(
  userText: string,
  context?: {
    tipo_evento?: string;
    qtd_pessoas?: number;
    data_evento?: string;
    menu?: string;
    eventoStatus?: string;
  }
): Promise<MessageAnalysis> {
  const systemPrompt = `
Você é um analisador semântico especializado em extrair informações de eventos sociais.

🎯 TAREFA:
Analise a mensagem do usuário e extraia TODAS as informações relevantes sobre o evento, sempre retornando JSON 100% válido.

📚 ESTRUTURA HIERÁRQUICA DE EVENTOS:
- categoria_evento: forma social (almoço, jantar, lanche, piquenique, café da manhã, brunch)
- subtipo_evento: estilo culinário (churrasco, feijoada, pizza, fondue, lasanha, sushi)
- finalidade_evento: motivo emocional (aniversário, encontro de amigos, confraternização, celebração)
- menu: prato principal específico (lasanha, carnes, massas, frutos do mar)

💬 INTENÇÕES POSSÍVEIS:
- criar_evento
- definir_menu
- confirmar_evento
- mostrar_itens
- editar_evento
- adicionar_participantes
- encerrar_conversa
- reiniciar_conversa
- out_of_domain
- desconhecida

🧩 REGRAS DE EXTRAÇÃO:
1. "churrasco" é subtipo_evento; categoria_evento deve ser inferida (geralmente "almoço").
2. "jantar" é categoria_evento, não subtipo.
3. Se mencionar apenas prato (ex: "lasanha"), classifique como menu.
4. Datas aceitas: dd/mm/yyyy, dd/mm, "dia X de mês", ou formato ISO.
5. Horários: formato 24h, "19h", "7 da noite".
6. Quantidade de pessoas: números seguidos de palavras como "pessoas" ou "convidados".
7. Frases como "recomeçar", "resetar", "começar de novo", "limpar tudo", "apagar conversa", "zerar tudo", "novo evento", "start over", "reset" devem ser classificadas como "reiniciar_conversa".

🧠 CONTEXTO ATUAL DO EVENTO:
${context?.tipo_evento ? `Tipo: ${context.tipo_evento}` : "Nenhum evento em andamento"}
${context?.qtd_pessoas ? `Pessoas: ${context.qtd_pessoas}` : ""}
${context?.data_evento ? `Data: ${context.data_evento}` : ""}
${context?.menu ? `Menu: ${context.menu}` : ""}
${context?.eventoStatus ? `Status: ${context.eventoStatus}` : ""}

⚙️ FORMATO DE SAÍDA:
Retorne **apenas JSON puro** (sem markdown, sem explicações). 
O JSON deve seguir EXATAMENTE o formato abaixo:

{
  "intencao": "criar_evento",
  "categoria_evento": "almoço",
  "subtipo_evento": "churrasco",
  "finalidade_evento": null,
  "menu": null,
  "qtd_pessoas": 10,
  "data_evento": "2025-12-25",
  "hora_evento": "12:00",
  "inclui_bebidas": true,
  "inclui_entradas": false,
  "nivel_confianca": 0.92
}

Se algum dado não for encontrado, use null.
`;

  try {
    const messages: LlmMessage[] = [
      { role: "system", content: systemPrompt },
      { role: "user", content: userText }
    ];

    const result = await getLlmSuggestions(systemPrompt, messages, 0.3);

    if (result?.content) {
      // Extrair trecho JSON de forma segura
      const jsonStart = result.content.indexOf("{");
      const jsonEnd = result.content.lastIndexOf("}");
      if (jsonStart !== -1 && jsonEnd !== -1) {
        const jsonString = result.content.slice(jsonStart, jsonEnd + 1);
        const parsed = JSON.parse(jsonString);

        // Validação e normalização
        const safe = MessageAnalysisSchema.safeParse(parsed);
        if (!safe.success) throw new Error("Formato inválido do LLM");

        const data = safe.data;

        // 🔹 Normalizar data para ISO
        const normalizedDate = data.data_evento ? parseToIsoDate(data.data_evento) : null;

        if (normalizedDate && data.data_evento) {
          // console.log('[analyzeMessage] Data detectada e normalizada:', {
          //   original: data.data_evento,
          //   normalized: normalizedDate
          // });
        }

        return {
          intencao: (data.intencao as MessageAnalysis["intencao"]) || "desconhecida",
          categoria_evento: normalize(data.categoria_evento),
          subtipo_evento: normalize(data.subtipo_evento),
          finalidade_evento: normalize(data.finalidade_evento),
          menu: normalize(data.menu),
          qtd_pessoas: data.qtd_pessoas ?? null,
          data_evento: normalizedDate,
          hora_evento: data.hora_evento ?? null,
          inclui_bebidas: data.inclui_bebidas ?? null,
          inclui_entradas: data.inclui_entradas ?? null,
          nivel_confianca: data.nivel_confianca ?? 0.5
        };
      }
    }
  } catch (error) {
    // console.warn("[analyzeMessage] LLM falhou, usando fallback heurístico:", error);
  }

  // 🔹 Fallback heurístico robusto
  return fallbackAnalysis(userText, context);
}

// ========================================================
// 🧩 FALLBACK HEURÍSTICO (regex + palavras-chave)
// ========================================================
function fallbackAnalysis(text: string, context?: any): MessageAnalysis {
  const lower = text.toLowerCase().trim();

  let intencao: MessageAnalysis["intencao"] = "desconhecida";

  if (/\b(sim|ok|confirma|confirmar lista|confirmar itens|pode confirmar|beleza|perfeito|pode seguir|isso|bora|quero|tá ótimo|ta otimo|está ótimo|esta otimo|lista ok|ótimo|otimo|perfeito assim)\b/i.test(lower))
    intencao = "confirmar_evento";
  else if (/\b(itens|lista|mostrar|mostra|mostre)\b/i.test(lower))
    intencao = "mostrar_itens";
  else if (/\b(editar|mudar|alterar|modificar|ajustar)\b/i.test(lower))
    intencao = "editar_evento";
  else if (/\b(participante|pessoas|convidado|dividir)\b/i.test(lower))
    intencao = "adicionar_participantes";
  else if (/\b(tchau|até|obrigado|valeu|flw)\b/i.test(lower))
    intencao = "encerrar_conversa";
  else if (/\b(recomeçar|resetar|reiniciar|começar de novo|limpar tudo|apagar conversa|zerar tudo|novo evento|start over|reset)\b/i.test(lower))
    intencao = "reiniciar_conversa";
  else if (/\b(churrasco|jantar|almoço|almoco|piquenique|festa|pizza|feijoada)\b/i.test(lower))
    intencao = "criar_evento";
  else if (/\b(lasanha|massa|carne|frango|peixe|sushi)\b/i.test(lower))
    intencao = "definir_menu";

  const categoriaMatch = lower.match(
    /\b(jantar|almoço|almoco|lanche|piquenique|café da manhã|cafe da manha|brunch)\b/i
  );
  const subtipoMatch = lower.match(/\b(churrasco|feijoada|pizza|fondue|lasanha|sushi)\b/i);
  const menuMatch = lower.match(
    /\b(lasanha|massa|massas|carne|carnes|frango|peixe|sushi|frutos do mar)\b/i
  );
  const qtdMatch = text.match(/\b(\d+)\s*(pessoa|pessoas|convidado|convidados)\b/i);
  const dateMatch = text.match(/\b(\d{1,2}\/\d{1,2}(?:\/\d{2,4})?|\d{4}-\d{2}-\d{2})\b/i);
  const horaMatch = text.match(
    /\b(\d{1,2})\s*(h|horas|da\s+noite|da\s+manhã|da\s+tarde)\b/i
  );

  const inclui_bebidas = /\b(cerveja|refrigerante|vinho|bebida)\b/i.test(lower);
  const inclui_entradas = /\b(salgadinho|petisco|entrada|aperitivo)\b/i.test(lower);

  // 🔹 Normalizar data extraída para ISO
  const extractedDate = dateMatch ? dateMatch[1] : null;
  const normalizedDate = extractedDate ? parseToIsoDate(extractedDate) : null;

  if (normalizedDate && extractedDate) {
    // console.log('[fallbackAnalysis] Data detectada e normalizada:', {
    //   original: extractedDate,
    //   normalized: normalizedDate
    // });
  }

  return {
    intencao,
    categoria_evento: categoriaMatch ? categoriaMatch[1].toLowerCase() : null,
    subtipo_evento: subtipoMatch ? subtipoMatch[1].toLowerCase() : null,
    finalidade_evento: null,
    menu: menuMatch ? menuMatch[1].toLowerCase() : null,
    qtd_pessoas: qtdMatch ? parseInt(qtdMatch[1], 10) : null,
    data_evento: normalizedDate,
    hora_evento: horaMatch ? horaMatch[1] : null,
    inclui_bebidas,
    inclui_entradas,
    nivel_confianca: 0.6
  };
}


============================================================
FILE PATH: .\src\core\orchestrator\chatTemplates.ts
============================================================
// Templates de resposta natural e humanizada

type TemplateContext = {
  categoria_evento?: string;
  subtipo_evento?: string;
  qtd_pessoas?: number;
  menu?: string;
  data_evento?: string;
  hora_evento?: string;
  [key: string]: any;
};

const templates = {
  // Saudações iniciais
  greeting: [
    "Olá! Sou o UNE.AI e vou ajudar a organizar seu evento. Me conta: que tipo de encontro você está planejando e quantas pessoas vão?",
    "Oi! Vou te ajudar com seu evento. Qual o tipo de reunião e quantas pessoas participam?",
    "E aí! Vamos planejar seu evento juntos. Me fala: é um jantar, churrasco, festa? E quantas pessoas?",
  ],

  // Perguntas sobre tipo de evento
  ask_tipo_evento: [
    "Que tipo de evento você quer organizar?",
    "Me conta: que tipo de evento vai ser?",
    "Qual vai ser o estilo do evento?",
  ],

  // Perguntas sobre quantidade
  ask_qtd: [
    "Ótimo! {{categoria_evento}} é uma boa escolha. Quantas pessoas vão?",
    "Combinado! E quantas pessoas participam desse {{categoria_evento}}?",
    "Perfeito! Quantos amigos vão estar no {{categoria_evento}}?",
  ],

  // Perguntas sobre categoria quando só temos subtipo
  ask_categoria: [
    "Show! {{subtipo_evento}} é ótimo. Vai ser no almoço, jantar ou lanche?",
    "Perfeito! {{subtipo_evento}} combina. Qual o período: almoço, jantar ou lanche?",
    "Legal! {{subtipo_evento}} é uma boa pedida. Me diz: almoço, jantar ou lanche?",
  ],

  // Perguntas sobre menu
  ask_menu: [
    "Show! E o que vai ter de comida? Me conta o cardápio.",
    "Beleza! Qual vai ser o menu? Pode falar o que você tá pensando.",
    "Vamos lá! O que vocês vão comer? Me diz o cardápio.",
  ],

  // Perguntas sobre data
  ask_data: [
    "Ótimo! {{categoria_evento}} para {{qtd_pessoas}} pessoas. Qual vai ser a data?",
    "Show! E quando vai ser? Me passa a data.",
    "Perfeito! Qual a data que você tá pensando?",
  ],

  // Confirmação de evento completo
  confirm_event: [
    "Beleza! {{categoria_evento}} para {{qtd_pessoas}} pessoas. Vou montar a lista de itens, tá?",
    "Ótimo! Um {{categoria_evento}} para {{qtd_pessoas}} pessoas. Vamos gerar os preparativos?",
    "Show! Tenho tudo aqui. Posso sugerir a lista de itens agora?",
  ],

  // Menu confirmado
  menu_confirmed: [
    "Boa escolha! {{menu}} vai ficar ótimo. Qual a data do evento?",
    "Perfeito! {{menu}} combina muito. Me passa a data agora?",
    "Legal! {{menu}} é uma boa. Quando vai ser?",
  ],

  // Itens gerados
  items_generated: [
    "Pronto! 🎉 Olha só a lista completa pro {{categoria_evento}} de {{qtd_pessoas}} pessoas. O que achou?",
    "Feito! ✨ Montei tudo pro {{categoria_evento}} com {{qtd_pessoas}} pessoas. Dá uma conferida!",
    "Show! 🎊 Aqui está sua lista pro {{categoria_evento}} de {{qtd_pessoas}} pessoas. Tá bom assim?",
  ],

  // Itens confirmados
  items_confirmed: [
    "Ótimo! Lista aprovada. Quer adicionar os participantes agora?",
    "Perfeito! ✅ Vamos dividir entre os participantes?",
    "Show! Itens OK. Bora adicionar a galera?",
  ],

  // Evento finalizado
  event_finalized: [
    "Pronto! 🎊 Evento confirmado. Agora é só aproveitar!",
    "Feito! ✅ Tudo certo pro seu evento. Pode comemorar!",
    "Show! 🎉 Evento criado com sucesso. Bom demais!",
  ],

  // Erros - Desvio de contexto
  erro_desvio_contexto: [
    "Haha, adorei! Mas vamos focar no evento? Me conta o que você quer organizar.",
    "Legal! Mas quero saber mais sobre o seu evento. O que vai ser?",
    "Boa! Mas bora planejar o evento? Me fala mais sobre ele.",
  ],

  // Erros - Ambiguidade
  erro_ambiguidade: [
    "Entendi, mas fiquei na dúvida. É almoço, jantar ou outro tipo?",
    "Hmm, não tenho certeza. Pode me dar mais detalhes?",
    "Quase lá! Me explica melhor o que você tem em mente?",
  ],

  // Erros - Dado inválido
  erro_dado_invalido: [
    "Hmm, esse dado parece estranho. Pode revisar?",
    "Ops! Esse número não parece certo. Vamos tentar de novo?",
    "Acho que algo não bateu. Pode verificar?",
  ],

  // Erros - Ruído textual
  erro_ruido: [
    "Haha, adorei! Agora, bora planejar o evento?",
    "Legal! E aí, qual evento você quer criar?",
    "Muito bom! Mas me conta: o que vamos organizar?",
  ],

  // Erros - Fora de escopo
  erro_fora_escopo: [
    "Opa, não manjo muito disso. Meu negócio é planejar eventos. Vamos voltar pro assunto?",
    "Hmm, essa fugiu um pouco. Sou especialista em eventos. Bora focar nisso?",
    "Essa não é minha praia. Mas posso te ajudar com o evento. Vamos lá?",
  ],
};

// Função auxiliar para substituir placeholders
function fillTemplate(template: string, context: TemplateContext): string {
  return template.replace(/\{\{(\w+)\}\}/g, (match, key) => {
    return context[key]?.toString() || match;
  });
}

// Função para selecionar template aleatório
export function getRandomTemplate(category: keyof typeof templates, context: TemplateContext = {}): string {
  const templateList = templates[category];
  if (!templateList || templateList.length === 0) {
    return "Desculpe, não entendi. Pode reformular?";
  }
  
  const randomIndex = Math.floor(Math.random() * templateList.length);
  const template = templateList[randomIndex];
  return fillTemplate(template, context);
}

// Função para obter template específico por índice
export function getTemplate(category: keyof typeof templates, index: number, context: TemplateContext = {}): string {
  const templateList = templates[category];
  if (!templateList || index >= templateList.length) {
    return getRandomTemplate(category, context);
  }
  
  return fillTemplate(templateList[index], context);
}

export { templates };


============================================================
FILE PATH: .\src\core\orchestrator\classifyIntent.ts
============================================================
import { MessageAnalysis } from "./analyzeMessage";

export interface IntentClassification {
  intent: MessageAnalysis['intencao'];
  confidence: number;
  needsClarification: boolean;
  suggestedReplies?: string[];
}

export function classifyIntent(analysis: MessageAnalysis, context?: any): IntentClassification {
  const { intencao, nivel_confianca } = analysis;

  // Intents que sempre são claros
  const clearIntents = ['confirmar_evento', 'mostrar_itens', 'encerrar_conversa', 'reiniciar_conversa'];

  if (clearIntents.includes(intencao)) {
    return {
      intent: intencao,
      confidence: nivel_confianca,
      needsClarification: false
    };
  }

  // Criar evento - verificar se precisa de mais informações
  if (intencao === 'criar_evento') {
    const hasCategoria = !!analysis.categoria_evento;
    const hasSubtipo = !!analysis.subtipo_evento;
    const hasQtd = !!analysis.qtd_pessoas;

    if (!hasCategoria && hasSubtipo) {
      // Tem subtipo mas não categoria - precisa clarificar
      return {
        intent: 'criar_evento',
        confidence: nivel_confianca,
        needsClarification: true,
        suggestedReplies: ['Almoço', 'Jantar', 'Lanche']
      };
    }

    if (hasCategoria && !hasQtd) {
      return {
        intent: 'criar_evento',
        confidence: nivel_confianca,
        needsClarification: false
      };
    }
  }

  // Definir menu
  if (intencao === 'definir_menu') {
    return {
      intent: 'definir_menu',
      confidence: nivel_confianca,
      needsClarification: false
    };
  }

  // Editar evento
  if (intencao === 'editar_evento') {
    return {
      intent: 'editar_evento',
      confidence: nivel_confianca,
      needsClarification: false,
      suggestedReplies: ['Mudar data', 'Alterar quantidade', 'Editar menu']
    };
  }

  // Out of domain - sempre com baixa confiança
  if (intencao === 'out_of_domain') {
    return {
      intent: 'out_of_domain',
      confidence: 0.9,
      needsClarification: false
    };
  }

  // Desconhecida - precisa de clarificação
  return {
    intent: 'desconhecida',
    confidence: 0.3,
    needsClarification: true,
    suggestedReplies: ['Criar evento', 'Ver meus eventos', 'Ajuda']
  };
}


============================================================
FILE PATH: .\src\core\orchestrator\contextManager.ts
============================================================
import { UUID } from '@/types/domain';
import { LlmMessage } from '@/types/llm';
import {
  ConversationMessagesRepository,
  ConversationMessage,
} from '@/db/repositories/conversationMessages';
import {   
  ConversationContextsRepository,
  ConversationContext,
} from '@/db/repositories/conversationContexts';

/**
 * Gerencia memória conversacional e contexto persistente
 */
export class ContextManager {
  private messagesRepo: ConversationMessagesRepository;
  private contextsRepo: ConversationContextsRepository;
  public lastProactiveTimestamp?: number;

  constructor() {
    this.messagesRepo = new ConversationMessagesRepository();
    this.contextsRepo = new ConversationContextsRepository();
  }

  /**
   * Carrega contexto conversacional completo do usuário
   */
  async loadUserContext(userId: UUID): Promise<{
    context: ConversationContext;
    history: LlmMessage[];
  }> {
    // Buscar contexto
    let context = await this.contextsRepo.getByUserId(userId);

    // Se não existe, criar inicial
    if (!context) {
      // console.log('[ContextManager] Criando contexto inicial para usuário:', userId);
      context = await this.contextsRepo.createInitial(userId);
      if (!context) {
        throw new Error('Falha ao criar contexto inicial');
      }
    }

    // Buscar histórico de mensagens
    const messages = await this.messagesRepo.getByUserId(userId, 50);
    const history = this.messagesRepo.toLlmMessages(messages);

    // console.log('[ContextManager] Contexto carregado:', {
    //   state: context.state,
    //   historyLength: history.length,
    //   eventoId: context.evento_id,
    // });

    return { context, history };
  }

  /**
   * Salva uma mensagem no histórico
   */
  async saveMessage(
    userId: UUID,
    role: 'user' | 'assistant',
    content: string,
    eventoId?: number
  ): Promise<void> {
    await this.messagesRepo.addMessage(userId, role, content, eventoId);
  }

  /**
   * Atualiza o contexto conversacional
   */
  async updateContext(
    userId: UUID,
    state: string,
    collectedData: Record<string, unknown>,
    missingSlots: string[],
    confidenceLevel: number,
    lastIntent?: string,
    eventoId?: number,
    summary?: string
  ): Promise<void> {
    await this.contextsRepo.upsert(
      userId,
      state,
      collectedData,
      missingSlots,
      confidenceLevel,
      lastIntent,
      eventoId,
      summary
    );
  }

  /**
   * Gera um resumo inteligente do histórico para passar à LLM
   * Mantém últimas N mensagens completas + resumo das anteriores
   */
  generateContextualSummary(
    messages: ConversationMessage[],
    currentContext: ConversationContext,
    maxRecentMessages = 10
  ): LlmMessage[] {
    if (messages.length <= maxRecentMessages) {
      return this.messagesRepo.toLlmMessages(messages);
    }

    // Separar mensagens antigas e recentes
    const recentMessages = messages.slice(-maxRecentMessages);
    const oldMessages = messages.slice(0, -maxRecentMessages);

    // Gerar resumo das mensagens antigas
    const summaryContent = this.summarizeOldMessages(oldMessages, currentContext);

    // Construir histórico: [resumo] + [mensagens recentes]
    const history: LlmMessage[] = [
      {
        role: 'system',
        content: summaryContent,
      },
      ...this.messagesRepo.toLlmMessages(recentMessages),
    ];

    return history;
  }

  /**
   * Resume mensagens antigas em texto condensado
   */
  private summarizeOldMessages(
    oldMessages: ConversationMessage[],
    context: ConversationContext
  ): string {
    const collectedData = context.collected_data || {};

    const summaryParts: string[] = [
      '**Resumo da conversa anterior:**',
    ];

    // Adicionar dados já coletados
    if (Object.keys(collectedData).length > 0) {
      summaryParts.push('Informações coletadas:');
      if (collectedData.categoria_evento) {
        summaryParts.push(`- Tipo de evento: ${collectedData.categoria_evento}`);
      }
      if (collectedData.subtipo_evento) {
        summaryParts.push(`- Subtipo: ${collectedData.subtipo_evento}`);
      }
      if (collectedData.qtd_pessoas) {
        summaryParts.push(`- Quantidade de pessoas: ${collectedData.qtd_pessoas}`);
      }
      if (collectedData.menu) {
        summaryParts.push(`- Menu: ${collectedData.menu}`);
      }
      if (collectedData.data_evento) {
        summaryParts.push(`- Data: ${collectedData.data_evento}`);
      }
    }

    // Adicionar resumo textual se existir
    if (context.summary) {
      summaryParts.push(`\nContexto adicional: ${context.summary}`);
    }

    summaryParts.push(
      `\nTotal de ${oldMessages.length} mensagens anteriores resumidas acima.`
    );

    return summaryParts.join('\n');
  }

  /**
   * Limpa contexto e histórico quando uma conversa é encerrada
   */
  async clearUserContext(userId: UUID): Promise<void> {
    // console.log('[ContextManager] Limpando contexto do usuário:', userId);

    // Limpar histórico de mensagens
    await this.messagesRepo.clearHistory(userId);

    // Resetar contexto para estado inicial limpo
    await this.contextsRepo.upsert(
      userId,
      'idle',
      {}, // collected_data vazio
      [], // missing_slots vazio
      0.5, // confidence default
      undefined, // last_intent
      undefined, // evento_id (vai ser null no banco)
      undefined // summary
    );

    // console.log(`[ContextManager] Contexto resetado para usuário: ${userId}`);
  }

  /**
   * Reseta contexto mas mantém histórico (para iniciar novo evento)
   */
  async resetContextKeepHistory(userId: UUID): Promise<void> {
    // console.log('[ContextManager] Resetando contexto (mantendo histórico)');
    await this.contextsRepo.createInitial(userId);
  }

  /**
   * Limpa apenas o evento_id do contexto, mantém outros dados coletados
   */
  async clearEventId(userId: UUID): Promise<void> {
    const context = await this.contextsRepo.getByUserId(userId);
    if (context?.evento_id) {
      await this.contextsRepo.upsert(
        userId,
        context.state,
        context.collected_data,
        context.missing_slots,
        context.confidence_level,
        context.last_intent,
        undefined, // evento_id = undefined
        context.summary
      );
    }
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\conversationalResponse.ts
============================================================
/**
 * Camada de Resposta Conversacional
 * 
 * Humaniza as respostas finais do orquestrador mantendo:
 * - Ritmo natural e transições suaves
 * - Ofertas opcionais (sem fluxos obrigatórios)
 * - Tom acolhedor mas não exagerado
 */

import { ChatUiPayload } from '@/types/domain';

/**
 * Tipos de ação que geram resposta conversacional
 */
export type ActionType =
    | 'event_created'
    | 'items_generated'
    | 'items_confirmed'
    | 'event_finalized'
    | 'date_added'
    | 'participants_added'
    | 'menu_defined'
    | 'collecting_info';

/**
 * Contexto da ação para personalização
 */
export interface ActionContext {
    eventType?: string;
    peopleCount?: number;
    hasItems?: boolean;
    hasDate?: boolean;
    hasParticipants?: boolean;
    date?: string;
}

/**
 * Resultado de ação estruturado
 */
export interface ActionResult {
    action: ActionType;
    context?: ActionContext;
}

/**
 * Resposta conversacional estruturada
 */
interface ConversationalResponse {
    acknowledgment: string;
    continuation?: string;
    suggestedReplies?: string[];
}

/**
 * Templates de reconhecimento por tipo de ação
 * Cada ação tem múltiplas variações para evitar repetição
 */
const acknowledgmentTemplates: Record<ActionType, string[]> = {
    event_created: [
        "Pronto, organizei o {{eventType}} pra você 🙂",
        "Feito! {{eventType}} tá criado ✨",
        "Show! Seu {{eventType}} tá pronto 🎉",
    ],
    items_generated: [
        "Montei a lista completa pro {{eventType}} de {{peopleCount}} pessoas ✨",
        "Pronto! Aqui tá a lista pro {{eventType}} de {{peopleCount}} pessoas 📝",
        "Feito! Lista prontinha pro {{eventType}} com {{peopleCount}} pessoas 🙂",
    ],
    items_confirmed: [
        "Lista aprovada! ✅",
        "Ótimo, lista confirmada! ✅",
        "Pronto, lista fechada! ✅",
    ],
    event_finalized: [
        "Pronto! Tá tudo organizado 🎉",
        "Feito! Evento confirmado 🙂",
        "Show! Tudo certo pro seu evento ✨",
    ],
    date_added: [
        "Data marcada! {{date}} 📅",
        "Anotado! {{date}} 📅",
        "Combinado pra {{date}} 📅",
    ],
    participants_added: [
        "Participantes adicionados! ✨",
        "Pronto! Galera adicionada 🙂",
        "Feito! Pessoal tá na lista ✅",
    ],
    menu_defined: [
        "Cardápio definido! 🍽️",
        "Ótimo! Menu anotado 🙂",
        "Show! Cardápio tá pronto ✨",
    ],
    collecting_info: [
        "Entendi! 🙂",
        "Beleza! 👍",
        "Show! ✨",
    ],
};

/**
 * Ofertas de continuação passiva por tipo de ação
 * Sempre opcionais, nunca exigem resposta
 */
const continuationTemplates: Record<ActionType, string[] | null> = {
    event_created: [
        "Se quiser, posso te ajudar a convidar amigos.",
        "Quer adicionar participantes? É só me avisar.",
    ],
    items_generated: [
        "Dá uma olhada e me diz se precisa ajustar algo.",
        "Confere aí e me fala se tá tudo certo.",
        "Se quiser, posso te ajudar a convidar amigos.",
    ],
    items_confirmed: [
        "Posso ajudar a dividir entre os participantes, se quiser.",
        "Se quiser, posso distribuir entre a galera.",
    ],
    event_finalized: [
        "Se precisar de algo mais, é só chamar.",
        "Qualquer coisa, tô por aqui.",
    ],
    date_added: null, // Sem continuação, fluxo natural
    participants_added: [
        "Quer que eu divida os itens entre eles?",
    ],
    menu_defined: null, // Sem continuação, fluxo natural
    collecting_info: null, // Sem continuação, continua coletando
};

/**
 * Sugestões visuais por tipo de ação
 */
const suggestedRepliesMap: Record<ActionType, string[] | undefined> = {
    event_created: ["Convidar amigos", "Ver detalhes"],
    items_generated: ["Confirmar lista", "Editar itens"],
    items_confirmed: ["Dividir itens", "Adicionar participantes"],
    event_finalized: undefined, // Não sugerir, deixar aberto
    date_added: undefined,
    participants_added: ["Dividir itens", "Finalizar"],
    menu_defined: undefined,
    collecting_info: undefined,
};

/**
 * Substitui placeholders no template
 */
function fillTemplate(template: string, context?: ActionContext): string {
    if (!context) return template;

    return template
        .replace(/\{\{eventType\}\}/g, context.eventType || 'evento')
        .replace(/\{\{peopleCount\}\}/g, String(context.peopleCount || ''))
        .replace(/\{\{date\}\}/g, context.date || '');
}

/**
 * Seleciona template aleatório de uma lista
 */
function pickRandom<T>(arr: T[]): T {
    return arr[Math.floor(Math.random() * arr.length)];
}

/**
 * Constrói resposta conversacional a partir de um resultado de ação
 */
export function buildConversationalResponse(result: ActionResult): ConversationalResponse {
    const { action, context } = result;

    // Pegar template de reconhecimento
    const ackTemplates = acknowledgmentTemplates[action] || acknowledgmentTemplates.collecting_info;
    const acknowledgment = fillTemplate(pickRandom(ackTemplates), context);

    // Pegar continuação (se houver)
    const contTemplates = continuationTemplates[action];
    const continuation = contTemplates ? fillTemplate(pickRandom(contTemplates), context) : undefined;

    // Pegar sugestões
    const suggestedReplies = suggestedRepliesMap[action];

    return {
        acknowledgment,
        continuation,
        suggestedReplies,
    };
}

/**
 * Detecta o tipo de ação a partir do estado do payload
 */
function detectActionFromPayload(payload: ChatUiPayload): ActionType {
    const estado = payload.estado;

    // Evento finalizado
    if (estado === 'finalizado' && payload.closeChat) {
        return 'event_finalized';
    }

    // Itens gerados/pendentes confirmação
    if (estado === 'itens_pendentes_confirmacao' && payload.showItems) {
        // Se a mensagem original indica confirmação, é items_confirmed
        if (payload.mensagem?.includes('aprovada') || payload.mensagem?.includes('confirmada')) {
            return 'items_confirmed';
        }
        return 'items_generated';
    }

    // Coletando informações
    if (estado === 'collecting_core') {
        return 'collecting_info';
    }

    // Default: deixar como está
    return 'collecting_info';
}

/**
 * Extrai contexto do snapshot
 */
function extractContextFromPayload(payload: ChatUiPayload): ActionContext {
    const evento = payload.snapshot?.evento;

    return {
        eventType: evento?.tipo_evento || evento?.categoria_evento || evento?.subtipo_evento,
        peopleCount: evento?.qtd_pessoas,
        hasItems: payload.showItems,
        hasDate: !!evento?.data_evento,
        hasParticipants: (payload.snapshot?.participantes?.length || 0) > 0,
        date: evento?.data_evento,
    };
}

/**
 * Wrapper principal: humaniza o payload de resposta
 * 
 * @param payload - Payload original do orquestrador
 * @param explicitAction - Ação explícita (opcional, detectada automaticamente se não fornecida)
 * @returns Payload com mensagem humanizada
 */
export function wrapWithConversationalTone(
    payload: ChatUiPayload,
    explicitAction?: ActionResult
): ChatUiPayload {
    // Se já está coletando informações ou é um fluxo intermediário, não modificar
    if (payload.estado === 'collecting_core' && !explicitAction) {
        return payload;
    }

    // Detectar ação se não foi explícita
    const action = explicitAction?.action || detectActionFromPayload(payload);
    const context = explicitAction?.context || extractContextFromPayload(payload);

    // Não modificar mensagens de coleta de dados intermediárias
    if (action === 'collecting_info') {
        return payload;
    }

    // Construir resposta conversacional
    const response = buildConversationalResponse({ action, context });

    // Montar mensagem final
    let finalMessage = response.acknowledgment;
    if (response.continuation) {
        finalMessage += '\n' + response.continuation;
    }

    // Mesclar sugestões (priorizar as do response, mas manter as originais se não houver)
    const finalSuggestions = response.suggestedReplies || payload.suggestedReplies;

    return {
        ...payload,
        mensagem: finalMessage,
        suggestedReplies: finalSuggestions,
    };
}

/**
 * Versão simplificada para casos onde só queremos a mensagem
 */
export function humanizeMessage(
    action: ActionType,
    context?: ActionContext
): string {
    const response = buildConversationalResponse({ action, context });

    let message = response.acknowledgment;
    if (response.continuation) {
        message += '\n' + response.continuation;
    }

    return message;
}


============================================================
FILE PATH: .\src\core\orchestrator\correctionDetector.ts
============================================================
import { MessageAnalysis } from './analyzeMessage';

/**
 * Detecta quando usuário está corrigindo ou ajustando algo que a IA interpretou incorretamente
 */
export class CorrectionDetector {
  /**
   * Verifica se a mensagem atual é uma correção da anterior
   */
  detectCorrection(
    userText: string,
    currentAnalysis: MessageAnalysis,
    previousContext: Record<string, unknown>
  ): {
    isCorrection: boolean;
    correctedField?: string;
    reason?: string;
  } {
    // Padrões linguísticos de correção
    const correctionPatterns = [
      /não|nao|errado|na verdade|melhor|prefiro/i,
      /na verdade é|na real é|não é isso|não era/i,
      /quero mudar|mudar para|trocar para/i,
    ];

    const hasCorrection = correctionPatterns.some(pattern =>
      pattern.test(userText)
    );

    if (!hasCorrection) {
      return { isCorrection: false };
    }

    // Detectar qual campo foi corrigido
    const corrections: Array<{ field: string; reason: string }> = [];

    // Categoria diferente da anterior
    if (
      currentAnalysis.categoria_evento &&
      previousContext.categoria_evento &&
      currentAnalysis.categoria_evento !== previousContext.categoria_evento
    ) {
      corrections.push({
        field: 'categoria_evento',
        reason: 'Usuário corrigiu o tipo de evento',
      });
    }

    // Quantidade diferente da anterior
    if (
      currentAnalysis.qtd_pessoas &&
      previousContext.qtd_pessoas &&
      currentAnalysis.qtd_pessoas !== previousContext.qtd_pessoas
    ) {
      corrections.push({
        field: 'qtd_pessoas',
        reason: 'Usuário corrigiu a quantidade de pessoas',
      });
    }

    // Menu diferente do anterior
    if (
      currentAnalysis.menu &&
      previousContext.menu &&
      currentAnalysis.menu !== previousContext.menu
    ) {
      corrections.push({
        field: 'menu',
        reason: 'Usuário corrigiu o cardápio',
      });
    }

    if (corrections.length > 0) {
      return {
        isCorrection: true,
        correctedField: corrections[0].field,
        reason: corrections[0].reason,
      };
    }

    return { isCorrection: hasCorrection };
  }

  /**
   * Detecta confusão do usuário
   */
  detectConfusion(userText: string): boolean {
    const confusionPatterns = [
      /não entendi|não compreendi|não sei|confuso|perdid[oa]/i,
      /como assim|o que|hein|ué/i,
      /pode explicar|explica de novo|não ficou claro/i,
    ];

    return confusionPatterns.some(pattern => pattern.test(userText));
  }

  /**
   * Gera resposta empática para correção
   */
  generateCorrectionResponse(correctedField: string): string {
    const responses: Record<string, string> = {
      categoria_evento: 'Ah, entendi! Vamos ajustar o tipo então.',
      qtd_pessoas: 'Certo! Vou ajustar a quantidade.',
      menu: 'Beleza! Vou atualizar o cardápio.',
    };

    return (
      responses[correctedField] || 'Entendido! Vou ajustar isso pra você.'
    );
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\eventManager.ts
============================================================
import { Event, EventSnapshot, Item, UUID, EventStatus } from "@/types/domain";
import { getLlmSuggestions } from "@/api/llm/chat";
import { rpc } from "@/api/rpc";
import { supabase } from "@/integrations/supabase/client";
import { parseLlmItemsResponse } from "./itemAdapter";
import { parseToIsoDate } from "@/core/nlp/date-parser";

export async function getPlanSnapshot(eventoId: UUID): Promise<EventSnapshot | null> {
  console.log(`[Manager] getPlanSnapshot called with eventoId: ${eventoId}`);
  try {
    const snapshot = await rpc.get_event_plan(eventoId);
    return snapshot as EventSnapshot;
  } catch (error) {
    console.error('[Manager] Erro ao buscar snapshot:', error);
    return null;
  }
}

export async function findDraftEventByUser(userId: UUID): Promise<EventSnapshot | null> {
  console.log(`[Manager] findDraftEventByUser called with userId: ${userId}`);
  try {
    // Busca eventos do usuário com status 'draft'
    const { data, error } = await supabase
      .from('table_reune')
      .select('*')
      .eq('user_id', userId)
      .eq('status', 'draft')
      .order('updated_at', { ascending: false })
      .limit(1)
      .maybeSingle();

    if (error || !data) {
      console.log('[Manager] Nenhum draft encontrado');
      return null;
    }

    console.log('[Manager] Draft encontrado:', data);

    // Monta o snapshot a partir dos dados do draft
    const snapshot: EventSnapshot = {
      evento: {
        id: data.id.toString(),
        usuario_id: data.user_id,
        nome_evento: data.title,
        tipo_evento: data.tipo_evento || '',
        data_evento: data.event_date,
        qtd_pessoas: data.qtd_pessoas || 0,
        status: 'collecting_core',
      },
      itens: [],
      participantes: [],
      distribuicao: [],
    };

    return snapshot;
  } catch (error) {
    console.error('[Manager] Erro ao buscar draft:', error);
    return null;
  }
}

/*export async function upsertEvent(event: Partial<Event> & { usuario_id: UUID; created_by_ai?: boolean }): Promise<Event> {
  console.log('[Manager] upsertEvent called with:', event);

  try {
    // 🔹 Normalizar data para formato ISO se fornecida
    let eventDate: string | undefined;

    if (event.data_evento) {
      const parsedDate = parseToIsoDate(event.data_evento);
      if (parsedDate) {
        eventDate = parsedDate;
        console.log('[Manager] Data normalizada:', { original: event.data_evento, parsed: eventDate });
      }
    }

    // Se for novo evento e não tem data, usar hoje (LOCAL)
    if (!event.id && !eventDate) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      eventDate = `${year}-${month}-${day}`;
    }

    const eventData: any = {
      user_id: event.usuario_id,
      description: '', // TODO: Permitir descrição
      event_time: '12:00', // Default
      status: event.status === 'collecting_core' ? 'draft' : event.status || 'draft',
      is_public: false,
      created_by_ai: event.created_by_ai ?? true,
    };

    // Preencher campos opcionais apenas se fornecidos (para evitar sobrescrever com null/undefined)
    if (event.nome_evento) eventData.title = event.nome_evento;
    if (eventDate) eventData.event_date = eventDate;
    if (event.tipo_evento) eventData.tipo_evento = event.tipo_evento;
    if (event.qtd_pessoas) eventData.qtd_pessoas = event.qtd_pessoas;
    if ((event as any).categoria_evento) eventData.categoria_evento = (event as any).categoria_evento;
    if ((event as any).subtipo_evento) eventData.subtipo_evento = (event as any).subtipo_evento;
    if ((event as any).menu) eventData.menu = (event as any).menu;
    if ((event as any).finalidade_evento) eventData.finalidade_evento = (event as any).finalidade_evento;

    if (event.id) {
      // Update existing event
      const eventIdNum = typeof event.id === 'string' ? parseInt(event.id, 10) : event.id;
      const { data, error } = await supabase
        .from('table_reune')
        .update(eventData)
        .eq('id', eventIdNum)
        .select()
        .single();

      if (error) throw error;

      return {
        id: data.id.toString(),
        usuario_id: data.user_id,
        nome_evento: data.title,
        tipo_evento: event.tipo_evento || '',
        data_evento: data.event_date,
        qtd_pessoas: event.qtd_pessoas || 0,
        status: data.status === 'draft' ? 'collecting_core' : data.status as Event['status'],
      };
    } else {
      // Create new event
      const { data, error } = await supabase
        .from('table_reune')
        .insert(eventData)
        .select()
        .single();

      if (error) throw error;

      return {
        id: data.id.toString(),
        usuario_id: data.user_id,
        nome_evento: data.title,
        tipo_evento: event.tipo_evento || '',
        data_evento: data.event_date,
        qtd_pessoas: event.qtd_pessoas || 0,
        status: data.status === 'draft' ? 'collecting_core' : data.status as Event['status'],
      };
    }
  } catch (error) {
    console.error('[Manager] Erro ao criar/atualizar evento:', error);
    throw error;
  }
}*/

export async function upsertEvent(event: Partial<Event> & { usuario_id: UUID; created_by_ai?: boolean }): Promise<Event> {
  try {
    let eventDate: string | undefined;

    if (event.data_evento) {
      const parsedDate = parseToIsoDate(event.data_evento);
      if (parsedDate) eventDate = parsedDate;
    }

    // Fallback de data para hoje usando formato ISO correto
    if (!event.id && !eventDate) {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      eventDate = `${year}-${month}-${day}`;
      console.log('[Manager] Data de fallback gerada:', eventDate);
    }

    const eventData: any = {
      user_id: event.usuario_id,
      event_time: '12:00',
      status: event.status === 'collecting_core' ? 'draft' : event.status || 'draft',
      created_by_ai: event.created_by_ai ?? true,
    };

    if (event.nome_evento) eventData.title = event.nome_evento;
    if (eventDate) eventData.event_date = eventDate;
    if (event.tipo_evento) eventData.tipo_evento = event.tipo_evento;
    if (event.qtd_pessoas) eventData.qtd_pessoas = event.qtd_pessoas;
    if ((event as any).categoria_evento) eventData.categoria_evento = (event as any).categoria_evento;
    if ((event as any).subtipo_evento) eventData.subtipo_evento = (event as any).subtipo_evento;
    if ((event as any).menu) eventData.menu = (event as any).menu;
    if ((event as any).finalidade_evento) eventData.finalidade_evento = (event as any).finalidade_evento;

    const { data, error } = event.id
      ? await supabase.from('table_reune').update(eventData).eq('id', parseInt(event.id, 10)).select().single()
      : await supabase.from('table_reune').insert(eventData).select().single();

    if (error) throw error;

    return {
      id: data.id.toString(),
      usuario_id: data.user_id,
      nome_evento: data.title,
      tipo_evento: data.tipo_evento || '',
      data_evento: data.event_date,
      qtd_pessoas: data.qtd_pessoas || 0,
      status: (data.status === 'draft' ? 'collecting_core' : data.status) as EventStatus,
    };
  } catch (error) {
    console.error('[Manager] Erro no upsertEvent:', error);
    throw error;
  }
}

export async function generateItemList(params: {
  tipo_evento: string;
  qtd_pessoas: number;
  menu?: string;
  finalidade_evento?: string;  // Ex: "Páscoa", "Natal", "Reveillon"
  excluir_alcool?: boolean;    // Não incluir bebidas alcoólicas por padrão
}): Promise<Partial<Item>[]> {
  console.log('[Manager] generateItemList called with:', params);

  // Montar descrição do perfil do evento
  const perfilEvento = params.finalidade_evento
    ? `${params.tipo_evento} de ${params.finalidade_evento}`
    : params.tipo_evento;

  // Regra de álcool: excluir por padrão, a menos que explicitamente incluído
  const excluirAlcool = params.excluir_alcool !== false; // true por padrão

  /*const systemPrompt = `Você é um especialista em planejamento de eventos.
Gere uma lista de itens para um evento do tipo "${params.tipo_evento}" para ${params.qtd_pessoas} pessoas.

Retorne APENAS um array JSON válido, sem markdown ou explicações.
Cada item deve ter exatamente estes campos (sem campos extras):
{
  "nome_item": string,
  "quantidade": number,
  "unidade": string,
  "valor_estimado": number,
  "categoria": string,
  "prioridade": "A" | "B" | "C"
}

Categorias comuns: comida, bebida, descartaveis, decoracao, combustivel.
Prioridade: A = essencial, B = importante, C = opcional.
Use a quantidade de pessoas para calcular as quantidades.`;*/

  const systemPrompt = `Você é um especialista em planejamento e organização de eventos sociais e corporativos.

Sua função é montar uma lista estruturada de itens e quantidades necessários para o evento descrito abaixo.

EVENTO:
- Tipo/Perfil: "${perfilEvento}"
- Quantidade de pessoas: ${params.qtd_pessoas}${params.menu ? `\n- Menu: "${params.menu}"` : ''}${params.finalidade_evento ? `\n- Ocasião especial: "${params.finalidade_evento}" (adapte os itens para essa ocasião específica no Brasil)` : ''}

Regras de Geração e Inteligência Cultural (CRÍTICO):
1. ADAPTAÇÃO INTELIGENTE AO TEMA:
   - Use seu conhecimento sobre a cultura brasileira para selecionar itens TÍPICOS e COERENTES com o evento.
   - A lista deve "ter a cara" do evento. Evite sugestões genéricas ou sofisticadas demais se o evento for tradicional/rústico.
   - Analise a "vibe" do evento e adapte os itens de acordo.

2. EXEMPLOS DE PADRÕES ESPERADOS (Use como referência de raciocínio):
   - Exemplo "Festa Junina": Espera-se Paçoca, Quentão, Milho, Canjica, Cachorro-quente. (Evite itens de churrasco como Picanha ou Linguiça, a menos que solicitado).
   - Exemplo "Churrasco": Espera-se Picanha, Linguiça, Pão de Alho, Farofa.
   - Exemplo "Natal/Ceia": Espera-se Peru/Chester, Rabanada, Frutas Secas.
   -> APLIQUE ESSE MESMO NÍVEL DE COERÊNCIA PARA QUALQUER OUTRO TEMA SOLICITADO.
   -> CASO O TEMA NÃO ESTEJA NOS EXEMPLOS (ex: "Aniversário Infantil", "Bodas"): Use sua inteligência para sugerir itens clássicos desse tipo de evento.

3. OUTRAS REGRAS:
   - Mantenha as quantidades realistas.
   - ${excluirAlcool ? 'NÃO inclua bebidas alcoólicas na lista inicial.' : 'Inclua bebidas alcoólicas se apropriado para o evento.'}
   - Classifique cada item com a categoria correta.
${params.finalidade_evento ? `7. ADAPTE os itens para a ocasião "${params.finalidade_evento}" - use ingredientes e pratos típicos dessa celebração no Brasil.` : ''}

Formato de saída:
Retorne APENAS um array JSON **válido** (sem markdown, texto adicional ou comentários).
Cada item deve seguir EXATAMENTE esta estrutura:
[
  {
    "nome_item": string,
    "quantidade": number,
    "unidade": string,
    "valor_estimado": number,
    "categoria": "comida" | "bebida" | "descartaveis" | "decoracao" | "combustivel" | "outros",
    "prioridade": "A" | "B" | "C"
  }
]

Definições:
- **categoria:** classifique corretamente cada item conforme sua natureza.
- **prioridade:** 
  - "A" = essencial (itens obrigatórios para o evento acontecer)
  - "B" = importante (melhoram a experiência, mas o evento ocorre sem eles)
  - "C" = opcional (complementos ou itens estéticos)
- **valor_estimado:** use valores aproximados e proporcionais às quantidades.
- **quantidade:** deve refletir o consumo médio esperado para ${params.qtd_pessoas} pessoas.

Importante:
- NÃO use markdown.
- NÃO adicione texto explicativo antes ou depois do JSON.
- O retorno deve ser apenas o JSON puro.`;


  const userPrompt = `Gere a lista para o evento "${perfilEvento}" com ${params.qtd_pessoas} pessoas.
Siga as diretrizes culturais. Se for um evento temático, respeite as tradições. Se for um evento comum (aniversário, reunião), sugira itens adequados ao público e ocasião.`;

  try {
    const llmResponse = await getLlmSuggestions(systemPrompt, [
      { role: 'user', content: userPrompt }
    ], 0.3);

    if (!llmResponse || !llmResponse.content) {
      console.warn('[Manager] LLM não retornou resposta, usando fallback');
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }

    // Usa o adapter robusto para processar a resposta
    try {
      const items = parseLlmItemsResponse(llmResponse.content);
      console.info('[Manager] Itens gerados pela LLM:', items.length);
      return items;
    } catch (adapterError) {
      console.error('[Manager] Erro no adapter, usando fallback:', adapterError);
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }
  } catch (error) {
    console.error('[Manager] Erro ao gerar itens com LLM:', error);
    return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
  }
}

// Função de fallback para gerar itens básicos
function generateFallbackItems(tipo_evento: string, qtd_pessoas: number): Partial<Item>[] {
  const baseItems = [
    {
      nome_item: 'Item principal',
      quantidade: Math.max(1, qtd_pessoas * 0.2),
      unidade: 'kg',
      valor_estimado: 25.90 * qtd_pessoas * 0.2,
      categoria: 'comida',
      prioridade: 'A'
    },
    {
      nome_item: 'Bebidas',
      quantidade: Math.max(1, qtd_pessoas * 0.5),
      unidade: 'L',
      valor_estimado: 8.90 * qtd_pessoas * 0.5,
      categoria: 'bebida',
      prioridade: 'A'
    },
    {
      nome_item: 'Copos/Pratos',
      quantidade: qtd_pessoas * 1.2,
      unidade: 'un',
      valor_estimado: 0.50 * qtd_pessoas * 1.2,
      categoria: 'descartaveis',
      prioridade: 'B'
    }
  ];

  // Personaliza baseado no tipo de evento
  if (tipo_evento.toLowerCase().includes('churrasco')) {
    baseItems[0].nome_item = 'Carne';
    baseItems.push({
      nome_item: 'Carvão',
      quantidade: Math.max(1, qtd_pessoas * 0.1),
      unidade: 'kg',
      valor_estimado: 12.90 * qtd_pessoas * 0.1,
      categoria: 'combustivel',
      prioridade: 'A'
    });
  } else if (tipo_evento.toLowerCase().includes('pizza')) {
    baseItems[0].nome_item = 'Pizzas';
    baseItems[0].unidade = 'un';
    baseItems[0].quantidade = Math.max(1, qtd_pessoas * 0.3);
  }

  return baseItems.map(item => ({
    ...item,
    prioridade: item.prioridade as 'A' | 'B' | 'C'
  }));
}

export async function generateEventName(params: {
  tipo_evento: string;
  qtd_pessoas: number;
  data_evento?: string;
}): Promise<string> {
  console.log('[Manager] generateEventName called with:', params);

  const systemPrompt = `Você é um especialista em criar nomes criativos e curtos para eventos sociais.
Gere um nome único e convidativo para o evento, com base nos dados fornecidos.
O nome deve ser curto (máximo 50 caracteres), criativo e em português.
Retorne APENAS o nome do evento, sem aspas, sem explicações adicionais.`;

  const userPrompt = `Evento: ${params.tipo_evento}, ${params.qtd_pessoas} pessoas${params.data_evento ? `, data: ${params.data_evento}` : ''}`;

  try {
    const llmResponse = await getLlmSuggestions(systemPrompt, [
      { role: 'user', content: userPrompt }
    ], 0.7);

    if (!llmResponse || !llmResponse.content) {
      console.warn('[Manager] LLM não retornou nome, usando fallback');
      return `${params.tipo_evento.charAt(0).toUpperCase() + params.tipo_evento.slice(1)} - ${params.qtd_pessoas} pessoas`;
    }

    const generatedName = llmResponse.content.trim().replace(/^["']|["']$/g, '');
    console.info('[Manager] Nome gerado pela LLM:', generatedName);
    return generatedName;
  } catch (error) {
    console.error('[Manager] Erro ao gerar nome com LLM:', error);
    return `${params.tipo_evento.charAt(0).toUpperCase() + params.tipo_evento.slice(1)} - ${params.qtd_pessoas} pessoas`;
  }
}

export async function setEventStatus(eventoId: UUID, status: Event['status']): Promise<void> {
  console.log(`[Manager] setEventStatus called with eventoId: ${eventoId}, status: ${status}`);
  try {
    const eventIdNum = typeof eventoId === 'string' ? parseInt(eventoId, 10) : eventoId;
    const mappedStatus = status === 'collecting_core' ? 'draft' : status;

    const { error } = await supabase
      .from('table_reune')
      .update({ status: mappedStatus })
      .eq('id', eventIdNum);

    if (error) {
      console.error('[Manager] Erro ao atualizar status:', error);
      throw error;
    }
  } catch (error) {
    console.error('[Manager] Erro ao atualizar status do evento:', error);
  }
}

/**
 * Finaliza evento SEM data definida
 * - Atualiza status para "criado_sem_data"
 * - Não regenera itens
 * - Não chama LLM
 */
export async function finalizeEventSemData(eventoId: UUID): Promise<EventSnapshot | null> {
  console.log(`[Manager] finalizeEventSemData called with eventoId: ${eventoId}`);
  try {
    const eventIdNum = typeof eventoId === 'string' ? parseInt(eventoId, 10) : eventoId;

    const { error } = await supabase
      .from('table_reune')
      .update({
        status: 'criado_sem_data',
        event_date: null
      })
      .eq('id', eventIdNum);

    if (error) {
      console.error('[Manager] Erro ao finalizar evento sem data:', error);
      throw error;
    }

    console.info('[Manager] Evento finalizado sem data com sucesso');
    return await getFinalSnapshot(eventoId);
  } catch (error) {
    console.error('[Manager] Erro ao finalizar evento sem data:', error);
    throw error;
  }
}

/**
 * Finaliza evento COM data definida
 * - Atualiza status para "criado"
 * - Normaliza e salva a data
 * - Não regenera itens
 * - Não chama LLM
 */
export async function finalizeEventComData(eventoId: UUID, data: string): Promise<EventSnapshot | null> {
  console.log(`[Manager] finalizeEventComData called with eventoId: ${eventoId}, data: ${data}`);
  try {
    const eventIdNum = typeof eventoId === 'string' ? parseInt(eventoId, 10) : eventoId;

    // Normaliza a data para ISO
    const parsedDate = parseToIsoDate(data);
    const eventDate = parsedDate || new Date().toISOString().split('T')[0];

    const { error } = await supabase
      .from('table_reune')
      .update({
        status: 'criado',
        event_date: eventDate
      })
      .eq('id', eventIdNum);

    if (error) {
      console.error('[Manager] Erro ao finalizar evento com data:', error);
      throw error;
    }

    console.info('[Manager] Evento finalizado com data:', eventDate);
    return await getFinalSnapshot(eventoId);
  } catch (error) {
    console.error('[Manager] Erro ao finalizar evento com data:', error);
    throw error;
  }
}

/**
 * Retorna snapshot final do evento com itens e participantes
 * - Usado após finalização para atualizar o frontend
 */
export async function getFinalSnapshot(eventoId: UUID): Promise<EventSnapshot | null> {
  console.log(`[Manager] getFinalSnapshot called with eventoId: ${eventoId}`);
  try {
    const eventIdNum = typeof eventoId === 'string' ? parseInt(eventoId, 10) : eventoId;

    // Busca evento
    const { data: evento, error: eventoError } = await supabase
      .from('table_reune')
      .select('*')
      .eq('id', eventIdNum)
      .single();

    if (eventoError || !evento) {
      console.error('[Manager] Erro ao buscar evento:', eventoError);
      return null;
    }

    // Busca itens
    const { data: itens, error: itensError } = await supabase
      .from('event_items')
      .select('*')
      .eq('event_id', eventIdNum);

    if (itensError) {
      console.error('[Manager] Erro ao buscar itens:', itensError);
    }

    // Busca participantes
    const { data: participantes, error: participantesError } = await supabase
      .from('event_participants')
      .select('*')
      .eq('event_id', eventIdNum);

    if (participantesError) {
      console.error('[Manager] Erro ao buscar participantes:', participantesError);
    }

    const snapshot: EventSnapshot = {
      evento: {
        id: evento.id.toString(),
        usuario_id: evento.user_id,
        nome_evento: evento.title,
        tipo_evento: evento.tipo_evento || '',
        data_evento: evento.event_date,
        qtd_pessoas: evento.qtd_pessoas || 0,
        status: evento.status as Event['status'],
      },
      itens: (itens || []).map(item => ({
        id: item.id.toString(),
        evento_id: item.event_id.toString(),
        nome_item: item.nome_item,
        quantidade: Number(item.quantidade),
        unidade: item.unidade,
        valor_estimado: Number(item.valor_estimado),
        categoria: item.categoria,
        prioridade: item.prioridade as 'A' | 'B' | 'C',
      })),
      participantes: (participantes || []).map(p => ({
        id: p.id.toString(),
        evento_id: p.event_id.toString(),
        nome_participante: p.nome_participante,
        contato: p.contato,
        status_convite: p.status_convite as 'pendente' | 'confirmado' | 'recusado',
      })),
      distribuicao: [],
    };

    return snapshot;
  } catch (error) {
    console.error('[Manager] Erro ao buscar snapshot final:', error);
    return null;
  }
}

/**
 * Finaliza evento (legado - mantido para compatibilidade)
 * @deprecated Use finalizeEventComData ou finalizeEventSemData
 */
export async function finalizeEvent(eventoId: UUID, eventData: Partial<Event>): Promise<void> {
  console.log(`[Manager] finalizeEvent called with eventoId: ${eventoId}`);
  try {
    const eventIdNum = typeof eventoId === 'string' ? parseInt(eventoId, 10) : eventoId;

    // Gera nome do evento se não houver
    let eventName = eventData.nome_evento || 'Rascunho';
    if (eventName === 'Rascunho' && eventData.tipo_evento && eventData.qtd_pessoas) {
      eventName = await generateEventName({
        tipo_evento: eventData.tipo_evento,
        qtd_pessoas: eventData.qtd_pessoas,
        data_evento: eventData.data_evento
      });
    }

    const { error } = await supabase
      .from('table_reune')
      .update({
        status: 'active',
        title: eventName
      })
      .eq('id', eventIdNum);

    if (error) {
      console.error('[Manager] Erro ao finalizar evento:', error);
      throw error;
    }

    console.info('[Manager] Evento finalizado com sucesso:', eventName);
  } catch (error) {
    console.error('[Manager] Erro ao finalizar evento:', error);
    throw error;
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\extractSlots.ts
============================================================
// src/core/orchestrator/extractSlots.ts
import { normalize } from "@/core/nlp/normalize";
import { parseToIsoDate } from "@/core/nlp/date-parser";

/**
 * Regexs refinados
 */
const CATEGORY_RE = /\b(almoço|almoco|jantar|lanche|piquenique|brunch|café da manhã|cafe da manha)\b/i;
const SUBTYPE_RE = /\b(churrasco|feijoada|pizza|fondue|sushi|lasanha|macarronada|rodízio|rodizio)\b/i;
const PURPOSE_RE = /\b(aniversário|aniversario|confraternização|confraternizacao|encontro|comemoração|celebração|casamento)\b/i;
const MENU_RE = /\b(lasanha|massa|massas|carne|carnes|frango|peixe|sushi|feijoada|pizza|fondue|frutos do mar|churrasco)\b/i;

// Captura datas: dd/mm/yyyy, dd/mm, yyyy-mm-dd, "dia 15 de novembro", "15 de novembro"
const DATE_RE =
  /\b(\d{1,2}\/\d{1,2}(?:\/\d{2,4})?|(?:dia\s+)?\d{1,2}\s+de\s+\w+(?:\s+de\s+\d{4})?|\d{4}-\d{2}-\d{2})\b/i;

// Quantidade de pessoas (somente com contexto)
const PEOPLE_COUNT_RE =
  /\b(\d+)\s*(pessoa|pessoas|convidado|convidados|participante|participantes)\b/i;

// Hora do evento
const HOUR_RE = /\b(\d{1,2})\s*(h|horas|da\s+noite|da\s+manhã|da\s+tarde)\b/i;

// Itens complementares
const BEVERAGES_RE = /\b(cerveja|refrigerante|vinho|bebida|bebidas)\b/i;
const ENTRADAS_RE = /\b(salgadinho|petisco|entrada|aperitivo|tábua|tabua)\b/i;

/**
 * Extrai informações estruturadas do texto do usuário
 * com fallback heurístico e coerência hierárquica.
 */
export function extractSlotsByRules(
  text: string,
  draft?: {
    tipo_evento?: string;
    qtd_pessoas?: number;
    data_evento?: string;
    menu?: string;
    finalidade_evento?: string;
  }
) {
  const t = normalize(text);

  // 1️⃣ Categoria e subtipo de evento
  const categoria_evento = t.match(CATEGORY_RE)?.[1]?.toLowerCase() || draft?.tipo_evento || null;
  const subtipo_evento = t.match(SUBTYPE_RE)?.[1]?.toLowerCase() || null;

  // 2️⃣ Finalidade (motivo)
  const finalidade_evento = t.match(PURPOSE_RE)?.[1]?.toLowerCase() || draft?.finalidade_evento || null;

  // 3️⃣ Menu principal
  const menu = t.match(MENU_RE)?.[1]?.toLowerCase() || draft?.menu || null;

  // 4️⃣ Quantidade de pessoas
  const qtdMatch = t.match(PEOPLE_COUNT_RE);
  const qtd_pessoas = qtdMatch ? parseInt(qtdMatch[1], 10) : draft?.qtd_pessoas || null;

  // 5️⃣ Data e hora
  const dateMatch = t.match(DATE_RE);
  const rawDate = dateMatch?.[1] || draft?.data_evento || null;
  const data_evento = rawDate ? parseToIsoDate(rawDate) : null;

  const hourMatch = t.match(HOUR_RE);
  const hora_evento = hourMatch?.[1] || null;

  // 6️⃣ Extras
  const inclui_bebidas = BEVERAGES_RE.test(t);
  const inclui_entradas = ENTRADAS_RE.test(t);

  // 7️⃣ Intenção inferida (heurística)
  const intencao = inferIntent(t, categoria_evento, subtipo_evento, finalidade_evento, menu);

  // 8️⃣ Verificação de confirmação
  const is_confirm = isConfirm(t);

  return {
    intencao,
    categoria_evento,
    subtipo_evento,
    finalidade_evento,
    menu,
    qtd_pessoas,
    data_evento,
    hora_evento,
    inclui_bebidas,
    inclui_entradas,
    is_confirm,
  };
}

/**
 * Heurística leve para detectar intenção sem LLM
 */
function inferIntent(
  text: string,
  categoria?: string | null,
  subtipo?: string | null,
  finalidade?: string | null,
  menu?: string | null
): string {
  if (/\b(sim|ok|beleza|perfeito|isso|pode seguir|segue|manda ver|to dentro|bora)\b/i.test(text))
    return "confirmar_evento";
  if (/\b(itens|lista|mostrar|mostra|mostre)\b/i.test(text))
    return "mostrar_itens";
  if (/\b(editar|mudar|alterar|modificar|ajustar)\b/i.test(text))
    return "editar_evento";
  if (/\b(participante|convidado|adicionar|incluir|dividir)\b/i.test(text))
    return "adicionar_participantes";
  if (/\b(tchau|até|obrigado|valeu|flw)\b/i.test(text))
    return "encerrar_conversa";
  if (categoria || subtipo || finalidade) return "criar_evento";
  if (menu) return "definir_menu";
  return "desconhecida";
}

/**
 * Detecta confirmação direta do usuário
 */
export function isConfirm(text: string) {
  const t = normalize(text);
  return /\b(ok|sim|beleza|perfeito|isso|pode seguir|segue|manda ver|sugira|sugestao|to dentro|bora)\b/i.test(
    t
  );
}


============================================================
FILE PATH: .\src\core\orchestrator\feedbackManager.ts
============================================================
import { UUID } from '@/types/domain';
import { ConversationAnalyticsRepository } from '@/db/repositories/conversationAnalytics';
import { UserFeedbackRepository } from '@/db/repositories/userFeedback';

/**
 * Gerencia feedback e aprendizado contínuo do UNE.AI
 */
export class FeedbackManager {
  private analyticsRepo: ConversationAnalyticsRepository;
  private feedbackRepo: UserFeedbackRepository;

  constructor() {
    this.analyticsRepo = new ConversationAnalyticsRepository();
    this.feedbackRepo = new UserFeedbackRepository();
  }

  /**
   * Registra uma interação completa com analytics
   */
  async logInteraction(
    userId: UUID,
    intent: string,
    confidenceLevel: number,
    responseType: 'template' | 'llm' | 'hybrid',
    options: {
      eventoId?: number;
      messageId?: string;
      responseTimeMs?: number;
      tokensUsed?: number;
      metadata?: Record<string, unknown>;
    } = {}
  ): Promise<string | null> {
    const analytic = await this.analyticsRepo.logInteraction(
      userId,
      intent,
      confidenceLevel,
      responseType,
      {
        ...options,
        clarificationNeeded: confidenceLevel < 0.6,
      }
    );

    return analytic?.id || null;
  }

  /**
   * Verifica se deve fazer clarificação baseado em histórico
   */
  async shouldClarify(
    userId: UUID,
    intent: string,
    confidenceLevel: number
  ): Promise<{
    shouldClarify: boolean;
    reason?: string;
  }> {
    // Sempre clarificar se confiança muito baixa
    if (confidenceLevel < 0.5) {
      return {
        shouldClarify: true,
        reason: 'low_confidence',
      };
    }

    // Verificar histórico de erros nessa intenção
    const errors = await this.analyticsRepo.getFrequentErrors(userId, 7);
    const intentError = errors.find((e) => e.intent === intent);

    if (intentError && intentError.error_count > 2) {
      return {
        shouldClarify: true,
        reason: 'frequent_errors',
      };
    }

    // Confiança média mas não crítica - não clarificar
    if (confidenceLevel >= 0.6) {
      return { shouldClarify: false };
    }

    return {
      shouldClarify: true,
      reason: 'moderate_confidence',
    };
  }

  /**
   * Gera mensagem de clarificação contextual
   */
  generateClarificationMessage(
    intent: string,
    context: Record<string, unknown>
  ): {
    message: string;
    suggestedReplies: string[];
  } {
    const clarifications: Record<string, { message: string; suggestedReplies: string[] }> = {
      criar_evento: {
        message: 'Só pra confirmar: você quer criar um evento novo?',
        suggestedReplies: ['Sim, criar novo', 'Não, quero editar'],
      },
      editar_evento: {
        message: 'Entendi que você quer editar. O que vamos mudar?',
        suggestedReplies: ['Mudar data', 'Mudar quantidade', 'Mudar cardápio'],
      },
      definir_menu: {
        message: 'Legal! Só confirmando: qual vai ser o cardápio principal?',
        suggestedReplies: ['Carne', 'Frango', 'Massa', 'Misto'],
      },
      confirmar_evento: {
        message: 'Perfeito! Posso confirmar e criar o evento?',
        suggestedReplies: ['Sim, confirmar', 'Não, revisar antes'],
      },
      desconhecida: {
        message: 'Não entendi bem. Pode reformular?',
        suggestedReplies: ['Criar evento', 'Ver eventos', 'Ajuda'],
      },
    };

    return (
      clarifications[intent] || {
        message: 'Me explica melhor o que você precisa?',
        suggestedReplies: ['Criar evento', 'Editar evento', 'Ver lista'],
      }
    );
  }

  /**
   * Registra que usuário corrigiu a IA
   */
  async recordCorrection(analyticId: string): Promise<void> {
    await this.analyticsRepo.markAsCorrected(analyticId);
  }

  /**
   * Registra que usuário ficou confuso
   */
  async recordConfusion(analyticId: string): Promise<void> {
    await this.analyticsRepo.markAsConfused(analyticId);
  }

  /**
   * Obtém métricas de performance
   */
  async getPerformanceMetrics(userId: UUID) {
    const metrics = await this.analyticsRepo.getMetrics(userId, 30);
    const feedbackStats = await this.feedbackRepo.getFeedbackStats(userId);
    const lowConfidence = await this.analyticsRepo.getLowConfidenceInteractions(
      userId,
      0.6,
      10
    );
    const errors = await this.analyticsRepo.getFrequentErrors(userId, 30);

    // Calcular taxa de sucesso
    const totalInteractions = metrics.reduce((sum, m) => sum + m.total_interactions, 0);
    const totalCorrections = metrics.reduce((sum, m) => sum + m.correction_count, 0);
    const successRate = totalInteractions > 0
      ? ((totalInteractions - totalCorrections) / totalInteractions) * 100
      : 0;

    return {
      summary: {
        total_interactions: totalInteractions,
        avg_confidence: metrics.length > 0
          ? metrics.reduce((sum, m) => sum + m.avg_confidence, 0) / metrics.length
          : 0,
        success_rate: successRate,
        clarification_rate: totalInteractions > 0
          ? (metrics.reduce((sum, m) => sum + m.clarification_count, 0) / totalInteractions) * 100
          : 0,
      },
      feedback: feedbackStats,
      recent_low_confidence: lowConfidence.slice(0, 5),
      frequent_errors: errors.slice(0, 5),
      daily_metrics: metrics.slice(0, 7),
    };
  }

  /**
   * Detecta padrões de confusão recorrentes
   */
  async detectConfusionPatterns(userId: UUID): Promise<{
    hasPatterns: boolean;
    patterns: Array<{
      intent: string;
      frequency: number;
      suggestion: string;
    }>;
  }> {
    const errors = await this.analyticsRepo.getFrequentErrors(userId, 7);

    const patterns = errors
      .filter((e) => e.error_count >= 2)
      .map((e) => ({
        intent: e.intent,
        frequency: e.error_count,
        suggestion: this.getSuggestionForIntent(e.intent),
      }));

    return {
      hasPatterns: patterns.length > 0,
      patterns,
    };
  }

  private getSuggestionForIntent(intent: string): string {
    const suggestions: Record<string, string> = {
      criar_evento: 'Tente ser mais específico sobre tipo e quantidade',
      editar_evento: 'Especifique claramente o que deseja editar',
      definir_menu: 'Descreva o cardápio principal com mais detalhes',
      desconhecida: 'Use comandos mais diretos como "criar", "editar", "confirmar"',
    };

    return suggestions[intent] || 'Tente reformular sua mensagem de forma mais clara';
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\index.ts
============================================================
// Orquestrador básico: interpreta inputs e sugere ações
import { detectIntent } from '@/core/nlp';
import { estimateQuantityPerPerson } from '@/core/calc';
import type { AiProfile, ConversationState } from '@/types/domain';

export interface OrchestratorContext {
  profile?: AiProfile;
}

export const orchestrate = (input: string, state: ConversationState, ctx: OrchestratorContext = {}) => {
  const intent = detectIntent(input);
  switch (intent) {
    case 'create_bbq_event':
      return {
        action: 'suggest_items',
        payload: [
          { name: 'Carne', perPerson: estimateQuantityPerPerson('carne'), unit: 'g' },
          { name: 'Bebidas', perPerson: estimateQuantityPerPerson('bebidas'), unit: 'L' },
        ],
      };
    case 'create_event':
      return { action: 'create_event_draft', payload: { title: 'Novo Evento' } };
    default:
      return { action: 'none', payload: {} };
  }
};

============================================================
FILE PATH: .\src\core\orchestrator\itemAdapter.ts
============================================================
/**
 * Adapter para normalizar itens vindos da LLM
 * Previne erros de tipo e formato antes de enviar para o banco
 */

import { z } from 'zod';
import type { Item } from '@/types/domain';

interface RawLlmItem {
  nome_item?: string;
  quantidade?: number | string;
  unidade?: string;
  valor_estimado?: number | string;
  categoria?: string;
  prioridade?: string;
  [key: string]: unknown;
}

const llmItemSchema = z.object({
  nome_item: z.string().min(1),
  quantidade: z.coerce.number().optional(),
  unidade: z.string().optional(),
  valor_estimado: z.coerce.number().optional(),
  categoria: z.string().optional(),
  prioridade: z.enum(['A', 'B', 'C']).optional(),
}).passthrough();

/**
 * Remove code fences (```json ... ```) do conteúdo LLM
 */
export function stripCodeFence(content: string): string {
  const fenceMatch = content.match(/```(?:json)?\s*([\s\S]*?)```/);
  return fenceMatch ? fenceMatch[1].trim() : content.trim();
}

/**
 * Normaliza um valor numérico (aceita string ou number)
 */
function normalizeNumber(value: unknown, defaultValue = 0): number {
  if (typeof value === 'number' && !isNaN(value)) {
    return value;
  }
  if (typeof value === 'string') {
    const parsed = parseFloat(value.replace(',', '.'));
    return isNaN(parsed) ? defaultValue : parsed;
  }
  return defaultValue;
}

/**
 * Normaliza string (garantindo não-vazio)
 */
function normalizeString(value: unknown, defaultValue = ''): string {
  if (typeof value === 'string' && value.trim()) {
    return value.trim();
  }
  return defaultValue;
}

/**
 * Valida e normaliza prioridade
 */
function normalizePriority(value: unknown): 'A' | 'B' | 'C' {
  const str = normalizeString(value, 'B').toUpperCase();
  if (str === 'A' || str === 'B' || str === 'C') {
    return str as 'A' | 'B' | 'C';
  }
  return 'B';
}

/**
 * Converte item bruto da LLM para o formato esperado pelo banco
 */
export function normalizeItem(raw: RawLlmItem): Partial<Item> | null {
  const nome = normalizeString(raw.nome_item);
  if (!nome) {
    console.warn('[itemAdapter] Item sem nome, ignorando:', raw);
    return null;
  }

  const normalized: Partial<Item> = {
    nome_item: nome,
    quantidade: normalizeNumber(raw.quantidade, 1),
    unidade: normalizeString(raw.unidade, 'un'),
    valor_estimado: normalizeNumber(raw.valor_estimado, 0),
    categoria: normalizeString(raw.categoria, 'geral'),
    prioridade: normalizePriority(raw.prioridade),
  };

  console.debug('[itemAdapter] Normalizado:', { raw, normalized });
  return normalized;
}

/**
 * Processa resposta da LLM e retorna array de itens normalizados
 */
export function parseLlmItemsResponse(content: string): Partial<Item>[] {
  try {
    // Remove code fences se existirem
    const cleaned = stripCodeFence(content);
    
    // Parse JSON
    const parsed = JSON.parse(cleaned);
    
    // Garante que é array
    const rawItems: RawLlmItem[] = Array.isArray(parsed) ? parsed : [parsed];
    
    console.debug('[itemAdapter] Raw items:', rawItems.length);
    
    // Normaliza e filtra nulos
    const normalized = rawItems
      .map(normalizeItem)
      .filter((item): item is Partial<Item> => item !== null);
    
    console.debug('[itemAdapter] Normalized items:', normalized.length);
    
    if (normalized.length === 0) {
      throw new Error('Nenhum item válido após normalização');
    }
    
    return normalized;
  } catch (error) {
    console.error('[itemAdapter] Erro ao processar resposta LLM:', error);
    throw new Error(`Falha ao processar itens da LLM: ${error instanceof Error ? error.message : 'erro desconhecido'}`);
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\personality.ts
============================================================
/**
 * Personalidade e Tom de Voz do UNE.AI
 * 
 * Identidade: Parceiro de conversa confiável, empático e eficiente
 * Tom: Natural, acolhedor e direto, com leveza na comunicação
 */

export const PERSONALITY = {
  name: 'UNE.AI',
  
  traits: {
    warmth: 0.8,      // Acolhedor mas não exagerado
    formality: 0.3,   // Casual mas respeitoso
    enthusiasm: 0.7,  // Animado mas não hiperativo
    directness: 0.8,  // Objetivo e claro
    empathy: 0.9,     // Atento às necessidades do usuário
  },
  
  voice: {
    vocabulary: 'simples, cotidiano, sem jargões',
    sentence_style: 'curtas, objetivas, ritmo natural',
    punctuation: 'leve, com pausas naturais',
    expressions: ['ótimo', 'perfeito', 'vamos lá', 'show', 'combinado'],
  },
  
  behavior: {
    greeting: 'amigável e direto',
    collecting_info: 'colaborativo e encorajador',
    confirming: 'positivo e claro',
    error_handling: 'empático e propositivo',
    closing: 'leve e simpático',
  },
};

/**
 * Gera o system prompt base que define a personalidade do UNE.AI
 */
export function getPersonalitySystemPrompt(): string {
  return `Você é o UNE.AI, um assistente especializado em planejamento de eventos.

**Sua Personalidade:**
- Você é acolhedor, natural e direto na comunicação
- Usa linguagem simples e cotidiana, sem jargões técnicos
- Mantém frases curtas e objetivas, com ritmo de conversa natural
- É empático e atento às necessidades do usuário
- Demonstra entusiasmo equilibrado (nem frio, nem exagerado)

**Seu Tom de Voz:**
- Casual mas respeitoso
- Usa expressões naturais como "ótimo", "perfeito", "vamos lá"
- Evita ser formal demais ou usar linguagem robótica
- Mantém coerência emocional conforme o contexto da conversa

**Como Você se Comporta:**
- Ao cumprimentar: seja amigável e vá direto ao ponto
- Ao coletar informações: seja colaborativo e encorajador
- Ao confirmar: seja positivo e claro
- Ao lidar com erros: seja empático e proponha soluções
- Ao encerrar: seja leve e simpático

**Regras Importantes:**
- Seja objetivo: não divague nem dê respostas longas demais
- Seja presente: demonstre que está prestando atenção
- Seja humano: não soe como um robô ou sistema automatizado
- Seja consistente: mantenha o mesmo tom em toda a conversa

Lembre-se: você é um parceiro de conversa confiável, não apenas um sistema.`;
}

/**
 * Ajusta o tom da mensagem conforme o estado da conversa
 */
export function adjustToneForState(state: string): string {
  const toneGuidance: Record<string, string> = {
    'idle': 'Seja acolhedor e convide o usuário a começar.',
    'collecting_core': 'Seja colaborativo e encorajador, guiando o usuário passo a passo.',
    'itens_pendentes_confirmacao': 'Seja positivo e claro, mostrando confiança no que foi criado.',
    'finalizado': 'Seja celebrativo mas discreto, reconhecendo o trabalho realizado.',
    'out_of_domain': 'Seja empático mas firme, redirecionando gentilmente.',
  };

  return toneGuidance[state] || 'Mantenha seu tom natural e empático.';
}

/**
 * Valida se uma mensagem está alinhada com a personalidade
 */
export function validatePersonality(message: string): {
  isValid: boolean;
  issues: string[];
} {
  const issues: string[] = [];

  // Verificar se é muito formal
  const formalWords = ['prezado', 'cordialmente', 'solicito', 'informo-lhe'];
  if (formalWords.some(word => message.toLowerCase().includes(word))) {
    issues.push('Mensagem muito formal');
  }

  // Verificar se é muito longa (>200 caracteres é um sinal)
  if (message.length > 300) {
    issues.push('Mensagem muito longa');
  }

  // Verificar se tem jargões técnicos desnecessários
  const jargon = ['implementar', 'executar', 'processar', 'otimizar'];
  if (jargon.some(word => message.toLowerCase().includes(word))) {
    issues.push('Contém jargões técnicos');
  }

  return {
    isValid: issues.length === 0,
    issues,
  };
}


============================================================
FILE PATH: .\src\core\orchestrator\proactiveActions.ts
============================================================
import type { SituationalInsight } from './situationalAnalyzer';
import type { Event } from '@/types/domain';

/**
 * Ação proativa sugerida pelo sistema
 */
export interface ProactiveAction {
  type: 'suggestion' | 'reminder' | 'automation' | 'clarification';
  message: string;
  actionLabel?: string;
  autoExecute: boolean;
  context?: Record<string, unknown>;
}

/**
 * Gerenciador de ações proativas - gera sugestões, lembretes e automações
 */
export class ProactiveActionsManager {
  /**
   * Gera ação proativa baseada em insight situacional
   */
  generateProactiveAction(insight: SituationalInsight): ProactiveAction {
    switch (insight.type) {
      case 'incomplete_event':
        return this.createSuggestionAction(insight);
      
      case 'approaching_event':
        return this.createReminderAction(insight);
      
      case 'ready_for_next_step':
        return this.createNextStepAction(insight);
      
      case 'stale_conversation':
        return this.createReengagementAction(insight);
      
      case 'missing_critical_info':
        return this.createClarificationAction(insight);
      
      default:
        return {
          type: 'suggestion',
          message: insight.message,
          autoExecute: false
        };
    }
  }

  /**
   * Cria ação de sugestão
   */
  private createSuggestionAction(insight: SituationalInsight): ProactiveAction {
    return {
      type: 'suggestion',
      message: `${insight.message} ${insight.suggestedAction || ''}`,
      actionLabel: 'Continuar',
      autoExecute: false,
      context: insight.context
    };
  }

  /**
   * Cria ação de lembrete
   */
  private createReminderAction(insight: SituationalInsight): ProactiveAction {
    return {
      type: 'reminder',
      message: insight.message,
      actionLabel: insight.suggestedAction,
      autoExecute: false,
      context: insight.context
    };
  }

  /**
   * Cria ação para próximo passo
   */
  private createNextStepAction(insight: SituationalInsight): ProactiveAction {
    const nextStep = insight.context?.nextStep as string;
    const autoExecute = nextStep === 'generate_items'; // Gerar itens pode ser automático

    return {
      type: 'suggestion',
      message: insight.message,
      actionLabel: insight.suggestedAction,
      autoExecute,
      context: insight.context
    };
  }

  /**
   * Cria ação de reengajamento
   */
  private createReengagementAction(insight: SituationalInsight): ProactiveAction {
    return {
      type: 'suggestion',
      message: insight.message,
      actionLabel: 'Sim, vamos continuar!',
      autoExecute: false,
      context: insight.context
    };
  }

  /**
   * Cria ação de clarificação
   */
  private createClarificationAction(insight: SituationalInsight): ProactiveAction {
    return {
      type: 'clarification',
      message: insight.message,
      actionLabel: 'Responder',
      autoExecute: false,
      context: insight.context
    };
  }

  /**
   * Gera automações complementares baseadas no estado do evento
   */
  generateComplementaryAutomations(event: Event): ProactiveAction[] {
    const automations: ProactiveAction[] = [];

    // Se confirmou itens, sugerir adicionar participantes
    if (event.status === 'distrib_pendente_confirmacao') {
      automations.push({
        type: 'automation',
        message: 'Show! Lista confirmada. Agora vamos pros participantes?',
        actionLabel: 'Adicionar participantes',
        autoExecute: false,
        context: { action: 'add_participants' }
      });
    }

    // Se finalizou, oferecer resumo
    if (event.status === 'finalizado') {
      automations.push({
        type: 'automation',
        message: 'Prontinho! Seu evento tá todo organizado. Quer um resumo completo?',
        actionLabel: 'Ver resumo',
        autoExecute: false,
        context: { action: 'show_summary' }
      });
    }

    return automations;
  }

  /**
   * Gera lembrete contextual baseado no tempo
   */
  generateTimeBasedReminder(event: Event, daysUntil: number): ProactiveAction | null {
    if (daysUntil === 1) {
      return {
        type: 'reminder',
        message: '⏰ Ei! Seu evento é amanhã. Tá tudo confirmado?',
        actionLabel: 'Revisar evento',
        autoExecute: false,
        context: { eventId: event.id, daysUntil }
      };
    }

    if (daysUntil === 0) {
      return {
        type: 'reminder',
        message: '🎉 Hoje é o dia! Boa sorte com o evento!',
        autoExecute: false,
        context: { eventId: event.id, daysUntil }
      };
    }

    return null;
  }

  /**
   * Formata mensagem proativa com tom empático e natural
   */
  formatProactiveMessage(action: ProactiveAction): string {
    const emojis: Record<string, string> = {
      suggestion: '💡',
      reminder: '⏰',
      automation: '✨',
      clarification: '🤔'
    };

    const emoji = emojis[action.type] || '';
    let formattedMessage = action.message;

    // Adicionar emoji se não tiver
    if (emoji && !formattedMessage.includes(emoji)) {
      formattedMessage = `${emoji} ${formattedMessage}`;
    }

    // ❌ REMOVIDO: Não adicionar actionLabel no texto, ele será renderizado como botão
    // O actionLabel é passado via suggestedReplies no ChatWidget

    return formattedMessage;
  }

  /**
   * Determina se a ação deve ser executada automaticamente
   */
  shouldAutoExecute(action: ProactiveAction, userPreferences?: Record<string, unknown>): boolean {
    // Por padrão, respeitar o flag autoExecute
    if (!action.autoExecute) return false;

    // Verificar preferências do usuário (se implementado)
    if (userPreferences?.disableAutoActions === true) {
      return false;
    }

    // Apenas automações simples e seguras
    const safeAutomations = ['generate_items', 'show_summary'];
    const actionType = action.context?.action as string;
    
    return safeAutomations.includes(actionType);
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\simpleOrchestrator.ts
============================================================
﻿/**
 * Orquestrador Simplificado usando Groq
 * Versão final: Prioridade IA, Regex Passivo e Persistência de Contexto
 */

import { UUID, EventStatus, ChatUiPayload } from '@/types/domain';
// import { ChatUiPayload } from './chatOrchestrator'; // Removed
import { processMessage } from '@/services/groqService';
import { ContextManager } from './contextManager';
import { getPlanSnapshot } from './eventManager';
import { wrapWithConversationalTone, ActionType } from './conversationalResponse';

type CollectedData = Record<string, unknown>;

export async function simpleOrchestrate(
  userText: string,
  userId: UUID,
  eventoId?: UUID
): Promise<ChatUiPayload> {
  // SANITIZAÇÃO: Garantir que string 'null' ou 'undefined' vira undefined
  if (eventoId === 'null' as any || eventoId === 'undefined' as any) {
    eventoId = undefined;
  }

  const contextManager = new ContextManager();

  // 1. Carregar contexto e histórico
  const { context: savedContext, history } = await contextManager.loadUserContext(userId);

  // 2. Extração Passiva (Regex apenas para Qtd e Data)
  const extracted = extractCollectedData(userText);
  const mergedCollected = {
    ...(savedContext.collected_data || {}),
    ...extracted,
  } as CollectedData;

  // 3. Processar mensagem com Groq (A IA decide o tipo do evento)
  // 🔥 NOVO: Se o eventoId foi explicitamente passado (undefined ou valor), usa ele
  // Se foi passado undefined e não tem histórico, ignora o salvo
  const currentEventId = eventoId !== undefined 
    ? (eventoId || null) 
    : (savedContext.evento_id && history.length > 0 ? savedContext.evento_id : null);
  const result = await processMessage(userText, history, userId, {
    collectedData: mergedCollected,
    evento: currentEventId ? {
      id: String(currentEventId),
      status: savedContext.state
    } : undefined
  });

  // 4. Identificar o ID do evento (novo ou existente)
  // Prioridade: ID novo criado > ID vindo da UI > ID salvo no contexto do banco
  let finalEventoId = result.actionExecuted?.eventoId || eventoId || savedContext.evento_id;

  // SANITIZAÇÃO DE SAÍDA:
  if (finalEventoId === 'null' as any || finalEventoId === 'undefined' as any) {
    finalEventoId = undefined;
  }

  // 5. Salvar Mensagens
  await contextManager.saveMessage(userId, 'user', userText, finalEventoId ? Number(finalEventoId) : undefined);
  await contextManager.saveMessage(userId, 'assistant', result.response, finalEventoId ? Number(finalEventoId) : undefined);

  // 6. Persistência de Contexto Inteligente
  // Se a IA extraiu dados (extractedData) mas o evento ainda não existir, salve-os no contextManager para a próxima mensagem.
  if (result.actionExecuted?.extractedData) {
    await contextManager.updateContext(
      userId,
      savedContext.state || 'collecting_core',
      { ...mergedCollected, ...result.actionExecuted.extractedData },
      [], 0.9, undefined, finalEventoId ? Number(finalEventoId) : undefined
    );
  }

  // 7. Carregar Snapshot para a UI
  let snapshot = null;
  if (finalEventoId) {
    try {
      snapshot = await getPlanSnapshot(String(finalEventoId));
      if (!snapshot) throw new Error('Snapshot nulo');
    } catch (error) {
      console.warn('Erro ao carregar snapshot (provavel ID órfão), limpando contexto...');
      await contextManager.updateContext(userId, 'idle', {}, [], 0.5, undefined, undefined);
      // Forçar refresh para o usuário
      return {
        estado: 'collecting_core',
        mensagem: 'Ocorreu um erro de sincronia. Por favor, tente novamente.',
        evento_id: null,
        showItems: false
      };
    }
  }

  // 8. Lógica de exibição da UI
  // Exibe itens se eles existirem, exceto para eventos finalizados
  let showItems = !!(snapshot?.itens && snapshot.itens.length > 0);
  if (snapshot?.evento?.status === 'finalizado') {
    showItems = false;
  }

  // 9. Construir Payload completo para não quebrar o ChatWidget
  const response: ChatUiPayload = {
    estado: (snapshot?.evento?.status || 'collecting_core') as EventStatus,
    evento_id: (finalEventoId && String(finalEventoId) !== 'null') ? String(finalEventoId) : null, // Garante NULL real
    mensagem: result.response,
    snapshot: snapshot || undefined,
    showItems: showItems,
    suggestedReplies: getSuggestedReplies(snapshot, result.response),
  };

  // 10. Finalização
  if (snapshot?.evento?.status === 'finalizado') {
    response.closeChat = true;
    response.toast = 'Evento criado com sucesso!';
  }

  // 11. Camada Conversacional Humana
  let detectedAction: ActionType | undefined;
  if (snapshot?.evento?.status === 'finalizado') detectedAction = 'event_finalized';
  else if (snapshot?.evento?.status === 'itens_pendentes_confirmacao' && showItems) detectedAction = 'items_generated';

  if (detectedAction) {
    return wrapWithConversationalTone(response, {
      action: detectedAction,
      context: {
        eventType: snapshot?.evento?.tipo_evento,
        peopleCount: snapshot?.evento?.qtd_pessoas,
        hasItems: showItems,
        hasDate: !!snapshot?.evento?.data_evento,
      }
    });
  }

  return response;
}

// Extração passiva: Não tenta adivinhar o tipo do evento
function extractCollectedData(userText: string): CollectedData {
  const text = userText.toLowerCase();
  const collected: CollectedData = {};

  // Apenas Qtd e Data via Regex (auxiliar)
  const qtd = extractPeopleCount(text);
  if (qtd) collected.qtd_pessoas = qtd;

  return collected;
}

function extractPeopleCount(text: string): number | undefined {
  const matches = text.match(/(\d+)\s*(pessoas|convidados|gente)/);
  if (matches) return Number(matches[1]);
  return undefined;
}

function getSuggestedReplies(snapshot: any, aiResponse: string): string[] | undefined {
  if (!snapshot?.evento) return ['Jantar para 10', 'Churrasco para 15', 'Festa para 20'];

  const status = snapshot.evento.status;
  if (status === 'itens_pendentes_confirmacao') return ['Confirmar lista', 'Editar itens'];
  if (status === 'aguardando_preferencia_menu') return ['Italiano', 'Churrasco', 'Japonês', 'Você escolhe'];

  return ['Entendido', 'Obrigado'];
}


============================================================
FILE PATH: .\src\core\orchestrator\situationalAnalyzer.ts
============================================================
import type { Event } from '@/types/domain';
import type { ConversationContext } from '@/db/repositories/conversationContexts';

/**
 * Situação detectada pelo analisador situacional
 */
export interface SituationalInsight {
  type: 'incomplete_event' | 'approaching_event' | 'stale_conversation' | 'missing_critical_info' | 'ready_for_next_step';
  priority: 'high' | 'medium' | 'low';
  message: string;
  suggestedAction?: string;
  context?: Record<string, unknown>;
}

/**
 * Analisador situacional - detecta estados, padrões e oportunidades de ação proativa
 */
export class SituationalAnalyzer {
  /**
   * Analisa a situação atual e retorna insights acionáveis
   */
  analyzeContext(
    event: Event | null,
    context: ConversationContext | null,
    hasItems: boolean,
    hasParticipants: boolean,
    lastInteractionTimestamp?: number
  ): SituationalInsight[] {
    const insights: SituationalInsight[] = [];

    // Detectar evento incompleto
    if (event) {
      const missingInfo = this.detectMissingInfo(event, hasItems, hasParticipants);
      if (missingInfo.length > 0) {
        insights.push({
          type: 'incomplete_event',
          priority: 'high',
          message: this.generateIncompletionMessage(missingInfo),
          suggestedAction: this.suggestNextStep(missingInfo[0]),
          context: { missingFields: missingInfo }
        });
      }

      // Detectar evento próximo
      const daysUntilEvent = this.getDaysUntilEvent(event.data_evento);
      if (daysUntilEvent !== null && daysUntilEvent <= 3 && daysUntilEvent >= 0) {
        insights.push({
          type: 'approaching_event',
          priority: daysUntilEvent <= 1 ? 'high' : 'medium',
          message: this.generateApproachingEventMessage(daysUntilEvent),
          suggestedAction: 'Quer revisar os detalhes finais?',
          context: { daysUntilEvent }
        });
      }
    }

    // Detectar conversa inativa
    if (lastInteractionTimestamp) {
      const hoursSinceLastInteraction = (Date.now() - lastInteractionTimestamp) / (1000 * 60 * 60);
      if (hoursSinceLastInteraction > 24 && event && event.status !== 'finalizado') {
        insights.push({
          type: 'stale_conversation',
          priority: 'low',
          message: 'Percebi que faz um tempo que não conversamos! Quer retomar o planejamento?',
          context: { hoursSinceLastInteraction }
        });
      }
    }

    // Detectar prontidão para próximo passo
    if (event && context) {
      const readyForNext = this.detectReadyForNextStep(event, context, hasItems, hasParticipants);
      if (readyForNext) {
        insights.push(readyForNext);
      }
    }

    return insights;
  }

  /**
   * Detecta informações faltantes no evento
   */
  private detectMissingInfo(event: Event, hasItems: boolean, hasParticipants: boolean): string[] {
    const missing: string[] = [];

    if (!event.data_evento || event.data_evento === '') {
      missing.push('data');
    }
    if (!event.tipo_evento || event.tipo_evento === '') {
      missing.push('tipo');
    }
    if (!event.qtd_pessoas || event.qtd_pessoas === 0) {
      missing.push('quantidade_pessoas');
    }
    // ❌ REMOVIDO: não considerar status como campo faltante
    // Status é gerenciado internamente, não é um "dado básico" que o usuário fornece
    if (!hasItems && event.status !== 'collecting_core') {
      missing.push('itens');
    }
    if (!hasParticipants && event.status === 'distrib_pendente_confirmacao') {
      missing.push('participantes');
    }

    return missing;
  }

  /**
   * Gera mensagem sobre evento incompleto
   */
  private generateIncompletionMessage(missingInfo: string[]): string {
    const messages: Record<string, string> = {
      data: 'Informe, por favor, a data do evento.',
      tipo: 'Falta definir o tipo de evento.',
      quantidade_pessoas: 'Quantas pessoas vão participar?',
      dados_basicos: 'Vamos completar as informações básicas do evento?',
      itens: 'Que tal definirmos a lista de itens agora?',
      participantes: 'Podemos adicionar os participantes?'
    };

    const firstMissing = missingInfo[0];
    return messages[firstMissing] || 'Há alguns detalhes pendentes no planejamento.';
  }

  /**
   * Sugere próximo passo baseado na informação faltante
   */
  private suggestNextStep(missingField: string): string {
    const suggestions: Record<string, string> = {
      data: 'Me passa a data do evento?',
      tipo: 'Que tipo de evento você quer fazer?',
      quantidade_pessoas: 'Me conta quantas pessoas você espera?',
      dados_basicos: 'Vamos começar pelos dados básicos?',
      itens: 'Posso gerar uma lista de itens pra você?',
      participantes: 'Quer adicionar os participantes agora?'
    };

    return suggestions[missingField] || 'Podemos continuar o planejamento?';
  }

  /**
   * Calcula dias até o evento
   */
  private getDaysUntilEvent(dataEvento: string): number | null {
    if (!dataEvento) return null;
    
    try {
      const eventDate = new Date(dataEvento);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      eventDate.setHours(0, 0, 0, 0);
      
      const diffTime = eventDate.getTime() - today.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      return diffDays;
    } catch {
      return null;
    }
  }

  /**
   * Gera mensagem sobre evento próximo
   */
  private generateApproachingEventMessage(daysUntil: number): string {
    if (daysUntil === 0) {
      return 'Seu evento é hoje! 🎉 Tá tudo certo?';
    } else if (daysUntil === 1) {
      return 'Seu evento é amanhã! Vamos dar uma revisada nos detalhes?';
    } else if (daysUntil === 2) {
      return 'Faltam só 2 dias pro evento! Quer confirmar se está tudo ok?';
    } else {
      return `Faltam ${daysUntil} dias pro evento. Tá tudo encaminhado?`;
    }
  }

  /**
   * Detecta se está pronto para o próximo passo
   */
  private detectReadyForNextStep(
    event: Event,
    context: ConversationContext,
    hasItems: boolean,
    hasParticipants: boolean
  ): SituationalInsight | null {
    // Se tem dados básicos completos mas não tem itens
    if (
      event.status === 'collecting_core' &&
      event.data_evento &&
      event.tipo_evento &&
      event.qtd_pessoas > 0 &&
      !hasItems
    ) {
      return {
        type: 'ready_for_next_step',
        priority: 'medium',
        message: 'Legal! Agora que temos as informações básicas, posso gerar a lista de itens pra você.',
        suggestedAction: 'Quer que eu monte a lista?',
        context: { nextStep: 'generate_items' }
      };
    }

    // Se tem itens mas não confirmou
    if (
      event.status === 'itens_pendentes_confirmacao' &&
      hasItems &&
      context.state === 'awaiting_items_confirmation'
    ) {
      return {
        type: 'ready_for_next_step',
        priority: 'medium',
        message: 'A lista tá pronta! Dá uma olhada e me diz se precisa mudar algo.',
        suggestedAction: 'Tá bom assim ou quer ajustar?',
        context: { nextStep: 'confirm_items' }
      };
    }

    // Se confirmou itens mas não tem participantes
    if (
      event.status === 'distrib_pendente_confirmacao' &&
      hasItems &&
      !hasParticipants
    ) {
      return {
        type: 'ready_for_next_step',
        priority: 'high',
        message: 'Perfeito! Agora vamos adicionar os participantes pra dividir os itens.',
        suggestedAction: 'Me passa os nomes das pessoas?',
        context: { nextStep: 'add_participants' }
      };
    }

    return null;
  }

  /**
   * Prioriza insights por relevância
   */
  prioritizeInsights(insights: SituationalInsight[]): SituationalInsight[] {
    const priorityOrder = { high: 0, medium: 1, low: 2 };
    return insights.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
  }

  /**
   * Determina se deve mostrar sugestão proativa agora
   */
  shouldShowProactiveSuggestion(
    insights: SituationalInsight[],
    lastProactiveMessageTimestamp?: number
  ): boolean {
    if (insights.length === 0) return false;

    // Não mostrar proativas com muita frequência
    if (lastProactiveMessageTimestamp) {
      const hoursSinceLast = (Date.now() - lastProactiveMessageTimestamp) / (1000 * 60 * 60);
      if (hoursSinceLast < 2) return false; // Esperar ao menos 2 horas
    }

    // Mostrar se houver insights de alta prioridade
    const hasHighPriority = insights.some(i => i.priority === 'high');
    return hasHighPriority;
  }
}


============================================================
FILE PATH: .\src\core\orchestrator\systemResponses.ts
============================================================
export const systemResponses = {
  plannerInvalid: 'Nao consegui interpretar sua mensagem. Pode reformular?',
  unknownIntent: 'Nao consegui entender o que voce precisa. Pode explicar melhor?',
  smallTalk: 'Posso te ajudar a organizar um evento. Me diga o tipo e a quantidade de pessoas.',
};


============================================================
FILE PATH: .\src\data\templates.ts
============================================================
export interface EventTemplate {
    slug: string;
    title: string;
    description: string;
    defaultItems?: {
        name: string;
        quantity: number;
        unit: string;
        category: string;
    }[];
}

export const templates: EventTemplate[] = [
    {
        slug: "churrasco",
        title: "Churrasco de Amigos",
        description: "Churrasco completo com carnes, bebidas e acompanhamentos para curtir com a galera.",
        defaultItems: [
            { name: "Picanha", quantity: 2, unit: "kg", category: "comida" },
            { name: "Linguiça", quantity: 1, unit: "kg", category: "comida" },
            { name: "Pão de Alho", quantity: 5, unit: "pct", category: "comida" },
            { name: "Carvão", quantity: 1, unit: "sc", category: "geral" },
            { name: "Cerveja", quantity: 24, unit: "lata", category: "bebida" },
            { name: "Refrigerante", quantity: 3, unit: "gf", category: "bebida" },
        ]
    },
    {
        slug: "jantar",
        title: "Jantar em Família",
        description: "Um jantar especial para reunir a família com pratos deliciosos.",
        defaultItems: [
            { name: "Prato Principal", quantity: 1, unit: "un", category: "comida" },
            { name: "Acompanhamento", quantity: 2, unit: "un", category: "comida" },
            { name: "Sobremesa", quantity: 1, unit: "un", category: "comida" },
            { name: "Vinho", quantity: 2, unit: "gf", category: "bebida" },
            { name: "Suco", quantity: 2, unit: "gf", category: "bebida" },
        ]
    },
    {
        slug: "aniversario",
        title: "Aniversário Simples",
        description: "Comemoração de aniversário sem estresse, com bolo e salgadinhos.",
        defaultItems: [
            { name: "Bolo", quantity: 1, unit: "un", category: "comida" },
            { name: "Salgadinhos", quantity: 100, unit: "un", category: "comida" },
            { name: "Docinhos", quantity: 50, unit: "un", category: "comida" },
            { name: "Refrigerante", quantity: 5, unit: "gf", category: "bebida" },
            { name: "Descartáveis", quantity: 1, unit: "kit", category: "geral" },
        ]
    },
    {
        slug: "reuniao",
        title: "Reunião de Equipe",
        description: "Coffee break produtivo para reuniões de trabalho.",
        defaultItems: [
            { name: "Café", quantity: 2, unit: "gf", category: "bebida" },
            { name: "Água", quantity: 5, unit: "gf", category: "bebida" },
            { name: "Biscoitos", quantity: 3, unit: "pct", category: "comida" },
            { name: "Pão de Queijo", quantity: 1, unit: "kg", category: "comida" },
        ]
    }
];


============================================================
FILE PATH: .\src\db\schema.ts
============================================================
export const TBL = {
  EVENTOS: 'eventos',
  ITENS: 'itens_evento',
  PARTICIPANTES: 'participantes_evento',
  DIST: 'distribuicao_itens',
  PREFS: 'preferencias_usuario',
} as const;

export type TableName = typeof TBL[keyof typeof TBL];

============================================================
FILE PATH: .\src\db\repositories\conversationAnalytics.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { UUID } from '@/types/domain';

export interface ConversationAnalytic {
  id: string;
  user_id: UUID;
  evento_id?: number;
  message_id?: string;
  intent: string;
  confidence_level: number;
  response_type?: 'template' | 'llm' | 'hybrid';
  user_corrected: boolean;
  user_confused: boolean;
  clarification_needed: boolean;
  response_time_ms?: number;
  tokens_used?: number;
  metadata?: Record<string, unknown>;
  created_at: string;
}

export interface ConversationMetric {
  user_id: UUID;
  date: string;
  total_interactions: number;
  avg_confidence: number;
  correction_count: number;
  clarification_count: number;
  avg_response_time_ms: number;
  unique_intents: number;
  events_touched: number;
}

export class ConversationAnalyticsRepository {
  /**
   * Registra uma nova interação para analytics
   */
  async logInteraction(
    userId: UUID,
    intent: string,
    confidenceLevel: number,
    responseType: 'template' | 'llm' | 'hybrid',
    options: {
      eventoId?: number;
      messageId?: string;
      userCorrected?: boolean;
      userConfused?: boolean;
      clarificationNeeded?: boolean;
      responseTimeMs?: number;
      tokensUsed?: number;
      metadata?: Record<string, unknown>;
    } = {}
  ): Promise<ConversationAnalytic | null> {
    const startTime = Date.now();

    const { data, error } = await supabase
      .from('conversation_analytics')
      .insert([{
        user_id: userId,
        evento_id: options.eventoId,
        message_id: options.messageId,
        intent,
        confidence_level: confidenceLevel,
        response_type: responseType,
        user_corrected: options.userCorrected || false,
        user_confused: options.userConfused || false,
        clarification_needed: options.clarificationNeeded || false,
        response_time_ms: options.responseTimeMs || (Date.now() - startTime),
        tokens_used: options.tokensUsed,
        metadata: options.metadata as any || {},
      }])
      .select()
      .single();

    if (error) {
      console.error('[Analytics] Erro ao registrar interação:', error);
      return null;
    }

    return data ? {
      ...data,
      metadata: data.metadata as Record<string, unknown>,
    } as ConversationAnalytic : null;
  }

  /**
   * Marca uma interação como tendo sido corrigida pelo usuário
   */
  async markAsCorrected(analyticId: string): Promise<boolean> {
    const { error } = await supabase
      .from('conversation_analytics')
      .update({ user_corrected: true })
      .eq('id', analyticId);

    if (error) {
      console.error('[Analytics] Erro ao marcar correção:', error);
      return false;
    }

    return true;
  }

  /**
   * Marca uma interação como tendo gerado confusão
   */
  async markAsConfused(analyticId: string): Promise<boolean> {
    const { error } = await supabase
      .from('conversation_analytics')
      .update({ user_confused: true })
      .eq('id', analyticId);

    if (error) {
      console.error('[Analytics] Erro ao marcar confusão:', error);
      return false;
    }

    return true;
  }

  /**
   * Busca métricas agregadas do usuário
   */
  async getMetrics(userId: UUID, days = 30): Promise<ConversationMetric[]> {
    const { data, error } = await supabase
      .from('conversation_metrics')
      .select('*')
      .eq('user_id', userId)
      .gte('date', new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString())
      .order('date', { ascending: false });

    if (error) {
      console.error('[Analytics] Erro ao buscar métricas:', error);
      return [];
    }

    return data || [];
  }

  /**
   * Busca interações com baixa confiança para análise
   */
  async getLowConfidenceInteractions(
    userId: UUID,
    threshold = 0.6,
    limit = 50
  ): Promise<ConversationAnalytic[]> {
    const { data, error } = await supabase
      .from('conversation_analytics')
      .select('*')
      .eq('user_id', userId)
      .lte('confidence_level', threshold)
      .order('created_at', { ascending: false })
      .limit(limit);

    if (error) {
      console.error('[Analytics] Erro ao buscar interações de baixa confiança:', error);
      return [];
    }

    return (data || []).map(d => ({
      ...d,
      metadata: d.metadata as Record<string, unknown>,
    })) as ConversationAnalytic[];
  }

  /**
   * Busca padrões de erro frequentes
   */
  async getFrequentErrors(userId: UUID, days = 30): Promise<{
    intent: string;
    error_count: number;
    avg_confidence: number;
  }[]> {
    const { data, error } = await supabase
      .from('conversation_analytics')
      .select('intent, user_corrected, user_confused, confidence_level')
      .eq('user_id', userId)
      .gte('created_at', new Date(Date.now() - days * 24 * 60 * 60 * 1000).toISOString());

    if (error) {
      console.error('[Analytics] Erro ao buscar erros frequentes:', error);
      return [];
    }

    // Agregar manualmente no cliente
    const grouped = (data || []).reduce((acc, row) => {
      if (row.user_corrected || row.user_confused) {
        if (!acc[row.intent]) {
          acc[row.intent] = { count: 0, totalConfidence: 0, items: 0 };
        }
        acc[row.intent].count++;
        acc[row.intent].totalConfidence += row.confidence_level;
        acc[row.intent].items++;
      }
      return acc;
    }, {} as Record<string, { count: number; totalConfidence: number; items: number }>);

    return Object.entries(grouped).map(([intent, stats]) => ({
      intent,
      error_count: stats.count,
      avg_confidence: stats.totalConfidence / stats.items,
    })).sort((a, b) => b.error_count - a.error_count);
  }
}


============================================================
FILE PATH: .\src\db\repositories\conversationContexts.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { UUID } from '@/types/domain';

export interface ConversationContext {
  id: string;
  user_id: UUID;
  state: string;
  evento_id?: number;
  collected_data: Record<string, unknown>;
  missing_slots: string[];
  confidence_level: number;
  last_intent?: string;
  summary?: string;
  historyLength?: number;
  created_at: string;
  updated_at: string;
}

export class ConversationContextsRepository {
  /**
   * Busca o contexto conversacional do usuário
   */
  async getByUserId(userId: UUID): Promise<ConversationContext | null> {
    const { data, error } = await supabase
      .from('conversation_contexts')
      .select('*')
      .eq('user_id', userId)
      .single();

    if (error) {
      if (error.code === 'PGRST116') {
        // Nenhum registro encontrado, retornar null
        return null;
      }
      console.error('[ConversationContexts] Erro ao buscar contexto:', error);
      return null;
    }

    return data ? {
      ...data,
      collected_data: data.collected_data as Record<string, unknown>,
    } as ConversationContext : null;
  }

  /**
   * Cria ou atualiza o contexto conversacional do usuário
   */
  async upsert(
    userId: UUID,
    state: string,
    collectedData: Record<string, unknown>,
    missingSlots: string[],
    confidenceLevel: number,
    lastIntent?: string,
    eventoId?: number,
    summary?: string
  ): Promise<ConversationContext | null> {
    const { data, error } = await supabase
      .from('conversation_contexts')
      .upsert(
        {
          user_id: userId,
          state,
          evento_id: eventoId,
          collected_data: collectedData as any,
          missing_slots: missingSlots,
          confidence_level: confidenceLevel,
          last_intent: lastIntent,
          summary,
          updated_at: new Date().toISOString(),
        },
        {
          onConflict: 'user_id',
        }
      )
      .select()
      .single();

    if (error) {
      console.error('[ConversationContexts] Erro ao upsert contexto:', error);
      return null;
    }

    return data ? {
      ...data,
      collected_data: data.collected_data as Record<string, unknown>,
    } as ConversationContext : null;
  }

  /**
   * Remove o contexto conversacional do usuário
   */
  async delete(userId: UUID): Promise<boolean> {
    const { error } = await supabase
      .from('conversation_contexts')
      .delete()
      .eq('user_id', userId);

    if (error) {
      console.error('[ConversationContexts] Erro ao deletar contexto:', error);
      return false;
    }

    return true;
  }

  /**
   * Cria um contexto inicial vazio
   */
  async createInitial(userId: UUID): Promise<ConversationContext | null> {
    return this.upsert(userId, 'idle', {}, [], 0.5);
  }
}


============================================================
FILE PATH: .\src\db\repositories\conversationMessages.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { UUID } from '@/types/domain';
import { LlmMessage } from '@/types/llm';

export interface ConversationMessage {
  id: string;
  user_id: UUID;
  evento_id?: number;
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp: string;
  metadata?: Record<string, unknown>;
}

export class ConversationMessagesRepository {
  /**
   * Busca histórico de mensagens do usuário, ordenadas por timestamp (mais antigas primeiro)
   */
  async getByUserId(userId: UUID, limit = 50): Promise<ConversationMessage[]> {
    const { data, error } = await supabase
      .from('conversation_messages')
      .select('*')
      .eq('user_id', userId)
      .order('timestamp', { ascending: true })
      .limit(limit);

    if (error) {
      console.error('[ConversationMessages] Erro ao buscar mensagens:', error);
      return [];
    }

    return (data || []).map(m => ({
      ...m,
      metadata: m.metadata as Record<string, unknown>,
    })) as ConversationMessage[];
  }

  /**
   * Adiciona uma nova mensagem ao histórico
   */
  async addMessage(
    userId: UUID,
    role: 'user' | 'assistant' | 'system',
    content: string,
    eventoId?: number,
    metadata?: Record<string, unknown>
  ): Promise<ConversationMessage | null> {
    const { data, error } = await supabase
      .from('conversation_messages')
      .insert([{
        user_id: userId,
        evento_id: eventoId,
        role,
        content,
        metadata: (metadata || {}) as any,
      }])
      .select()
      .single();

    if (error) {
      console.error('[ConversationMessages] Erro ao adicionar mensagem:', error);
      return null;
    }

    return data ? {
      ...data,
      metadata: data.metadata as Record<string, unknown>,
    } as ConversationMessage : null;
  }

  /**
   * Limpa histórico de mensagens do usuário
   */
  async clearHistory(userId: UUID): Promise<boolean> {
    const { error } = await supabase
      .from('conversation_messages')
      .delete()
      .eq('user_id', userId);

    if (error) {
      console.error('[ConversationMessages] Erro ao limpar histórico:', error);
      return false;
    }

    return true;
  }

  /**
   * Converte mensagens do banco para formato LlmMessage
   */
  toLlmMessages(messages: ConversationMessage[]): LlmMessage[] {
    return messages.map((m) => ({
      role: m.role as 'user' | 'assistant' | 'system',
      content: m.content,
    }));
  }

  /**
   * Busca apenas mensagens relacionadas a um evento específico
   */
  async getByEventId(eventoId: number): Promise<ConversationMessage[]> {
    const { data, error } = await supabase
      .from('conversation_messages')
      .select('*')
      .eq('evento_id', eventoId)
      .order('timestamp', { ascending: true });

    if (error) {
      console.error('[ConversationMessages] Erro ao buscar mensagens do evento:', error);
      return [];
    }

    return (data || []).map(m => ({
      ...m,
      metadata: m.metadata as Record<string, unknown>,
    })) as ConversationMessage[];
  }
}


============================================================
FILE PATH: .\src\db\repositories\events.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { UUID } from '@/types/domain';
import { Tables } from '@/integrations/supabase/types';

export interface EventData {
  id: number;
  user_id: string;
  title: string;
  tipo_evento: string;
  subtipo_evento: string | null;
  categoria_evento: string | null;
  event_date: string;
  event_time: string;
  qtd_pessoas: number | null;
  status: string | null;
  created_at: string;
  updated_at: string | null;
}

export interface RecentEvent {
  id: number;
  title: string;
  tipo_evento: string;
  event_date: string; // Formatado como 'dd/mm'
  status: string;
  qtd_pessoas: number;
}

export class EventsRepository {
  /**
   * Busca os últimos 3 eventos em aberto do usuário
   * Status considerados "em aberto": draft, collecting_core, aguardando_data, aguardando_preferencia_menu, itens_pendentes_confirmacao
   */
  async getRecentOpenEvents(userId: UUID, limit = 3): Promise<RecentEvent[]> {
    const openStatuses = [
      'draft',
      'collecting_core',
      'aguardando_data',
      'aguardando_preferencia_menu',
      'itens_pendentes_confirmacao'
    ];

    const { data, error } = await supabase
      .from('table_reune')
      .select('*')
      .eq('user_id', userId)
      .in('status', openStatuses)
      .order('created_at', { ascending: false })
      .limit(limit);

    if (error) {
      console.error('[EventsRepository] Erro ao buscar eventos recentes:', error);
      return [];
    }

    return (data || []).map((event) => {
      const typedEvent = event as Tables<'table_reune'>;
      return {
        id: typedEvent.id,
        title: typedEvent.title || typedEvent.tipo_evento || 'Evento',
        tipo_evento: typedEvent.tipo_evento || '',
        event_date: this.formatDate(typedEvent.event_date),
        status: typedEvent.status || 'draft',
        qtd_pessoas: typedEvent.qtd_pessoas || 0
      };
    }) as RecentEvent[];
  }

  /**
   * Busca um evento específico por ID
   */
  async getById(eventoId: number): Promise<EventData | null> {
    const { data, error } = await supabase
      .from('table_reune')
      .select('*')
      .eq('id', eventoId)
      .single();

    if (error) {
      console.error('[EventsRepository] Erro ao buscar evento:', error);
      return null;
    }

    return data as EventData;
  }

  /**
   * Formata data de evento para 'dd/mm'
   */
  private formatDate(dateString: string): string {
    try {
      const date = new Date(dateString);
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      return `${day}/${month}`;
    } catch (error) {
      console.error('[EventsRepository] Erro ao formatar data:', error);
      return dateString;
    }
  }
}


============================================================
FILE PATH: .\src\db\repositories\userFeedback.ts
============================================================
import { supabase } from '@/integrations/supabase/client';
import { UUID } from '@/types/domain';

export type FeedbackType = 'thumbs_up' | 'thumbs_down' | 'report' | 'suggestion';

export interface UserFeedback {
  id: string;
  user_id: UUID;
  evento_id?: number;
  message_id?: string;
  feedback_type: FeedbackType;
  rating?: number;
  comment?: string;
  created_at: string;
}

export class UserFeedbackRepository {
  /**
   * Registra feedback do usuário sobre uma mensagem
   */
  async submitFeedback(
    userId: UUID,
    feedbackType: FeedbackType,
    options: {
      eventoId?: number;
      messageId?: string;
      rating?: number;
      comment?: string;
    } = {}
  ): Promise<UserFeedback | null> {
    const { data, error } = await supabase
      .from('user_feedback')
      .insert([{
        user_id: userId,
        evento_id: options.eventoId,
        message_id: options.messageId,
        feedback_type: feedbackType,
      rating: options.rating,
      comment: options.comment,
    }])
      .select()
      .single();

    if (error) {
      console.error('[Feedback] Erro ao registrar feedback:', error);
      return null;
    }

    return data ? {
      ...data,
      feedback_type: data.feedback_type as FeedbackType,
    } as UserFeedback : null;
  }

  /**
   * Busca feedback do usuário
   */
  async getUserFeedback(userId: UUID, limit = 50): Promise<UserFeedback[]> {
    const { data, error } = await supabase
      .from('user_feedback')
      .select('*')
      .eq('user_id', userId)
      .order('created_at', { ascending: false })
      .limit(limit);

    if (error) {
      console.error('[Feedback] Erro ao buscar feedback:', error);
      return [];
    }

    return (data || []).map(d => ({
      ...d,
      feedback_type: d.feedback_type as FeedbackType,
    })) as UserFeedback[];
  }

  /**
   * Busca feedback por tipo
   */
  async getFeedbackByType(
    userId: UUID,
    feedbackType: FeedbackType
  ): Promise<UserFeedback[]> {
    const { data, error } = await supabase
      .from('user_feedback')
      .select('*')
      .eq('user_id', userId)
      .eq('feedback_type', feedbackType)
      .order('created_at', { ascending: false });

    if (error) {
      console.error('[Feedback] Erro ao buscar feedback por tipo:', error);
      return [];
    }

    return (data || []).map(d => ({
      ...d,
      feedback_type: d.feedback_type as FeedbackType,
    })) as UserFeedback[];
  }

  /**
   * Conta feedback positivo vs negativo
   */
  async getFeedbackStats(userId: UUID): Promise<{
    positive: number;
    negative: number;
    total: number;
  }> {
    const { data, error } = await supabase
      .from('user_feedback')
      .select('feedback_type')
      .eq('user_id', userId);

    if (error) {
      console.error('[Feedback] Erro ao buscar estatísticas:', error);
      return { positive: 0, negative: 0, total: 0 };
    }

    const positive = (data || []).filter(
      (f) => f.feedback_type === 'thumbs_up'
    ).length;
    const negative = (data || []).filter(
      (f) => f.feedback_type === 'thumbs_down'
    ).length;

    return {
      positive,
      negative,
      total: (data || []).length,
    };
  }
}


============================================================
FILE PATH: .\src\hooks\use-mobile.tsx
============================================================
import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}


============================================================
FILE PATH: .\src\hooks\use-toast.ts
============================================================
import * as React from "react";

import type { ToastActionElement, ToastProps } from "@/components/ui/toast";

const TOAST_LIMIT = 1;
const TOAST_REMOVE_DELAY = 1000000;

type ToasterToast = ToastProps & {
  id: string;
  title?: React.ReactNode;
  description?: React.ReactNode;
  action?: ToastActionElement;
};

const actionTypes = {
  ADD_TOAST: "ADD_TOAST",
  UPDATE_TOAST: "UPDATE_TOAST",
  DISMISS_TOAST: "DISMISS_TOAST",
  REMOVE_TOAST: "REMOVE_TOAST",
} as const;

let count = 0;

function genId() {
  count = (count + 1) % Number.MAX_SAFE_INTEGER;
  return count.toString();
}

type ActionType = typeof actionTypes;

type Action =
  | {
      type: ActionType["ADD_TOAST"];
      toast: ToasterToast;
    }
  | {
      type: ActionType["UPDATE_TOAST"];
      toast: Partial<ToasterToast>;
    }
  | {
      type: ActionType["DISMISS_TOAST"];
      toastId?: ToasterToast["id"];
    }
  | {
      type: ActionType["REMOVE_TOAST"];
      toastId?: ToasterToast["id"];
    };

interface State {
  toasts: ToasterToast[];
}

const toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>();

const addToRemoveQueue = (toastId: string) => {
  if (toastTimeouts.has(toastId)) {
    return;
  }

  const timeout = setTimeout(() => {
    toastTimeouts.delete(toastId);
    dispatch({
      type: "REMOVE_TOAST",
      toastId: toastId,
    });
  }, TOAST_REMOVE_DELAY);

  toastTimeouts.set(toastId, timeout);
};

export const reducer = (state: State, action: Action): State => {
  switch (action.type) {
    case "ADD_TOAST":
      return {
        ...state,
        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),
      };

    case "UPDATE_TOAST":
      return {
        ...state,
        toasts: state.toasts.map((t) => (t.id === action.toast.id ? { ...t, ...action.toast } : t)),
      };

    case "DISMISS_TOAST": {
      const { toastId } = action;

      // ! Side effects ! - This could be extracted into a dismissToast() action,
      // but I'll keep it here for simplicity
      if (toastId) {
        addToRemoveQueue(toastId);
      } else {
        state.toasts.forEach((toast) => {
          addToRemoveQueue(toast.id);
        });
      }

      return {
        ...state,
        toasts: state.toasts.map((t) =>
          t.id === toastId || toastId === undefined
            ? {
                ...t,
                open: false,
              }
            : t,
        ),
      };
    }
    case "REMOVE_TOAST":
      if (action.toastId === undefined) {
        return {
          ...state,
          toasts: [],
        };
      }
      return {
        ...state,
        toasts: state.toasts.filter((t) => t.id !== action.toastId),
      };
  }
};

const listeners: Array<(state: State) => void> = [];

let memoryState: State = { toasts: [] };

function dispatch(action: Action) {
  memoryState = reducer(memoryState, action);
  listeners.forEach((listener) => {
    listener(memoryState);
  });
}

type Toast = Omit<ToasterToast, "id">;

function toast({ ...props }: Toast) {
  const id = genId();

  const update = (props: ToasterToast) =>
    dispatch({
      type: "UPDATE_TOAST",
      toast: { ...props, id },
    });
  const dismiss = () => dispatch({ type: "DISMISS_TOAST", toastId: id });

  dispatch({
    type: "ADD_TOAST",
    toast: {
      ...props,
      id,
      open: true,
      onOpenChange: (open) => {
        if (!open) dismiss();
      },
    },
  });

  return {
    id: id,
    dismiss,
    update,
  };
}

function useToast() {
  const [state, setState] = React.useState<State>(memoryState);

  React.useEffect(() => {
    listeners.push(setState);
    return () => {
      const index = listeners.indexOf(setState);
      if (index > -1) {
        listeners.splice(index, 1);
      }
    };
  }, [state]);

  return {
    ...state,
    toast,
    dismiss: (toastId?: string) => dispatch({ type: "DISMISS_TOAST", toastId }),
  };
}

export { useToast, toast };


============================================================
FILE PATH: .\src\hooks\useAddresses.tsx
============================================================
import { useState, useEffect } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from './useAuth';
import { useToast } from './use-toast';

export interface Address {
  id: string;
  user_id: string;
  nickname: string;
  street: string;
  number: string;
  complement?: string | null;
  neighborhood: string;
  city: string;
  state: string;
  zip_code: string;
  country: string;
  is_primary: boolean;
  created_at?: string;
  updated_at?: string;
}

export const useAddresses = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [addresses, setAddresses] = useState<Address[]>([]);
  const [loading, setLoading] = useState(true);

  const fetchAddresses = async () => {
    if (!user) return;

    try {
      setLoading(true);
      const { data, error } = await supabase
        .from('user_addresses')
        .select('*')
        .eq('user_id', user.id)
        .order('is_primary', { ascending: false })
        .order('created_at', { ascending: false });

      if (error) throw error;
      setAddresses(data || []);
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao carregar endereços",
        description: err?.message || "Não foi possível carregar os endereços.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const addAddress = async (address: Omit<Address, 'id' | 'user_id' | 'created_at' | 'updated_at'>) => {
    if (!user) return { success: false, error: 'Usuário não autenticado' };

    try {
      const { error } = await supabase
        .from('user_addresses')
        .insert([{ ...address, user_id: user.id }]);

      if (error) throw error;

      toast({
        title: "Endereço adicionado!",
        description: "Seu endereço foi salvo com sucesso.",
      });

      await fetchAddresses();
      return { success: true };
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao adicionar endereço",
        description: err?.message || "Não foi possível adicionar o endereço.",
        variant: "destructive",
      });
      return { success: false, error: err?.message };
    }
  };

  const updateAddress = async (id: string, updates: Partial<Address>) => {
    if (!user) return { success: false, error: 'Usuário não autenticado' };

    try {
      const { error } = await supabase
        .from('user_addresses')
        .update(updates)
        .eq('id', id)
        .eq('user_id', user.id);

      if (error) throw error;

      toast({
        title: "Endereço atualizado!",
        description: "Suas alterações foram salvas.",
      });

      await fetchAddresses();
      return { success: true };
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao atualizar endereço",
        description: err?.message || "Não foi possível atualizar o endereço.",
        variant: "destructive",
      });
      return { success: false, error: err?.message };
    }
  };

  const deleteAddress = async (id: string) => {
    if (!user) return { success: false, error: 'Usuário não autenticado' };

    try {
      const { error } = await supabase
        .from('user_addresses')
        .delete()
        .eq('id', id)
        .eq('user_id', user.id);

      if (error) throw error;

      toast({
        title: "Endereço removido!",
        description: "O endereço foi excluído com sucesso.",
      });

      await fetchAddresses();
      return { success: true };
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao remover endereço",
        description: err?.message || "Não foi possível remover o endereço.",
        variant: "destructive",
      });
      return { success: false, error: err?.message };
    }
  };

  const setPrimaryAddress = async (id: string) => {
    return updateAddress(id, { is_primary: true });
  };

  useEffect(() => {
    fetchAddresses();
  }, [user]);

  return {
    addresses,
    loading,
    addAddress,
    updateAddress,
    deleteAddress,
    setPrimaryAddress,
    refetch: fetchAddresses,
  };
};


============================================================
FILE PATH: .\src\hooks\useAuth.tsx
============================================================
import { useState, useEffect } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/integrations/supabase/client';

export const useAuth = () => {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    // Use real Supabase auth
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      (event, session) => {
        setSession(session);
        setUser(session?.user ?? null);
        setLoading(false);
      }
    );

    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      setLoading(false);
    });

    return () => subscription.unsubscribe();
  }, []);

  return { user, session, loading };
};

============================================================
FILE PATH: .\src\hooks\useConversationMetrics.tsx
============================================================
import { useState, useEffect } from 'react';
import { useAuth } from './useAuth';
import { FeedbackManager } from '@/core/orchestrator/feedbackManager';

export interface PerformanceMetrics {
  summary: {
    total_interactions: number;
    avg_confidence: number;
    success_rate: number;
    clarification_rate: number;
  };
  feedback: {
    positive: number;
    negative: number;
    total: number;
  };
  recent_low_confidence: Array<{
    intent: string;
    confidence_level: number;
    created_at: string;
  }>;
  frequent_errors: Array<{
    intent: string;
    error_count: number;
    avg_confidence: number;
  }>;
}

/**
 * Hook para acessar métricas de performance do UNE.AI
 */
export function useConversationMetrics() {
  const { user } = useAuth();
  const [metrics, setMetrics] = useState<PerformanceMetrics | null>(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const loadMetrics = async () => {
    if (!user?.id) return;

    setLoading(true);
    setError(null);

    try {
      const feedbackManager = new FeedbackManager();
      const data = await feedbackManager.getPerformanceMetrics(user.id);
      setMetrics(data as PerformanceMetrics);
    } catch (err) {
      console.error('[useConversationMetrics] Erro ao carregar métricas:', err);
      setError('Erro ao carregar métricas');
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    loadMetrics();
  }, [user?.id]);

  return {
    metrics,
    loading,
    error,
    refresh: loadMetrics,
  };
}


============================================================
FILE PATH: .\src\hooks\useEvent.tsx
============================================================
import { useState, useEffect, useCallback } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from './useAuth';
// Force TypeScript refresh

interface Event {
  id: number;
  title: string;
  description: string | null;
  event_date: string;
  event_time: string;
  location: string | null;
  user_id: string | null;
  max_attendees: number | null;
  is_public: boolean | null;
  status: string | null;
  created_by_ai?: boolean;
}

interface EventOrganizer {
  id: string;
  user_id: string;
  added_by: string;
  added_at: string;
}

export const useEvent = (eventId: string) => {
  const eventIdNumber = parseInt(eventId);
  const { user } = useAuth();
  const [event, setEvent] = useState<Event | null>(null);
  const [organizers, setOrganizers] = useState<EventOrganizer[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  // Verifica se o usuário atual é organizador do evento
  const isOrganizer = () => {
    if (!user || !event) return false;
    
    // É criador do evento
    if (event.user_id === user.id) return true;
    
    // É co-organizador
    return organizers.some(org => org.user_id === user.id);
  };

  // Busca dados do evento
  const fetchEvent = useCallback(async () => {
    try {
      setLoading(true);
      const { data, error } = await supabase.rpc('get_event_details_safe', {
        _event_id: eventIdNumber,
      });

      if (error) throw error;
      const result = Array.isArray(data) ? data[0] : data;
      setEvent(result || null);
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Erro ao carregar evento');
    } finally {
      setLoading(false);
    }
  }, [eventIdNumber]);

  // Busca co-organizadores do evento
  const fetchOrganizers = useCallback(async () => {
    try {
      const { data, error } = await supabase
        .from('event_organizers')
        .select('*')
        .eq('event_id', eventIdNumber);

      if (error) throw error;
      setOrganizers(data || []);
    } catch (err) {
      console.error('Erro ao buscar organizadores:', err);
    }
  }, [eventIdNumber]);

  // Adiciona co-organizador
  const addOrganizer = async (userId: string) => {
    if (!user) return { error: 'Usuário não autenticado' };

    try {
      const { error } = await supabase
        .from('event_organizers')
        .insert({
          event_id: eventIdNumber,
          user_id: userId,
          added_by: user.id
        });

      if (error) throw error;
      
      await fetchOrganizers(); // Atualiza a lista
      return { error: null };
    } catch (err) {
      return { error: err instanceof Error ? err.message : 'Erro ao adicionar organizador' };
    }
  };

  // Remove co-organizador
  const removeOrganizer = async (organizerId: string) => {
    try {
      const { error } = await supabase
        .from('event_organizers')
        .delete()
        .eq('id', organizerId);

      if (error) throw error;
      
      await fetchOrganizers(); // Atualiza a lista
      return { error: null };
    } catch (err) {
      return { error: err instanceof Error ? err.message : 'Erro ao remover organizador' };
    }
  };

  useEffect(() => {
    if (eventId && !isNaN(eventIdNumber)) {
      fetchEvent();
      fetchOrganizers();
    }
  }, [eventId, eventIdNumber, fetchEvent, fetchOrganizers]);

  return {
    event,
    organizers,
    loading,
    error,
    isOrganizer: isOrganizer(),
    addOrganizer,
    removeOrganizer,
    refetch: () => {
      fetchEvent();
      fetchOrganizers();
    }
  };
};


============================================================
FILE PATH: .\src\hooks\useProfile.tsx
============================================================
import { useState, useEffect, useCallback } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from './useAuth';
import { useToast } from './use-toast';

export interface Profile {
  id: string;
  display_name: string | null;
  username: string | null;
  avatar_url: string | null;
  phone: string | null;
  city: string | null;
  state: string | null;
  country: string | null;
  favorite_event_type: string | null;
  language: string | null;
  allow_search_by_username: boolean | null;
  accept_notifications: boolean | null;
  terms_accepted_at: string | null;
  bio: string | null;
}

export const useProfile = () => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);
  const [completion, setCompletion] = useState(0);

  const fetchProfile = async () => {
    if (!user) return;

    try {
      setLoading(true);

      // Buscar perfil
      const { data: profileData, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', user.id)
        .single();

      if (profileError && profileError.code !== 'PGRST116') {
        throw profileError;
      }

      // Se não existe perfil, criar um
      if (!profileData) {
        const { data: newProfile, error: insertError } = await supabase
          .from('profiles')
          .insert([{ id: user.id }])
          .select()
          .single();

        if (insertError) throw insertError;
        setProfile(newProfile);
      } else {
        setProfile(profileData);
      }

      // Buscar completude do perfil
      const { data: completionData } = await supabase
        .rpc('get_profile_completion');

      if (completionData !== null) {
        setCompletion(completionData);
      }
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao carregar perfil",
        description: err?.message || "Não foi possível carregar o perfil.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const checkUsernameAvailable = useCallback(async (username: string): Promise<boolean> => {
    if (!username || username.length < 3) return false;

    try {
      const { data, error } = await supabase
        .rpc('check_username_available', { desired_username: username.toLowerCase() });

      if (error) throw error;
      return data === true;
    } catch (error) {
      return false;
    }
  }, []); // Sem dependências - função estável

  const updateProfile = async (updates: Partial<Profile>) => {
    if (!user) return { success: false, error: 'Usuário não autenticado' };

    try {
      // Converter username para lowercase se fornecido
      if (updates.username) {
        updates.username = updates.username.toLowerCase();
      }

      const { error } = await supabase
        .from('profiles')
        .update(updates)
        .eq('id', user.id);

      if (error) throw error;

      toast({
        title: "Perfil atualizado!",
        description: "Suas informações foram salvas com sucesso.",
      });

      // Recarregar perfil
      await fetchProfile();
      return { success: true };
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao atualizar perfil",
        description: err?.message || "Não foi possível atualizar o perfil.",
        variant: "destructive",
      });
      return { success: false, error: err?.message };
    }
  };

  const uploadAvatar = async (file: File) => {
    if (!user) return { success: false, error: 'Usuário não autenticado' };

    try {
      const fileExt = file.name.split('.').pop();
      const fileName = `${user.id}/${Math.random()}.${fileExt}`;

      // Upload do arquivo
      const { error: uploadError } = await supabase.storage
        .from('avatars')
        .upload(fileName, file, { upsert: true });

      if (uploadError) throw uploadError;

      // Obter URL pública
      const { data: { publicUrl } } = supabase.storage
        .from('avatars')
        .getPublicUrl(fileName);

      // Atualizar perfil com nova URL
      await updateProfile({ avatar_url: publicUrl });

      return { success: true, url: publicUrl };
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao fazer upload",
        description: err?.message || "Não foi possível fazer upload da imagem.",
        variant: "destructive",
      });
      return { success: false, error: err?.message };
    }
  };

  useEffect(() => {
    fetchProfile();
  }, [user]);

  return {
    profile,
    loading,
    completion,
    updateProfile,
    uploadAvatar,
    checkUsernameAvailable,
    refetch: fetchProfile,
  };
};


============================================================
FILE PATH: .\src\lib\utils.ts
============================================================
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}


============================================================
FILE PATH: .\src\pages\AcceptInvite.tsx
============================================================
import { useEffect, useState } from "react";
import { useNavigate, useSearchParams } from "react-router-dom";
import { supabase } from "@/integrations/supabase/client";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Loader2, CheckCircle2, XCircle, Sparkles, UserPlus, ArrowRight } from "lucide-react";
import { toast } from "sonner";
import { motion } from "framer-motion";

export default function AcceptInvite() {
  const [searchParams] = useSearchParams();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [eventData, setEventData] = useState<{ title: string; id: number } | null>(null);
  const [requiresSignup, setRequiresSignup] = useState(false);

  const token = searchParams.get("token");

  useEffect(() => {
    if (!token) {
      setError("Token de convite não encontrado");
      setLoading(false);
      return;
    }

    handleAcceptInvite();
  }, [token]);

  const handleAcceptInvite = async () => {
    try {
      setLoading(true);

      // Verificar se usuário está logado
      const { data: { user } } = await supabase.auth.getUser();

      // Chamar função para aceitar convite
      const { data, error: rpcError } = await supabase.rpc('accept_event_invitation', {
        _invitation_token: token,
        _user_id: user?.id || null
      });

      if (rpcError) throw rpcError;

      const result = data as { success: boolean; event_id: number; event_title: string; requires_signup: boolean };

      setEventData({
        id: result.event_id,
        title: result.event_title
      });

      // Captura discreta de email para early adopters (quando não está logado)
      if (result.requires_signup) {
        // Buscar email do convite para adicionar à waitlist de early adopters
        const { data: invitationData } = await supabase
          .from('event_invitations')
          .select('participant_email')
          .eq('invitation_token', token)
          .single();

        if (invitationData?.participant_email) {
          // Enviar para API de waitlist com tracking
          try {
            await fetch('/functions/v1/waitlist', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({
                email: invitationData.participant_email,
                source_url: window.location.href
              })
            });
            console.log('Email capturado para benefícios futuros:', invitationData.participant_email);
          } catch (error) {
            console.error('Erro ao capturar email:', error);
          }
        }

        setRequiresSignup(true);
        toast.success("Convite aceito! Faça seu cadastro para continuar.");
      } else {
        toast.success("Convite aceito com sucesso!");
      }

      setLoading(false);
    } catch (err: any) {
      console.error("Erro ao aceitar convite:", err);
      setError(err.message || "Erro ao aceitar convite");
      setLoading(false);
      toast.error("Erro ao aceitar convite");
    }
  };

  // Loading State
  if (loading) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background relative overflow-hidden p-4">
        {/* Animated Background Orbs */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-blue-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-purple-500/20 rounded-full blur-3xl"
        />

        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ duration: 0.5 }}
          className="w-full max-w-md relative z-10"
        >
          <div className="relative">
            <div className="absolute -inset-1 bg-gradient-to-r from-blue-500/50 to-purple-500/50 rounded-3xl blur opacity-25"></div>

            <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
              <div className="h-2 w-full bg-gradient-to-r from-blue-500 to-purple-500" />

              <CardHeader className="pt-8 pb-6 text-center">
                <motion.div
                  animate={{ rotate: 360 }}
                  transition={{ duration: 2, repeat: Infinity, ease: "linear" }}
                  className="mx-auto mb-4"
                >
                  <Loader2 className="h-16 w-16 text-blue-500" />
                </motion.div>
                <CardTitle className="text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-500 bg-clip-text text-transparent">
                  Processando convite...
                </CardTitle>
                <CardDescription className="mt-2">
                  Aguarde enquanto validamos seu convite
                </CardDescription>
              </CardHeader>
            </Card>
          </div>
        </motion.div>
      </div>
    );
  }

  // Error State
  if (error) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background relative overflow-hidden p-4">
        {/* Animated Background Orbs */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-red-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-orange-500/20 rounded-full blur-3xl"
        />

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="w-full max-w-md relative z-10"
        >
          <div className="relative">
            <div className="absolute -inset-1 bg-gradient-to-r from-red-500/50 to-orange-500/50 rounded-3xl blur opacity-25"></div>

            <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
              <div className="h-2 w-full bg-gradient-to-r from-red-500 to-orange-500" />

              <CardHeader className="pt-8 pb-6 text-center">
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  transition={{ type: "spring", duration: 0.5 }}
                  className="mx-auto mb-4"
                >
                  <div className="w-20 h-20 rounded-full bg-red-500/20 flex items-center justify-center">
                    <XCircle className="h-10 w-10 text-red-500" />
                  </div>
                </motion.div>
                <CardTitle className="text-2xl font-bold text-destructive">
                  Erro ao aceitar convite
                </CardTitle>
                <CardDescription className="mt-2 text-base">
                  {error}
                </CardDescription>
              </CardHeader>
              <CardContent className="pb-8">
                <Button
                  onClick={() => navigate("/")}
                  className="w-full h-12 bg-gradient-to-r from-red-500 to-orange-500 hover:from-red-600 hover:to-orange-600"
                >
                  Voltar ao início
                </Button>
              </CardContent>
            </Card>
          </div>
        </motion.div>
      </div>
    );
  }

  // Requires Signup State
  if (requiresSignup) {
    return (
      <div className="min-h-screen flex items-center justify-center bg-background relative overflow-hidden p-4">
        {/* Animated Background Orbs */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-green-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-emerald-500/20 rounded-full blur-3xl"
        />

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="w-full max-w-md relative z-10"
        >
          <div className="relative">
            <div className="absolute -inset-1 bg-gradient-to-r from-green-500/50 to-emerald-500/50 rounded-3xl blur opacity-25"></div>

            <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
              <div className="h-2 w-full bg-gradient-to-r from-green-500 to-emerald-500" />

              <CardHeader className="pt-8 pb-6 text-center">
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  transition={{ type: "spring", duration: 0.5 }}
                  className="mx-auto mb-4"
                >
                  <div className="relative">
                    <div className="absolute inset-0 bg-gradient-to-r from-green-500 to-emerald-500 rounded-full blur-xl opacity-30 animate-pulse"></div>
                    <div className="relative w-20 h-20 rounded-full bg-green-500/20 flex items-center justify-center">
                      <CheckCircle2 className="h-10 w-10 text-green-500" />
                    </div>
                  </div>
                </motion.div>
                <CardTitle className="text-2xl font-bold bg-gradient-to-r from-green-500 to-emerald-500 bg-clip-text text-transparent">
                  Convite aceito!
                </CardTitle>
                <CardDescription className="mt-2 text-base">
                  Você aceitou o convite para:{" "}
                  <strong className="text-foreground">{eventData?.title}</strong>
                </CardDescription>

                <Badge className="mt-4 px-4 py-2 bg-gradient-to-r from-green-500/10 to-emerald-500/10 border-green-500/20 text-green-600 dark:text-green-400">
                  <UserPlus className="w-4 h-4 mr-2 inline" />
                  Cadastro Necessário
                </Badge>
              </CardHeader>

              <CardContent className="space-y-4 pb-8">
                <p className="text-sm text-muted-foreground text-center">
                  Faça seu cadastro com o mesmo e-mail que recebeu o convite para acessar o evento.
                </p>
                <Button
                  onClick={() => navigate("/app")}
                  className="w-full h-14 text-base font-semibold bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 shadow-lg group"
                >
                  Fazer cadastro
                  <ArrowRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                </Button>
              </CardContent>
            </Card>
          </div>
        </motion.div>
      </div>
    );
  }

  // Success State
  return (
    <div className="min-h-screen flex items-center justify-center bg-background relative overflow-hidden p-4">
      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-blue-500/20 rounded-full blur-3xl"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-cyan-500/20 rounded-full blur-3xl"
      />

      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="w-full max-w-md relative z-10"
      >
        <div className="relative">
          <div className="absolute -inset-1 bg-gradient-to-r from-blue-500/50 to-cyan-500/50 rounded-3xl blur opacity-25"></div>

          <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
            <div className="h-2 w-full bg-gradient-to-r from-blue-500 to-cyan-500" />

            <CardHeader className="pt-8 pb-6 text-center">
              <motion.div
                initial={{ scale: 0 }}
                animate={{ scale: 1 }}
                transition={{ type: "spring", duration: 0.5 }}
                className="mx-auto mb-4"
              >
                <div className="relative">
                  <div className="absolute inset-0 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full blur-xl opacity-30 animate-pulse"></div>
                  <div className="relative w-20 h-20 rounded-full bg-blue-500/20 flex items-center justify-center">
                    <CheckCircle2 className="h-10 w-10 text-blue-500" />
                  </div>
                </div>
              </motion.div>
              <CardTitle className="text-2xl font-bold bg-gradient-to-r from-blue-500 to-cyan-500 bg-clip-text text-transparent">
                Convite aceito com sucesso!
              </CardTitle>
              <CardDescription className="mt-2 text-base">
                Você foi adicionado ao evento:{" "}
                <strong className="text-foreground">{eventData?.title}</strong>
              </CardDescription>

              <Badge className="mt-4 px-4 py-2 bg-gradient-to-r from-blue-500/10 to-cyan-500/10 border-blue-500/20 text-blue-600 dark:text-blue-400">
                <Sparkles className="w-4 h-4 mr-2 inline" />
                Bem-vindo ao Evento!
              </Badge>
            </CardHeader>

            <CardContent className="space-y-3 pb-8">
              <Button
                onClick={() => navigate(`/events/${eventData?.id}`)}
                className="w-full h-14 text-base font-semibold bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 shadow-lg group"
              >
                Ver detalhes do evento
                <ArrowRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
              </Button>
              <Button
                onClick={() => navigate("/app")}
                variant="outline"
                className="w-full h-12 border-2"
              >
                Ir para Dashboard
              </Button>
            </CardContent>
          </Card>
        </div>
      </motion.div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\AdminDashboard.tsx
============================================================
import { useState, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";
import { supabase } from "@/integrations/supabase/client";
import { Lock, Users, Gift, Mail } from "lucide-react";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { motion } from "framer-motion";
import AdminEmailCenter from "./AdminEmailCenter";

const AdminDashboard = () => {
    const [isAuthenticated, setIsAuthenticated] = useState(false);
    const [password, setPassword] = useState("");
    const [waitlistData, setWaitlistData] = useState<any[]>([]);
    const [eventsData, setEventsData] = useState<any[]>([]);
    const [loading, setLoading] = useState(false);

    const handleLogin = async (e: React.FormEvent) => {
        e.preventDefault();
        const ok = await fetchData();
        if (ok) {
            setIsAuthenticated(true);
        } else {
            alert("Senha incorreta ou função admin indisponível");
        }
    };

    const fetchData = async (): Promise<boolean> => {
        setLoading(true);
        try {
            const { data, error } = await supabase.functions.invoke('get-admin-data', {
                body: { password }
            });

            if (error) throw error;

            if (data) {
                setWaitlistData(data.waitlist || []);
                setEventsData(data.events || []);
            }

            return true;
        } catch (error) {
            console.error("Error fetching data:", error);
            alert("Erro ao carregar dados. Verifique se a função foi deployada.");
            return false;
        } finally {
            setLoading(false);
        }
    };

    if (!isAuthenticated) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-background relative overflow-hidden">
                {/* Animated Background Orbs */}
                <motion.div
                    animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
                    transition={{ duration: 8, repeat: Infinity }}
                    className="absolute top-1/4 left-1/4 w-96 h-96 bg-amber-500/20 rounded-full blur-3xl"
                />
                <motion.div
                    animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
                    transition={{ duration: 8, repeat: Infinity, delay: 1 }}
                    className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl"
                />

                <div className="relative z-10">
                    <div className="relative">
                        <div className="absolute -inset-1 bg-gradient-to-r from-amber-500/50 to-purple-500/50 rounded-3xl blur opacity-25"></div>
                        <Card className="relative w-full max-w-md border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
                            <div className="h-2 w-full bg-gradient-to-r from-amber-500 to-purple-500" />
                            <CardHeader className="text-center pt-8">
                                <motion.div
                                    initial={{ scale: 0.8, opacity: 0 }}
                                    animate={{ scale: 1, opacity: 1 }}
                                    transition={{ duration: 0.5 }}
                                    className="flex justify-center mb-4"
                                >
                                    <div className="relative">
                                        <div className="absolute inset-0 bg-gradient-to-r from-amber-500 to-purple-500 rounded-full blur-xl opacity-30 animate-pulse"></div>
                                        <div className="relative w-16 h-16 rounded-full bg-gradient-to-r from-amber-500 to-purple-500 flex items-center justify-center">
                                            <Lock className="w-8 h-8 text-white" />
                                        </div>
                                    </div>
                                </motion.div>
                                <CardTitle className="text-2xl font-bold bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
                                    Acesso Admin
                                </CardTitle>
                            </CardHeader>
                            <CardContent className="px-8 pb-8">
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <Input
                                        type="password"
                                        placeholder="Senha de acesso"
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm"
                                    />
                                    <Button type="submit" className="w-full h-12 bg-gradient-to-r from-amber-500 to-purple-500 hover:from-amber-600 hover:to-purple-600">
                                        Entrar
                                    </Button>
                                </form>
                            </CardContent>
                        </Card>
                    </div>
                </div>
            </div>
        );
    }

    return (
        <Tabs defaultValue="dashboard" className="min-h-screen bg-background">
            <div className="fixed top-4 left-1/2 -translate-x-1/2 z-50">
                <TabsList className="bg-card/80 backdrop-blur-xl border border-border/50 shadow-2xl h-12">
                    <TabsTrigger value="dashboard" className="text-base">Dashboard</TabsTrigger>
                    <TabsTrigger value="email-center" className="text-base">
                        <Mail className="w-4 h-4 mr-2" />
                        Email Center
                    </TabsTrigger>
                </TabsList>
            </div>

            <TabsContent value="dashboard" className="m-0">
                <div className="min-h-screen bg-background relative overflow-hidden p-8 pt-24">
                    {/* Animated Background Orbs */}
                    <motion.div
                        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
                        transition={{ duration: 8, repeat: Infinity }}
                        className="fixed top-0 left-0 w-[600px] h-[600px] bg-amber-500/20 rounded-full blur-3xl pointer-events-none"
                    />
                    <motion.div
                        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
                        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
                        className="fixed bottom-0 right-0 w-[600px] h-[600px] bg-purple-500/20 rounded-full blur-3xl pointer-events-none"
                    />

                    <div className="max-w-6xl mx-auto space-y-8 relative z-10">
                        <div className="flex items-center justify-between">
                            <h1 className="text-3xl font-bold bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
                                Painel Administrativo
                            </h1>
                            <Button variant="outline" onClick={() => setIsAuthenticated(false)}>
                                Sair
                            </Button>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm">
                                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                                    <CardTitle className="text-sm font-medium">
                                        Total na Lista de Espera
                                    </CardTitle>
                                    <Users className="h-4 w-4 text-amber-500" />
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold">{waitlistData.length}</div>
                                </CardContent>
                            </Card>
                            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm">
                                <CardHeader className="flex flex-row items-center justify-between space-y-0 pb-2">
                                    <CardTitle className="text-sm font-medium">
                                        Eventos de Amigo Secreto
                                    </CardTitle>
                                    <Gift className="h-4 w-4 text-purple-500" />
                                </CardHeader>
                                <CardContent>
                                    <div className="text-2xl font-bold">{eventsData.length}</div>
                                </CardContent>
                            </Card>
                        </div>

                        <Tabs defaultValue="waitlist" className="w-full">
                            <TabsList className="bg-card/80 backdrop-blur-sm">
                                <TabsTrigger value="waitlist">Lista de Espera</TabsTrigger>
                                <TabsTrigger value="events">Amigo Secreto</TabsTrigger>
                            </TabsList>

                            <TabsContent value="waitlist">
                                <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm">
                                    <CardHeader>
                                        <CardTitle>Cadastros na Lista de Espera</CardTitle>
                                    </CardHeader>
                                    <CardContent>
                                        <Table>
                                            <TableHeader>
                                                <TableRow>
                                                    <TableHead>Data</TableHead>
                                                    <TableHead>Email</TableHead>
                                                </TableRow>
                                            </TableHeader>
                                            <TableBody>
                                                {waitlistData.map((item) => (
                                                    <TableRow key={item.id}>
                                                        <TableCell>
                                                            {format(new Date(item.created_at), "dd/MM/yyyy HH:mm", { locale: ptBR })}
                                                        </TableCell>
                                                        <TableCell>{item.email}</TableCell>
                                                    </TableRow>
                                                ))}
                                            </TableBody>
                                        </Table>
                                    </CardContent>
                                </Card>
                            </TabsContent>

                            <TabsContent value="events">
                                <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm">
                                    <CardHeader>
                                        <CardTitle>Eventos Criados</CardTitle>
                                    </CardHeader>
                                    <CardContent>
                                        <Table>
                                            <TableHeader>
                                                <TableRow>
                                                    <TableHead>Data Criação</TableHead>
                                                    <TableHead>Nome do Evento</TableHead>
                                                    <TableHead>Data Sorteio</TableHead>
                                                    <TableHead>Configuração</TableHead>
                                                </TableRow>
                                            </TableHeader>
                                            <TableBody>
                                                {eventsData.map((item) => (
                                                    <TableRow key={item.id}>
                                                        <TableCell>
                                                            {format(new Date(item.created_at), "dd/MM/yyyy HH:mm", { locale: ptBR })}
                                                        </TableCell>
                                                        <TableCell className="font-medium">
                                                            {item.table_reune?.title || "Sem nome"}
                                                        </TableCell>
                                                        <TableCell>
                                                            {item.draw_date
                                                                ? format(new Date(item.draw_date), "dd/MM/yyyy", { locale: ptBR })
                                                                : "Não definida"}
                                                        </TableCell>
                                                        <TableCell>
                                                            Min: {item.min_value ? `R$ ${item.min_value}` : "-"} |
                                                            Max: {item.max_value ? `R$ ${item.max_value}` : "-"}
                                                        </TableCell>
                                                    </TableRow>
                                                ))}
                                            </TableBody>
                                        </Table>
                                    </CardContent>
                                </Card>
                            </TabsContent>
                        </Tabs>
                    </div>
                </div>
            </TabsContent>

            <TabsContent value="email-center" className="m-0">
                <AdminEmailCenter password={password} onLogout={() => setIsAuthenticated(false)} />
            </TabsContent>
        </Tabs>
    );
};

export default AdminDashboard;


============================================================
FILE PATH: .\src\pages\AdminEmailCenter.tsx
============================================================
import { useState, useEffect } from "react";
import { motion } from "framer-motion";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Users, Mail, CheckCircle2, XCircle, Clock, UserCog, RefreshCw } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import AdminHeader from "@/components/admin/AdminHeader";
import LeadTable from "@/components/admin/LeadTable";
import SendEmailModal from "@/components/admin/SendEmailModal";
import EmailTemplateEditor from "@/components/admin/EmailTemplateEditor";
import EmailLogViewer from "@/components/admin/EmailLogViewer";
import { AdminData } from "@/types/admin";
import { toast } from "sonner";
import { supabase } from "@/integrations/supabase/client";

interface AdminEmailCenterProps {
  password: string;
  onLogout: () => void;
}

export default function AdminEmailCenter({ password, onLogout }: AdminEmailCenterProps) {
  const [data, setData] = useState<AdminData | null>(null);
  const [loading, setLoading] = useState(true);
  const [selectedLeads, setSelectedLeads] = useState<string[]>([]);
  const [sendEmailModalOpen, setSendEmailModalOpen] = useState(false);
  const [viewMode, setViewMode] = useState<'waitlist' | 'users'>('waitlist');
  const [syncing, setSyncing] = useState(false);

  useEffect(() => {
    if (password) {
      fetchData();
      // Sincronização automática ao abrir o dashboard
      syncEmailStatus();
    }
  }, [password]);

  const fetchData = async () => {
    setLoading(true);

    console.log('🔐 Enviando requisição com senha:', password ? '✅ Presente' : '❌ Vazia');

    try {
      const { data: result, error } = await supabase.functions.invoke('get-admin-data', {
        body: { password }
      });

      console.log('📡 Resposta da API:', result);

      if (error) {
        throw new Error(error.message || 'Erro ao carregar dados');
      }

      setData(result);
      toast.success('Dados carregados com sucesso!');
    } catch (error: any) {
      console.error('❌ Erro ao carregar dados:', error);
      toast.error(error.message || 'Erro ao carregar dados');
    } finally {
      setLoading(false);
    }
  };

  const syncEmailStatus = async (showToast = false) => {
    if (syncing) return;

    setSyncing(true);

    if (showToast) {
      toast.info('🔄 Sincronizando status dos emails...');
    }

    try {
      const { data: result, error } = await supabase.functions.invoke('sync-email-status', {
        body: {
          password,
          hours_back: 48 // Verificar últimas 48 horas
        }
      });

      if (error) {
        throw new Error(error.message || 'Erro ao sincronizar');
      }

      console.log('✅ Sincronização concluída:', result);

      if (showToast) {
        toast.success(
          `Sincronização concluída! ${result.updated} emails atualizados de ${result.synced} verificados.`
        );
      }

      // Recarregar dados após sincronização
      await fetchData();
    } catch (error: any) {
      console.error('❌ Erro ao sincronizar:', error);
      if (showToast) {
        toast.error(error.message || 'Erro ao sincronizar status dos emails');
      }
    } finally {
      setSyncing(false);
    }
  };

  const handleSelectLead = (leadId: string) => {
    setSelectedLeads(prev =>
      prev.includes(leadId)
        ? prev.filter(id => id !== leadId)
        : [...prev, leadId]
    );
  };

  const handleSelectAll = (selected: boolean) => {
    if (selected && data) {
      const currentList = viewMode === 'waitlist' ? data.waitlist : data.users;
      setSelectedLeads(currentList.map(item => item.id));
    } else {
      setSelectedLeads([]);
    }
  };

  const handleSendEmail = (leadIds: string[]) => {
    setSelectedLeads(leadIds);
    setSendEmailModalOpen(true);
  };

  const handleViewLogs = (leadId: string) => {
    // TODO: Implementar visualização de logs específicos do lead
    toast.info(`Logs do lead: ${leadId}`);
  };

  if (loading || !data) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-primary"></div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background relative overflow-hidden">
      {/* Animated Background Orbs - Amber/Purple Theme */}
      <motion.div
        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
        transition={{ duration: 8, repeat: Infinity }}
        className="fixed top-0 left-0 w-[600px] h-[600px] bg-amber-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="fixed bottom-0 right-0 w-[600px] h-[600px] bg-purple-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
        transition={{ duration: 8, repeat: Infinity, delay: 2 }}
        className="fixed top-1/2 right-1/4 w-[400px] h-[400px] bg-pink-500/15 rounded-full blur-3xl pointer-events-none"
      />

      {/* Header */}
      <AdminHeader
        title="Admin Email Center"
        subtitle="Gerenciamento de e-mails e comunicações"
        onLogout={onLogout}
      />

      {/* Main Content */}
      <main className="relative z-10 max-w-7xl mx-auto px-4 pt-40 pb-20 space-y-8">
        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3 }}
          >
            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm hover:shadow-xl transition-shadow">
              <CardHeader className="flex flex-row items-center justify-between pb-2">
                <CardTitle className="text-sm font-medium text-muted-foreground">
                  {viewMode === 'waitlist' ? 'Leads (Waitlist)' : 'Usuários Registrados'}
                </CardTitle>
                {viewMode === 'waitlist' ? (
                  <Users className="h-4 w-4 text-amber-500" />
                ) : (
                  <UserCog className="h-4 w-4 text-purple-500" />
                )}
              </CardHeader>
              <CardContent>
                <div className="text-3xl font-bold bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
                  {viewMode === 'waitlist' ? data.waitlist.length : data.users?.length || 0}
                </div>
              </CardContent>
            </Card>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: 0.1 }}
          >
            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm hover:shadow-xl transition-shadow">
              <CardHeader className="flex flex-row items-center justify-between pb-2">
                <CardTitle className="text-sm font-medium text-muted-foreground">
                  E-mails Enviados (30d)
                </CardTitle>
                <Mail className="h-4 w-4 text-blue-500" />
              </CardHeader>
              <CardContent>
                <div className="text-3xl font-bold">{data.emailStats.total}</div>
              </CardContent>
            </Card>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: 0.2 }}
          >
            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm hover:shadow-xl transition-shadow">
              <CardHeader className="flex flex-row items-center justify-between pb-2">
                <CardTitle className="text-sm font-medium text-muted-foreground">
                  Taxa de Sucesso
                </CardTitle>
                <CheckCircle2 className="h-4 w-4 text-green-500" />
              </CardHeader>
              <CardContent>
                <div className="text-3xl font-bold text-green-600">
                  {data.emailStats.total > 0
                    ? Math.round((data.emailStats.success / data.emailStats.total) * 100)
                    : 0}%
                </div>
              </CardContent>
            </Card>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3, delay: 0.3 }}
          >
            <Card className="border-2 border-border/50 bg-card/80 backdrop-blur-sm hover:shadow-xl transition-shadow">
              <CardHeader className="flex flex-row items-center justify-between pb-2">
                <CardTitle className="text-sm font-medium text-muted-foreground">
                  Sem Boas-vindas
                </CardTitle>
                <XCircle className="h-4 w-4 text-amber-500" />
              </CardHeader>
              <CardContent>
                <div className="text-3xl font-bold text-amber-600">
                  {data.leadsWithoutWelcome}
                </div>
              </CardContent>
            </Card>
          </motion.div>
        </div>

        {/* Tabs */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.3, delay: 0.4 }}
        >
          <Tabs defaultValue="leads" className="w-full">
            <TabsList className="grid w-full grid-cols-3 h-12">
              <TabsTrigger value="leads" className="text-base">Leads</TabsTrigger>
              <TabsTrigger value="templates" className="text-base">Templates</TabsTrigger>
              <TabsTrigger value="logs" className="text-base">Logs</TabsTrigger>
            </TabsList>

            <TabsContent value="leads" className="space-y-4 mt-6">
              {/* Seletor de View Mode */}
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <Button
                    variant={viewMode === 'waitlist' ? 'default' : 'outline'}
                    onClick={() => {
                      setViewMode('waitlist');
                      setSelectedLeads([]);
                    }}
                    className="gap-2"
                  >
                    <Users className="w-4 h-4" />
                    Waitlist
                    <Badge variant="secondary" className="ml-1">
                      {data.waitlist.length}
                    </Badge>
                  </Button>
                  <Button
                    variant={viewMode === 'users' ? 'default' : 'outline'}
                    onClick={() => {
                      setViewMode('users');
                      setSelectedLeads([]);
                    }}
                    className="gap-2"
                  >
                    <UserCog className="w-4 h-4" />
                    Usuários Registrados
                    <Badge variant="secondary" className="ml-1">
                      {data.users?.length || 0}
                    </Badge>
                  </Button>
                </div>

                {/* Botão de Sincronização */}
                <Button
                  variant="outline"
                  onClick={() => syncEmailStatus(true)}
                  disabled={syncing}
                  className="gap-2"
                >
                  <RefreshCw className={`w-4 h-4 ${syncing ? 'animate-spin' : ''}`} />
                  {syncing ? 'Sincronizando...' : 'Sincronizar Status'}
                </Button>
              </div>

              <LeadTable
                leads={viewMode === 'waitlist' ? data.waitlist : data.users || []}
                selectedLeads={selectedLeads}
                onSelectLead={handleSelectLead}
                onSelectAll={handleSelectAll}
                onSendEmail={handleSendEmail}
                onViewLogs={handleViewLogs}
              />
            </TabsContent>

            <TabsContent value="templates" className="mt-6">
              <EmailTemplateEditor
                templates={data.templates}
                password={password}
                onUpdate={fetchData}
              />
            </TabsContent>

            <TabsContent value="logs" className="mt-6">
              <EmailLogViewer password={password} />
            </TabsContent>
          </Tabs>
        </motion.div>
      </main>

      {/* Send Email Modal */}
      <SendEmailModal
        open={sendEmailModalOpen}
        onClose={() => {
          setSendEmailModalOpen(false);
          setSelectedLeads([]);
        }}
        templates={data.templates}
        leadIds={selectedLeads}
        leadCount={selectedLeads.length}
        password={password}
      />
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\CreateEvent.tsx
============================================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Label } from '@/components/ui/label';
import { Textarea } from '@/components/ui/textarea';
import { Alert, AlertDescription } from '@/components/ui/alert';
import { type LucideIcon, ArrowLeft, AlertTriangle, MapPinned, Home, Sparkles, Calendar as CalendarIcon, Clock, Flame, UtensilsCrossed, Cake, Briefcase, Package, Plus, X, Trash2 } from 'lucide-react';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from '@/hooks/useAuth';
import { useToast } from '@/hooks/use-toast';
import { EventInviteSelector, Invitee } from '@/components/events/EventInviteSelector';
import { AddressSelector } from '@/components/events/AddressSelector';
import { Address } from '@/hooks/useAddresses';
import { EventTemplate, templates } from '@/data/templates';
import { DatePicker } from '@/components/ui/date-picker';
import { TimePicker } from '@/components/ui/time-picker';
import { format } from 'date-fns';
import { motion } from 'framer-motion';
import { cn } from '@/lib/utils';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';

interface ManualItem {
  id: string;
  name: string;
  quantity: number;
  unit: string;
}

interface CreateEventProps {
  onBack: () => void;
  onCreate: () => void;
  initialData?: EventTemplate | null;
}

const templateIcons: Record<string, LucideIcon> = {
  churrasco: Flame,
  jantar: UtensilsCrossed,
  aniversario: Cake,
  reuniao: Briefcase,
};

const CreateEvent = ({ onBack, onCreate, initialData }: CreateEventProps) => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [selectedTemplate, setSelectedTemplate] = useState<EventTemplate | null>(initialData || null);
  const [title, setTitle] = useState(initialData?.title || '');
  const [date, setDate] = useState<Date | undefined>();
  const [time, setTime] = useState<string>('');
  const [location, setLocation] = useState('');
  const [description, setDescription] = useState(initialData?.description || '');
  const [selectedInvitees, setSelectedInvitees] = useState<Invitee[]>([]);
  const [loading, setLoading] = useState(false);
  const [showLocationWarning, setShowLocationWarning] = useState(false);
  const [isPublic, setIsPublic] = useState(true);
  const [selectedAddressId, setSelectedAddressId] = useState<string | null>(null);
  const [useManualLocation, setUseManualLocation] = useState(false);

  // Estado para lista de itens manual
  const [manualItems, setManualItems] = useState<ManualItem[]>([]);
  const [newItemName, setNewItemName] = useState('');
  const [newItemQuantity, setNewItemQuantity] = useState(1);
  const [newItemUnit, setNewItemUnit] = useState('un');

  // Funções para gerenciar itens manuais
  const addManualItem = () => {
    if (!newItemName.trim()) return;

    const newItem: ManualItem = {
      id: crypto.randomUUID(),
      name: newItemName.trim(),
      quantity: newItemQuantity,
      unit: newItemUnit,
    };

    setManualItems([...manualItems, newItem]);
    setNewItemName('');
    setNewItemQuantity(1);
    setNewItemUnit('un');

    toast({
      title: "Item adicionado",
      description: `"${newItem.name}" foi adicionado à lista.`,
    });
  };

  const removeManualItem = (itemId: string) => {
    setManualItems(manualItems.filter(item => item.id !== itemId));
  };

  // Combinar itens do template com itens manuais
  const getAllItems = () => {
    const templateItems = selectedTemplate?.defaultItems?.map(item => ({
      name: item.name,
      quantity: item.quantity,
      unit: item.unit,
      category: item.category,
    })) || [];

    const manualItemsMapped = manualItems.map(item => ({
      name: item.name,
      quantity: item.quantity,
      unit: item.unit,
      category: 'geral',
    }));

    return [...templateItems, ...manualItemsMapped];
  };

  useEffect(() => {
    if (initialData) {
      setSelectedTemplate(initialData);
      setTitle(initialData.title);
      setDescription(initialData.description);
    }
  }, [initialData]);

  const handleTemplateSelect = (template: EventTemplate) => {
    setSelectedTemplate(template);
    setTitle(template.title);
    setDescription(template.description);
    toast({
      title: "Modelo aplicado",
      description: `O modelo "${template.title}" foi selecionado.`,
    });
  };

  // Detectar se localização parece residencial
  const checkResidentialLocation = (loc: string) => {
    const residentialPatterns = /(casa|residência|apt|apartamento|rua|avenida|av\.|r\.)/i;
    return residentialPatterns.test(loc);
  };

  const handleLocationChange = (value: string) => {
    setLocation(value);
    setShowLocationWarning(isPublic && checkResidentialLocation(value));
    // Se o usuário digitar manualmente, limpar o endereço selecionado
    if (selectedAddressId) {
      setSelectedAddressId(null);
    }
  };

  const handleAddressSelect = (address: Address) => {
    const formattedAddress = `${address.nickname} — ${address.street}, ${address.number}${address.complement ? ', ' + address.complement : ''}, ${address.city}/${address.state}`;
    setLocation(formattedAddress);
    setSelectedAddressId(address.id);
    setUseManualLocation(false);
    setShowLocationWarning(isPublic && checkResidentialLocation(formattedAddress));

    toast({
      title: "Endereço aplicado",
      description: `Usando "${address.nickname}" como local do evento.`,
    });
  };

  const handleToggleManualLocation = () => {
    if (!useManualLocation) {
      setLocation('');
      setSelectedAddressId(null);
    }
    setUseManualLocation(!useManualLocation);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!user) {
      toast({
        title: "Erro",
        description: "Você precisa estar logado para criar um evento.",
        variant: "destructive",
      });
      return;
    }

    if (!date) {
      toast({
        title: "Data obrigatória",
        description: "Por favor, selecione uma data para o evento.",
        variant: "destructive",
      });
      return;
    }

    // Validar se a data não é no passado
    const today = new Date();
    today.setHours(0, 0, 0, 0);

    if (date < today) {
      toast({
        title: "Data inválida",
        description: "Não é possível criar eventos em datas passadas. Escolha uma data futura.",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);

    try {
      const eventDescription = description || null;
      const formattedDate = format(date, 'yyyy-MM-dd');

      const { data: eventData, error } = await supabase
        .from('table_reune')
        .insert({
          title,
          event_date: formattedDate,
          event_time: time,
          location,
          description: eventDescription,
          user_id: user.id,
          is_public: isPublic,
          status: 'published',
          created_by_ai: false,
          public_location: isPublic && checkResidentialLocation(location)
            ? 'Local a confirmar com organizador'
            : null
        })
        .select()
        .single();

      if (error) throw error;

      // Inserir todos os itens (template + manuais)
      const allItems = getAllItems();
      if (allItems.length > 0 && eventData) {
        const itemsToInsert = allItems.map(item => ({
          event_id: eventData.id,
          nome_item: item.name,
          quantidade: item.quantity,
          unidade: item.unit,
          categoria: item.category,
          prioridade: 'B',
        }));

        const { error: itemsError } = await supabase
          .from('event_items')
          .insert(itemsToInsert);

        if (itemsError) {
          console.error("Erro ao inserir itens:", itemsError);
        }
      }

      // Se há convidados selecionados, criar convites
      if (selectedInvitees.length > 0 && eventData) {
        for (const invitee of selectedInvitees) {
          try {
            const { data: inviteData, error: inviteError } = await supabase.rpc(
              "process_invitation",
              {
                _event_id: eventData.id,
                _invitee_email: invitee.email || null,
                _invitee_name: invitee.name,
                _is_organizer: false,
                _invitee_user_id: invitee.user_id || null,
              }
            );

            if (inviteError) {
              console.error("Erro ao enviar convite para", invitee.email || invitee.name, ":", inviteError);
              continue;
            }

            const result = inviteData as any;

            if (!result?.user_exists && result?.invitation_token && invitee.email) {
              const { error: emailError } = await supabase.functions.invoke("send-invitation-email", {
                body: {
                  invitee_email: invitee.email,
                  invitee_name: invitee.name,
                  event_title: title,
                  event_date: date,
                  event_time: time,
                  is_organizer: false,
                  invitation_token: result.invitation_token,
                },
              });

              if (emailError) {
                console.error("Erro ao enviar email para", invitee.email || invitee.name, ":", emailError);
              }
            }
          } catch (err) {
            console.error("Erro ao processar convite individual:", err);
          }
        }
      }

      const pendingCount = selectedInvitees.filter(
        (inv) => inv.status === "pendente"
      ).length;
      const confirmedCount = selectedInvitees.filter(
        (inv) => inv.status === "convidado"
      ).length;

      let successMessage = "Seu evento foi publicado e já está disponível.";
      if (selectedInvitees.length > 0) {
        if (pendingCount > 0 && confirmedCount > 0) {
          successMessage = `${confirmedCount} amigo(s) convidado(s) e ${pendingCount} convite(s) pendente(s) criado(s).`;
        } else if (pendingCount > 0) {
          successMessage = `${pendingCount} convite(s) pendente(s) criado(s).`;
        } else {
          successMessage = `${confirmedCount} amigo(s) foram convidados.`;
        }
      }

      toast({
        title: "Evento criado com sucesso!",
        description: successMessage,
      });

      onCreate();
    } catch (error) {
      const message = error instanceof Error ? error.message : "Ocorreu um erro. Tente novamente.";
      toast({
        title: "Erro ao criar evento",
        description: message,
        variant: "destructive",
        duration: 5000,
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-background relative overflow-hidden">
      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="fixed top-0 left-0 w-[600px] h-[600px] bg-green-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="fixed bottom-0 right-0 w-[600px] h-[600px] bg-blue-500/20 rounded-full blur-3xl pointer-events-none"
      />

      {/* Floating Header */}
      <motion.header
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        className="fixed top-6 left-1/2 -translate-x-1/2 z-40 w-full max-w-2xl px-4"
      >
        <div className="rounded-3xl bg-card/80 backdrop-blur-xl border border-border/50 shadow-2xl px-6 py-4">
          <div className="flex items-center">
            <Button
              variant="ghost"
              size="sm"
              onClick={onBack}
              className="mr-4 hover:bg-background/80"
            >
              <ArrowLeft className="w-4 h-4" />
            </Button>
            <div>
              <h1 className="text-xl font-bold bg-gradient-to-r from-green-500 to-blue-500 bg-clip-text text-transparent">
                Criar Novo Evento
              </h1>
              <p className="text-muted-foreground text-sm">Preencha as informações do seu evento</p>
            </div>
          </div>
        </div>
      </motion.header>

      <main className="relative z-10 max-w-2xl mx-auto px-4 pt-32 pb-20">
        {/* Template Selector */}
        <motion.section
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="mb-6"
        >
          <Label className="mb-3 block text-base font-semibold flex items-center gap-2">
            <Sparkles className="w-5 h-5 text-primary" />
            Comece com um modelo (opcional)
          </Label>
          <div className="flex flex-wrap gap-2">
            {templates.map((template, index) => {
              const Icon = templateIcons[template.slug] ?? Sparkles;
              const isSelected = selectedTemplate?.slug === template.slug;

              return (
                <motion.button
                  key={template.slug}
                  type="button"
                  initial={{ opacity: 0, y: 12 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.25, delay: index * 0.08 }}
                  whileHover={{ y: -2 }}
                  onClick={() => handleTemplateSelect(template)}
                  aria-pressed={isSelected}
                  className={cn(
                    "inline-flex items-center gap-2 rounded-full border px-4 py-2 text-sm font-semibold transition-all",
                    "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary/40",
                    isSelected
                      ? "border-primary/60 bg-primary/10 text-primary shadow-sm"
                      : "border-border/60 bg-card/60 text-foreground/80 hover:border-primary/40 hover:bg-card/80"
                  )}
                >
                  <span
                    className={cn(
                      "flex h-6 w-6 items-center justify-center rounded-full",
                      isSelected ? "bg-primary/15 text-primary" : "bg-muted text-muted-foreground"
                    )}
                  >
                    <Icon className="h-3.5 w-3.5" />
                  </span>
                  <span>{template.title}</span>
                </motion.button>
              );
            })}
          </div>
        </motion.section>

        {/* Main Form Card */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.2 }}
        >
          <div className="relative">
            <div className="absolute -inset-1 bg-gradient-to-r from-green-500/50 to-blue-500/50 rounded-3xl blur opacity-20"></div>

            <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
              <div className="h-2 w-full bg-gradient-to-r from-green-500 to-blue-500" />

              <CardHeader className="pt-8">
                <CardTitle className="text-2xl font-bold flex items-center gap-2">
                  <CalendarIcon className="w-6 h-6 text-primary" />
                  Informações do Evento
                </CardTitle>
                <CardDescription className="text-base">
                  Adicione os detalhes principais do seu evento
                </CardDescription>
              </CardHeader>

              <CardContent className="pb-8">
                <form onSubmit={handleSubmit} className="space-y-6">
                  {/* Event Title */}
                  <motion.div
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.3 }}
                  >
                    <Label htmlFor="title" className="text-sm font-semibold">Nome do Evento</Label>
                    <Input
                      id="title"
                      type="text"
                      placeholder="Ex: Churrasco de Domingo"
                      value={title}
                      onChange={(e) => setTitle(e.target.value)}
                      required
                      className="h-12 mt-2 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:border-green-500 focus:shadow-lg focus:shadow-green-500/20"
                    />
                  </motion.div>

                  {/* Date and Time */}
                  <motion.div
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.4 }}
                    className="grid grid-cols-1 md:grid-cols-2 gap-4"
                  >
                    <div>
                      <Label htmlFor="date" className="text-sm font-semibold flex items-center gap-2">
                        <CalendarIcon className="w-4 h-4" />
                        Data
                      </Label>
                      <div className="mt-2">
                        <DatePicker
                          value={date}
                          onChange={setDate}
                          placeholder="Escolha a data do evento"
                          disabled={loading}
                        />
                      </div>
                    </div>
                    <div>
                      <Label htmlFor="time" className="text-sm font-semibold flex items-center gap-2">
                        <Clock className="w-4 h-4" />
                        Horário
                      </Label>
                      <div className="mt-2">
                        <TimePicker
                          value={time}
                          onChange={setTime}
                          placeholder="Escolha o horário"
                          disabled={loading}
                        />
                      </div>
                    </div>
                  </motion.div>

                  {/* Location */}
                  <motion.div
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.5 }}
                  >
                    <Label htmlFor="location" className="text-sm font-semibold flex items-center gap-2">
                      <MapPinned className="w-4 h-4" />
                      Endereço
                    </Label>
                    <div className="space-y-3 mt-2">
                      {!useManualLocation && (
                        <AddressSelector
                          onAddressSelect={handleAddressSelect}
                          disabled={loading}
                        />
                      )}

                      {useManualLocation ? (
                        <div className="space-y-2">
                          <Input
                            id="location"
                            type="text"
                            placeholder="Ex: Rua das Flores, 123 - Centro"
                            value={location}
                            onChange={(e) => handleLocationChange(e.target.value)}
                            required
                            className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:border-blue-500 focus:shadow-lg focus:shadow-blue-500/20"
                          />
                          <Button
                            type="button"
                            variant="ghost"
                            size="sm"
                            onClick={handleToggleManualLocation}
                            className="text-xs"
                          >
                            <Home className="h-3 w-3 mr-1" />
                            Voltar para endereços salvos
                          </Button>
                        </div>
                      ) : (
                        <Button
                          type="button"
                          variant="outline"
                          onClick={handleToggleManualLocation}
                          disabled={loading}
                          className="w-full h-12 border-2"
                        >
                          <MapPinned className="h-4 w-4 mr-2" />
                          Digitar endereço manualmente
                        </Button>
                      )}
                    </div>

                    {showLocationWarning && (
                      <Alert className="mt-3 border-2 border-amber-500/50 bg-amber-500/10">
                        <AlertTriangle className="h-4 w-4 text-amber-500" />
                        <AlertDescription className="text-sm">
                          <strong>Atenção:</strong> Você está adicionando um endereço residencial em um evento público.
                          Por segurança, apenas a região será exibida para não-convidados.
                          O endereço completo ficará visível apenas para você e seus convidados.
                        </AlertDescription>
                      </Alert>
                    )}
                  </motion.div>

                  {/* Description */}
                  <motion.div
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.6 }}
                  >
                    <Label htmlFor="description" className="text-sm font-semibold">Descrição (opcional)</Label>
                    <Textarea
                      id="description"
                      placeholder="Adicione detalhes sobre o evento..."
                      value={description}
                      onChange={(e) => setDescription(e.target.value)}
                      rows={4}
                      className="mt-2 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:border-primary focus:shadow-lg focus:shadow-primary/20"
                    />
                  </motion.div>

                  {/* Lista de Itens */}
                  <motion.div
                    initial={{ opacity: 0, x: -20 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ duration: 0.5, delay: 0.65 }}
                    className="space-y-4"
                  >
                    <Label className="text-sm font-semibold flex items-center gap-2">
                      <Package className="w-4 h-4" />
                      Lista de Itens (opcional)
                    </Label>

                    {/* Itens do template selecionado */}
                    {selectedTemplate?.defaultItems && selectedTemplate.defaultItems.length > 0 && (
                      <div className="space-y-2">
                        <p className="text-xs text-muted-foreground">Itens do modelo "{selectedTemplate.title}":</p>
                        <div className="flex flex-wrap gap-2">
                          {selectedTemplate.defaultItems.map((item, index) => (
                            <div
                              key={`template-${index}`}
                              className="flex items-center gap-2 px-3 py-1.5 bg-primary/10 border border-primary/20 rounded-lg text-sm"
                            >
                              <span>{item.name}</span>
                              <span className="text-muted-foreground">({item.quantity} {item.unit})</span>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {/* Itens manuais adicionados */}
                    {manualItems.length > 0 && (
                      <div className="space-y-2">
                        <p className="text-xs text-muted-foreground">Itens adicionados manualmente:</p>
                        <div className="flex flex-wrap gap-2">
                          {manualItems.map((item) => (
                            <div
                              key={item.id}
                              className="flex items-center gap-2 px-3 py-1.5 bg-muted border border-border rounded-lg text-sm group"
                            >
                              <span>{item.name}</span>
                              <span className="text-muted-foreground">({item.quantity} {item.unit})</span>
                              <button
                                type="button"
                                onClick={() => removeManualItem(item.id)}
                                className="ml-1 text-muted-foreground hover:text-destructive transition-colors"
                              >
                                <X className="w-3.5 h-3.5" />
                              </button>
                            </div>
                          ))}
                        </div>
                      </div>
                    )}

                    {/* Formulário para adicionar item */}
                    <div className="p-4 bg-muted/50 rounded-xl border-2 border-dashed border-border/50 space-y-3">
                      <div className="flex gap-2">
                        <Input
                          placeholder="Nome do item..."
                          value={newItemName}
                          onChange={(e) => setNewItemName(e.target.value)}
                          onKeyPress={(e) => e.key === 'Enter' && (e.preventDefault(), addManualItem())}
                          className="flex-1 h-10 rounded-lg bg-background"
                          disabled={loading}
                        />
                      </div>
                      <div className="flex gap-2">
                        <Input
                          type="number"
                          min="0.1"
                          step="0.1"
                          value={newItemQuantity}
                          onChange={(e) => setNewItemQuantity(parseFloat(e.target.value) || 1)}
                          placeholder="Qtd"
                          className="w-20 h-10 rounded-lg bg-background"
                          disabled={loading}
                        />
                        <Select value={newItemUnit} onValueChange={setNewItemUnit} disabled={loading}>
                          <SelectTrigger className="w-32 h-10 rounded-lg bg-background">
                            <SelectValue />
                          </SelectTrigger>
                          <SelectContent>
                            <SelectItem value="un">Unidade(s)</SelectItem>
                            <SelectItem value="kg">Kg</SelectItem>
                            <SelectItem value="g">Grama(s)</SelectItem>
                            <SelectItem value="l">Litro(s)</SelectItem>
                            <SelectItem value="ml">ml</SelectItem>
                            <SelectItem value="pct">Pacote(s)</SelectItem>
                            <SelectItem value="cx">Caixa(s)</SelectItem>
                            <SelectItem value="dz">Dúzia(s)</SelectItem>
                          </SelectContent>
                        </Select>
                        <Button
                          type="button"
                          variant="outline"
                          onClick={addManualItem}
                          disabled={!newItemName.trim() || loading}
                          className="h-10 gap-2"
                        >
                          <Plus className="w-4 h-4" />
                          Adicionar
                        </Button>
                      </div>
                    </div>
                  </motion.div>

                  {/* Event Invite Selector */}
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.7 }}
                  >
                    <EventInviteSelector
                      selectedInvitees={selectedInvitees}
                      onInviteesChange={setSelectedInvitees}
                    />
                  </motion.div>

                  {/* Submit Button */}
                  <motion.div
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ opacity: 1, y: 0 }}
                    transition={{ duration: 0.5, delay: 0.8 }}
                  >
                    <Button
                      type="submit"
                      className="w-full h-14 text-base font-semibold bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600 shadow-lg hover:shadow-xl transition-all"
                      disabled={loading || !title || !date || !time || !location}
                    >
                      {loading ? (
                        <div className="flex items-center gap-2">
                          <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                          Criando evento...
                        </div>
                      ) : (
                        'Criar Evento'
                      )}
                    </Button>
                  </motion.div>
                </form>
              </CardContent>
            </Card>
          </div>
        </motion.div>
      </main>
    </div>
  );
};

export default CreateEvent;


============================================================
FILE PATH: .\src\pages\Dashboard.tsx
============================================================
import { useState, useEffect, useCallback } from 'react';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Plus, Calendar, Clock, MapPin, Users, LogOut, AlertTriangle, Trash2, LayoutGrid, CheckCircle, UserCheck, Sparkles } from 'lucide-react';
import { cn } from '@/lib/utils';
import { supabase } from '@/integrations/supabase/client';
import { useToast } from '@/hooks/use-toast';
import { useAuth } from '@/hooks/useAuth';
import reUneLogo from '@/assets/reune-logo.png';
import { FriendsDialog } from '@/components/friends/FriendsDialog';
import { NotificationBell } from '@/components/notifications/NotificationBell';
import { AccountDialog } from '@/components/AccountDialog';
import { ProfilePromptDialog } from '@/components/ProfilePromptDialog';
import { BugReportButton } from '@/components/BugReportButton';
import { ThemeToggle } from '@/components/landing/ThemeToggle';
import { motion, useScroll, useTransform } from 'framer-motion';
import { FounderBadge } from '@/components/FounderBadge';

interface Event {
  id: number;
  title: string;
  event_date: string;
  event_time: string;
  location: string | null;
  description: string | null;
  user_id: string | null;
  is_public: boolean | null;
  status: string | null;
  created_at: string;
  isOwner: boolean;
  isConfirmed: boolean;
}

interface DashboardProps {
  userEmail: string;
  onCreateEvent: () => void;
  onViewEvent: (eventId: string) => void;
  onLogout: () => void;
}

const Dashboard = ({ userEmail, onCreateEvent, onViewEvent, onLogout }: DashboardProps) => {
  const { user } = useAuth();
  const { toast } = useToast();
  const [events, setEvents] = useState<Event[]>([]);
  const [loading, setLoading] = useState(true);
  const [accountDialogOpen, setAccountDialogOpen] = useState(false);
  const [profilePromptOpen, setProfilePromptOpen] = useState(false);
  const [founderData, setFounderData] = useState<{
    is_founder: boolean;
    founder_since?: string;
    premium_until?: string;
    storage_multiplier?: number;
  } | null>(null);
  const userId = user?.id;
  const { scrollYProgress } = useScroll();
  const opacity = useTransform(scrollYProgress, [0, 0.2], [1, 0]);

  const handleLogout = async () => {
    try {
      const { error } = await supabase.auth.signOut();
      if (error) throw error;

      toast({
        title: "Logout realizado com sucesso!",
        description: "Até logo!",
      });

      onLogout();
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro no logout",
        description: err?.message || "Ocorreu um erro. Tente novamente.",
        variant: "destructive",
      });
    }
  };

  const handleDeleteEvent = async (eventId: number, e: React.MouseEvent) => {
    e.stopPropagation();

    if (!confirm('Tem certeza que deseja deletar este evento? Esta ação não pode ser desfeita.')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('table_reune')
        .delete()
        .eq('id', eventId);

      if (error) throw error;

      toast({
        title: "Evento deletado!",
        description: "O evento foi removido com sucesso.",
      });

      fetchEvents();
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao deletar evento",
        description: err?.message || "Não foi possível deletar o evento.",
        variant: "destructive",
      });
    }
  };

  const fetchFounderData = useCallback(async () => {
    if (!userId) return;

    try {
      const { data, error } = await supabase
        .from('profiles')
        .select('is_founder, founder_since, premium_until, storage_multiplier')
        .eq('id', userId)
        .single();

      if (error) {
        console.error('Erro ao buscar dados de founder:', error);
        return;
      }

      if (data?.is_founder) {
        setFounderData(data);
      }
    } catch (error) {
      console.error('Erro ao buscar dados de founder:', error);
    }
  }, [userId]);

  const fetchEvents = useCallback(async () => {
    if (!userId) return;

    try {
      setLoading(true);

      // Busca apenas eventos onde o usuário é criador
      const { data: ownEvents, error: ownError } = await supabase
        .from('table_reune')
        .select('*')
        .eq('user_id', userId)
        .order('event_date', { ascending: true });

      if (ownError) throw ownError;

      // Busca notificações de convites para o usuário atual
      const { data: notifications, error: notificationsError } = await supabase
        .from('notifications')
        .select('event_id, metadata')
        .eq('user_id', userId)
        .in('type', ['event_invite', 'organizer_invite']);

      if (notificationsError) throw notificationsError;

      // Se há notificações de convite, buscar os eventos correspondentes
      let invitedEvents: any[] = [];
      if (notifications && notifications.length > 0) {
        const invitedEventIds = [...new Set(notifications.map(n => n.event_id).filter(Boolean))];

        if (invitedEventIds.length > 0) {
          const invitedDetails = await Promise.all(
            invitedEventIds.map(async (eventId) => {
              const { data, error } = await supabase.rpc('get_event_details_safe', {
                _event_id: eventId,
              });

              if (error) {
                console.error('Erro ao buscar detalhes do evento convidado:', error);
                return null;
              }

              const row = Array.isArray(data) ? data[0] : data;
              return row || null;
            })
          );

          invitedEvents = invitedDetails.filter(Boolean);
        }
      }

      // Combinar eventos próprios e convidados (sem duplicatas)
      const allEvents = [...(ownEvents || [])];
      invitedEvents.forEach(event => {
        if (!allEvents.find(e => e.id === event.id)) {
          allEvents.push(event);
        }
      });

      // Ordenar por data
      allEvents.sort((a, b) => new Date(a.event_date).getTime() - new Date(b.event_date).getTime());

      // Busca confirmações do usuário
      const { data: confirmationsData, error: confirmationsError } = await supabase
        .from('event_confirmations')
        .select('event_id, presence_confirmed')
        .eq('user_id', userId);

      if (confirmationsError) throw confirmationsError;

      // Cria um mapa de confirmações
      const confirmationsMap = new Map(
        confirmationsData?.map(c => [c.event_id, c.presence_confirmed]) || []
      );

      const eventsWithStatus = allEvents.map(event => ({
        ...event,
        isOwner: event.user_id === userId,
        isConfirmed: confirmationsMap.get(event.id) === true
      }));

      setEvents(eventsWithStatus);
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao carregar eventos",
        description: err?.message || "Não foi possível carregar os eventos.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  }, [userId, toast, user?.email]);

  useEffect(() => {
    fetchEvents();
    fetchFounderData();
  }, [fetchEvents, fetchFounderData]);

  // Verificar se deve exibir o popup de perfil
  useEffect(() => {
    const checkProfilePrompt = async () => {
      if (!userId) return;

      try {
        const { data: profile, error } = await supabase
          .from('profiles')
          .select('hide_profile_prompt')
          .eq('id', userId)
          .single();

        if (error) throw error;

        // Mostrar popup se a preferência não estiver marcada
        if (!profile?.hide_profile_prompt) {
          // Pequeno delay para melhor UX (esperar a tela carregar)
          setTimeout(() => {
            setProfilePromptOpen(true);
          }, 1000);
        }
      } catch (error) {
        console.error('Erro ao verificar preferência de perfil:', error);
      }
    };

    checkProfilePrompt();
  }, [userId]);

  const formatDate = (dateStr: string) => {
    if (!dateStr) return '';
    // Fix timezone issue by parsing components manually
    // Treating YYYY-MM-DD as local date instead of UTC midnight
    const [year, month, day] = dateStr.split('T')[0].split('-').map(Number);
    const date = new Date(year, month - 1, day);

    return date.toLocaleDateString('pt-BR', {
      day: 'numeric',
      month: 'short'
    });
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center relative overflow-hidden">
        {/* Animated Background Orbs */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-96 h-96 bg-orange-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl"
        />

        <div className="text-center relative z-10">
          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto"></div>
          <p className="mt-4 text-muted-foreground">Carregando eventos...</p>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background overflow-hidden relative">
      {/* Theme Toggle */}
      <ThemeToggle className="fixed top-4 right-4 z-50" />

      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="fixed top-0 left-0 w-[600px] h-[600px] bg-orange-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="fixed bottom-0 right-0 w-[600px] h-[600px] bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 2 }}
        className="fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-amber-500/10 rounded-full blur-3xl pointer-events-none"
      />

      {/* Floating Header */}
      <motion.header
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        className="fixed top-6 z-40 w-full md:w-auto left-0 md:left-auto right-0 md:right-20 flex justify-center md:block px-4 pointer-events-none"
      >
        <div className="pointer-events-auto rounded-3xl bg-background/80 backdrop-blur-xl border border-border/50 shadow-2xl px-6 py-4 w-full max-w-md md:w-auto md:max-w-none">
          <div className="flex justify-between md:justify-start items-center md:gap-12">
            <div className="flex items-center gap-4">
              <motion.img
                src={reUneLogo}
                alt="ReUNE Logo"
                className="h-12 w-auto"
                whileHover={{ scale: 1.05, rotate: 5 }}
                transition={{ type: "spring", stiffness: 400 }}
              />
              <div>
                <h1 className="text-2xl font-bold bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                  ReUNE
                </h1>
                <div className="flex items-center gap-2">
                  <p className="text-sm text-muted-foreground">Olá, {userEmail}!</p>
                  {founderData?.is_founder && (
                    <FounderBadge
                      variant="compact"
                      founderSince={founderData.founder_since}
                      premiumUntil={founderData.premium_until}
                      storageMultiplier={founderData.storage_multiplier}
                    />
                  )}
                </div>
                <Button
                  variant="link"
                  size="sm"
                  onClick={() => setAccountDialogOpen(true)}
                >
                  Minha Conta →
                </Button>
              </div>
            </div>
            <div className="flex items-center gap-2">
              <NotificationBell />
              <Button
                variant="ghost"
                size="sm"
                onClick={handleLogout}
                className="text-muted-foreground hover:text-foreground"
              >
                <LogOut className="w-4 h-4 mr-2" />
                Sair
              </Button>
            </div>
          </div>
        </div>
      </motion.header>

      {/* Main Content */}
      <main className="relative z-10 max-w-6xl mx-auto px-4 pt-32 pb-20">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5 }}
          className="mb-8"
        >
          <div className="flex flex-col gap-6 sm:flex-row sm:justify-between sm:items-center mb-8">
            <div>
              <Badge className="mb-3 px-3 py-1 text-sm font-medium bg-gradient-to-r from-orange-500/10 to-amber-500/10 border-orange-500/20 text-orange-600 dark:text-orange-400">
                <Sparkles className="w-4 h-4 mr-2 inline" />
                Dashboard Inteligente
              </Badge>
              <h2 className="text-4xl font-bold bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                Meus Eventos
              </h2>
              <p className="text-muted-foreground mt-2">
                Organize e gerencie todos os seus eventos em um só lugar
              </p>
            </div>
            <div className="flex gap-2 flex-wrap">
              <FriendsDialog />
              <Button
                onClick={onCreateEvent}
                size="lg"
                className="bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 shadow-lg group"
              >
                <Plus className="w-4 h-4 mr-2 group-hover:rotate-90 transition-transform" />
                Criar Novo Evento
              </Button>
            </div>
          </div>

          {/* Enhanced Tabs for Event Categorization */}
          <Tabs defaultValue="all" className="w-full">
            <TabsList className="grid w-full max-w-2xl grid-cols-4 h-14 mb-10 bg-card/50 backdrop-blur-sm p-1.5 rounded-2xl border border-border/50 shadow-lg">
              <TabsTrigger
                value="all"
                className="rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/10 data-[state=active]:to-amber-500/10 data-[state=active]:shadow-md transition-all font-medium"
              >
                <LayoutGrid className="w-4 h-4 mr-2" />
                Todos ({events.length})
              </TabsTrigger>
              <TabsTrigger
                value="owner"
                className="rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/10 data-[state=active]:to-amber-500/10 data-[state=active]:shadow-md transition-all font-medium"
              >
                <Users className="w-4 h-4 mr-2" />
                Criados ({events.filter(e => e.isOwner).length})
              </TabsTrigger>
              <TabsTrigger
                value="confirmed"
                className="rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/10 data-[state=active]:to-amber-500/10 data-[state=active]:shadow-md transition-all font-medium"
              >
                <CheckCircle className="w-4 h-4 mr-2" />
                Confirmados ({events.filter(e => !e.isOwner && e.isConfirmed).length})
              </TabsTrigger>
              <TabsTrigger
                value="pending"
                className="rounded-xl data-[state=active]:bg-gradient-to-r data-[state=active]:from-orange-500/10 data-[state=active]:to-amber-500/10 data-[state=active]:shadow-md transition-all font-medium"
              >
                <UserCheck className="w-4 h-4 mr-2" />
                Pendentes ({events.filter(e => !e.isOwner && !e.isConfirmed).length})
              </TabsTrigger>
            </TabsList>

            {/* All Events */}
            <TabsContent value="all" className="mt-0">
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
                className="grid gap-6 md:grid-cols-2 lg:grid-cols-3"
              >
                {events.length === 0 ? (
                  <div className="col-span-full text-center py-20">
                    <div className="max-w-md mx-auto">
                      <div className="w-20 h-20 rounded-full bg-gradient-to-r from-orange-500/20 to-amber-500/20 flex items-center justify-center mx-auto mb-6">
                        <Calendar className="w-10 h-10 text-orange-500" />
                      </div>
                      <h3 className="text-2xl font-bold text-foreground mb-2">Nenhum evento ainda</h3>
                      <p className="text-muted-foreground mb-6">Comece criando seu primeiro evento incrível!</p>
                      <Button
                        onClick={onCreateEvent}
                        size="lg"
                        className="bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600"
                      >
                        <Plus className="w-4 h-4 mr-2" />
                        Criar Primeiro Evento
                      </Button>
                    </div>
                  </div>
                ) : (
                  events.map((event, index) => (
                    <EventCard
                      key={event.id}
                      event={event}
                      index={index}
                      onViewEvent={onViewEvent}
                      onDeleteEvent={handleDeleteEvent}
                      formatDate={formatDate}
                    />
                  ))
                )}
              </motion.div>
            </TabsContent>

            {/* Owner Events */}
            <TabsContent value="owner" className="mt-0">
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
                className="grid gap-6 md:grid-cols-2 lg:grid-cols-3"
              >
                {events.filter(event => event.isOwner).length === 0 ? (
                  <div className="col-span-full text-center py-20">
                    <div className="max-w-md mx-auto">
                      <div className="w-20 h-20 rounded-full bg-gradient-to-r from-orange-500/20 to-amber-500/20 flex items-center justify-center mx-auto mb-6">
                        <Users className="w-10 h-10 text-orange-500" />
                      </div>
                      <h3 className="text-2xl font-bold text-foreground mb-2">Nenhum evento criado</h3>
                      <p className="text-muted-foreground mb-6">Crie eventos e convide seus amigos!</p>
                      <Button
                        onClick={onCreateEvent}
                        size="lg"
                        className="bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600"
                      >
                        <Plus className="w-4 h-4 mr-2" />
                        Criar Primeiro Evento
                      </Button>
                    </div>
                  </div>
                ) : (
                  events.filter(event => event.isOwner).map((event, index) => (
                    <EventCard
                      key={event.id}
                      event={event}
                      index={index}
                      onViewEvent={onViewEvent}
                      onDeleteEvent={handleDeleteEvent}
                      formatDate={formatDate}
                    />
                  ))
                )}
              </motion.div>
            </TabsContent>

            {/* Confirmed Events */}
            <TabsContent value="confirmed" className="mt-0">
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
                className="grid gap-6 md:grid-cols-2 lg:grid-cols-3"
              >
                {events.filter(event => !event.isOwner && event.isConfirmed).length === 0 ? (
                  <div className="col-span-full text-center py-20">
                    <div className="max-w-md mx-auto">
                      <div className="w-20 h-20 rounded-full bg-gradient-to-r from-green-500/20 to-emerald-500/20 flex items-center justify-center mx-auto mb-6">
                        <CheckCircle className="w-10 h-10 text-green-500" />
                      </div>
                      <h3 className="text-2xl font-bold text-foreground mb-2">Nenhum evento confirmado</h3>
                      <p className="text-muted-foreground">Confirme sua presença nos eventos pendentes!</p>
                    </div>
                  </div>
                ) : (
                  events.filter(event => !event.isOwner && event.isConfirmed).map((event, index) => (
                    <EventCard
                      key={event.id}
                      event={event}
                      index={index}
                      onViewEvent={onViewEvent}
                      onDeleteEvent={handleDeleteEvent}
                      formatDate={formatDate}
                    />
                  ))
                )}
              </motion.div>
            </TabsContent>

            {/* Pending Events */}
            <TabsContent value="pending" className="mt-0">
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.3 }}
                className="grid gap-6 md:grid-cols-2 lg:grid-cols-3"
              >
                {events.filter(event => !event.isOwner && !event.isConfirmed).length === 0 ? (
                  <div className="col-span-full text-center py-20">
                    <div className="max-w-md mx-auto">
                      <div className="w-20 h-20 rounded-full bg-gradient-to-r from-amber-500/20 to-yellow-500/20 flex items-center justify-center mx-auto mb-6">
                        <UserCheck className="w-10 h-10 text-amber-500" />
                      </div>
                      <h3 className="text-2xl font-bold text-foreground mb-2">Nenhum evento pendente</h3>
                      <p className="text-muted-foreground">Você está em dia com seus eventos!</p>
                    </div>
                  </div>
                ) : (
                  events.filter(event => !event.isOwner && !event.isConfirmed).map((event, index) => (
                    <EventCard
                      key={event.id}
                      event={event}
                      index={index}
                      onViewEvent={onViewEvent}
                      onDeleteEvent={handleDeleteEvent}
                      formatDate={formatDate}
                    />
                  ))
                )}
              </motion.div>
            </TabsContent>
          </Tabs>
        </motion.div>
      </main>

      {/* Modal Minha Conta */}
      <AccountDialog
        open={accountDialogOpen}
        onOpenChange={setAccountDialogOpen}
        userEmail={userEmail}
      />

      {/* Popup educacional de perfil */}
      <ProfilePromptDialog
        open={profilePromptOpen}
        onOpenChange={setProfilePromptOpen}
        onNavigateToProfile={() => setAccountDialogOpen(true)}
      />

      {/* Bug Report Button - Fixed position */}
      <BugReportButton />
    </div>
  );
};

// Event Card Component for DRY principle
interface EventCardProps {
  event: Event;
  index: number;
  onViewEvent: (eventId: string) => void;
  onDeleteEvent: (eventId: number, e: React.MouseEvent) => Promise<void>;
  formatDate: (dateStr: string) => string;
}

const EventCard = ({ event, index, onViewEvent, onDeleteEvent, formatDate }: EventCardProps) => {
  const gradients = [
    'from-orange-500/20 to-amber-500/20',
    'from-cyan-500/20 to-blue-500/20',
    'from-purple-500/20 to-pink-500/20',
    'from-green-500/20 to-emerald-500/20',
    'from-red-500/20 to-orange-500/20',
    'from-indigo-500/20 to-purple-500/20',
  ];

  const borderGradients = [
    'from-orange-500/50 to-amber-500/50',
    'from-cyan-500/50 to-blue-500/50',
    'from-purple-500/50 to-pink-500/50',
    'from-green-500/50 to-emerald-500/50',
    'from-red-500/50 to-orange-500/50',
    'from-indigo-500/50 to-purple-500/50',
  ];

  const gradient = gradients[index % gradients.length];
  const borderGradient = borderGradients[index % borderGradients.length];

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.3, delay: index * 0.05 }}
      whileHover={{ y: -8, scale: 1.02 }}
      className="group"
    >
      <div className="relative">
        {/* Gradient Border Glow */}
        <div className={cn(
          "absolute -inset-0.5 bg-gradient-to-r rounded-3xl opacity-0 group-hover:opacity-100 blur transition-opacity duration-300",
          borderGradient
        )} />

        <Card
          className={cn(
            "relative cursor-pointer border-2 border-border/50 rounded-3xl overflow-hidden transition-all duration-300",
            "bg-card/50 backdrop-blur-sm",
            "group-hover:border-border group-hover:shadow-2xl"
          )}
          onClick={() => onViewEvent(event.id.toString())}
        >
          {/* Top Gradient Bar */}
          <div className={cn("h-2 w-full bg-gradient-to-r", borderGradient)} />

          <CardHeader className="pb-4 pt-6">
            <div className="flex justify-between items-start">
              <div className="flex-1">
                <Badge
                  variant="secondary"
                  className={cn(
                    "mb-3 px-3 py-1 text-xs font-semibold bg-gradient-to-r",
                    gradient,
                    "border-0"
                  )}
                >
                  {event.isOwner ? '👑 Organizador' : event.isConfirmed ? '✓ Confirmado' : '⏳ Pendente'}
                </Badge>
                <CardTitle className="text-xl font-bold text-foreground group-hover:bg-gradient-to-r group-hover:from-orange-500 group-hover:to-amber-500 group-hover:bg-clip-text group-hover:text-transparent transition-all">
                  {event.title}
                </CardTitle>
              </div>
              {event.isOwner && (
                <Button
                  variant="ghost"
                  size="sm"
                  className="h-9 w-9 p-0 hover:bg-destructive/10 hover:text-destructive rounded-full"
                  onClick={(e) => onDeleteEvent(event.id, e)}
                >
                  <Trash2 className="w-4 h-4" />
                </Button>
              )}
            </div>
          </CardHeader>

          <CardContent>
            <div className="space-y-3">
              <div className="flex items-center text-sm font-medium text-foreground/90">
                <div className={cn("w-9 h-9 rounded-xl bg-gradient-to-r flex items-center justify-center mr-3", gradient)}>
                  <Calendar className="w-4 h-4 text-foreground" />
                </div>
                <div>
                  <div>{formatDate(event.event_date)}</div>
                  <div className="text-xs text-muted-foreground">{event.event_time}</div>
                </div>
              </div>

              <div className="flex items-center text-sm text-foreground/80">
                <div className={cn("w-9 h-9 rounded-xl bg-gradient-to-r flex items-center justify-center mr-3", gradient)}>
                  <MapPin className="w-4 h-4 text-foreground" />
                </div>
                <div className="flex-1 truncate">
                  {event.location || 'Local não informado'}
                </div>
              </div>
            </div>

            {/* Hover Effect Line */}
            <div className={cn(
              "mt-4 h-1 w-0 group-hover:w-full transition-all duration-300 rounded-full bg-gradient-to-r",
              borderGradient
            )} />
          </CardContent>
        </Card>
      </div>
    </motion.div>
  );
};

export default Dashboard;


============================================================
FILE PATH: .\src\pages\EventDetails.tsx
============================================================
import { useState, useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Checkbox } from "@/components/ui/checkbox";
import { Calendar as CalendarComponent } from "@/components/ui/calendar";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Textarea } from "@/components/ui/textarea";
import { ArrowLeft, Calendar, Clock, MapPin, Users, Plus, Package, Check, X, UserPlus, UserMinus, Trash2, Edit2, Save, Gift, DollarSign, Pencil } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { useEvent } from "@/hooks/useEvent";
import { useAuth } from "@/hooks/useAuth";
import { OrganizerInviteDialog } from "@/components/events/OrganizerInviteDialog";
import { supabase } from "@/integrations/supabase/client";
import { rpc } from "@/api/rpc";
import { useNavigate } from "react-router-dom";
import { motion } from "framer-motion";
import { Label } from "@/components/ui/label";
import { DatePicker } from "@/components/ui/date-picker";
import { TimePicker } from "@/components/ui/time-picker";

interface Attendee {
  id: number;
  name: string;
  email?: string;
  status: "pendente" | "confirmado" | "recusado";
}

interface Supply {
  id: number;
  name: string;
  quantidade: number;
  unidade: string;
  categoria: string;
  prioridade: string;
  valor_estimado: number | null;
  assignments: ItemAssignment[];
}

interface ItemAssignment {
  id: string;
  participant_id: number;
  participant_name: string;
  quantidade_atribuida: number;
  confirmado: boolean;
}

interface EventDetailsProps {
  eventId: string;
  onBack: () => void;
}

interface EventConfirmation {
  date: "confirmed" | "rejected" | "pending";
  time: "confirmed" | "rejected" | "pending";
  location: "confirmed" | "rejected" | "pending";
}

const EventDetails = ({ eventId, onBack }: EventDetailsProps) => {
  const { toast } = useToast();
  const { user, session } = useAuth();
  const { event, organizers, loading, error, isOrganizer, addOrganizer, removeOrganizer } = useEvent(eventId);
  const navigate = useNavigate();

  const [attendees, setAttendees] = useState<Attendee[]>([]);
  const [supplies, setSupplies] = useState<Supply[]>([]);
  const [newSupply, setNewSupply] = useState("");
  const [newSupplyQuantity, setNewSupplyQuantity] = useState(1);
  const [newSupplyUnit, setNewSupplyUnit] = useState("un");
  const [friends, setFriends] = useState<{ friend_id: string }[]>([]);
  const [currentParticipantId, setCurrentParticipantId] = useState<number | null>(null);
  const [isConfirmedGuest, setIsConfirmedGuest] = useState(false);

  // Variáveis de permissão consolidadas para restaurar funcionalidade
  const isEventCreator = event?.user_id === user?.id;
  const canViewFullDetails = isOrganizer || isEventCreator || isConfirmedGuest;
  // Permissão de edição: apenas criador ou organizador podem editar
  const canEdit = isOrganizer || isEventCreator;

  console.log('[EventDetails] Debug Permissions:', {
    userId: user?.id,
    eventUserId: event?.user_id,
    isEventCreator,
    isOrganizer,
    canEdit,
    canViewFullDetails,
    eventData: event
  });

  // Estados para edição das informações básicas do evento
  const [isEditingEventInfo, setIsEditingEventInfo] = useState(false);
  const [editEventTitle, setEditEventTitle] = useState('');
  const [editEventDate, setEditEventDate] = useState<Date | undefined>();
  const [editEventTime, setEditEventTime] = useState('');
  const [editEventLocation, setEditEventLocation] = useState('');
  const [editEventDescription, setEditEventDescription] = useState('');

  const [editingSupplyId, setEditingSupplyId] = useState<number | null>(null);
  const [editingSupplyData, setEditingSupplyData] = useState<{ name: string; quantidade: number; unidade: string; valor_estimado: number | null }>({ name: '', quantidade: 1, unidade: 'un', valor_estimado: null });
  const [organizerInfo, setOrganizerInfo] = useState<{ username: string | null; email: string | null }>({
    username: null,
    email: null
  });
  const [coOrganizersInfo, setCoOrganizersInfo] = useState<Record<string, { username: string | null; email: string | null }>>({});

  // Estados para dinâmicas do evento
  const [hasSecretSanta, setHasSecretSanta] = useState(false);
  const [secretSantaData, setSecretSantaData] = useState<any>(null);

  // Estados para confirmação flexível
  const [confirmation, setConfirmation] = useState<EventConfirmation>({
    date: "pending",
    time: "pending",
    location: "pending",
  });

  // Estados para alternativas propostas
  const [alternativeDate, setAlternativeDate] = useState<Date | undefined>();
  const [alternativeTime, setAlternativeTime] = useState("");
  const [alternativeLocation, setAlternativeLocation] = useState("");

  // Estados para controlar popovers
  const [showDatePopover, setShowDatePopover] = useState(false);
  const [showTimePopover, setShowTimePopover] = useState(false);
  const [showLocationPopover, setShowLocationPopover] = useState(false);
  const [saving, setSaving] = useState(false);

  // Carregar amigos
  useEffect(() => {
    if (!user) return;

    const loadFriends = async () => {
      try {
        const { data, error } = await supabase.rpc("get_friends", { _search: null });
        if (error) throw error;
        if (data) {
          setFriends(data.map((f: any) => ({ friend_id: f.friend_id })));
        }
      } catch (err) {
        console.error("Erro ao carregar amigos:", err);
      }
    };

    loadFriends();
  }, [user]);

  // Verificar se usuário é convidado confirmado
  useEffect(() => {
    if (!event || !user) return;

    const checkInvitationStatus = async () => {
      try {
        const { data, error } = await supabase
          .from('event_invitations')
          .select('status')
          .eq('event_id', Number(eventId))
          .eq('participant_email', user.email)
          .maybeSingle();

        if (error) {
          setIsConfirmedGuest(false);
          return;
        }
        if (!data) {
          setIsConfirmedGuest(false);
          return;
        }
        if (data.status === 'accepted') {
          setIsConfirmedGuest(true);
        } else {
          setIsConfirmedGuest(false);
        }
      } catch (err) {
        console.error('Erro ao verificar status de convite:', err);
      }
    };

    checkInvitationStatus();
  }, [event, user, eventId]);

  // Buscar informações do organizador
  useEffect(() => {
    if (!event) return;

    const fetchOrganizerInfo = async () => {
      try {
        const { data: profileData } = await supabase
          .from('profiles')
          .select('username')
          .eq('id', event.user_id)
          .maybeSingle();

        // Se o usuário logado é o organizador, usar seu próprio email
        const organizerEmail = user?.id === event.user_id ? user.email : null;

        setOrganizerInfo({
          username: profileData?.username || null,
          email: organizerEmail || null,
        });
      } catch (err) {
        console.error('Erro ao buscar informações do organizador:', err);
      }
    };

    fetchOrganizerInfo();
  }, [event, user]);

  // Buscar informações dos co-organizadores
  useEffect(() => {
    if (!organizers.length) return;

    const fetchCoOrganizersInfo = async () => {
      try {
        const userIds = organizers.map(o => o.user_id);
        const { data: profilesData } = await supabase
          .from('profiles')
          .select('id, username')
          .in('id', userIds);

        if (profilesData) {
          const infoMap: Record<string, { username: string | null; email: string | null }> = {};
          profilesData.forEach((profile: any) => {
            infoMap[profile.id] = {
              username: profile.username || null,
              email: null,
            };
          });
          setCoOrganizersInfo(infoMap);
        }
      } catch (err) {
        console.error('Erro ao buscar informações dos co-organizadores:', err);
      }
    };

    fetchCoOrganizersInfo();
  }, [organizers]);

  // Carregar dinâmicas do evento
  useEffect(() => {
    if (!event) return;

    const loadDynamics = async () => {
      try {
        const { data: dynamicsData, error: dynamicsError } = await supabase
          .from("event_dynamics")
          .select("*")
          .eq("event_id", Number(eventId))
          .eq("type", "secret_santa")
          .maybeSingle();

        if (dynamicsError && dynamicsError.code !== 'PGRST116') throw dynamicsError;

        if (dynamicsData) {
          setHasSecretSanta(true);

          // Carregar dados do Amigo Secreto
          const { data: secretSantaData, error: secretSantaError } = await supabase
            .from("event_secret_santa")
            .select("*")
            .eq("event_id", Number(eventId))
            .maybeSingle();

          if (secretSantaError && secretSantaError.code !== 'PGRST116') throw secretSantaError;

          if (secretSantaData) {
            setSecretSantaData(secretSantaData);
          }
        }
      } catch (err) {
        console.error("Erro ao carregar dinâmicas:", err);
      }
    };

    loadDynamics();
  }, [event, eventId]);

  // Carregar participantes e itens do banco de dados
  useEffect(() => {
    // Carregar dados para qualquer usuário autenticado com acesso ao evento
    if (!event || !user) return;

    const loadEventData = async () => {
      try {
        const eventIdNum = Number(eventId);

        // Carregar participantes a partir de event_invitations
        const { data: invitationsData, error: invitationsError } = await supabase
          .from("event_invitations")
          .select("id, participant_email, participant_name, status")
          .eq("event_id", eventIdNum);

        if (invitationsError) throw invitationsError;

        if (invitationsData) {
          const mappedAttendees: Attendee[] = invitationsData.map((inv: any) => ({
            id: inv.id,
            name: inv.participant_name,
            email: inv.participant_email,
            status: inv.status === 'accepted' ? 'confirmado' : inv.status === 'declined' ? 'recusado' : 'pendente',
          }));
          setAttendees(mappedAttendees);

          // Encontrar o ID da invitation do usuário atual
          const myInvitation = invitationsData.find((inv: any) => inv.participant_email === user.email);
          if (myInvitation) {
            // Buscar o participant_id na tabela event_participants baseado no email
            const { data: participantData } = await supabase
              .from("event_participants")
              .select("id")
              .eq("event_id", eventIdNum)
              .eq("contato", user.email)
              .maybeSingle();

            if (participantData) {
              setCurrentParticipantId(participantData.id);
            }
          }
        }

        // Carregar itens com suas atribuições
        const { data: itemsData, error: itemsError } = await supabase
          .from("event_items")
          .select("*")
          .eq("event_id", eventIdNum);

        if (itemsError) throw itemsError;

        // Carregar atribuições
        const { data: assignmentsData, error: assignmentsError } = await supabase
          .from("item_assignments")
          .select(`
            id,
            item_id,
            participant_id,
            quantidade_atribuida,
            confirmado
          `)
          .eq("event_id", eventIdNum);

        if (assignmentsError) throw assignmentsError;

        if (itemsData) {
          const mappedSupplies: Supply[] = itemsData.map((item: any) => {
            const itemAssignments = (assignmentsData || [])
              .filter((a: any) => a.item_id === item.id)
              .map((a: any) => ({
                id: a.id,
                participant_id: a.participant_id,
                participant_name: "Participante",
                quantidade_atribuida: a.quantidade_atribuida,
                confirmado: a.confirmado,
              }));

            return {
              id: item.id,
              name: item.nome_item,
              quantidade: item.quantidade,
              unidade: item.unidade,
              categoria: item.categoria,
              prioridade: item.prioridade,
              valor_estimado: item.valor_estimado,
              assignments: itemAssignments,
            };
          });
          setSupplies(mappedSupplies);
        }
      } catch (err) {
        console.error("Erro ao carregar dados do evento:", err);
      }
    };

    loadEventData();

    // Configurar realtime
    const eventIdNum = Number(eventId);

    const invitationsChannel = supabase
      .channel(`invitations_${eventIdNum}`)
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'event_invitations',
          filter: `event_id=eq.${eventIdNum}`
        },
        () => {
          loadEventData();
        }
      )
      .subscribe();

    const itemsChannel = supabase
      .channel(`items_${eventIdNum}`)
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'event_items',
          filter: `event_id=eq.${eventIdNum}`
        },
        () => {
          loadEventData();
        }
      )
      .subscribe();

    const assignmentsChannel = supabase
      .channel(`assignments_${eventIdNum}`)
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'item_assignments',
          filter: `event_id=eq.${eventIdNum}`
        },
        () => {
          loadEventData();
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(invitationsChannel);
      supabase.removeChannel(itemsChannel);
      supabase.removeChannel(assignmentsChannel);
    };
  }, [event, eventId, user]);

  const formatDate = (dateStr: string) => {
    const date = new Date(dateStr);
    return date.toLocaleDateString("pt-BR", {
      weekday: "long",
      year: "numeric",
      month: "long",
      day: "numeric",
    });
  };

  // Funções para edição das informações do evento
  const startEditingEventInfo = () => {
    if (!event) return;
    setEditEventTitle(event.title);
    setEditEventDate(new Date(event.event_date + 'T12:00:00'));
    setEditEventTime(event.event_time);
    setEditEventLocation(event.location || '');
    setEditEventDescription(event.description || '');
    setIsEditingEventInfo(true);
  };

  // Auto-start edit mode for creators/organizers
  const hasInitializedEditMode = useState(false); // Using state to track initialization
  useEffect(() => {
    if (event && canEdit && !isEditingEventInfo && !hasInitializedEditMode[0]) {
      startEditingEventInfo();
      hasInitializedEditMode[1](true);
    }
  }, [event, canEdit]);

  const cancelEditingEventInfo = () => {
    setIsEditingEventInfo(false);
    setEditEventTitle('');
    setEditEventDate(undefined);
    setEditEventTime('');
    setEditEventLocation('');
    setEditEventDescription('');
  };

  const saveEventInfo = async () => {
    if (!event || !editEventDate) return;

    setSaving(true);
    try {
      const { error } = await supabase
        .from('table_reune')
        .update({
          title: editEventTitle,
          event_date: format(editEventDate, 'yyyy-MM-dd'),
          event_time: editEventTime,
          location: editEventLocation,
          description: editEventDescription || null,
        })
        .eq('id', Number(eventId));

      if (error) throw error;

      toast({
        title: "Evento atualizado",
        description: "As informações do evento foram salvas com sucesso.",
      });

      setIsEditingEventInfo(false);
      // Força refetch do evento
      window.location.reload();
    } catch (err: any) {
      console.error("Erro ao salvar evento:", err);
      toast({
        title: "Erro ao salvar",
        description: err.message || "Não foi possível salvar as alterações.",
        variant: "destructive",
      });
    } finally {
      setSaving(false);
    }
  };

  // Função para verificar se pode confirmar presença
  const canConfirmPresence = () => {
    return (
      confirmation.date === "confirmed" && confirmation.time === "confirmed" && confirmation.location === "confirmed"
    );
  };

  const handleConfirmDate = () => {
    setConfirmation((prev) => ({ ...prev, date: "confirmed" }));
  };

  const handleRejectDate = () => {
    setConfirmation((prev) => ({ ...prev, date: "rejected" }));
    setShowDatePopover(true);
  };

  const handleConfirmTime = () => {
    setConfirmation((prev) => ({ ...prev, time: "confirmed" }));
  };

  const handleRejectTime = () => {
    setConfirmation((prev) => ({ ...prev, time: "rejected" }));
    setShowTimePopover(true);
  };

  const handleConfirmLocation = () => {
    setConfirmation((prev) => ({ ...prev, location: "confirmed" }));
  };

  const handleRejectLocation = () => {
    setConfirmation((prev) => ({ ...prev, location: "rejected" }));
    setShowLocationPopover(true);
  };

  // Funções para salvar alternativas
  const saveAlternativeDate = () => {
    if (alternativeDate) {
      toast({
        title: "Alternativa de data enviada!",
        description: `Você sugeriu: ${format(alternativeDate, "dd/MM/yyyy", { locale: ptBR })}`,
      });
      setShowDatePopover(false);
    }
  };

  const saveAlternativeTime = () => {
    if (alternativeTime) {
      toast({
        title: "Alternativa de horário enviada!",
        description: `Você sugeriu: ${alternativeTime}`,
      });
      setShowTimePopover(false);
    }
  };

  const saveAlternativeLocation = () => {
    if (alternativeLocation.trim()) {
      toast({
        title: "Alternativa de local enviada!",
        description: `Você sugeriu: ${alternativeLocation}`,
      });
      setShowLocationPopover(false);
      setAlternativeLocation("");
    }
  };

  const handleSaveConfirmation = async () => {
    if (!user || !session) {
      toast({
        title: "Autenticação necessária",
        description: "Você precisa estar logado para salvar as configurações.",
      });
      return;
    }
    if (!event) return;
    setSaving(true);
    try {
      const { error } = await supabase.from("event_confirmations").upsert({
        event_id: Number(event.id),
        user_id: session.user.id,
        date_confirmed: confirmation.date === "confirmed",
        time_confirmed: confirmation.time === "confirmed",
        location_confirmed: confirmation.location === "confirmed",
        presence_confirmed: false,
        alternative_date:
          confirmation.date === "rejected" && alternativeDate ? alternativeDate.toISOString().split("T")[0] : null,
        alternative_time: confirmation.time === "rejected" ? alternativeTime : null,
        alternative_location: confirmation.location === "rejected" ? alternativeLocation : null,
      });
      if (error) throw error;
      toast({ title: "Configurações salvas!", description: "Suas preferências foram registradas." });
    } catch (err: any) {
      console.error("Erro ao salvar:", err);
      toast({
        title: "Erro ao salvar",
        description: err?.message || "Não foi possível salvar suas preferências. Verifique sua autenticação.",
      });
    } finally {
      setSaving(false);
    }
  };

  const handleConfirmPresence = async () => {
    if (!user || !session) {
      toast({
        title: "Autenticação necessária",
        description: "Você precisa estar logado para confirmar presença.",
      });
      return;
    }
    if (!event) return;
    setSaving(true);
    try {
      const { error } = await supabase.from("event_confirmations").upsert({
        event_id: Number(event.id),
        user_id: session.user.id,
        date_confirmed: true,
        time_confirmed: true,
        location_confirmed: true,
        presence_confirmed: true,
      });
      if (error) throw error;
      toast({ title: "Presença confirmada!", description: "Sua confirmação foi registrada com sucesso." });
      setIsConfirmedGuest(true);
      setTimeout(() => {
        onBack();
      }, 1500);
    } catch (err: any) {
      console.error("Erro ao confirmar presença:", err);
      toast({
        title: "Erro ao confirmar",
        description: err?.message || "Não foi possível confirmar sua presença. Verifique sua autenticação.",
      });
      setSaving(false);
    }
  };

  const handleInvite = async (
    userId: string | null,
    email: string | null,
    name: string,
    shouldBeOrganizer: boolean
  ) => {
    if (!event) return { error: "Evento não encontrado" };
    if (!session) return { error: "Autenticação necessária" };

    try {
      const { data, error } = await supabase.rpc("process_invitation" as any, {
        _event_id: Number(event.id),
        _invitee_email: email,
        _invitee_name: name,
        _is_organizer: shouldBeOrganizer,
        _invitee_user_id: userId,
      });

      if (error) throw error;

      const result = data as {
        user_exists?: boolean;
        message?: string;
        invitation_token?: string;
        invitation_id?: string;
        event_data?: { title: string; date: string; time: string };
      };

      // Se usuário não existe, enviar email
      if (!result?.user_exists && result?.invitation_token && email) {
        const { error: emailError } = await supabase.functions.invoke("send-invitation-email", {
          body: {
            invitee_email: email,
            invitee_name: name,
            event_title: result.event_data?.title || event.title,
            event_date: result.event_data?.date || event.event_date,
            event_time: result.event_data?.time || event.event_time,
            is_organizer: shouldBeOrganizer,
            invitation_token: result.invitation_token,
          },
        });

        if (emailError) {
          console.error("Erro ao enviar email:", emailError);
          toast({
            title: "Aviso",
            description: "Convite registrado, mas houve erro ao enviar o email",
            variant: "destructive",
          });
        } else {
          toast({
            title: "Convite enviado por email",
            description: `Um email foi enviado para ${email}`,
          });
        }
      } else if (result?.user_exists) {
        // Usuário existe - notificação já foi criada pelo RPC
        toast({
          title: "Convite enviado!",
          description: `${name} recebeu uma notificação sobre o convite.`,
        });
      }

      return { error: null };
    } catch (err: any) {
      console.error("Erro ao processar convite:", err);
      return { error: err?.message || "Erro ao enviar convite" };
    }
  };


  const addSupply = async () => {
    if (!newSupply.trim()) return;

    try {
      // Adicionar ao estado local imediatamente
      const newItem = {
        id: Date.now(),
        name: newSupply,
        quantidade: newSupplyQuantity,
        unidade: newSupplyUnit,
        categoria: 'geral',
        prioridade: 'B',
        valor_estimado: null,
        assignments: [],
      };

      setSupplies([...supplies, newItem]);
      setNewSupply("");
      setNewSupplyQuantity(1);
      setNewSupplyUnit("un");

      // Se for convidado confirmado ou organizador, salvar diretamente no banco
      if ((isConfirmedGuest || isOrganizer) && event) {
        const { error } = await supabase
          .from('event_items')
          .insert({
            event_id: Number(eventId),
            nome_item: newSupply.trim(),
            quantidade: newSupplyQuantity,
            unidade: newSupplyUnit,
            categoria: 'geral',
            prioridade: 'B',
            valor_estimado: null,
          });

        if (error) {
          throw error;
        }

        toast({
          title: "Item adicionado",
          description: "O item foi adicionado à lista automaticamente.",
        });

        // Refetch para garantir que os IDs e assignments estão corretos
        const { data: itemsData, error: itemsError } = await supabase
          .from('event_items')
          .select('*')
          .eq('event_id', Number(eventId))
          .order('updated_at', { ascending: false });

        if (!itemsError && itemsData) {
          const { data: assignmentsData } = await supabase
            .from('item_assignments')
            .select('*, event_participants(nome_participante)')
            .eq('event_id', Number(eventId));

          if (assignmentsData) {
            const suppliesWithAssignments = itemsData.map((item) => ({
              id: item.id,
              name: item.nome_item,
              quantidade: item.quantidade,
              unidade: item.unidade,
              categoria: item.categoria,
              prioridade: item.prioridade,
              valor_estimado: item.valor_estimado,
              assignments: assignmentsData
                .filter((a) => a.item_id === item.id)
                .map((a) => ({
                  id: a.id,
                  participant_id: a.participant_id,
                  participant_name: (a.event_participants as any)?.nome_participante || 'Participante',
                  quantidade_atribuida: a.quantidade_atribuida,
                  confirmado: a.confirmado,
                })),
            }));

            setSupplies(suppliesWithAssignments);
          }
        }
      }
    } catch (err: any) {
      console.error('Erro ao adicionar item:', err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível adicionar o item.",
        variant: "destructive",
      });
    }
  };

  const toggleSupplyAssignment = async (supplyId: number) => {
    if (!currentParticipantId) {
      toast({
        title: "Erro",
        description: "Você precisa estar confirmado como participante para se responsabilizar por itens.",
        variant: "destructive",
      });
      return;
    }

    try {
      const supply = supplies.find(s => s.id === supplyId);
      if (!supply) return;

      const myAssignment = supply.assignments.find(a => a.participant_id === currentParticipantId);

      if (myAssignment) {
        // Remover atribuição
        const { error } = await supabase
          .from('item_assignments')
          .delete()
          .eq('id', myAssignment.id);

        if (error) throw error;

        toast({
          title: "Responsabilidade removida",
          description: "Você não é mais responsável por este item.",
        });
      } else {
        // Adicionar atribuição
        const { error } = await supabase
          .from('item_assignments')
          .insert({
            event_id: Number(eventId),
            item_id: supplyId,
            participant_id: currentParticipantId,
            quantidade_atribuida: supply.quantidade,
            confirmado: false,
          });

        if (error) throw error;

        toast({
          title: "Responsabilidade assumida",
          description: "Você agora é responsável por este item!",
        });
      }
    } catch (err: any) {
      console.error('Erro ao alterar atribuição:', err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível alterar a atribuição.",
        variant: "destructive",
      });
    }
  };

  const getSupplyStatus = (supply: Supply) => {
    if (!supply.assignments.length) return 'available';
    const myAssignment = supply.assignments.find(a => a.participant_id === currentParticipantId);
    if (myAssignment) return 'mine';
    return 'taken';
  };

  const getSupplyStatusText = (supply: Supply) => {
    const status = getSupplyStatus(supply);
    if (status === 'available') return 'Disponível';
    if (status === 'mine') return 'Você se responsabilizou';
    return `Responsável: ${supply.assignments.map(a => a.participant_name).join(', ')}`;
  };

  const getSupplyStatusVariant = (supply: Supply): "default" | "secondary" | "outline" => {
    const status = getSupplyStatus(supply);
    if (status === 'available') return 'outline';
    if (status === 'mine') return 'default';
    return 'secondary';
  };

  const handleScheduleDelivery = () => {
    toast({
      title: "Funcionalidade em desenvolvimento!",
      description: "Funcionalidade de agendamento de entrega em desenvolvimento!",
    });
  };

  // Salvar convidados e lista de insumos (organizador)
  const handleSaveLists = async () => {
    if (!event) return;
    setSaving(true);
    try {
      // Como os itens já são salvos automaticamente ao adicionar/editar,
      // apenas confirmamos que tudo está salvo
      await new Promise(resolve => setTimeout(resolve, 500)); // Pequeno delay para feedback visual

      toast({
        title: "Listas salvas",
        description: "Todas as alterações foram registradas.",
      });
    } catch (err: any) {
      console.error("Erro ao salvar listas:", err);
      toast({
        title: "Erro ao salvar",
        description: "Não foi possível salvar as alterações.",
        variant: "destructive",
      });
    } finally {
      setSaving(false);
    }
  };

  const handleUpdateItemPrice = async (itemId: number, price: number | null) => {
    try {
      const { error } = await supabase
        .from('event_items')
        .update({ valor_estimado: price })
        .eq('id', itemId);

      if (error) throw error;

      setSupplies(prev => prev.map(item =>
        item.id === itemId ? { ...item, valor_estimado: price } : item
      ));

      toast({
        title: "Valor atualizado",
        description: "O valor estimado do item foi salvo.",
      });
    } catch (err) {
      console.error("Erro ao atualizar preço:", err);
      toast({
        title: "Erro",
        description: "Não foi possível atualizar o valor.",
        variant: "destructive",
      });
    }
  };

  // Cost Calculation Logic
  const calculateCosts = () => {
    // 🔥 CORREÇÃO: valor_estimado já é o valor TOTAL, não multiplicar por quantidade
    const totalCost = supplies.reduce((acc, item) => {
      return acc + (item.valor_estimado || 0);
    }, 0);

    // Count confirmed guests + organizer (1)
    const confirmedGuestsCount = attendees.filter(a => a.status === 'confirmado').length;
    const totalPeople = confirmedGuestsCount + 1; // +1 for organizer

    const costPerPerson = totalPeople > 0 ? totalCost / totalPeople : 0;

    return { totalCost, costPerPerson, totalPeople };
  };

  const { totalCost, costPerPerson, totalPeople } = calculateCosts();
  const hasAnyPrice = supplies.some(s => s.valor_estimado !== null && s.valor_estimado > 0);

  // Deletar item
  const deleteSupply = async (supplyId: number) => {
    try {
      const { error } = await supabase
        .from('event_items')
        .delete()
        .eq('id', supplyId);

      if (error) throw error;

      setSupplies(supplies.filter(s => s.id !== supplyId));

      toast({
        title: "Item removido",
        description: "O item foi removido da lista.",
      });
    } catch (err: any) {
      console.error('Erro ao deletar item:', err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível remover o item.",
        variant: "destructive",
      });
    }
  };

  // Editar item
  const updateSupply = async (supplyId: number, updates: { nome_item?: string; quantidade?: number; unidade?: string }) => {
    try {
      const { error } = await supabase
        .from('event_items')
        .update(updates)
        .eq('id', supplyId);

      if (error) throw error;

      setSupplies(supplies.map(s =>
        s.id === supplyId
          ? { ...s, name: updates.nome_item || s.name, quantidade: updates.quantidade || s.quantidade, unidade: updates.unidade || s.unidade }
          : s
      ));

      toast({
        title: "Item atualizado",
        description: "As alterações foram salvas.",
      });
    } catch (err: any) {
      console.error('Erro ao atualizar item:', err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível atualizar o item.",
        variant: "destructive",
      });
    }
  };

  // Loading state
  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto"></div>
          <p className="mt-4 text-muted-foreground">Carregando evento...</p>
        </div>
      </div>
    );
  }

  // Error state
  if (error || !event) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <p className="text-destructive mb-4">{error || "Evento não encontrado"}</p>
          <Button onClick={onBack}>Voltar</Button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background relative overflow-hidden">
      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="fixed top-0 left-0 w-[600px] h-[600px] bg-purple-500/20 rounded-full blur-3xl pointer-events-none"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="fixed bottom-0 right-0 w-[600px] h-[600px] bg-cyan-500/20 rounded-full blur-3xl pointer-events-none"
      />

      {/* Floating Header */}
      <motion.header
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        className="fixed top-6 left-1/2 -translate-x-1/2 z-40 w-full max-w-4xl px-4"
      >
        <div className="rounded-3xl bg-card/80 backdrop-blur-xl border border-border/50 shadow-2xl px-6 py-4">
          <div className="flex items-center">
            <Button
              variant="ghost"
              size="sm"
              onClick={onBack}
              className="mr-4 hover:bg-background/80"
            >
              <ArrowLeft className="w-4 h-4" />
            </Button>
            <div className="flex-1">
              <h1 className="text-xl font-bold bg-gradient-to-r from-purple-500 to-cyan-500 bg-clip-text text-transparent">
                {event.title}
              </h1>
              {isOrganizer && (
                <Badge className="mt-1 bg-gradient-to-r from-purple-500/10 to-cyan-500/10 border-purple-500/20 text-purple-600 dark:text-purple-400">
                  👑 Organizador
                </Badge>
              )}
            </div>
          </div>
        </div>
      </motion.header>

      <main className="relative z-10 max-w-4xl mx-auto px-4 pt-32 pb-20 space-y-6">
        {/* Event Info */}
        <Card>
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle>Informações do Evento</CardTitle>
                {!canEdit && <CardDescription>Confirme ou sugira alternativas para cada item</CardDescription>}
                {canEdit && !isEditingEventInfo && <CardDescription>Clique em editar para modificar as informações</CardDescription>}
                {canEdit && isEditingEventInfo && <CardDescription className="text-primary">Modo de edição ativo</CardDescription>}
              </div>
              {canEdit && !isEditingEventInfo && (
                <Button
                  variant="outline"
                  size="sm"
                  onClick={startEditingEventInfo}
                  className="gap-2"
                >
                  <Pencil className="w-4 h-4" />
                  Editar
                </Button>
              )}
              {canEdit && isEditingEventInfo && (
                <div className="flex gap-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={cancelEditingEventInfo}
                  >
                    <X className="w-4 h-4 mr-1" />
                    Cancelar
                  </Button>
                  <Button
                    size="sm"
                    onClick={saveEventInfo}
                    disabled={saving || !editEventTitle || !editEventDate || !editEventTime}
                  >
                    <Save className="w-4 h-4 mr-1" />
                    {saving ? "Salvando..." : "Salvar"}
                  </Button>
                </div>
              )}
            </div>
          </CardHeader>
          <CardContent>
            {/* Modo de Edição para Organizadores */}
            {isEditingEventInfo && canEdit ? (
              <div className="space-y-4">
                <div>
                  <Label htmlFor="editTitle" className="text-sm font-semibold">Nome do Evento</Label>
                  <Input
                    id="editTitle"
                    value={editEventTitle}
                    onChange={(e) => setEditEventTitle(e.target.value)}
                    className="mt-1"
                    placeholder="Digite o título do evento"
                  />
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <div>
                    <Label className="text-sm font-semibold flex items-center gap-2">
                      <Calendar className="w-4 h-4" />
                      Data
                    </Label>
                    <div className="mt-1">
                      <DatePicker
                        value={editEventDate}
                        onChange={setEditEventDate}
                        placeholder="Escolha a data"
                      />
                    </div>
                  </div>
                  <div>
                    <Label className="text-sm font-semibold flex items-center gap-2">
                      <Clock className="w-4 h-4" />
                      Horário
                    </Label>
                    <div className="mt-1">
                      <TimePicker
                        value={editEventTime}
                        onChange={setEditEventTime}
                        placeholder="Escolha o horário"
                      />
                    </div>
                  </div>
                </div>

                <div>
                  <Label htmlFor="editLocation" className="text-sm font-semibold flex items-center gap-2">
                    <MapPin className="w-4 h-4" />
                    Local
                  </Label>
                  <Input
                    id="editLocation"
                    value={editEventLocation}
                    onChange={(e) => setEditEventLocation(e.target.value)}
                    className="mt-1"
                    placeholder="Digite o local do evento"
                  />
                </div>

                <div>
                  <Label htmlFor="editDescription" className="text-sm font-semibold">Descrição</Label>
                  <Textarea
                    id="editDescription"
                    value={editEventDescription}
                    onChange={(e) => setEditEventDescription(e.target.value)}
                    className="mt-1"
                    placeholder="Descrição do evento (opcional)"
                    rows={3}
                  />
                </div>
              </div>
            ) : (
              /* Modo de Visualização */
              <div className="space-y-6">
                {/* Título - visível para todos */}
                <div className="flex items-center p-4 border rounded-lg bg-muted/30">
                  <div>
                    <span className="font-medium text-foreground">Título:</span>
                    <p className="text-lg font-semibold">{event.title}</p>
                  </div>
                </div>

                {/* Data */}
                <div className="flex items-center justify-between p-4 border rounded-lg">
                  <div className="flex items-center text-muted-foreground">
                    <Calendar className="w-5 h-5 mr-3" />
                    <div>
                      <span className="font-medium text-foreground">Data:</span>
                      <p>{formatDate(event.event_date)}</p>
                    </div>
                  </div>
                  {!canEdit && (
                    <div className="flex gap-2">
                      <Button
                        variant={confirmation.date === "confirmed" ? "default" : "outline"}
                        size="sm"
                        onClick={handleConfirmDate}
                      >
                        <Check className="w-4 h-4 mr-1" />
                        Confirmar
                      </Button>
                      <Popover open={showDatePopover} onOpenChange={setShowDatePopover}>
                        <PopoverTrigger asChild>
                          <Button
                            variant={confirmation.date === "rejected" ? "destructive" : "outline"}
                            size="sm"
                            onClick={handleRejectDate}
                          >
                            <X className="w-4 h-4 mr-1" />
                            Não posso
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-auto p-4">
                          <div className="space-y-4">
                            <h4 className="font-medium">Sugira uma data alternativa:</h4>
                            <CalendarComponent
                              mode="single"
                              selected={alternativeDate}
                              onSelect={setAlternativeDate}
                              className="pointer-events-auto"
                            />
                            <Button onClick={saveAlternativeDate} className="w-full">
                              Confirmar Alternativa
                            </Button>
                          </div>
                        </PopoverContent>
                      </Popover>
                    </div>
                  )}
                </div>

                {/* Horário */}
                <div className="flex items-center justify-between p-4 border rounded-lg">
                  <div className="flex items-center text-muted-foreground">
                    <Clock className="w-5 h-5 mr-3" />
                    <div>
                      <span className="font-medium text-foreground">Horário:</span>
                      <p>{event.event_time}</p>
                    </div>
                  </div>
                  {!canEdit && (
                    <div className="flex gap-2">
                      <Button
                        variant={confirmation.time === "confirmed" ? "default" : "outline"}
                        size="sm"
                        onClick={handleConfirmTime}
                      >
                        <Check className="w-4 h-4 mr-1" />
                        Confirmar
                      </Button>
                      <Popover open={showTimePopover} onOpenChange={setShowTimePopover}>
                        <PopoverTrigger asChild>
                          <Button
                            variant={confirmation.time === "rejected" ? "destructive" : "outline"}
                            size="sm"
                            onClick={handleRejectTime}
                          >
                            <X className="w-4 h-4 mr-1" />
                            Não posso
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-auto p-4">
                          <div className="space-y-4">
                            <h4 className="font-medium">Sugira um horário alternativo:</h4>
                            <Select value={alternativeTime} onValueChange={setAlternativeTime}>
                              <SelectTrigger>
                                <SelectValue placeholder="Selecione um horário" />
                              </SelectTrigger>
                              <SelectContent>
                                {Array.from({ length: 24 }, (_, i) => (
                                  <SelectItem key={i} value={`${i.toString().padStart(2, "0")}:00`}>
                                    {`${i.toString().padStart(2, "0")}:00`}
                                  </SelectItem>
                                ))}
                              </SelectContent>
                            </Select>
                            <Button onClick={saveAlternativeTime} className="w-full">
                              Confirmar Alternativa
                            </Button>
                          </div>
                        </PopoverContent>
                      </Popover>
                    </div>
                  )}
                </div>

                {/* Local */}
                <div className="flex items-center justify-between p-4 border rounded-lg">
                  <div className="flex items-center text-muted-foreground">
                    <MapPin className="w-5 h-5 mr-3" />
                    <div>
                      <span className="font-medium text-foreground">Local:</span>
                      <p>{event.location}</p>
                    </div>
                  </div>
                  {!canEdit && (
                    <div className="flex gap-2">
                      <Button
                        variant={confirmation.location === "confirmed" ? "default" : "outline"}
                        size="sm"
                        onClick={handleConfirmLocation}
                      >
                        <Check className="w-4 h-4 mr-1" />
                        Confirmar
                      </Button>
                      <Popover open={showLocationPopover} onOpenChange={setShowLocationPopover}>
                        <PopoverTrigger asChild>
                          <Button
                            variant={confirmation.location === "rejected" ? "destructive" : "outline"}
                            size="sm"
                            onClick={handleRejectLocation}
                          >
                            <X className="w-4 h-4 mr-1" />
                            Não posso
                          </Button>
                        </PopoverTrigger>
                        <PopoverContent className="w-80 p-4">
                          <div className="space-y-4">
                            <h4 className="font-medium">Sugira um local alternativo:</h4>
                            <Textarea
                              placeholder="Digite sua sugestão de local..."
                              value={alternativeLocation}
                              onChange={(e) => setAlternativeLocation(e.target.value)}
                            />
                            <Button onClick={saveAlternativeLocation} className="w-full">
                              Confirmar Alternativa
                            </Button>
                          </div>
                        </PopoverContent>
                      </Popover>
                    </div>
                  )}
                </div>

                {event.description && (
                  <div className="pt-4 border-t">
                    <span className="font-medium text-foreground text-sm">Descrição:</span>
                    <p className="text-muted-foreground mt-1">{event.description}</p>
                  </div>
                )}

                {/* Botão de confirmar presença - apenas para convidados */}
                {!canEdit && canConfirmPresence() && (
                  <div className="pt-6 border-t mt-6">
                    <Button
                      className="w-full"
                      size="lg"
                      disabled={saving}
                      onClick={handleConfirmPresence}
                      variant="default"
                    >
                      {saving ? "Confirmando..." : "✓ Confirmar Presença no Evento"}
                    </Button>
                    <p className="text-xs text-muted-foreground text-center mt-2">
                      Confirme sua presença após validar data, hora e local
                    </p>
                  </div>
                )}
              </div>
            )}
          </CardContent>
        </Card>

        {/* Organizers - apenas organizadores podem ver e editar */}
        {isOrganizer && (
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <CardTitle className="flex items-center">
                  <UserPlus className="w-5 h-5 mr-2" />
                  Organizadores ({1 + organizers.length})
                </CardTitle>
                <OrganizerInviteDialog
                  onInvite={handleInvite}
                  excludeUserIds={[event.user_id, ...organizers.map((o) => o.user_id)]}
                  friends={friends}
                  isOrganizer={true}
                  triggerLabel={
                    <>
                      <span className="hidden sm:inline">Adicionar Organizador</span>
                      <span className="sm:hidden">Adicionar</span>
                    </>
                  }
                />
              </div>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {/* Criador do evento */}
                {/* Criador do evento */}
                <div className="flex items-center gap-4 p-3 sm:p-4 bg-muted/30 rounded-lg border">
                  <Avatar className="h-12 w-12 border-2 border-primary/20">
                    <AvatarFallback className="bg-primary/10 text-primary font-bold text-lg">
                      {(organizerInfo.username || organizerInfo.email || '?').substring(0, 2).toUpperCase()}
                    </AvatarFallback>
                  </Avatar>
                  <div className="flex-1 min-w-0">
                    <div className="flex items-center gap-2">
                      <p className="font-semibold text-base text-foreground truncate">
                        {organizerInfo.username || organizerInfo.email || 'Criador do evento'}
                      </p>
                      {user?.id === event.user_id && (
                        <Badge variant="secondary" className="text-[10px] h-5 px-1.5 font-normal">
                          Você
                        </Badge>
                      )}
                    </div>
                    <div className="flex items-center gap-2 mt-1">
                      <Badge variant="default" className="text-[10px] h-5 px-2 font-normal">Organizador Principal</Badge>
                      <span className="text-xs text-muted-foreground">Criador do evento</span>
                    </div>
                  </div>
                </div>

                {/* Co-organizadores */}
                {organizers.map((organizer) => {
                  const info = coOrganizersInfo[organizer.user_id];
                  const displayName = info?.username || info?.email || 'Co-organizador';
                  const isCurrentUser = user?.id === organizer.user_id;

                  return (
                    <div key={organizer.id} className="flex items-center gap-4 p-3 sm:p-4 bg-muted/30 rounded-lg border hover:bg-muted/50 transition-colors">
                      <Avatar className="h-10 w-10">
                        {/* Fallback to user initials if no avatar is available. For now, assuming no avatar URL in current data structure, using fallback. 
                             Ideally, organizers join would include avatar_url. */}
                        <AvatarFallback className="bg-primary/10 text-primary font-medium">
                          {displayName?.substring(0, 2).toUpperCase() || "OR"}
                        </AvatarFallback>
                      </Avatar>
                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <p className="font-semibold text-foreground truncate">{displayName}</p>
                          {isCurrentUser && (
                            <Badge variant="secondary" className="text-[10px] h-5 px-1.5 font-normal">
                              Você
                            </Badge>
                          )}
                        </div>
                        <p className="text-xs text-muted-foreground mt-0.5">
                          Incluso em {new Date(organizer.added_at).toLocaleDateString("pt-BR")}
                        </p>
                      </div>
                      <Button
                        variant="ghost"
                        size="icon"
                        className="text-muted-foreground hover:text-destructive hover:bg-destructive/10 h-8 w-8 shrink-0"
                        onClick={() => removeOrganizer(organizer.id)}
                        title="Remover co-organizador"
                      >
                        <UserMinus className="w-4 h-4" />
                      </Button>
                    </div>
                  );
                })}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Attendees - Visível para todos os usuários com acesso ao evento */}
        {event && (
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <div>
                  <CardTitle className="flex items-center">
                    <Users className="w-5 h-5 mr-2" />
                    Participantes ({attendees.length})
                  </CardTitle>
                  <CardDescription className="mt-1">
                    Lista de pessoas convidadas para o evento
                  </CardDescription>
                </div>
                {isOrganizer && (
                  <OrganizerInviteDialog
                    onInvite={handleInvite}
                    excludeUserIds={[]}
                    friends={friends}
                    isOrganizer={false}
                    triggerLabel={
                      <>
                        <span className="hidden sm:inline">Convidar Participante</span>
                        <span className="sm:hidden">Convidar</span>
                      </>
                    }
                  />
                )}
              </div>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {/* Organizador - sempre aparece primeiro */}
                {event && (
                  <div className="flex items-center gap-4 p-3 sm:p-4 bg-primary/5 border border-primary/20 rounded-lg">
                    <Avatar className="h-10 w-10 border border-primary/20">
                      <AvatarFallback className="bg-primary text-primary-foreground font-medium">
                        {(organizerInfo.username || organizerInfo.email || '?').substring(0, 2).toUpperCase()}
                      </AvatarFallback>
                    </Avatar>
                    <div className="flex-1 min-w-0">
                      <div className="flex items-center gap-2">
                        <p className="font-semibold text-foreground truncate">
                          {organizerInfo.username || organizerInfo.email || 'Organizador'}
                        </p>
                        {user?.id === event.user_id && (
                          <Badge variant="outline" className="text-[10px] h-5 px-1.5 font-normal border-primary/30 text-primary">
                            Você
                          </Badge>
                        )}
                      </div>
                      <p className="text-xs text-muted-foreground">Organizador do Evento</p>
                    </div>
                    <Badge variant="default" className="shrink-0 h-6">
                      Organizador
                    </Badge>
                  </div>
                )}

                {/* Convidados */}
                {attendees.map((attendee) => {
                  const isCurrentUser = user?.email === attendee.email;
                  const displayName = attendee.name || attendee.email || 'Participante';

                  return (
                    <div key={attendee.id} className="flex items-center gap-4 p-3 sm:p-4 bg-muted/30 rounded-lg border hover:bg-muted/50 transition-colors">
                      <Avatar className="h-10 w-10">
                        <AvatarFallback className="bg-background border-2 border-muted text-muted-foreground font-medium">
                          {displayName?.substring(0, 2).toUpperCase() || "PA"}
                        </AvatarFallback>
                      </Avatar>

                      <div className="flex-1 min-w-0">
                        <div className="flex items-center gap-2">
                          <p className="font-semibold text-foreground truncate">
                            {displayName}
                          </p>
                          {isCurrentUser && (
                            <Badge variant="secondary" className="text-[10px] h-5 px-1.5 font-normal">
                              Você
                            </Badge>
                          )}
                        </div>
                        {isOrganizer && attendee.email && (
                          <p className="text-xs text-muted-foreground truncate mt-0.5">{attendee.email}</p>
                        )}
                      </div>

                      <Badge
                        variant={
                          attendee.status === "confirmado"
                            ? "default"
                            : attendee.status === "pendente"
                              ? "outline"
                              : "destructive"
                        }
                        className={`shrink-0 h-6 ${attendee.status === "pendente" ? "bg-background border-dashed" : ""}`}
                      >
                        {attendee.status === "confirmado"
                          ? "Confirmado"
                          : attendee.status === "pendente"
                            ? "Pendente"
                            : "Recusado"}
                      </Badge>
                    </div>
                  );
                })}
                {attendees.length === 0 && (
                  <p className="text-center text-muted-foreground py-6 mt-3">
                    Nenhum participante convidado ainda
                  </p>
                )}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Supplies List - Visível para todos os usuários com acesso ao evento */}
        {event && (
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <div>
                  <CardTitle className="flex items-center">
                    <Package className="w-5 h-5 mr-2" />
                    Lista de Insumos ({supplies.length})
                  </CardTitle>
                  <CardDescription className="mt-1">
                    {isConfirmedGuest && !isOrganizer && !isEventCreator
                      ? "Escolha os itens que você pode levar"
                      : "Gerencie os itens necessários para o evento"}
                  </CardDescription>
                </div>
                {/* Botão destacado para adicionar itens */}
                {canEdit && (
                  <Button
                    variant="default"
                    size="sm"
                    onClick={() => {
                      const input = document.querySelector('[placeholder="Adicionar item..."]') as HTMLInputElement;
                      if (input) {
                        input.focus();
                        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      }
                    }}
                    className="gap-2"
                  >
                    <Plus className="w-4 h-4" />
                    Adicionar Item
                  </Button>
                )}
              </div>
            </CardHeader>
            <CardContent>
              {/* Cost Summary */}
              {hasAnyPrice && (
                <div className="mb-6 p-4 bg-primary/5 border border-primary/20 rounded-lg">
                  <div className="flex flex-col sm:flex-row justify-between gap-4">
                    <div>
                      <p className="text-sm text-muted-foreground">Custo Total Estimado</p>
                      <p className="text-2xl font-bold text-primary">
                        {totalCost.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}
                      </p>
                    </div>
                    <div className="sm:text-right">
                      <p className="text-sm text-muted-foreground">
                        Custo por Pessoa ({totalPeople} confirmados)
                      </p>
                      <p className="text-xl font-semibold text-primary">
                        {costPerPerson.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}
                      </p>
                    </div>
                  </div>
                </div>
              )}

              <div className="space-y-3">
                {supplies.map((supply) => {
                  const isEditing = editingSupplyId === supply.id;

                  return (
                    <div
                      key={supply.id}
                      className={`p-4 border-2 rounded-lg transition-all ${getSupplyStatus(supply) === 'mine'
                        ? 'border-primary bg-primary/5'
                        : getSupplyStatus(supply) === 'taken'
                          ? 'border-muted bg-muted/30'
                          : 'border-border hover:border-primary/50'
                        }`}
                    >
                      {isEditing ? (
                        // Modo de edição
                        <div className="space-y-3">
                          <Input
                            value={editingSupplyData.name}
                            onChange={(e) => setEditingSupplyData({ ...editingSupplyData, name: e.target.value })}
                            placeholder="Nome do item"
                            className="font-medium"
                          />
                          <div className="flex gap-2">
                            <Input
                              type="number"
                              min="0.1"
                              step="0.1"
                              value={editingSupplyData.quantidade}
                              onChange={(e) => setEditingSupplyData({ ...editingSupplyData, quantidade: parseFloat(e.target.value) || 0 })}
                              placeholder="Quantidade"
                              className="flex-1"
                            />
                            <Select
                              value={editingSupplyData.unidade}
                              onValueChange={(value) => setEditingSupplyData({ ...editingSupplyData, unidade: value })}
                            >
                              <SelectTrigger className="w-[140px]">
                                <SelectValue />
                              </SelectTrigger>
                              <SelectContent className="bg-background border shadow-lg z-50">
                                <SelectItem value="un">Unidade(s)</SelectItem>
                                <SelectItem value="kg">Quilograma(s)</SelectItem>
                                <SelectItem value="g">Grama(s)</SelectItem>
                                <SelectItem value="l">Litro(s)</SelectItem>
                                <SelectItem value="ml">Mililitro(s)</SelectItem>
                                <SelectItem value="pacote">Pacote(s)</SelectItem>
                                <SelectItem value="caixa">Caixa(s)</SelectItem>
                                <SelectItem value="dúzia">Dúzia(s)</SelectItem>
                                <SelectItem value="fatia">Fatia(s)</SelectItem>
                                <SelectItem value="porção">Porção(ões)</SelectItem>
                              </SelectContent>
                            </Select>
                          </div>
                          <div className="flex items-center gap-2">
                            <DollarSign className="w-4 h-4 text-muted-foreground" />
                            <Input
                              type="number"
                              min="0"
                              step="0.01"
                              value={editingSupplyData.valor_estimado || ''}
                              onChange={(e) => setEditingSupplyData({ ...editingSupplyData, valor_estimado: e.target.value ? parseFloat(e.target.value) : null })}
                              placeholder="Valor unitário estimado (opcional)"
                              className="flex-1"
                            />
                          </div>
                          <div className="flex gap-2 justify-end">
                            <Button
                              size="sm"
                              variant="outline"
                              onClick={() => setEditingSupplyId(null)}
                            >
                              <X className="w-4 h-4 mr-1" />
                              Cancelar
                            </Button>
                            <Button
                              size="sm"
                              onClick={() => {
                                updateSupply(supply.id, {
                                  nome_item: editingSupplyData.name,
                                  quantidade: editingSupplyData.quantidade,
                                  unidade: editingSupplyData.unidade,
                                });
                                handleUpdateItemPrice(supply.id, editingSupplyData.valor_estimado);
                                setEditingSupplyId(null);
                              }}
                            >
                              <Save className="w-4 h-4 mr-1" />
                              Salvar
                            </Button>
                          </div>
                        </div>
                      ) : (
                        // Modo de visualização
                        <>
                          <div className="flex items-start justify-between mb-3">
                            <div className="flex-1">
                              <div className="flex items-center gap-2 mb-1">
                                <h4 className="font-medium">{supply.name}</h4>
                                <Badge variant={getSupplyStatusVariant(supply)} className="text-xs">
                                  {getSupplyStatusText(supply)}
                                </Badge>
                              </div>
                              <div className="flex items-center gap-4 text-sm text-muted-foreground">
                                <p>
                                  {supply.quantidade} {supply.unidade}
                                </p>
                                {supply.valor_estimado && (
                                  <p className="flex items-center text-primary">
                                    <DollarSign className="w-3 h-3 mr-1" />
                                    {supply.valor_estimado.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}
                                  </p>
                                )}
                              </div>
                            </div>
                            {canEdit && (
                              <div className="flex gap-1">
                                <Button
                                  size="sm"
                                  variant="ghost"
                                  onClick={() => {
                                    setEditingSupplyId(supply.id);
                                    setEditingSupplyData({
                                      name: supply.name,
                                      quantidade: supply.quantidade,
                                      unidade: supply.unidade,
                                      valor_estimado: supply.valor_estimado
                                    });
                                  }}
                                >
                                  <Edit2 className="w-4 h-4" />
                                </Button>
                                <Button
                                  size="sm"
                                  variant="ghost"
                                  onClick={() => {
                                    if (confirm('Tem certeza que deseja remover este item?')) {
                                      deleteSupply(supply.id);
                                    }
                                  }}
                                  className="text-destructive hover:text-destructive hover:bg-destructive/10"
                                >
                                  <Trash2 className="w-4 h-4" />
                                </Button>
                              </div>
                            )}
                          </div>

                          {canViewFullDetails && currentParticipantId && (
                            <div className="flex items-center space-x-2 pt-2 border-t">
                              <Checkbox
                                id={`supply-${supply.id}`}
                                checked={getSupplyStatus(supply) === 'mine'}
                                onCheckedChange={() => toggleSupplyAssignment(supply.id)}
                                disabled={getSupplyStatus(supply) === 'taken'}
                              />
                              <label
                                htmlFor={`supply-${supply.id}`}
                                className={`text-sm font-medium leading-none ${getSupplyStatus(supply) === 'taken'
                                  ? 'cursor-not-allowed opacity-70'
                                  : 'cursor-pointer'
                                  }`}
                              >
                                {getSupplyStatus(supply) === 'mine'
                                  ? 'Desistir deste item'
                                  : getSupplyStatus(supply) === 'taken'
                                    ? 'Item já foi escolhido'
                                    : 'Me responsabilizar por este item'}
                              </label>
                            </div>
                          )}
                        </>
                      )}
                    </div>
                  );
                })}

                {supplies.length === 0 && (
                  <div className="text-center py-8">
                    <Package className="w-12 h-12 mx-auto mb-3 text-muted-foreground/50" />
                    <p className="text-muted-foreground mb-4">
                      Nenhum item adicionado ainda
                    </p>
                    {canViewFullDetails && (
                      <p className="text-sm text-muted-foreground">
                        Use o campo abaixo para adicionar o primeiro item
                      </p>
                    )}
                  </div>
                )}

                {/* Campo de adicionar item - APENAS ORGANIZADORES/CRIADORES */}
                {canEdit && (
                  <div className="space-y-3 mt-4 p-4 bg-muted/50 rounded-lg border-2 border-dashed border-primary/30">
                    <Input
                      placeholder="Adicionar item..."
                      value={newSupply}
                      onChange={(e) => setNewSupply(e.target.value)}
                      onKeyPress={(e) => e.key === "Enter" && addSupply()}
                      className="bg-background"
                    />
                    <div className="flex gap-2">
                      <Input
                        type="number"
                        min="0.1"
                        step="0.1"
                        value={newSupplyQuantity}
                        onChange={(e) => setNewSupplyQuantity(parseFloat(e.target.value) || 1)}
                        placeholder="Quantidade"
                        className="bg-background flex-1"
                      />
                      <Select
                        value={newSupplyUnit}
                        onValueChange={setNewSupplyUnit}
                      >
                        <SelectTrigger className="w-[140px] bg-background">
                          <SelectValue />
                        </SelectTrigger>
                        <SelectContent className="bg-background border shadow-lg z-50">
                          <SelectItem value="un">Unidade(s)</SelectItem>
                          <SelectItem value="kg">Quilograma(s)</SelectItem>
                          <SelectItem value="g">Grama(s)</SelectItem>
                          <SelectItem value="l">Litro(s)</SelectItem>
                          <SelectItem value="ml">Mililitro(s)</SelectItem>
                          <SelectItem value="pacote">Pacote(s)</SelectItem>
                          <SelectItem value="caixa">Caixa(s)</SelectItem>
                          <SelectItem value="dúzia">Dúzia(s)</SelectItem>
                          <SelectItem value="fatia">Fatia(s)</SelectItem>
                          <SelectItem value="porção">Porção(ões)</SelectItem>
                        </SelectContent>
                      </Select>
                      <Button onClick={addSupply} disabled={!newSupply.trim()} className="shrink-0">
                        <Plus className="w-4 h-4 mr-2" />
                        Adicionar
                      </Button>
                    </div>
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Dinâmicas do Evento - Visível para organizadores e convidados confirmados */}
        {canViewFullDetails && (
          <Card>
            <CardHeader>
              <div className="flex items-center justify-between">
                <div>
                  <CardTitle className="flex items-center">
                    <Gift className="w-5 h-5 mr-2" />
                    Dinâmicas do Evento
                  </CardTitle>
                  <CardDescription className="mt-1">
                    Atividades especiais para tornar o evento mais divertido
                  </CardDescription>
                </div>
              </div>
            </CardHeader>
            <CardContent>
              <div className="space-y-3">
                {hasSecretSanta ? (
                  <div className="p-4 border-2 border-primary/20 rounded-lg bg-primary/5">
                    <div className="flex items-start justify-between">
                      <div className="flex items-start gap-3 flex-1">
                        <div className="p-2 bg-primary/10 rounded-lg">
                          <Gift className="w-5 h-5 text-primary" />
                        </div>
                        <div className="flex-1">
                          <h3 className="font-semibold mb-1">Amigo Secreto</h3>
                          {secretSantaData && (
                            <div className="space-y-1 text-sm text-muted-foreground">
                              {secretSantaData.min_value && secretSantaData.max_value && (
                                <p>
                                  Valor: R$ {secretSantaData.min_value} - R$ {secretSantaData.max_value}
                                </p>
                              )}
                              {secretSantaData.draw_date && (
                                <p>
                                  Data do sorteio: {format(new Date(secretSantaData.draw_date), "dd/MM/yyyy", { locale: ptBR })}
                                </p>
                              )}
                              {secretSantaData.has_drawn && (
                                <Badge variant="default" className="mt-2">Sorteio realizado</Badge>
                              )}
                              {!secretSantaData.has_drawn && (
                                <Badge variant="secondary" className="mt-2">Aguardando sorteio</Badge>
                              )}
                            </div>
                          )}
                        </div>
                      </div>
                      {isOrganizer && (
                        <Button
                          variant="outline"
                          size="sm"
                          onClick={() => navigate(`/event/${eventId}/secret-santa/admin`)}
                        >
                          Gerenciar
                        </Button>
                      )}
                      {!isOrganizer && secretSantaData.has_drawn && (
                        <Button
                          variant="default"
                          size="sm"
                          onClick={() => navigate(`/event/${eventId}/secret-santa/my-result`)}
                        >
                          Ver Meu Resultado
                        </Button>
                      )}
                    </div>
                  </div>
                ) : (
                  <>
                    {isOrganizer ? (
                      <div className="text-center py-8">
                        <Gift className="w-12 h-12 mx-auto mb-3 text-muted-foreground/50" />
                        <p className="text-muted-foreground mb-4">
                          Nenhuma dinâmica adicionada ainda
                        </p>
                        <Button
                          onClick={() => navigate(`/event/${eventId}/secret-santa/setup`)}
                          className="gap-2"
                        >
                          <Plus className="w-4 h-4" />
                          Adicionar Amigo Secreto
                        </Button>
                      </div>
                    ) : (
                      <p className="text-center text-muted-foreground py-6">
                        Nenhuma dinâmica configurada para este evento
                      </p>
                    )}
                  </>
                )}
              </div>
            </CardContent>
          </Card>
        )}

        {/* Botão de Salvar (organizador) */}
        {isOrganizer && (
          <Card className="bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
            <CardContent className="pt-6">
              <Button className="w-full" size="lg" disabled={saving} onClick={handleSaveLists}>
                {saving ? "Salvando..." : "💾 Salvar Alterações"}
              </Button>
              <p className="text-xs text-muted-foreground text-center mt-3">
                Salva convidados e lista de insumos do evento
              </p>
            </CardContent>
          </Card>
        )}

        {/* Botão de Salvar - apenas para convidados, no final da página */}
        {!isOrganizer &&
          (confirmation.date !== "pending" ||
            confirmation.time !== "pending" ||
            confirmation.location !== "pending") && (
            <Card className="bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20">
              <CardContent className="pt-6">
                <Button
                  variant="floating"
                  className="w-full"
                  size="lg"
                  disabled={saving}
                  onClick={handleSaveConfirmation}
                >
                  {saving ? "Salvando..." : "💾 Salvar Minhas Preferências"}
                </Button>
                <p className="text-xs text-muted-foreground text-center mt-3">
                  Salve suas confirmações e sugestões de alternativas antes de sair
                </p>
              </CardContent>
            </Card>
          )}
      </main>
    </div>
  );
};

export default EventDetails;


============================================================
FILE PATH: .\src\pages\Index.tsx
============================================================
import { useState, useEffect } from 'react';
import { useAuth } from '@/hooks/useAuth';
import { supabase } from '@/integrations/supabase/client';
import LandingPage from './LandingPage';
import Login from './Login';
import Dashboard from './Dashboard';
import CreateEvent from './CreateEvent';
import EventDetails from './EventDetails';
import ChatWidget from '@/components/ChatWidget';
import { ThemeToggle } from '@/components/landing/ThemeToggle';
import { motion } from 'framer-motion';

import { useSearchParams } from 'react-router-dom';
import { templates, EventTemplate } from '@/data/templates';

type Screen = 'landing' | 'login' | 'dashboard' | 'createEvent' | 'eventDetails';

const Index = () => {
  const { user, loading } = useAuth();
  const [currentScreen, setCurrentScreen] = useState<Screen>('login');
  const [selectedEventId, setSelectedEventId] = useState<string>('');
  const [searchParams] = useSearchParams();
  const [initialTemplate, setInitialTemplate] = useState<EventTemplate | null>(null);

  useEffect(() => {
    const templateSlug = searchParams.get('template');
    if (templateSlug) {
      const template = templates.find(t => t.slug === templateSlug);
      if (template) {
        setInitialTemplate(template);
      }
    }
  }, [searchParams]);

  useEffect(() => {
    if (user) {
      // If there is a template and we just logged in (or loaded), go to create event
      if (initialTemplate) {
        setCurrentScreen('createEvent');
      } else {
        setCurrentScreen('dashboard');
      }
    } else if (!loading) {
      setCurrentScreen('landing');
    }
  }, [user, loading, initialTemplate]);

  const handleLogin = () => {
    // If we have a template, go to create event after login
    if (initialTemplate) {
      setCurrentScreen('createEvent');
    } else {
      setCurrentScreen('dashboard');
    }
  };

  const handleLogout = async () => {
    await supabase.auth.signOut();
    setCurrentScreen('login');
  };

  const handleCreateEvent = () => {
    setInitialTemplate(null); // Clear template if creating manually from dashboard
    setCurrentScreen('createEvent');
  };

  const handleViewEvent = (eventId: string) => {
    setSelectedEventId(eventId);
    setCurrentScreen('eventDetails');
  };

  const handleBackToDashboard = () => {
    setInitialTemplate(null);
    setCurrentScreen('dashboard');
  };

  const handleEventCreated = () => {
    setInitialTemplate(null);
    setCurrentScreen('dashboard');
  };

  const renderScreen = () => {
    if (loading) {
      return (
        <div className="min-h-screen bg-background flex items-center justify-center relative overflow-hidden">
          {/* Animated Background Orbs */}
          <motion.div
            animate={{
              scale: [1, 1.2, 1],
              opacity: [0.3, 0.5, 0.3],
            }}
            transition={{ duration: 8, repeat: Infinity }}
            className="absolute top-1/4 left-1/4 w-96 h-96 bg-orange-500/20 rounded-full blur-3xl"
          />
          <motion.div
            animate={{
              scale: [1, 1.2, 1],
              opacity: [0.3, 0.5, 0.3],
            }}
            transition={{ duration: 8, repeat: Infinity, delay: 1 }}
            className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl"
          />

          <div className="text-center relative z-10">
            <div className="animate-spin rounded-full h-32 w-32 border-b-2 border-primary mx-auto"></div>
            <p className="mt-4 text-muted-foreground">Carregando...</p>
          </div>
        </div>
      );
    }

    if (!user && currentScreen !== 'login') {
      return <Login onLogin={handleLogin} />;
    }

    switch (currentScreen) {
      case 'landing':
        return <LandingPage />;

      case 'login':
        return <Login onLogin={handleLogin} />;

      case 'dashboard':
        return (
          <Dashboard
            userEmail={user?.email || ''}
            onCreateEvent={handleCreateEvent}
            onViewEvent={handleViewEvent}
            onLogout={handleLogout}
          />
        );

      case 'createEvent':
        return (
          <CreateEvent
            onBack={handleBackToDashboard}
            onCreate={handleEventCreated}
            initialData={initialTemplate}
          />
        );

      case 'eventDetails':
        return (
          <EventDetails
            eventId={selectedEventId}
            onBack={handleBackToDashboard}
          />
        );

      default:
        return <Login onLogin={handleLogin} />;
    }
  };

  return (
    <>
      <ThemeToggle className="fixed top-4 right-4 z-50" />
      {renderScreen()}
      <ChatWidget />
    </>
  );
};

export default Index;


============================================================
FILE PATH: .\src\pages\Index2.tsx
============================================================
import { useNavigate } from "react-router-dom";
import { motion, useScroll, useTransform } from "framer-motion";
import { toast } from "sonner";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import {
  Sparkles,
  ArrowRight,
  Check,
  Zap,
  Users,
  Calendar,
  DollarSign,
  MessageSquare,
  Shield,
  Smartphone,
  ChevronRight,
  Star
} from "lucide-react";
import { ThemeToggle } from "@/components/landing/ThemeToggle";
import { Footer } from "@/components/landing/Footer";
import reuneLogo from "@/assets/reunelogo.png";
import videoAtual from "@/assets/video_atual.mp4";

export default function Index2() {
  const navigate = useNavigate();
  const { scrollYProgress } = useScroll();
  const opacity = useTransform(scrollYProgress, [0, 0.2], [1, 0]);
  const scale = useTransform(scrollYProgress, [0, 0.2], [1, 0.95]);

  const handlePricingClick = (e: React.MouseEvent) => {
    e.preventDefault();
    toast.success("Aproveite os recursos gratuitamente até 01/02/2026", {
      description: "Sem pegadinhas. Acesso liberado para você testar.",
      duration: 5000,
    });
  };

  const features = [
    {
      icon: Sparkles,
      title: "IA que Entende Você",
      description: "Descreva seu evento em linguagem natural e deixe a UNE.AI criar tudo: listas, quantidades e convidados.",
      gradient: "from-orange-500 to-amber-500"
    },
    {
      icon: Users,
      title: "Gestão de Convidados",
      description: "RSVP automático, lembretes inteligentes e acompanhamento de confirmações em tempo real.",
      gradient: "from-cyan-500 to-blue-500"
    },
    {
      icon: DollarSign,
      title: "Divisão Inteligente",
      description: "Calcule custos por pessoa instantaneamente e compartilhe despesas de forma justa.",
      gradient: "from-green-500 to-teal-500"
    },
    {
      icon: Calendar,
      title: "Templates Prontos",
      description: "Churrasco, jantar, aniversário... Modelos pré-configurados para começar em segundos.",
      gradient: "from-purple-500 to-pink-500"
    },
    {
      icon: MessageSquare,
      title: "Comunicação Fácil",
      description: "Integração com WhatsApp e e-mail para notificar seus convidados automaticamente.",
      gradient: "from-indigo-500 to-violet-500"
    },
    {
      icon: Smartphone,
      title: "Acesse de Qualquer Lugar",
      description: "PWA instalável funciona perfeitamente em qualquer dispositivo, online ou offline.",
      gradient: "from-rose-500 to-red-500"
    }
  ];

  const benefits = [
    "Planejamento em minutos, não horas",
    "Acompanhamento de confirmações em tempo real",
    "Divisão de custos sem complicação (em breve)",
    "Templates prontos para cada ocasião",
    "Funciona em qualquer celular ou computador",
  ];

  const stats = [
    { value: "< 30s", label: "Para Criar Evento" },
    { value: "100%", label: "Grátis até 2026" },
    { value: "24/7", label: "IA Disponível" },
    { value: "Zero", label: "Complexidade" }
  ];

  return (
    <div className="min-h-screen bg-background overflow-hidden">
      <ThemeToggle className="fixed top-4 right-4 z-50" />

      {/* Floating Navigation */}
      <motion.nav
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        className="fixed top-4 left-1/2 -translate-x-1/2 z-40 px-6 py-3 rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-2xl"
      >
        <div className="flex items-center gap-8">
          <span className="text-xl font-bold bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
            ReUNE
          </span>
          <div className="hidden md:flex items-center gap-6 text-sm">
            <a href="#features" className="hover:text-primary transition-colors">Recursos</a>
            <a href="#how-it-works" className="hover:text-primary transition-colors">Como Funciona</a>
            <a href="#pricing" onClick={handlePricingClick} className="hover:text-primary transition-colors cursor-pointer">Preços</a>
          </div>
          <Button size="sm" onClick={() => navigate("/app")} className="ml-4">
            Entrar
            <ArrowRight className="w-4 h-4 ml-2" />
          </Button>
        </div>
      </motion.nav>

      {/* Hero Section - Ultra Modern */}
      <section className="relative min-h-screen flex items-center justify-center px-4 pt-24 pb-12 overflow-hidden">
        {/* Animated Background Gradient */}
        <div className="absolute inset-0 bg-gradient-to-br from-orange-500/5 via-background to-cyan-500/5" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(251,146,60,0.1)_0%,transparent_50%)]" />

        {/* Floating Orbs */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-96 h-96 bg-orange-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1.2, 1, 1.2],
            opacity: [0.5, 0.3, 0.5],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan-500/20 rounded-full blur-3xl"
        />

        <motion.div
          style={{ opacity, scale }}
          className="relative z-10 max-w-7xl mx-auto text-center space-y-8"
        >
          {/* Badges */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="flex flex-col items-center gap-3"
          >
            <Badge className="px-4 py-2 text-sm font-medium bg-gradient-to-r from-orange-500/10 to-amber-500/10 border-orange-500/20 text-orange-600 dark:text-orange-400">
              <Sparkles className="w-4 h-4 mr-2 inline" />
              Powered by UNE.AI - Inteligência Artificial
            </Badge>

            {/* Free Access Banner */}
            <motion.div
              initial={{ scale: 0.9, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{ duration: 0.5, delay: 0.2 }}
              className="relative"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-green-500 to-emerald-500 blur-xl opacity-30 animate-pulse" />
              <Badge className="relative px-6 py-3 text-base font-bold bg-gradient-to-r from-green-500 to-emerald-500 text-white border-0 shadow-lg">
                <Zap className="w-5 h-5 mr-2 inline animate-pulse" />
                GRÁTIS até 01/02/2026 - Todos os Recursos!
              </Badge>
            </motion.div>
          </motion.div>

          {/* Main Headline */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.1 }}
            className="space-y-6"
          >
            <h1 className="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tight">
              Organize eventos{" "}
              <span className="relative inline-block">
                <span className="bg-gradient-to-r from-orange-500 via-amber-500 to-orange-600 bg-clip-text text-transparent">
                  sem esforço
                </span>
                <motion.div
                  className="absolute -bottom-2 left-0 right-0 h-3 bg-gradient-to-r from-orange-500/20 to-amber-500/20 -z-10 rounded-full blur-sm"
                  animate={{ scaleX: [0, 1] }}
                  transition={{ duration: 0.8, delay: 0.5 }}
                />
              </span>
            </h1>

            <p className="text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto leading-relaxed">
              A primeira IA que planeja, convida e organiza seus eventos do zero.
              <span className="block mt-2 text-primary font-medium">
                Churrasco, jantar, festa — tudo em minutos.
              </span>
            </p>
          </motion.div>

          {/* CTA Buttons */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="flex flex-col sm:flex-row gap-4 justify-center items-center"
          >
            <Button
              size="lg"
              className="group h-14 px-8 text-lg bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600"
              onClick={() => navigate("/app")}
            >
              Sem cartão de crédito. Sem instalação. Comece agora
              <ArrowRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
            </Button>
            <Button
              size="lg"
              variant="outline"
              className="h-14 px-8 text-lg border-2"
              onClick={() => document.getElementById('demo')?.scrollIntoView({ behavior: 'smooth' })}
            >
              Ver Demonstração
              <ChevronRight className="w-5 h-5 ml-2" />
            </Button>
          </motion.div>

          {/* Social Proof */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.5, delay: 0.3 }}
            className="flex flex-wrap justify-center gap-8 pt-8"
          >
            {stats.map((stat, index) => (
              <div key={index} className="text-center">
                <div className="text-3xl font-bold bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                  {stat.value}
                </div>
                <div className="text-sm text-muted-foreground">{stat.label}</div>
              </div>
            ))}
          </motion.div>
        </motion.div>

        {/* Scroll Indicator */}
        <motion.div
          animate={{ y: [0, 10, 0] }}
          transition={{ duration: 2, repeat: Infinity }}
          className="absolute bottom-8 left-1/2 -translate-x-1/2"
        >
          <div className="w-6 h-10 rounded-full border-2 border-muted-foreground/30 flex items-start justify-center p-2">
            <motion.div
              animate={{ y: [0, 12, 0] }}
              transition={{ duration: 2, repeat: Infinity }}
              className="w-1 h-3 bg-primary rounded-full"
            />
          </div>
        </motion.div>
      </section>

      {/* Demo Video Section */}
      <section id="demo" className="py-24 px-4 relative">
        <div className="absolute inset-0 bg-gradient-to-b from-background via-muted/20 to-background" />

        <div className="max-w-5xl mx-auto relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
            className="text-center mb-12"
          >
            <Badge className="mb-4">
              <Zap className="w-4 h-4 mr-2" />
              Veja em Ação
            </Badge>
            <h2 className="text-3xl md:text-5xl font-bold mb-4">
              Do caos à organização{" "}
              <span className="bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                em 30 segundos
              </span>
            </h2>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            whileInView={{ opacity: 1, scale: 1 }}
            viewport={{ once: true }}
            transition={{ duration: 0.6 }}
            className="relative rounded-3xl overflow-hidden shadow-2xl border-2 border-border/50 bg-gradient-to-br from-orange-500/10 to-cyan-500/10 p-2 max-w-3xl mx-auto"
          >
            <video
              src={videoAtual}
              className="w-full h-full object-cover"
              controls
              poster="/placeholder.svg"
            >
              Seu navegador não suporta o elemento de vídeo.
            </video>
          </motion.div>
        </div>
      </section>

      {/* Features Grid */}
      <section id="features" className="py-32 px-4 relative">
        <div className="max-w-7xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            className="text-center mb-20"
          >
            <Badge className="mb-4">
              <Star className="w-4 h-4 mr-2 fill-current" />
              Recursos Completos
            </Badge>
            <h2 className="text-4xl md:text-6xl font-bold mb-6">
              Tudo que você precisa.{" "}
              <span className="bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                Nada que não precise.
              </span>
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              Ferramentas poderosas que tornam a organização de eventos simples, rápida e eficiente.
            </p>
          </motion.div>

          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {features.map((feature, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 40 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                whileHover={{ y: -8, scale: 1.02 }}
                className="group relative p-8 rounded-3xl bg-card border border-border/50 hover:border-border transition-all duration-300 hover:shadow-2xl"
              >
                {/* Icon with Gradient */}
                <div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${feature.gradient} p-0.5 mb-6`}>
                  <div className="w-full h-full rounded-2xl bg-background flex items-center justify-center">
                    <feature.icon className={`w-8 h-8 bg-gradient-to-br ${feature.gradient} bg-clip-text text-transparent`} />
                  </div>
                </div>

                <h3 className="text-2xl font-bold mb-4 group-hover:text-primary transition-colors">
                  {feature.title}
                </h3>
                <p className="text-muted-foreground leading-relaxed">
                  {feature.description}
                </p>

                {/* Hover Effect */}
                <div className={`absolute inset-0 rounded-3xl bg-gradient-to-br ${feature.gradient} opacity-0 group-hover:opacity-5 transition-opacity duration-300 -z-10`} />
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* How It Works - Modern Timeline */}
      <section id="how-it-works" className="py-32 px-4 relative bg-muted/30">
        <div className="max-w-5xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            className="text-center mb-20"
          >
            <Badge className="mb-4">
              <Sparkles className="w-4 h-4 mr-2" />
              Simples e Rápido
            </Badge>
            <h2 className="text-4xl md:text-6xl font-bold mb-6">
              3 passos para seu{" "}
              <span className="bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                evento perfeito
              </span>
            </h2>
          </motion.div>

          <div className="space-y-12">
            {[
              {
                step: "01",
                title: "Descreva em linguagem natural",
                description: "Diga 'Churrasco para 20 pessoas sábado às 14h' e a IA entende tudo: tipo de evento, quantidade, data e horário.",
                color: "from-orange-500 to-amber-500"
              },
              {
                step: "02",
                title: "IA cria tudo automaticamente",
                description: "Lista de compras, quantidades ideais, sugestões de cardápio e até divisão de tarefas — tudo gerado em segundos.",
                color: "from-cyan-500 to-blue-500"
              },
              {
                step: "03",
                title: "Convide e gerencie com um clique",
                description: "Envie convites via WhatsApp, acompanhe confirmações em tempo real e divida custos automaticamente.",
                color: "from-green-500 to-teal-500"
              }
            ].map((item, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, x: index % 2 === 0 ? -40 : 40 }}
                whileInView={{ opacity: 1, x: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.6, delay: index * 0.2 }}
                className="relative flex items-center gap-8"
              >
                {/* Step Number */}
                <div className={`flex-shrink-0 w-20 h-20 rounded-full bg-gradient-to-br ${item.color} flex items-center justify-center text-3xl font-bold text-white shadow-xl`}>
                  {item.step}
                </div>

                {/* Content */}
                <div className="flex-1 p-8 rounded-2xl bg-background border border-border/50 hover:border-border transition-all duration-300 hover:shadow-xl">
                  <h3 className="text-2xl font-bold mb-3">{item.title}</h3>
                  <p className="text-muted-foreground leading-relaxed">{item.description}</p>
                </div>

                {/* Connecting Line */}
                {index < 2 && (
                  <div className={`absolute left-10 top-24 w-0.5 h-12 bg-gradient-to-b ${item.color}`} />
                )}
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Benefits Checklist */}
      <section className="py-32 px-4">
        <div className="max-w-7xl mx-auto">
          <div className="grid lg:grid-cols-2 gap-16 items-center">
            <motion.div
              initial={{ opacity: 0, x: -40 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
            >
              <Badge className="mb-4">
                <Shield className="w-4 h-4 mr-2" />
                Benefícios Garantidos
              </Badge>
              <h2 className="text-4xl md:text-6xl font-bold mb-6">
                Menos estresse.{" "}
                <span className="bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
                  Mais diversão.
                </span>
              </h2>
              <p className="text-xl text-muted-foreground mb-8">
                Pare de perder tempo com planilhas e anotações. Deixe a IA fazer o trabalho pesado.
              </p>

              <div className="space-y-4">
                {benefits.map((benefit, index) => (
                  <motion.div
                    key={index}
                    initial={{ opacity: 0, x: -20 }}
                    whileInView={{ opacity: 1, x: 0 }}
                    viewport={{ once: true }}
                    transition={{ delay: index * 0.1 }}
                    className="flex items-center gap-4 p-4 rounded-xl bg-muted/50 hover:bg-muted transition-colors"
                  >
                    <div className="flex-shrink-0 w-8 h-8 rounded-full bg-gradient-to-br from-green-500 to-teal-500 flex items-center justify-center">
                      <Check className="w-5 h-5 text-white" />
                    </div>
                    <span className="text-lg font-medium">{benefit}</span>
                  </motion.div>
                ))}
              </div>
            </motion.div>

            <motion.div
              initial={{ opacity: 0, x: 40 }}
              whileInView={{ opacity: 1, x: 0 }}
              viewport={{ once: true }}
              className="relative"
            >
              <div className="aspect-square rounded-3xl bg-gradient-to-br from-orange-500/20 to-cyan-500/20 p-8 backdrop-blur-xl border border-border/50">
                <div className="w-full h-full rounded-2xl bg-background/50 flex items-center justify-center">
                  <div className="text-center">
                    <div className="text-6xl font-bold bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent mb-4">
                      Minutos
                    </div>
                    <p className="text-2xl font-semibold mb-2">Não Horas</p>
                    <p className="text-muted-foreground">
                      Nossa promessa para você
                    </p>
                  </div>
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      </section>

      {/* Final CTA */}
      <section className="py-32 px-4 relative overflow-hidden">
        <div className="absolute inset-0 bg-gradient-to-br from-orange-500/10 via-background to-cyan-500/10" />

        <motion.div
          initial={{ opacity: 0, y: 40 }}
          whileInView={{ opacity: 1, y: 0 }}
          viewport={{ once: true }}
          className="max-w-5xl mx-auto text-center relative z-10"
        >
          <h2 className="text-5xl md:text-7xl font-bold mb-8">
            Pronto para{" "}
            <span className="bg-gradient-to-r from-orange-500 to-amber-500 bg-clip-text text-transparent">
              revolucionar
            </span>
            <br />
            seus eventos?
          </h2>

          <p className="text-2xl text-muted-foreground mb-8">
            Seja um dos primeiros a experimentar o futuro da organização de eventos.
          </p>

          {/* Free Access Highlight */}
          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            whileInView={{ opacity: 1, scale: 1 }}
            viewport={{ once: true }}
            className="inline-block mb-8"
          >
            <div className="px-6 py-3 rounded-full bg-gradient-to-r from-green-500/20 to-emerald-500/20 border-2 border-green-500/30">
              <p className="text-lg font-semibold text-green-600 dark:text-green-400">
                <Zap className="w-5 h-5 inline mr-2" />
                Acesso gratuito ilimitado até 01/01/2026
              </p>
            </div>
          </motion.div>

          <div className="flex flex-col sm:flex-row gap-6 justify-center">
            <Button
              size="lg"
              className="h-16 px-12 text-xl bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 shadow-2xl group"
              onClick={() => navigate("/app")}
            >
              Começar Gratuitamente
              <ArrowRight className="w-6 h-6 ml-3 group-hover:translate-x-2 transition-transform" />
            </Button>
          </div>

          <p className="text-sm text-muted-foreground mt-8">
            Sem cartão de crédito. Sem instalação. Comece agora
          </p>
        </motion.div>
      </section>

      {/* Footer */}
      <Footer />
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\LandingPage.tsx
============================================================
import { Hero } from "@/components/landing/Hero";
import { HowItWorks } from "@/components/landing/HowItWorks";
import { Benefits } from "@/components/landing/Benefits";
import { Demo } from "@/components/landing/Demo";
import { Templates } from "@/components/landing/Templates";
import { Testimonials } from "@/components/landing/Testimonials";
import { Integrations } from "@/components/landing/Integrations";
import { FAQ } from "@/components/landing/FAQ";
import { FinalCTA } from "@/components/landing/FinalCTA";
import { Footer } from "@/components/landing/Footer";
import { ThemeToggle } from "@/components/landing/ThemeToggle";

const LandingPage = () => {
  return (
    <div className="min-h-screen bg-background">
      <ThemeToggle className="fixed top-4 right-4 z-50" />

      {/* Main content with improved spacing and visual hierarchy */}
      <Hero />

      {/* Subtle divider for visual breathing */}
      <div className="container max-w-7xl mx-auto px-4">
        <div className="h-px bg-gradient-to-r from-transparent via-border to-transparent my-8" />
      </div>

      <HowItWorks />

      <div className="container max-w-7xl mx-auto px-4">
        <div className="h-px bg-gradient-to-r from-transparent via-border to-transparent my-8" />
      </div>

      <Benefits />

      {/* Demo section - strategic placement after benefits */}
      <div className="py-8" />
      <Demo />

      <div className="container max-w-7xl mx-auto px-4">
        <div className="h-px bg-gradient-to-r from-transparent via-border to-transparent my-8" />
      </div>

      <Templates />
      {/* <Testimonials /> */}

      <div className="py-8" />
      <Integrations />
      {/* <FAQ /> */}

      {/* Final CTA gets extra spacing for emphasis */}
      <div className="py-12" />
      <FinalCTA />

      <Footer />
    </div>
  );
};

export default LandingPage;


============================================================
FILE PATH: .\src\pages\LaunchLandingPage.tsx
============================================================
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/button';
import { Badge } from '@/components/ui/badge';
import { Input } from '@/components/ui/input';
import { motion, useScroll, useTransform } from 'framer-motion';
import { Sparkles, Calendar, Wallet, ArrowRight, CheckCircle2, AlertCircle, Zap, Star } from 'lucide-react';
import { Helmet } from 'react-helmet';
import { ThemeToggle } from '@/components/landing/ThemeToggle';
import { Footer } from '@/components/landing/Footer';

export default function LaunchLandingPage() {
    const { scrollYProgress } = useScroll();
    const opacity = useTransform(scrollYProgress, [0, 0.2], [1, 0]);
    const scale = useTransform(scrollYProgress, [0, 0.2], [1, 0.95]);

    const [email, setEmail] = useState('');
    const [loading, setLoading] = useState(false);
    const [status, setStatus] = useState<'idle' | 'success' | 'error'>('idle');
    const [errorMessage, setErrorMessage] = useState('');
    const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });

    // Data de lançamento: 05/12/2025
    const launchDate = new Date('2025-12-05T00:00:00').getTime();

    useEffect(() => {
        const timer = setInterval(() => {
            const now = new Date().getTime();
            const distance = launchDate - now;

            if (distance < 0) {
                clearInterval(timer);
                return;
            }

            setTimeLeft({
                days: Math.floor(distance / (1000 * 60 * 60 * 24)),
                hours: Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
                minutes: Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)),
                seconds: Math.floor((distance % (1000 * 60)) / 1000),
            });
        }, 1000);

        return () => clearInterval(timer);
    }, [launchDate]);

    const handleSubmit = async (e: React.FormEvent) => {
        e.preventDefault();
        if (!email) return;

        setLoading(true);
        setStatus('idle');
        setErrorMessage('');

        try {
            const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/waitlist`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    email,
                    source_url: window.location.href,
                }),
            });

            if (!response.ok) {
                throw new Error('Failed to submit');
            }

            setStatus('success');
            setEmail('');
        } catch (error) {
            setStatus('error');
            setErrorMessage('Ocorreu um erro. Tente novamente.');
        } finally {
            setLoading(false);
        }
    };

    const features = [
        {
            icon: Sparkles,
            title: "Planejamento com IA",
            description: "Listas de compras e quantidades calculadas automaticamente pela inteligência artificial.",
            gradient: "from-purple-500 to-violet-500"
        },
        {
            icon: Calendar,
            title: "Convites Digitais",
            description: "Crie e compartilhe convites personalizados em um clique via WhatsApp ou e-mail.",
            gradient: "from-pink-500 to-rose-500"
        },
        {
            icon: Wallet,
            title: "Controle de Custos",
            description: "Orçamento estimado e sugestão inteligente de divisão de despesas entre participantes.",
            gradient: "from-indigo-500 to-purple-500"
        }
    ];

    return (
        <div className="min-h-screen bg-background overflow-hidden">
            <Helmet>
                <title>ReUNE - O Futuro da Organização de Eventos | Acesso Antecipado</title>
                <meta name="description" content="Cadastre-se para o lançamento do ReUNE. A primeira IA que organiza seus eventos do zero. Acesso exclusivo e benefícios para early adopters." />
                <meta name="keywords" content="organização de eventos, IA para eventos, app de festas, ReUNE launch" />
            </Helmet>

            <ThemeToggle className="fixed top-4 right-4 z-50" />

            {/* Floating Navigation */}
            <motion.nav
                initial={{ y: -100 }}
                animate={{ y: 0 }}
                className="fixed top-4 left-1/2 -translate-x-1/2 z-40 px-6 py-3 rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-2xl"
            >
                <div className="flex items-center gap-8">
                    <span className="text-xl font-bold bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent">
                        ReUNE
                    </span>
                    <div className="hidden md:flex items-center gap-2 text-sm font-medium border-l border-border/50 pl-6">
                        <span className="text-muted-foreground">Lançamento</span>
                        <span className="font-bold">05.12.2025</span>
                    </div>
                    <Button size="sm" onClick={() => window.location.href = '/'} variant="ghost" className="ml-4">
                        <ArrowRight className="w-4 h-4 mr-2 rotate-180" />
                        Voltar
                    </Button>
                </div>
            </motion.nav>

            {/* Hero Section - Ultra Modern */}
            <section className="relative min-h-screen flex items-center justify-center px-4 pt-24 pb-12 overflow-hidden">
                {/* Animated Background Gradient */}
                <div className="absolute inset-0 bg-gradient-to-br from-purple-500/5 via-background to-pink-500/5" />
                <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(168,85,247,0.1)_0%,transparent_50%)]" />

                {/* Floating Orbs - Purple/Pink */}
                <motion.div
                    animate={{
                        scale: [1, 1.2, 1],
                        opacity: [0.3, 0.5, 0.3],
                    }}
                    transition={{ duration: 8, repeat: Infinity }}
                    className="absolute top-1/4 left-1/4 w-96 h-96 bg-purple-500/20 rounded-full blur-3xl"
                />
                <motion.div
                    animate={{
                        scale: [1.2, 1, 1.2],
                        opacity: [0.5, 0.3, 0.5],
                    }}
                    transition={{ duration: 8, repeat: Infinity, delay: 1 }}
                    className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-pink-500/20 rounded-full blur-3xl"
                />

                <motion.div
                    style={{ opacity, scale }}
                    className="relative z-10 max-w-7xl mx-auto text-center space-y-8"
                >
                    {/* Badges */}
                    <motion.div
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5 }}
                        className="flex flex-col items-center gap-3"
                    >
                        <Badge className="px-4 py-2 text-sm font-medium bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/20 text-purple-600 dark:text-purple-400">
                            <Sparkles className="w-4 h-4 mr-2 inline" />
                            A Revolução dos Eventos
                        </Badge>

                        {/* Early Access Banner */}
                        <motion.div
                            initial={{ scale: 0.9, opacity: 0 }}
                            animate={{ scale: 1, opacity: 1 }}
                            transition={{ duration: 0.5, delay: 0.2 }}
                            className="relative"
                        >
                            <div className="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-500 blur-xl opacity-30 animate-pulse" />
                            <Badge className="relative px-6 py-3 text-base font-bold bg-gradient-to-r from-purple-500 to-pink-500 text-white border-0 shadow-lg">
                                <Star className="w-5 h-5 mr-2 inline animate-pulse" />
                                Acesso Exclusivo VIP - Benefícios Vitalícios
                            </Badge>
                        </motion.div>
                    </motion.div>

                    {/* Main Headline */}
                    <motion.div
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5, delay: 0.1 }}
                        className="space-y-6"
                    >
                        <h1 className="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tight">
                            Chega de caos.{" "}
                            <span className="relative inline-block">
                                <span className="bg-gradient-to-r from-purple-500 via-pink-500 to-purple-600 bg-clip-text text-transparent">
                                    Organize com IA.
                                </span>
                                <motion.div
                                    className="absolute -bottom-2 left-0 right-0 h-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 -z-10 rounded-full blur-sm"
                                    animate={{ scaleX: [0, 1] }}
                                    transition={{ duration: 0.8, delay: 0.5 }}
                                />
                            </span>
                        </h1>

                        <p className="text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto leading-relaxed">
                            O ReUNE é a primeira inteligência artificial que planeja, convida e organiza seus eventos do zero.
                            <span className="block mt-2 text-primary font-medium">
                                Garanta seu acesso antecipado e benefícios vitalícios.
                            </span>
                        </p>
                    </motion.div>

                    {/* Countdown */}
                    <motion.div
                        initial={{ opacity: 0, scale: 0.9 }}
                        animate={{ opacity: 1, scale: 1 }}
                        transition={{ delay: 0.2, duration: 0.5 }}
                        className="pt-8"
                    >
                        <p className="text-xs uppercase tracking-widest text-muted-foreground mb-4">Lançamento em</p>
                        <div className="grid grid-cols-4 gap-4 md:gap-8 max-w-2xl mx-auto">
                            {[
                                { label: 'Dias', value: timeLeft.days },
                                { label: 'Horas', value: timeLeft.hours },
                                { label: 'Min', value: timeLeft.minutes },
                                { label: 'Seg', value: timeLeft.seconds }
                            ].map((item, idx) => (
                                <motion.div
                                    key={idx}
                                    initial={{ opacity: 0, y: 20 }}
                                    animate={{ opacity: 1, y: 0 }}
                                    transition={{ delay: 0.1 * idx, duration: 0.4 }}
                                    className="flex flex-col items-center group"
                                >
                                    <div className="relative">
                                        <div className={`absolute inset-0 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl ${
                                            idx % 2 === 0 ? 'bg-purple-600/20' : 'bg-pink-600/20'
                                        }`} />

                                        <motion.div
                                            key={item.value}
                                            initial={{ scale: 1 }}
                                            animate={{ scale: [1, 1.05, 1] }}
                                            transition={{ duration: 0.3 }}
                                            className={`relative text-3xl md:text-5xl font-mono font-bold mb-2 px-4 py-2 md:px-6 md:py-3 rounded-2xl bg-gradient-to-br ${
                                                idx % 2 === 0 ? 'from-purple-500/10 to-purple-500/5' : 'from-pink-500/10 to-pink-500/5'
                                            } border ${
                                                idx % 2 === 0 ? 'border-purple-500/20' : 'border-pink-500/20'
                                            } backdrop-blur-sm group-hover:border-primary/50 transition-all duration-300`}
                                        >
                                            {idx === 3 && (
                                                <div className="absolute inset-0 bg-gradient-to-br from-purple-600/10 to-pink-600/10 rounded-2xl animate-pulse" />
                                            )}
                                            <span className="relative z-10">{String(item.value).padStart(2, '0')}</span>
                                        </motion.div>
                                    </div>
                                    <div className="text-xs uppercase tracking-widest text-muted-foreground group-hover:text-primary transition-colors">
                                        {item.label}
                                    </div>
                                </motion.div>
                            ))}
                        </div>
                    </motion.div>

                    {/* Email Form / Success Message */}
                    <motion.div
                        initial={{ opacity: 0, y: 20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5, delay: 0.3 }}
                        className="flex flex-col items-center gap-6 pt-8"
                    >
                        <div className="w-full max-w-md">
                            {status === 'success' ? (
                                <motion.div
                                    initial={{ opacity: 0, scale: 0.95 }}
                                    animate={{ opacity: 1, scale: 1 }}
                                    className="p-8 bg-card border-2 border-green-500/20 rounded-3xl shadow-2xl space-y-4"
                                >
                                    <CheckCircle2 className="w-16 h-16 text-green-500 mx-auto" />
                                    <h3 className="text-2xl font-bold text-center">Você está na lista VIP!</h3>
                                    <p className="text-muted-foreground text-center">
                                        Fique de olho no seu e-mail para novidades exclusivas e acesso antecipado.
                                    </p>
                                </motion.div>
                            ) : (
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div className="relative">
                                        <div className="absolute -inset-1 bg-gradient-to-r from-purple-600 to-pink-600 rounded-3xl blur opacity-25"></div>
                                        <div className="relative flex gap-2 p-2 bg-card border-2 border-border rounded-3xl shadow-2xl">
                                            <Input
                                                type="email"
                                                placeholder="Seu melhor e-mail"
                                                className="flex-1 h-12 border-0 bg-transparent focus-visible:ring-0"
                                                value={email}
                                                onChange={(e) => setEmail(e.target.value)}
                                                required
                                            />
                                            <Button
                                                type="submit"
                                                disabled={loading}
                                                className="h-12 px-8 bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 font-semibold"
                                            >
                                                {loading ? 'Enviando...' : (
                                                    <>
                                                        Entrar na Lista VIP
                                                        <ArrowRight className="w-4 h-4 ml-2" />
                                                    </>
                                                )}
                                            </Button>
                                        </div>
                                    </div>
                                    {status === 'error' && (
                                        <div className="text-center text-destructive text-sm flex items-center justify-center gap-2">
                                            <AlertCircle className="w-4 h-4" /> {errorMessage}
                                        </div>
                                    )}
                                </form>
                            )}
                        </div>

                        <p className="text-xs text-muted-foreground">
                            Junte-se a milhares de organizadores esperando pelo lançamento • 100% gratuito
                        </p>
                    </motion.div>
                </motion.div>

                {/* Scroll Indicator */}
                <motion.div
                    animate={{ y: [0, 10, 0] }}
                    transition={{ duration: 2, repeat: Infinity }}
                    className="absolute bottom-8 left-1/2 -translate-x-1/2"
                >
                    <div className="w-6 h-10 rounded-full border-2 border-muted-foreground/30 flex items-start justify-center p-2">
                        <motion.div
                            animate={{ y: [0, 12, 0] }}
                            transition={{ duration: 2, repeat: Infinity }}
                            className="w-1 h-3 bg-primary rounded-full"
                        />
                    </div>
                </motion.div>
            </section>

            {/* Features Grid */}
            <section id="features" className="py-32 px-4 relative">
                <div className="max-w-7xl mx-auto">
                    <motion.div
                        initial={{ opacity: 0, y: 40 }}
                        whileInView={{ opacity: 1, y: 0 }}
                        viewport={{ once: true }}
                        className="text-center mb-20"
                    >
                        <Badge className="mb-4">
                            <Zap className="w-4 h-4 mr-2" />
                            O que vem por aí
                        </Badge>
                        <h2 className="text-4xl md:text-6xl font-bold mb-6">
                            Recursos que vão{" "}
                            <span className="bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent">
                                transformar
                            </span>
                            <br />
                            seus eventos
                        </h2>
                        <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
                            IA de última geração para automatizar tudo que você precisa.
                        </p>
                    </motion.div>

                    <div className="grid md:grid-cols-3 gap-8">
                        {features.map((feature, index) => (
                            <motion.div
                                key={index}
                                initial={{ opacity: 0, y: 40 }}
                                whileInView={{ opacity: 1, y: 0 }}
                                viewport={{ once: true }}
                                transition={{ duration: 0.5, delay: index * 0.1 }}
                                whileHover={{ y: -8, scale: 1.02 }}
                                className="group relative p-8 rounded-3xl bg-card border border-border/50 hover:border-border transition-all duration-300 hover:shadow-2xl"
                            >
                                <div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${feature.gradient} p-0.5 mb-6`}>
                                    <div className="w-full h-full rounded-2xl bg-background flex items-center justify-center">
                                        <feature.icon className={`w-8 h-8 bg-gradient-to-br ${feature.gradient} bg-clip-text text-transparent`} />
                                    </div>
                                </div>

                                <h3 className="text-2xl font-bold mb-4 group-hover:text-primary transition-colors">
                                    {feature.title}
                                </h3>
                                <p className="text-muted-foreground leading-relaxed">
                                    {feature.description}
                                </p>

                                <div className={`absolute inset-0 rounded-3xl bg-gradient-to-br ${feature.gradient} opacity-0 group-hover:opacity-5 transition-opacity duration-300 -z-10`} />
                            </motion.div>
                        ))}
                    </div>
                </div>
            </section>

            {/* Footer */}
            <Footer />
        </div>
    );
}


============================================================
FILE PATH: .\src\pages\Login.tsx
============================================================
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { Badge } from "@/components/ui/badge";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";
import { ArrowLeft, Sparkles, Mail, Lock } from "lucide-react";
import reUneLogo from "@/assets/reune-logo.png";
import { motion } from "framer-motion";

interface LoginProps {
  onLogin: () => void;
}

const Login = ({ onLogin }: LoginProps) => {
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");
  const [isLogin, setIsLogin] = useState(true);
  const [loading, setLoading] = useState(false);
  const { toast } = useToast();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!email || !password) return;

    setLoading(true);

    try {
      if (isLogin) {
        const { error } = await supabase.auth.signInWithPassword({
          email,
          password,
        });

        if (error) throw error;

        toast({
          title: "Login realizado com sucesso!",
          description: "Bem-vindo de volta!",
        });

        onLogin();
      } else {
        const redirectUrl = `${window.location.origin}/`;

        const { error } = await supabase.auth.signUp({
          email,
          password,
          options: {
            emailRedirectTo: redirectUrl,
          },
        });

        if (error) throw error;

        toast({
          title: "Conta criada com sucesso!",
          description: "Verifique seu email para confirmar a conta.",
        });
      }
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro na autenticação",
        description: err?.message || "Ocorreu um erro. Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const handlePasswordReset = async () => {
    if (!email) {
      toast({
        title: "Informe seu email",
        description: "Digite o email cadastrado para receber o link de redefinição.",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);

    try {
      const redirectUrl = `${window.location.origin}/reset-password`;
      const { error } = await supabase.auth.resetPasswordForEmail(email, {
        redirectTo: redirectUrl,
      });

      if (error) throw error;

      toast({
        title: "Link enviado",
        description: "Confira seu email para redefinir a senha.",
      });
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao enviar link",
        description: err?.message || "Tente novamente em instantes.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-background flex items-center justify-center p-6 relative overflow-hidden">
      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-orange-500/20 rounded-full blur-3xl"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-cyan-500/20 rounded-full blur-3xl"
      />

      {/* Login Card */}
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="w-full max-w-md relative z-10"
      >
        {/* Back Button */}
        <motion.div
          initial={{ opacity: 0, x: -20 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.5, delay: 0.1 }}
          className="mb-6"
        >
          <Button
            variant="ghost"
            size="sm"
            onClick={() => window.location.href = '/'}
            className="gap-2 hover:bg-background/80 backdrop-blur-sm"
          >
            <ArrowLeft className="h-4 w-4" />
            Voltar
          </Button>
        </motion.div>

        {/* Card with Gradient Border */}
        <div className="relative">
          <div className="absolute -inset-1 bg-gradient-to-r from-orange-500/50 to-cyan-500/50 rounded-3xl blur opacity-25"></div>

          <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
            {/* Top Gradient Bar */}
            <div className="h-2 w-full bg-gradient-to-r from-orange-500 to-cyan-500" />

            <CardHeader className="text-center pt-8 pb-6 px-8">
              {/* Logo */}
              <motion.div
                initial={{ scale: 0.8, opacity: 0 }}
                animate={{ scale: 1, opacity: 1 }}
                transition={{ duration: 0.5, delay: 0.2 }}
                className="flex justify-center mb-6"
              >
                <div className="relative">
                  <div className="absolute inset-0 bg-gradient-to-r from-orange-500 to-cyan-500 rounded-full blur-xl opacity-30 animate-pulse"></div>
                  <img src={reUneLogo} alt="ReUNE Logo" className="relative h-24 w-auto" />
                </div>
              </motion.div>

              {/* Title */}
              <motion.div
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ duration: 0.5, delay: 0.3 }}
              >
                <CardTitle className="text-3xl font-bold bg-gradient-to-r from-orange-500 to-cyan-500 bg-clip-text text-transparent mb-2">
                  {isLogin ? "Bem-vindo de volta!" : "Criar Conta"}
                </CardTitle>
                <CardDescription className="text-base">
                  {isLogin ? "Faça login para continuar" : "Comece sua jornada com a gente"}
                </CardDescription>
              </motion.div>

              {/* Badge */}
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ duration: 0.5, delay: 0.4 }}
                className="mt-4"
              >
                <Badge className="px-3 py-1 text-xs bg-gradient-to-r from-orange-500/10 to-cyan-500/10 border-orange-500/20 text-orange-600 dark:text-orange-400">
                  <Sparkles className="w-3 h-3 mr-1 inline" />
                  Plataforma Inteligente
                </Badge>
              </motion.div>
            </CardHeader>

            <CardContent className="space-y-6 px-8 pb-8">
              <form onSubmit={handleSubmit} className="space-y-5">
                {/* Email Input */}
                <motion.div
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ duration: 0.5, delay: 0.5 }}
                  className="space-y-2"
                >
                  <Label htmlFor="email" className="text-sm font-medium flex items-center gap-2">
                    <Mail className="w-4 h-4" />
                    Email
                  </Label>
                  <div className="relative">
                    <Input
                      id="email"
                      type="email"
                      placeholder="seu@email.com"
                      value={email}
                      onChange={(e) => setEmail(e.target.value)}
                      className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:bg-background focus:border-orange-500 focus:shadow-lg focus:shadow-orange-500/20 pl-4"
                    />
                  </div>
                </motion.div>

                {/* Password Input */}
                <motion.div
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ duration: 0.5, delay: 0.6 }}
                  className="space-y-2"
                >
                  <Label htmlFor="password" className="text-sm font-medium flex items-center gap-2">
                    <Lock className="w-4 h-4" />
                    Senha
                  </Label>
                  <div className="relative">
                    <Input
                      id="password"
                      type="password"
                      placeholder="••••••••"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:bg-background focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/20 pl-4"
                    />
                  </div>
                </motion.div>

                {/* Submit Button */}
                <motion.div
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5, delay: 0.7 }}
                  className="pt-2"
                >
                  <Button
                    type="submit"
                    className="w-full h-14 text-base font-semibold bg-gradient-to-r from-orange-500 to-cyan-500 hover:from-orange-600 hover:to-cyan-600 shadow-lg hover:shadow-xl transition-all"
                    disabled={!email || !password || loading}
                  >
                    {loading ? (
                      <div className="flex items-center gap-2">
                        <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                        Aguarde...
                      </div>
                    ) : (
                      isLogin ? "Entrar" : "Criar Conta"
                    )}
                  </Button>
                </motion.div>

                {isLogin && (
                  <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ duration: 0.5, delay: 0.75 }}
                    className="text-right"
                  >
                    <button
                      type="button"
                      onClick={handlePasswordReset}
                      className="text-sm font-medium text-muted-foreground hover:text-primary transition-colors hover:underline"
                      disabled={loading}
                    >
                      Esqueci minha senha
                    </button>
                  </motion.div>
                )}
              </form>

              {/* Toggle Login/Signup */}
              <motion.div
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                transition={{ duration: 0.5, delay: 0.8 }}
                className="text-center pt-4 border-t border-border/50"
              >
                <button
                  type="button"
                  onClick={() => setIsLogin(!isLogin)}
                  className="text-sm font-medium text-muted-foreground hover:text-primary transition-colors hover:underline"
                >
                  {isLogin ? "Não tem conta? Cadastre-se" : "Já tem conta? Faça login"}
                </button>
              </motion.div>
            </CardContent>
          </Card>
        </div>

        {/* Info Footer */}
        <motion.div
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.9 }}
          className="mt-6 text-center text-sm text-muted-foreground"
        >
          <p>Ao continuar, você concorda com nossos termos de uso</p>
        </motion.div>
      </motion.div>
    </div>
  );
};

export default Login;


============================================================
FILE PATH: .\src\pages\MarketingScreenshots.tsx
============================================================
import { useState } from "react";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Camera, Calendar, MessageSquare, Users, BarChart3, HelpCircle, CheckCircle2 } from "lucide-react";
import { Alert, AlertDescription, AlertTitle } from "@/components/ui/alert";

const MarketingScreenshots = () => {
  const [activeTab, setActiveTab] = useState("tutorial");

  return (
    <div className="min-h-screen bg-gradient-to-br from-background via-background to-primary/5">
      <div className="border-b bg-background/95 backdrop-blur-sm sticky top-0 z-40">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <h1 className="text-2xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">
              ReUNE - Screenshots Marketing
            </h1>
            <Button variant="outline" size="sm" asChild>
              <a href="/app">Voltar ao App</a>
            </Button>
          </div>
        </div>
      </div>

      <div className="container mx-auto px-4 py-8">
        <Tabs value={activeTab} onValueChange={setActiveTab}>
          <TabsList className="grid w-full grid-cols-5 mb-6">
            <TabsTrigger value="tutorial">
              <HelpCircle className="w-4 h-4 mr-2" />
              Tutorial
            </TabsTrigger>
            <TabsTrigger value="dashboard">
              <BarChart3 className="w-4 h-4 mr-2" />
              Dashboard
            </TabsTrigger>
            <TabsTrigger value="events">
              <Calendar className="w-4 h-4 mr-2" />
              Eventos
            </TabsTrigger>
            <TabsTrigger value="chat">
              <MessageSquare className="w-4 h-4 mr-2" />
              Chat IA
            </TabsTrigger>
            <TabsTrigger value="guests">
              <Users className="w-4 h-4 mr-2" />
              Convidados
            </TabsTrigger>
          </TabsList>

          <TabsContent value="tutorial" className="space-y-4">
            <Alert>
              <HelpCircle className="h-4 w-4" />
              <AlertTitle>Como capturar screenshots profissionais</AlertTitle>
              <AlertDescription>
                Use as ferramentas do seu navegador para capturar estas telas
              </AlertDescription>
            </Alert>

            <Card>
              <CardHeader>
                <CardTitle>📸 Passo a Passo Rápido</CardTitle>
              </CardHeader>
              <CardContent className="space-y-6">
                <div className="space-y-4">
                  <div className="flex items-start gap-3">
                    <div className="bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-bold">
                      1
                    </div>
                    <div>
                      <h4 className="font-semibold mb-1">Use DevTools do Chrome</h4>
                      <p className="text-sm text-muted-foreground">
                        Pressione F12 → Ctrl+Shift+M (modo responsivo) → Configure a dimensão desejada
                      </p>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <div className="bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-bold">
                      2
                    </div>
                    <div>
                      <h4 className="font-semibold mb-1">Configure Dimensões</h4>
                      <ul className="text-sm text-muted-foreground space-y-1">
                        <li>• Instagram Feed: 1080 x 1350</li>
                        <li>• Instagram Story: 1080 x 1920</li>
                        <li>• LinkedIn: 1200 x 627</li>
                      </ul>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <div className="bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-bold">
                      3
                    </div>
                    <div>
                      <h4 className="font-semibold mb-1">Capture a Tela</h4>
                      <p className="text-sm text-muted-foreground">
                        Pressione Ctrl+Shift+P → Digite "Capture screenshot" → Enter
                      </p>
                    </div>
                  </div>

                  <div className="flex items-start gap-3">
                    <div className="bg-primary text-primary-foreground rounded-full w-8 h-8 flex items-center justify-center flex-shrink-0 font-bold">
                      4
                    </div>
                    <div>
                      <h4 className="font-semibold mb-1">Navegue pelas Abas</h4>
                      <p className="text-sm text-muted-foreground">
                        Use as abas acima para ver diferentes telas do app com dados de exemplo
                      </p>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>

            <Card>
              <CardHeader>
                <CardTitle>💡 Dicas para Screenshots Profissionais</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-3 text-sm">
                  <div className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" />
                    <p><strong>Zoom 100%:</strong> Mantenha o zoom do navegador em 100%</p>
                  </div>
                  <div className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" />
                    <p><strong>Tela cheia:</strong> Maximize a janela do navegador</p>
                  </div>
                  <div className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" />
                    <p><strong>Múltiplas capturas:</strong> Tire várias versões de cada tela</p>
                  </div>
                  <div className="flex items-start gap-2">
                    <CheckCircle2 className="w-4 h-4 text-green-500 mt-0.5 flex-shrink-0" />
                    <p><strong>Tutorial completo:</strong> Veja TUTORIAL_SCREENSHOTS.md no projeto</p>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="dashboard" className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <Card>
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-muted-foreground">Total de Eventos</p>
                      <p className="text-3xl font-bold mt-1">12</p>
                    </div>
                    <Calendar className="w-10 h-10 text-primary opacity-20" />
                  </div>
                </CardContent>
              </Card>
              
              <Card>
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-muted-foreground">Conversas Ativas</p>
                      <p className="text-3xl font-bold mt-1">8</p>
                    </div>
                    <MessageSquare className="w-10 h-10 text-primary opacity-20" />
                  </div>
                </CardContent>
              </Card>
              
              <Card>
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-muted-foreground">Itens Organizados</p>
                      <p className="text-3xl font-bold mt-1">156</p>
                    </div>
                    <BarChart3 className="w-10 h-10 text-primary opacity-20" />
                  </div>
                </CardContent>
              </Card>
              
              <Card>
                <CardContent className="p-6">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="text-sm text-muted-foreground">Convidados</p>
                      <p className="text-3xl font-bold mt-1">48</p>
                    </div>
                    <Users className="w-10 h-10 text-primary opacity-20" />
                  </div>
                </CardContent>
              </Card>
            </div>

            <div>
              <h3 className="text-xl font-semibold mb-4">Próximos Eventos</h3>
              <div className="grid gap-4">
                <Card className="hover:shadow-lg transition-shadow">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <h4 className="text-lg font-semibold mb-2">Churrasco de Final de Ano</h4>
                        <div className="space-y-1 text-sm text-muted-foreground">
                          <p>📅 15/12/2024 às 18:00</p>
                          <p>📍 Sítio do João Silva</p>
                          <p>👥 24/30 confirmados</p>
                        </div>
                      </div>
                      <div className="px-3 py-1 rounded-full text-xs font-medium bg-green-500/10 text-green-500">
                        Confirmado
                      </div>
                    </div>
                  </CardContent>
                </Card>

                <Card className="hover:shadow-lg transition-shadow">
                  <CardContent className="p-6">
                    <div className="flex items-start justify-between">
                      <div className="flex-1">
                        <h4 className="text-lg font-semibold mb-2">Noite de Pizza</h4>
                        <div className="space-y-1 text-sm text-muted-foreground">
                          <p>📅 22/12/2024 às 20:00</p>
                          <p>📍 Apartamento 501</p>
                          <p>👥 12/15 confirmados</p>
                        </div>
                      </div>
                      <div className="px-3 py-1 rounded-full text-xs font-medium bg-yellow-500/10 text-yellow-500">
                        Pendente
                      </div>
                    </div>
                  </CardContent>
                </Card>
              </div>
            </div>
          </TabsContent>

          <TabsContent value="events">
            <Card>
              <CardHeader>
                <CardTitle>Detalhes do Evento</CardTitle>
              </CardHeader>
              <CardContent className="space-y-6">
                <div>
                  <h4 className="text-2xl font-bold mb-2">Churrasco de Final de Ano</h4>
                  <p className="text-muted-foreground">Celebração de fim de ano com amigos e família</p>
                </div>
                
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <p className="text-sm text-muted-foreground">Data e Hora</p>
                    <p className="font-medium">15/12/2024 às 18:00</p>
                  </div>
                  <div>
                    <p className="text-sm text-muted-foreground">Local</p>
                    <p className="font-medium">Sítio do João Silva</p>
                  </div>
                </div>

                <div>
                  <h5 className="font-semibold mb-3">Lista de Compras</h5>
                  <div className="space-y-2">
                    <div className="flex items-center justify-between p-3 bg-muted/50 rounded-lg">
                      <div>
                        <p className="font-medium">🥩 Carne (12kg)</p>
                        <p className="text-sm text-muted-foreground">400g por pessoa</p>
                      </div>
                      <span className="text-xs bg-primary/10 text-primary px-2 py-1 rounded">
                        João Silva
                      </span>
                    </div>
                    
                    <div className="flex items-center justify-between p-3 bg-muted/50 rounded-lg">
                      <div>
                        <p className="font-medium">🍺 Cerveja (5 caixas)</p>
                        <p className="text-sm text-muted-foreground">72 latas</p>
                      </div>
                      <span className="text-xs bg-primary/10 text-primary px-2 py-1 rounded">
                        Maria Santos
                      </span>
                    </div>
                    
                    <div className="flex items-center justify-between p-3 bg-muted/50 rounded-lg">
                      <div>
                        <p className="font-medium">🥤 Refrigerante (3 caixas)</p>
                        <p className="text-sm text-muted-foreground">36 latas</p>
                      </div>
                      <span className="text-xs bg-primary/10 text-primary px-2 py-1 rounded">
                        Pedro Costa
                      </span>
                    </div>
                    
                    <div className="flex items-center justify-between p-3 bg-muted/50 rounded-lg">
                      <div>
                        <p className="font-medium">🍞 Pão (60 unidades)</p>
                        <p className="text-sm text-muted-foreground">2 por pessoa</p>
                      </div>
                      <span className="text-xs bg-muted text-muted-foreground px-2 py-1 rounded">
                        Não atribuído
                      </span>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="chat">
            <Card>
              <CardHeader>
                <CardTitle>Conversa com IA</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-4">
                  <div className="flex justify-end">
                    <div className="max-w-[80%] p-4 rounded-lg bg-primary text-primary-foreground">
                      <p>Preciso organizar um churrasco para 30 pessoas</p>
                    </div>
                  </div>
                  
                  <div className="flex justify-start">
                    <div className="max-w-[80%] p-4 rounded-lg bg-muted">
                      <p>Ótimo! Vou te ajudar a organizar. Quando será o evento?</p>
                    </div>
                  </div>
                  
                  <div className="flex justify-end">
                    <div className="max-w-[80%] p-4 rounded-lg bg-primary text-primary-foreground">
                      <p>Sábado, dia 15 de dezembro às 18h</p>
                    </div>
                  </div>
                  
                  <div className="flex justify-start">
                    <div className="max-w-[80%] p-4 rounded-lg bg-muted">
                      <p className="mb-2">Perfeito! Para 30 pessoas em um churrasco, sugiro:</p>
                      <ul className="list-disc list-inside space-y-1 text-sm">
                        <li>12kg de carne (400g por pessoa)</li>
                        <li>60 pães (2 por pessoa)</li>
                        <li>3kg de sal grosso</li>
                        <li>90 bebidas entre cervejas e refrigerantes</li>
                      </ul>
                      <p className="mt-2">Quer que eu adicione esses itens à lista do evento?</p>
                    </div>
                  </div>
                  
                  <div className="flex justify-end">
                    <div className="max-w-[80%] p-4 rounded-lg bg-primary text-primary-foreground">
                      <p>Sim, por favor! E adiciona também carvão</p>
                    </div>
                  </div>
                  
                  <div className="flex justify-start">
                    <div className="max-w-[80%] p-4 rounded-lg bg-muted">
                      <p>✅ Itens adicionados à lista do evento! Também adicionei 10kg de carvão. Quer distribuir esses itens entre os convidados?</p>
                    </div>
                  </div>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="guests">
            <Card>
              <CardHeader>
                <CardTitle>Lista de Convidados</CardTitle>
              </CardHeader>
              <CardContent>
                <div className="space-y-2">
                  {[
                    { name: "João Silva", items: 3, status: "confirmed" },
                    { name: "Maria Santos", items: 2, status: "confirmed" },
                    { name: "Pedro Costa", items: 1, status: "confirmed" },
                    { name: "Ana Paula", items: 0, status: "pending" },
                    { name: "Carlos Eduardo", items: 1, status: "confirmed" },
                    { name: "Fernanda Lima", items: 2, status: "confirmed" },
                  ].map((guest, i) => (
                    <div key={i} className="flex items-center justify-between p-4 bg-muted/50 rounded-lg">
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                          <span className="font-semibold text-primary">
                            {guest.name.split(' ').map(n => n[0]).join('')}
                          </span>
                        </div>
                        <div>
                          <p className="font-medium">{guest.name}</p>
                          <p className="text-sm text-muted-foreground">
                            {guest.items} {guest.items === 1 ? 'item' : 'itens'} atribuídos
                          </p>
                        </div>
                      </div>
                      <div className={`px-3 py-1 rounded-full text-xs font-medium ${
                        guest.status === 'confirmed' 
                          ? 'bg-green-500/10 text-green-500' 
                          : 'bg-yellow-500/10 text-yellow-500'
                      }`}>
                        {guest.status === 'confirmed' ? 'Confirmado' : 'Pendente'}
                      </div>
                    </div>
                  ))}
                </div>
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
};

export default MarketingScreenshots;


============================================================
FILE PATH: .\src\pages\NotFound.tsx
============================================================
import { useLocation, useNavigate } from "react-router-dom";
import { useEffect } from "react";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Home, ArrowLeft, Search, Sparkles } from "lucide-react";
import { motion } from "framer-motion";

const NotFound = () => {
  const location = useLocation();
  const navigate = useNavigate();

  useEffect(() => {
    console.error("404 Error: User attempted to access non-existent route:", location.pathname);
  }, [location.pathname]);

  return (
    <div className="flex min-h-screen items-center justify-center bg-background relative overflow-hidden px-4">
      {/* Animated Background Orbs */}
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity }}
        className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-purple-500/20 rounded-full blur-3xl"
      />
      <motion.div
        animate={{
          scale: [1, 1.2, 1],
          opacity: [0.3, 0.5, 0.3],
        }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-pink-500/20 rounded-full blur-3xl"
      />

      {/* 404 Content */}
      <div className="text-center relative z-10 max-w-2xl mx-auto">
        {/* 404 Number */}
        <motion.div
          initial={{ scale: 0.5, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ duration: 0.5, type: "spring" }}
          className="mb-8"
        >
          <div className="relative inline-block">
            <div className="absolute inset-0 bg-gradient-to-r from-purple-500 to-pink-500 blur-3xl opacity-30 animate-pulse" />
            <h1 className="relative text-[12rem] md:text-[16rem] font-black bg-gradient-to-r from-purple-500 to-pink-500 bg-clip-text text-transparent leading-none">
              404
            </h1>
          </div>
        </motion.div>

        {/* Badge */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.2 }}
          className="mb-6"
        >
          <Badge className="px-4 py-2 text-sm font-medium bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/20 text-purple-600 dark:text-purple-400">
            <Search className="w-4 h-4 mr-2 inline" />
            Página Não Encontrada
          </Badge>
        </motion.div>

        {/* Message */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.3 }}
          className="mb-8 space-y-3"
        >
          <h2 className="text-3xl md:text-4xl font-bold text-foreground">
            Ops! Parece que você se perdeu
          </h2>
          <p className="text-lg md:text-xl text-muted-foreground max-w-md mx-auto">
            A página que você está procurando não existe ou foi movida.
          </p>
        </motion.div>

        {/* Path Info */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.4 }}
          className="mb-10"
        >
          <div className="inline-block px-6 py-3 rounded-xl bg-muted/50 backdrop-blur-sm border border-border/50">
            <code className="text-sm font-mono text-muted-foreground">
              {location.pathname}
            </code>
          </div>
        </motion.div>

        {/* Action Buttons */}
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.5, delay: 0.5 }}
          className="flex flex-col sm:flex-row gap-4 justify-center items-center"
        >
          <Button
            size="lg"
            onClick={() => navigate(-1)}
            variant="outline"
            className="h-14 px-8 text-base font-semibold border-2 hover:bg-background/80 backdrop-blur-sm group"
          >
            <ArrowLeft className="w-5 h-5 mr-2 group-hover:-translate-x-1 transition-transform" />
            Voltar
          </Button>

          <Button
            size="lg"
            onClick={() => navigate("/")}
            className="h-14 px-8 text-base font-semibold bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 shadow-lg hover:shadow-xl transition-all group"
          >
            <Home className="w-5 h-5 mr-2" />
            Ir para Home
            <Sparkles className="w-4 h-4 ml-2 group-hover:rotate-12 transition-transform" />
          </Button>
        </motion.div>

        {/* Fun Message */}
        <motion.div
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          transition={{ duration: 0.5, delay: 0.6 }}
          className="mt-12"
        >
          <p className="text-sm text-muted-foreground italic">
            "Nem todos aqueles que vagam estão perdidos... mas você está!" 😅
          </p>
        </motion.div>
      </div>
    </div>
  );
};

export default NotFound;


============================================================
FILE PATH: .\src\pages\PrivacyPolicy.tsx
============================================================
import { ArrowLeft } from "lucide-react";
import { Link } from "react-router-dom";
import { Button } from "@/components/ui/button";

export default function PrivacyPolicy() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-background via-background to-accent/5">
      {/* Header */}
      <header className="border-b border-border/40 bg-background/80 backdrop-blur-sm sticky top-0 z-50">
        <div className="container mx-auto px-4 py-4">
          <Link to="/">
            <Button variant="ghost" size="sm">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Voltar ao site
            </Button>
          </Link>
        </div>
      </header>

      {/* Main Content */}
      <main className="container mx-auto px-4 py-12 max-w-4xl">
        <div className="prose prose-slate dark:prose-invert max-w-none">
          <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
            Política de Privacidade
          </h1>
          <p className="text-muted-foreground mb-8">
            Última atualização: {new Date().toLocaleDateString('pt-BR')}
          </p>

          <div className="bg-card/50 backdrop-blur-sm border border-border/50 rounded-2xl p-8 space-y-8">
            <section>
              <h2 className="text-2xl font-bold mb-4">1. Informações que Coletamos</h2>
              <p className="mb-4">
                O ReUNE coleta as seguintes informações para proporcionar a melhor experiência possível:
              </p>

              <h3 className="text-xl font-semibold mb-3 mt-6">1.1 Informações Fornecidas por Você</h3>
              <ul className="list-disc pl-6 space-y-2 mb-4">
                <li><strong>Dados de Cadastro:</strong> Nome, e-mail, telefone e foto de perfil</li>
                <li><strong>Informações de Eventos:</strong> Título, descrição, data, local e participantes dos eventos criados</li>
                <li><strong>Conteúdo Gerado:</strong> Mensagens, comentários, fotos e demais interações no aplicativo</li>
                <li><strong>Lista de Contatos:</strong> Com sua permissão, para facilitar o convite de amigos</li>
              </ul>

              <h3 className="text-xl font-semibold mb-3 mt-6">1.2 Informações Coletadas Automaticamente</h3>
              <ul className="list-disc pl-6 space-y-2">
                <li><strong>Dados de Uso:</strong> Interações com o app, eventos acessados, funcionalidades utilizadas</li>
                <li><strong>Informações do Dispositivo:</strong> Modelo, sistema operacional, identificador único, endereço IP</li>
                <li><strong>Cookies e Tecnologias Similares:</strong> Para melhorar a experiência e autenticação</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">2. Como Usamos Suas Informações</h2>
              <p className="mb-4">
                Utilizamos suas informações para:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Fornecer, manter e melhorar nossos serviços</li>
                <li>Facilitar a criação e gestão de eventos</li>
                <li>Conectar você com seus amigos e participantes de eventos</li>
                <li>Enviar notificações sobre eventos, convites e atualizações</li>
                <li>Personalizar sua experiência no aplicativo</li>
                <li>Garantir a segurança e prevenir fraudes</li>
                <li>Analisar o uso do app para melhorias contínuas</li>
                <li>Cumprir obrigações legais e regulatórias</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">3. Compartilhamento de Informações</h2>
              <p className="mb-4">
                Nós <strong>NÃO vendemos</strong> suas informações pessoais. Compartilhamos dados apenas quando:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li><strong>Com Outros Usuários:</strong> Informações de perfil e eventos são visíveis para participantes convidados</li>
                <li><strong>Prestadores de Serviços:</strong> Empresas que nos auxiliam (hospedagem, email, analytics) sob rigorosos termos de confidencialidade</li>
                <li><strong>Exigências Legais:</strong> Quando necessário para cumprir leis, regulamentos ou ordens judiciais</li>
                <li><strong>Proteção de Direitos:</strong> Para proteger direitos, segurança e propriedade do ReUNE e seus usuários</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">4. Seus Direitos (LGPD)</h2>
              <p className="mb-4">
                De acordo com a Lei Geral de Proteção de Dados (LGPD), você tem direito a:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li><strong>Confirmação e Acesso:</strong> Saber se tratamos seus dados e acessá-los</li>
                <li><strong>Correção:</strong> Corrigir dados incompletos, inexatos ou desatualizados</li>
                <li><strong>Anonimização, Bloqueio ou Eliminação:</strong> De dados desnecessários ou excessivos</li>
                <li><strong>Portabilidade:</strong> Receber seus dados em formato estruturado</li>
                <li><strong>Informação sobre Compartilhamento:</strong> Saber com quem compartilhamos seus dados</li>
                <li><strong>Revogação do Consentimento:</strong> A qualquer momento</li>
                <li><strong>Oposição ao Tratamento:</strong> Quando não houver consentimento ou base legal</li>
              </ul>
              <p className="mt-4">
                Para exercer seus direitos, entre em contato pelo email: <strong>contato@reuneapp.com.br</strong>
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">5. Segurança dos Dados</h2>
              <p>
                Implementamos medidas de segurança técnicas e organizacionais apropriadas para proteger suas informações
                contra acesso não autorizado, alteração, divulgação ou destruição. Isso inclui:
              </p>
              <ul className="list-disc pl-6 space-y-2 mt-4">
                <li>Criptografia de dados em trânsito e em repouso</li>
                <li>Controles de acesso rigorosos</li>
                <li>Monitoramento contínuo de segurança</li>
                <li>Auditorias regulares de segurança</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">6. Retenção de Dados</h2>
              <p>
                Mantemos suas informações pelo tempo necessário para fornecer nossos serviços,
                cumprir obrigações legais, resolver disputas e fazer cumprir nossos acordos.
                Quando você excluir sua conta, seus dados serão removidos dentro de 90 dias,
                exceto quando precisarmos mantê-los por obrigação legal.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">7. Menores de Idade</h2>
              <p>
                O ReUNE não é destinado a menores de 13 anos. Não coletamos intencionalmente
                informações de crianças. Se você acredita que uma criança nos forneceu dados pessoais,
                entre em contato para que possamos removê-los.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">8. Alterações nesta Política</h2>
              <p>
                Podemos atualizar esta Política de Privacidade periodicamente. Notificaremos sobre
                mudanças significativas por email ou aviso no aplicativo. O uso continuado após as
                alterações constitui aceitação da nova política.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">9. Contato</h2>
              <p className="mb-4">
                Para dúvidas, solicitações ou reclamações sobre privacidade:
              </p>
              <ul className="list-none space-y-2">
                <li><strong>Email:</strong> contato@reuneapp.com.br</li>
                
              </ul>
              <p className="mt-4 text-sm text-muted-foreground">
                Você também pode registrar uma reclamação junto à Autoridade Nacional de Proteção de Dados (ANPD).
              </p>
            </section>
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t border-border/40 mt-16">
        <div className="container mx-auto px-4 py-8 text-center text-muted-foreground">
          <p>&copy; {new Date().getFullYear()} ReUNE. Todos os direitos reservados.</p>
        </div>
      </footer>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\ResetPassword.tsx
============================================================
import { useEffect, useState } from "react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Label } from "@/components/ui/label";
import { supabase } from "@/integrations/supabase/client";
import { useToast } from "@/hooks/use-toast";
import { ArrowLeft, Lock } from "lucide-react";
import { motion } from "framer-motion";

const ResetPassword = () => {
  const { toast } = useToast();
  const [password, setPassword] = useState("");
  const [confirmPassword, setConfirmPassword] = useState("");
  const [loading, setLoading] = useState(false);
  const [ready, setReady] = useState(false);
  const [hasSession, setHasSession] = useState(false);

  useEffect(() => {
    const init = async () => {
      try {
        const hash = window.location.hash.replace(/^#/, "");
        const params = new URLSearchParams(hash);
        const accessToken = params.get("access_token");
        const refreshToken = params.get("refresh_token");

        if (accessToken && refreshToken) {
          await supabase.auth.setSession({
            access_token: accessToken,
            refresh_token: refreshToken,
          });

          // Remove tokens from the URL
          window.history.replaceState(null, "", window.location.pathname);
        }

        const { data } = await supabase.auth.getSession();
        setHasSession(!!data.session);
      } catch (error) {
        setHasSession(false);
      } finally {
        setReady(true);
      }
    };

    void init();
  }, []);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();

    if (!password || !confirmPassword) return;
    if (password !== confirmPassword) {
      toast({
        title: "Senhas nao conferem",
        description: "Digite a mesma senha nos dois campos.",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);

    try {
      const { error } = await supabase.auth.updateUser({ password });
      if (error) throw error;

      toast({
        title: "Senha atualizada",
        description: "Voce ja pode entrar com sua nova senha.",
      });

      window.location.href = "/app";
    } catch (error) {
      const err = error as { message?: string };
      toast({
        title: "Erro ao atualizar senha",
        description: err?.message || "Tente novamente.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-background flex items-center justify-center p-6 relative overflow-hidden">
      <motion.div
        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
        transition={{ duration: 8, repeat: Infinity }}
        className="absolute top-1/4 left-1/4 w-[600px] h-[600px] bg-orange-500/20 rounded-full blur-3xl"
      />
      <motion.div
        animate={{ scale: [1, 1.2, 1], opacity: [0.3, 0.5, 0.3] }}
        transition={{ duration: 8, repeat: Infinity, delay: 1 }}
        className="absolute bottom-1/4 right-1/4 w-[600px] h-[600px] bg-cyan-500/20 rounded-full blur-3xl"
      />

      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.5 }}
        className="w-full max-w-md relative z-10"
      >
        <div className="mb-6">
          <Button
            variant="ghost"
            size="sm"
            onClick={() => (window.location.href = "/")}
            className="gap-2 hover:bg-background/80 backdrop-blur-sm"
          >
            <ArrowLeft className="h-4 w-4" />
            Voltar
          </Button>
        </div>

        <div className="relative">
          <div className="absolute -inset-1 bg-gradient-to-r from-orange-500/50 to-cyan-500/50 rounded-3xl blur opacity-25"></div>
          <Card className="relative border-2 border-border/50 bg-card/80 backdrop-blur-xl rounded-3xl shadow-2xl overflow-hidden">
            <div className="h-2 w-full bg-gradient-to-r from-orange-500 to-cyan-500" />
            <CardHeader className="text-center pt-8 pb-6 px-8">
              <CardTitle className="text-2xl font-bold bg-gradient-to-r from-orange-500 to-cyan-500 bg-clip-text text-transparent mb-2">
                Redefinir senha
              </CardTitle>
              <CardDescription className="text-base">
                Defina uma nova senha para sua conta
              </CardDescription>
            </CardHeader>

            <CardContent className="space-y-6 px-8 pb-8">
              {!ready ? (
                <div className="text-center text-sm text-muted-foreground">
                  Verificando link...
                </div>
              ) : !hasSession ? (
                <div className="text-center text-sm text-muted-foreground">
                  Link invalido ou expirado. Solicite um novo.
                </div>
              ) : (
                <form onSubmit={handleSubmit} className="space-y-5">
                  <div className="space-y-2">
                    <Label htmlFor="password" className="text-sm font-medium flex items-center gap-2">
                      <Lock className="w-4 h-4" />
                      Nova senha
                    </Label>
                    <Input
                      id="password"
                      type="password"
                      value={password}
                      onChange={(e) => setPassword(e.target.value)}
                      className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:bg-background focus:border-orange-500 focus:shadow-lg focus:shadow-orange-500/20 pl-4"
                      disabled={loading}
                    />
                  </div>

                  <div className="space-y-2">
                    <Label htmlFor="confirmPassword" className="text-sm font-medium flex items-center gap-2">
                      <Lock className="w-4 h-4" />
                      Confirmar senha
                    </Label>
                    <Input
                      id="confirmPassword"
                      type="password"
                      value={confirmPassword}
                      onChange={(e) => setConfirmPassword(e.target.value)}
                      className="h-12 rounded-xl border-2 border-border/50 bg-background/50 backdrop-blur-sm transition-all focus:bg-background focus:border-cyan-500 focus:shadow-lg focus:shadow-cyan-500/20 pl-4"
                      disabled={loading}
                    />
                  </div>

                  <Button
                    type="submit"
                    className="w-full h-14 text-base font-semibold bg-gradient-to-r from-orange-500 to-cyan-500 hover:from-orange-600 hover:to-cyan-600 shadow-lg hover:shadow-xl transition-all"
                    disabled={!password || !confirmPassword || loading}
                  >
                    {loading ? "Aguarde..." : "Atualizar senha"}
                  </Button>
                </form>
              )}
            </CardContent>
          </Card>
        </div>
      </motion.div>
    </div>
  );
};

export default ResetPassword;


============================================================
FILE PATH: .\src\pages\ReuneWaitlist.tsx
============================================================
import { useState } from "react";
import { motion } from "framer-motion";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";
import { useToast } from "@/hooks/use-toast";
import { ThemeToggle } from "@/components/landing/ThemeToggle";

const ReuneWaitlist = () => {
  const [email, setEmail] = useState("");
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);
  const { toast } = useToast();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!email || !email.includes("@") || !email.includes(".")) {
      toast({
        title: "Email inválido",
        description: "Por favor, insira um email válido.",
        variant: "destructive",
      });
      return;
    }

    setIsSubmitting(true);

    try {
      const response = await fetch(`${import.meta.env.VITE_SUPABASE_URL}/functions/v1/waitlist`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          email: email.toLowerCase().trim(),
          source_url: window.location.href,
        }),
      });

      if (!response.ok) {
        const data = await response.json();
        throw new Error(data.error || 'Failed to submit');
      }

      setIsSubmitted(true);
      setEmail("");
      toast({
        title: "Você está na lista! 🎉",
        description: "Fique de olho no lançamento.",
      });
    } catch (error) {
      console.error("Error submitting to waitlist:", error);
      toast({
        title: "Erro ao cadastrar",
        description: "Tente novamente em alguns instantes.",
        variant: "destructive",
      });
    } finally {
      setIsSubmitting(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-orange-50 via-white to-amber-50 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 flex items-center justify-center p-4 relative overflow-hidden">
      <ThemeToggle className="fixed top-4 right-4 z-50" />
      
      {/* Decorative background elements */}
      <div className="absolute inset-0 overflow-hidden pointer-events-none">
        <motion.div
          className="absolute top-20 left-10 w-72 h-72 bg-orange-200/20 dark:bg-orange-900/10 rounded-full blur-3xl"
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{
            duration: 8,
            repeat: Infinity,
            ease: "easeInOut",
          }}
        />
        <motion.div
          className="absolute bottom-20 right-10 w-96 h-96 bg-amber-200/20 dark:bg-amber-900/10 rounded-full blur-3xl"
          animate={{
            scale: [1, 1.3, 1],
            opacity: [0.2, 0.4, 0.2],
          }}
          transition={{
            duration: 10,
            repeat: Infinity,
            ease: "easeInOut",
            delay: 1,
          }}
        />
      </div>

      <div className="max-w-2xl w-full relative z-10">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ duration: 0.8 }}
          className="text-center space-y-8"
        >
          {/* Hero Section */}
          <div className="space-y-4">
            <motion.h1
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.2 }}
              className="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white leading-tight"
            >
              Organizar eventos entre amigos{" "}
              <span className="text-orange-600 dark:text-orange-400">
                nunca deveria ser um caos.
              </span>
            </motion.h1>
            
            <motion.p
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ duration: 0.8, delay: 0.4 }}
              className="text-xl md:text-2xl text-gray-600 dark:text-gray-300"
            >
              É por isso que o ReUNE está chegando.
            </motion.p>
          </div>

          {/* Waitlist Form */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.8, delay: 0.6 }}
            className="bg-white/80 dark:bg-gray-800/80 backdrop-blur-sm rounded-3xl p-8 md:p-12 shadow-xl border border-orange-100 dark:border-gray-700 space-y-6"
          >
            <p className="text-lg text-gray-700 dark:text-gray-300 leading-relaxed">
              Em breve, organizar encontros e eventos vai ser simples, colaborativo e leve.{" "}
              <span className="font-semibold text-orange-600 dark:text-orange-400">
                Faça parte da lista de espera
              </span>{" "}
              e receba o acesso antecipado.
            </p>

            {!isSubmitted ? (
              <form onSubmit={handleSubmit} className="flex flex-col sm:flex-row gap-3">
                <Input
                  type="email"
                  placeholder="seu@email.com"
                  value={email}
                  onChange={(e) => setEmail(e.target.value)}
                  className="flex-1 h-12 text-base bg-white dark:bg-gray-900 border-gray-300 dark:border-gray-600"
                  disabled={isSubmitting}
                  required
                />
                <Button
                  type="submit"
                  size="lg"
                  disabled={isSubmitting}
                  className="h-12 px-8 bg-orange-600 hover:bg-orange-700 dark:bg-orange-500 dark:hover:bg-orange-600 text-white font-semibold"
                >
                  {isSubmitting ? "Enviando..." : "Quero entrar"}
                </Button>
              </form>
            ) : (
              <motion.div
                initial={{ opacity: 0, scale: 0.9 }}
                animate={{ opacity: 1, scale: 1 }}
                className="p-6 bg-green-50 dark:bg-green-900/20 rounded-2xl border border-green-200 dark:border-green-800"
              >
                <p className="text-green-800 dark:text-green-300 text-lg font-medium">
                  ✓ Você está na lista! Fique de olho no lançamento 🎉
                </p>
              </motion.div>
            )}
          </motion.div>

          {/* Footer */}
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ duration: 0.8, delay: 0.8 }}
            className="space-y-4 pt-8"
          >
            <motion.div
              animate={{
                rotate: [0, 5, -5, 0],
              }}
              transition={{
                duration: 4,
                repeat: Infinity,
                ease: "easeInOut",
              }}
              className="text-6xl"
            >
              🍻
            </motion.div>
            
            <p className="text-gray-600 dark:text-gray-400 text-sm md:text-base max-w-xl mx-auto leading-relaxed">
              Feito com leveza e propósito para quem já viveu o caos dos grupos de WhatsApp.
            </p>
            
            <p className="text-gray-500 dark:text-gray-500 text-xs">
              © 2025 ReUNE
            </p>
          </motion.div>
        </motion.div>
      </div>
    </div>
  );
};

export default ReuneWaitlist;

============================================================
FILE PATH: .\src\pages\SecretSantaAdmin.tsx
============================================================
import { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Badge } from "@/components/ui/badge";
import { ArrowLeft, Users, Check, X, FileText, Eye, Shuffle, AlertCircle } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";
import {
  AlertDialog,
  AlertDialogAction,
  AlertDialogCancel,
  AlertDialogContent,
  AlertDialogDescription,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogTitle,
  AlertDialogTrigger,
} from "@/components/ui/alert-dialog";

interface ParticipantStatus {
  id: string;
  user_id: string;
  display_name: string;
  avatar_url?: string;
  status: "pending" | "confirmed";
  has_wishlist: boolean;
  has_viewed_result: boolean;
}

export default function SecretSantaAdmin() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { toast } = useToast();
  const { user } = useAuth();

  const [loading, setLoading] = useState(true);
  const [participants, setParticipants] = useState<ParticipantStatus[]>([]);
  const [secretSantaData, setSecretSantaData] = useState<any>(null);
  const [isOrganizer, setIsOrganizer] = useState(false);
  const [redrawing, setRedrawing] = useState(false);

  useEffect(() => {
    if (!user || !eventId) return;
    checkOrganizer();
  }, [user, eventId]);

  const checkOrganizer = async () => {
    if (!user || !eventId) return;

    try {
      // Verificar se é organizador
      const { data: eventData, error: eventError } = await supabase
        .from("table_reune")
        .select("user_id")
        .eq("id", Number(eventId))
        .maybeSingle();

      if (eventError) throw eventError;

      if (!eventData || eventData.user_id !== user.id) {
        // Verificar se é co-organizador
        const { data: coOrgData } = await supabase
          .from("event_organizers")
          .select("id")
          .eq("event_id", Number(eventId))
          .eq("user_id", user.id)
          .maybeSingle();

        if (!coOrgData) {
          toast({
            title: "Acesso negado",
            description: "Apenas organizadores podem acessar esta página.",
            variant: "destructive",
          });
          navigate(`/app?event=${eventId}`);
          return;
        }
      }

      setIsOrganizer(true);
      loadData();
    } catch (err: any) {
      console.error("Erro ao verificar permissões:", err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível verificar permissões.",
        variant: "destructive",
      });
    }
  };

  const loadData = async () => {
    if (!eventId) return;

    setLoading(true);
    try {
      // Buscar configuração do Amigo Secreto
      const { data: secretSantaData, error: secretSantaError } = await supabase
        .from("event_secret_santa")
        .select("*")
        .eq("event_id", Number(eventId))
        .maybeSingle();

      if (secretSantaError) throw secretSantaError;

      if (!secretSantaData) {
        toast({
          title: "Amigo Secreto não encontrado",
          description: "Configure o Amigo Secreto primeiro.",
          variant: "destructive",
        });
        navigate(`/event/${eventId}/secret-santa/setup`);
        return;
      }

      setSecretSantaData(secretSantaData);

      // Buscar participantes
      const { data: participantsData, error: participantsError } = await supabase
        .from("event_secret_santa_participants")
        .select("id, user_id, status, wishlist_text, wishlist_link")
        .eq("secret_santa_id", secretSantaData.id);

      if (participantsError) throw participantsError;

      // Buscar perfis
      if (participantsData && participantsData.length > 0) {
        const userIds = participantsData.map((p) => p.user_id);
        const { data: profilesData } = await supabase
          .from("profiles")
          .select("id, display_name, avatar_url")
          .in("id", userIds);

        const participantsStatus: ParticipantStatus[] = participantsData.map((p) => {
          const profile = profilesData?.find((prof) => prof.id === p.user_id);
          return {
            id: p.id,
            user_id: p.user_id,
            display_name: profile?.display_name || "Participante",
            avatar_url: profile?.avatar_url,
            status: p.status as "pending" | "confirmed",
            has_wishlist: !!(p.wishlist_text || p.wishlist_link),
            has_viewed_result: false, // TODO: implementar tracking de visualização
          };
        });

        setParticipants(participantsStatus);
      }
    } catch (err: any) {
      console.error("Erro ao carregar dados:", err);
      toast({
        title: "Erro ao carregar",
        description: err.message || "Não foi possível carregar os dados.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const handleRedraw = async () => {
    if (!secretSantaData) return;

    setRedrawing(true);
    try {
      // Deletar pares existentes
      const { error: deleteError } = await supabase
        .from("event_secret_santa_pairs")
        .delete()
        .eq("secret_santa_id", secretSantaData.id);

      if (deleteError) throw deleteError;

      // Marcar como não sorteado
      const { error: updateError } = await supabase
        .from("event_secret_santa")
        .update({ has_drawn: false })
        .eq("id", secretSantaData.id);

      if (updateError) throw updateError;

      toast({
        title: "Sorteio resetado",
        description: "Você pode realizar um novo sorteio agora.",
      });

      navigate(`/event/${eventId}/secret-santa/participants`);
    } catch (err: any) {
      console.error("Erro ao refazer sorteio:", err);
      toast({
        title: "Erro",
        description: err.message || "Não foi possível refazer o sorteio.",
        variant: "destructive",
      });
    } finally {
      setRedrawing(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <p className="text-muted-foreground">Carregando...</p>
      </div>
    );
  }

  if (!isOrganizer) {
    return null;
  }

  const confirmedCount = participants.filter((p) => p.status === "confirmed").length;
  const wishlistCount = participants.filter((p) => p.has_wishlist).length;

  return (
    <div className="min-h-screen bg-background p-4 md:p-8">
      <div className="max-w-4xl mx-auto space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        {/* Resumo */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <Card>
            <CardContent className="pt-6">
              <div className="text-center">
                <Users className="w-8 h-8 mx-auto mb-2 text-primary" />
                <p className="text-3xl font-bold">{participants.length}</p>
                <p className="text-sm text-muted-foreground">Participantes</p>
              </div>
            </CardContent>
          </Card>
          <Card>
            <CardContent className="pt-6">
              <div className="text-center">
                <Check className="w-8 h-8 mx-auto mb-2 text-green-600" />
                <p className="text-3xl font-bold">{confirmedCount}</p>
                <p className="text-sm text-muted-foreground">Confirmados</p>
              </div>
            </CardContent>
          </Card>
          <Card>
            <CardContent className="pt-6">
              <div className="text-center">
                <FileText className="w-8 h-8 mx-auto mb-2 text-blue-600" />
                <p className="text-3xl font-bold">{wishlistCount}</p>
                <p className="text-sm text-muted-foreground">Com Wishlist</p>
              </div>
            </CardContent>
          </Card>
        </div>

        {/* Status do sorteio */}
        <Card>
          <CardHeader>
            <div className="flex items-center justify-between">
              <div>
                <CardTitle>Status do Sorteio</CardTitle>
                <CardDescription>
                  {secretSantaData?.has_drawn
                    ? "O sorteio já foi realizado"
                    : "O sorteio ainda não foi realizado"}
                </CardDescription>
              </div>
              {secretSantaData?.has_drawn && (
                <Badge variant="default">Sorteado</Badge>
              )}
            </div>
          </CardHeader>
          {secretSantaData && !secretSantaData.has_drawn && (
            <CardContent>
              <div className="flex gap-3">
                <Button
                  onClick={() => navigate(`/event/${eventId}/secret-santa/participants`)}
                  className="flex-1"
                >
                  <Shuffle className="w-4 h-4 mr-2" />
                  Realizar Sorteio
                </Button>
              </div>
            </CardContent>
          )}
        </Card>

        {/* Lista de participantes */}
        <Card>
          <CardHeader>
            <CardTitle>Participantes</CardTitle>
            <CardDescription>
              Acompanhe o status de cada participante
            </CardDescription>
          </CardHeader>
          <CardContent>
            <div className="space-y-3">
              {participants.length === 0 ? (
                <p className="text-center text-muted-foreground py-6">
                  Nenhum participante adicionado ainda
                </p>
              ) : (
                participants.map((participant) => (
                  <div
                    key={participant.id}
                    className="flex items-center justify-between p-4 bg-muted/50 rounded-lg"
                  >
                    <div className="flex items-center gap-3 flex-1">
                      <Avatar>
                        <AvatarImage src={participant.avatar_url} />
                        <AvatarFallback>{participant.display_name[0]}</AvatarFallback>
                      </Avatar>
                      <div className="flex-1">
                        <p className="font-medium">{participant.display_name}</p>
                        <div className="flex gap-2 mt-1">
                          <Badge
                            variant={
                              participant.status === "confirmed" ? "default" : "secondary"
                            }
                            className="text-xs"
                          >
                            {participant.status === "confirmed" ? "Confirmado" : "Pendente"}
                          </Badge>
                          {participant.has_wishlist ? (
                            <Badge variant="outline" className="text-xs gap-1">
                              <FileText className="w-3 h-3" />
                              Com Wishlist
                            </Badge>
                          ) : (
                            <Badge variant="outline" className="text-xs gap-1 text-muted-foreground">
                              <X className="w-3 h-3" />
                              Sem Wishlist
                            </Badge>
                          )}
                        </div>
                      </div>
                    </div>
                  </div>
                ))
              )}
            </div>
          </CardContent>
        </Card>

        {/* Ações administrativas */}
        {secretSantaData?.has_drawn && (
          <Card className="border-2 border-destructive/20">
            <CardHeader>
              <div className="flex items-center gap-2">
                <AlertCircle className="w-5 h-5 text-destructive" />
                <CardTitle>Ações Administrativas</CardTitle>
              </div>
              <CardDescription>
                Use com cuidado - estas ações afetam o sorteio
              </CardDescription>
            </CardHeader>
            <CardContent>
              <AlertDialog>
                <AlertDialogTrigger asChild>
                  <Button variant="destructive" disabled={redrawing}>
                    <Shuffle className="w-4 h-4 mr-2" />
                    Refazer Sorteio
                  </Button>
                </AlertDialogTrigger>
                <AlertDialogContent>
                  <AlertDialogHeader>
                    <AlertDialogTitle>Tem certeza?</AlertDialogTitle>
                    <AlertDialogDescription>
                      Esta ação irá deletar todos os pares atuais e permitir um novo sorteio.
                      Os participantes precisarão ver seus novos pares novamente.
                    </AlertDialogDescription>
                  </AlertDialogHeader>
                  <AlertDialogFooter>
                    <AlertDialogCancel>Cancelar</AlertDialogCancel>
                    <AlertDialogAction onClick={handleRedraw}>
                      Confirmar Refazer
                    </AlertDialogAction>
                  </AlertDialogFooter>
                </AlertDialogContent>
              </AlertDialog>
            </CardContent>
          </Card>
        )}
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaLanding.tsx
============================================================
import { useState, useEffect } from "react";
import { useNavigate } from "react-router-dom";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";
import { motion, useScroll, useTransform } from "framer-motion";
import { Gift, Users, Link2, Shuffle, TreePine, Sparkles, ArrowRight, Loader2, ChevronRight, Zap } from "lucide-react";
import { Helmet } from "react-helmet";
import { toast } from "sonner";
import { ThemeToggle } from "@/components/landing/ThemeToggle";
import { Footer } from "@/components/landing/Footer";

export default function SecretSantaLanding() {
  const navigate = useNavigate();
  const { user, loading: authLoading } = useAuth();
  const { scrollYProgress } = useScroll();
  const opacity = useTransform(scrollYProgress, [0, 0.2], [1, 0]);
  const scale = useTransform(scrollYProgress, [0, 0.2], [1, 0.95]);

  const [timeLeft, setTimeLeft] = useState({ days: 0, hours: 0, minutes: 0, seconds: 0 });
  const [showWizard, setShowWizard] = useState(false);
  const [creating, setCreating] = useState(false);

  // Wizard state
  const [groupName, setGroupName] = useState("Amigo Secreto 2025");
  const [minValue, setMinValue] = useState("50");
  const [maxValue, setMaxValue] = useState("100");

  // Countdown to Christmas
  const christmasDate = new Date("2025-12-25T00:00:00").getTime();

  useEffect(() => {
    const timer = setInterval(() => {
      const now = new Date().getTime();
      const distance = christmasDate - now;

      if (distance < 0) {
        clearInterval(timer);
        return;
      }

      setTimeLeft({
        days: Math.floor(distance / (1000 * 60 * 60 * 24)),
        hours: Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)),
        minutes: Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60)),
        seconds: Math.floor((distance % (1000 * 60)) / 1000),
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [christmasDate]);

  const handleStartClick = () => {
    if (!user) {
      navigate("/app");
      return;
    }
    setShowWizard(true);
  };

  const handleCreateSecretSanta = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!user) return;

    const min = parseFloat(minValue);
    const max = parseFloat(maxValue);

    if (isNaN(min) || isNaN(max) || min < 0 || max < min) {
      toast.error("Valores inválidos. O valor mínimo deve ser menor que o máximo.");
      return;
    }

    setCreating(true);

    try {
      const { data: eventData, error: eventError } = await supabase
        .from("table_reune")
        .insert({
          title: groupName.trim() || "Amigo Secreto 2025",
          description: "Evento de Amigo Secreto criado pelo ReUNE",
          user_id: user.id,
          event_date: "2025-12-25",
          event_time: "20:00",
          tipo_evento: "confraternizacao",
          categoria_evento: "amigo_secreto",
          status: "draft",
          is_public: false,
        })
        .select()
        .single();

      if (eventError) throw eventError;

      const { error: dynamicError } = await supabase.from("event_dynamics").insert({
        event_id: eventData.id,
        type: "secret_santa",
      });

      if (dynamicError) throw dynamicError;

      const { error: secretSantaError } = await supabase.from("event_secret_santa").insert({
        event_id: eventData.id,
        min_value: min,
        max_value: max,
        draw_date: "2025-12-20",
        has_drawn: false,
      });

      if (secretSantaError) throw secretSantaError;

      toast.success("Amigo Secreto criado! Agora adicione os participantes.");
      navigate(`/event/${eventData.id}/secret-santa/participants`);
    } catch (error) {
      console.error("Erro ao criar Amigo Secreto:", error);
      toast.error("Erro ao criar o Amigo Secreto. Tente novamente.");
    } finally {
      setCreating(false);
    }
  };

  const features = [
    {
      icon: Shuffle,
      title: "Sorteio Justo",
      description: "Algoritmo garante que ninguém tire a si mesmo e todos recebam alguém para presentear.",
      gradient: "from-red-500 to-pink-500"
    },
    {
      icon: Gift,
      title: "Lista de Desejos",
      description: "Cada participante adiciona sugestões de presente para facilitar a escolha.",
      gradient: "from-amber-500 to-yellow-500"
    },
    {
      icon: Link2,
      title: "Convite por Link",
      description: "Compartilhe no WhatsApp ou e-mail em 1 clique. Simples e rápido.",
      gradient: "from-green-500 to-emerald-500"
    }
  ];

  return (
    <div className="min-h-screen bg-background overflow-hidden">
      <Helmet>
        <title>Amigo Secreto Online Grátis | ReUNE</title>
        <meta
          name="description"
          content="Organize seu amigo secreto online em 30 segundos. Sorteio automático, lista de desejos e compartilhamento fácil. Grátis!"
        />
        <meta name="keywords" content="amigo secreto, sorteio online, amigo oculto, natal 2025, amigo secreto gratis" />
      </Helmet>

      <ThemeToggle className="fixed top-4 right-4 z-50" />

      {/* Floating Navigation */}
      <motion.nav
        initial={{ y: -100 }}
        animate={{ y: 0 }}
        className="fixed top-4 left-1/2 -translate-x-1/2 z-40 px-6 py-3 rounded-full bg-background/80 backdrop-blur-xl border border-border/50 shadow-2xl"
      >
        <div className="flex items-center gap-8">
          <span className="text-xl font-bold bg-gradient-to-r from-red-500 to-green-500 bg-clip-text text-transparent">
            ReUNE
          </span>
          <div className="hidden md:flex items-center gap-2 text-sm font-medium border-l border-border/50 pl-6">
            <TreePine className="w-4 h-4 text-green-500" />
            <span className="text-muted-foreground">Amigo Secreto 2025</span>
          </div>
          <Button size="sm" onClick={() => navigate("/")} variant="ghost" className="ml-4">
            <ArrowRight className="w-4 h-4 mr-2 rotate-180" />
            Voltar
          </Button>
        </div>
      </motion.nav>

      {/* Hero Section - Ultra Modern */}
      <section className="relative min-h-screen flex items-center justify-center px-4 pt-24 pb-12 overflow-hidden">
        {/* Animated Background Gradient - Festive */}
        <div className="absolute inset-0 bg-gradient-to-br from-red-500/5 via-background to-green-500/5" />
        <div className="absolute inset-0 bg-[radial-gradient(circle_at_center,rgba(220,38,38,0.1)_0%,transparent_50%)]" />

        {/* Floating Orbs - Christmas Colors */}
        <motion.div
          animate={{
            scale: [1, 1.2, 1],
            opacity: [0.3, 0.5, 0.3],
          }}
          transition={{ duration: 8, repeat: Infinity }}
          className="absolute top-1/4 left-1/4 w-96 h-96 bg-red-500/20 rounded-full blur-3xl"
        />
        <motion.div
          animate={{
            scale: [1.2, 1, 1.2],
            opacity: [0.5, 0.3, 0.5],
          }}
          transition={{ duration: 8, repeat: Infinity, delay: 1 }}
          className="absolute bottom-1/4 right-1/4 w-96 h-96 bg-green-500/20 rounded-full blur-3xl"
        />

        <motion.div
          style={{ opacity, scale }}
          className="relative z-10 max-w-7xl mx-auto text-center space-y-8"
        >
          {/* Badges */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="flex flex-col items-center gap-3"
          >
            <Badge className="px-4 py-2 text-sm font-medium bg-gradient-to-r from-red-500/10 to-green-500/10 border-red-500/20 text-red-600 dark:text-red-400">
              <Gift className="w-4 h-4 mr-2 inline" />
              Sorteio Automático e Gratuito
            </Badge>

            {/* Free Access Banner */}
            <motion.div
              initial={{ scale: 0.9, opacity: 0 }}
              animate={{ scale: 1, opacity: 1 }}
              transition={{ duration: 0.5, delay: 0.2 }}
              className="relative"
            >
              <div className="absolute inset-0 bg-gradient-to-r from-green-500 to-emerald-500 blur-xl opacity-30 animate-pulse" />
              <Badge className="relative px-6 py-3 text-base font-bold bg-gradient-to-r from-green-500 to-emerald-500 text-white border-0 shadow-lg">
                <Zap className="w-5 h-5 mr-2 inline animate-pulse" />
                GRÁTIS até 01/02/2026 - Todos os Recursos!
              </Badge>
            </motion.div>
          </motion.div>

          {/* Main Headline */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.1 }}
            className="space-y-6"
          >
            <h1 className="text-5xl md:text-7xl lg:text-8xl font-bold tracking-tight">
              Organize seu{" "}
              <span className="relative inline-block">
                <span className="bg-gradient-to-r from-red-500 via-amber-500 to-green-600 bg-clip-text text-transparent">
                  Amigo Secreto
                </span>
                <motion.div
                  className="absolute -bottom-2 left-0 right-0 h-3 bg-gradient-to-r from-red-500/20 to-green-500/20 -z-10 rounded-full blur-sm"
                  animate={{ scaleX: [0, 1] }}
                  transition={{ duration: 0.8, delay: 0.5 }}
                />
              </span>
            </h1>

            <p className="text-xl md:text-2xl text-muted-foreground max-w-3xl mx-auto leading-relaxed">
              Sorteio aleatório e justo, lista de desejos integrada e convites instantâneos.
              <span className="block mt-2 text-primary font-medium">
                Sem complicação. Tudo em 30 segundos.
              </span>
            </p>
          </motion.div>

          {/* Countdown to Christmas */}
          <motion.div
            initial={{ opacity: 0, scale: 0.9 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2, duration: 0.5 }}
            className="pt-8"
          >
            <p className="text-xs uppercase tracking-widest text-muted-foreground mb-4">Contagem para o Natal</p>
            <div className="grid grid-cols-4 gap-4 md:gap-8 max-w-2xl mx-auto">
              {[
                { label: "Dias", value: timeLeft.days },
                { label: "Horas", value: timeLeft.hours },
                { label: "Min", value: timeLeft.minutes },
                { label: "Seg", value: timeLeft.seconds },
              ].map((item, idx) => (
                <motion.div
                  key={idx}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 * idx, duration: 0.4 }}
                  className="flex flex-col items-center group"
                >
                  <div className="relative">
                    <div className={`absolute inset-0 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-2xl ${idx % 2 === 0 ? 'bg-red-600/20' : 'bg-green-600/20'
                      }`} />

                    <motion.div
                      key={item.value}
                      initial={{ scale: 1 }}
                      animate={{ scale: [1, 1.05, 1] }}
                      transition={{ duration: 0.3 }}
                      className={`relative text-3xl md:text-5xl font-mono font-bold mb-2 px-4 py-2 md:px-6 md:py-3 rounded-2xl bg-gradient-to-br ${idx % 2 === 0 ? 'from-red-500/10 to-red-500/5' : 'from-green-500/10 to-green-500/5'
                        } border ${idx % 2 === 0 ? 'border-red-500/20' : 'border-green-500/20'
                        } backdrop-blur-sm group-hover:border-primary/50 transition-all duration-300`}
                    >
                      {idx === 3 && (
                        <div className="absolute inset-0 bg-gradient-to-br from-red-600/10 to-green-600/10 rounded-2xl animate-pulse" />
                      )}
                      <span className="relative z-10">{String(item.value).padStart(2, "0")}</span>
                    </motion.div>
                  </div>
                  <div className="text-xs uppercase tracking-widest text-muted-foreground group-hover:text-primary transition-colors">
                    {item.label}
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>

          {/* CTA Buttons */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.3 }}
            className="flex flex-col items-center gap-6 pt-8"
          >
            {!showWizard ? (
              <div className="flex flex-col sm:flex-row gap-4 justify-center items-center w-full max-w-md">
                <Button
                  size="lg"
                  onClick={handleStartClick}
                  disabled={authLoading}
                  className="group h-14 px-8 text-lg bg-gradient-to-r from-red-500 to-green-500 hover:from-red-600 hover:to-green-600 w-full"
                >
                  <Gift className="w-5 h-5 mr-2" />
                  Criar Meu Amigo Secreto
                  <ArrowRight className="w-5 h-5 ml-2 group-hover:translate-x-1 transition-transform" />
                </Button>
              </div>
            ) : (
              <motion.div
                initial={{ opacity: 0, scale: 0.95 }}
                animate={{ opacity: 1, scale: 1 }}
                className="w-full max-w-md"
              >
                <div className="relative p-8 bg-card border-2 border-border rounded-3xl shadow-2xl space-y-6">
                  <div className="flex items-center gap-2 mb-4">
                    <Sparkles className="w-5 h-5 text-primary" />
                    <h3 className="text-xl font-semibold">Configuração Rápida</h3>
                  </div>

                  <form onSubmit={handleCreateSecretSanta} className="space-y-4">
                    <div className="space-y-2">
                      <Label htmlFor="groupName">Nome do Grupo</Label>
                      <Input
                        id="groupName"
                        value={groupName}
                        onChange={(e) => setGroupName(e.target.value)}
                        placeholder="Ex: Família Silva, Amigos do Trabalho"
                        className="h-11"
                      />
                    </div>

                    <div className="grid grid-cols-2 gap-3">
                      <div className="space-y-2">
                        <Label htmlFor="minValue">Valor Mínimo (R$)</Label>
                        <Input
                          id="minValue"
                          type="number"
                          value={minValue}
                          onChange={(e) => setMinValue(e.target.value)}
                          placeholder="50"
                          min="0"
                          className="h-11"
                        />
                      </div>
                      <div className="space-y-2">
                        <Label htmlFor="maxValue">Valor Máximo (R$)</Label>
                        <Input
                          id="maxValue"
                          type="number"
                          value={maxValue}
                          onChange={(e) => setMaxValue(e.target.value)}
                          placeholder="100"
                          min="0"
                          className="h-11"
                        />
                      </div>
                    </div>

                    <Button
                      type="submit"
                      disabled={creating}
                      className="w-full h-12 text-base font-semibold bg-gradient-to-r from-green-600 to-emerald-500 hover:from-green-500 hover:to-emerald-400"
                    >
                      {creating ? (
                        <>
                          <Loader2 className="w-5 h-5 mr-2 animate-spin" />
                          Criando...
                        </>
                      ) : (
                        <>
                          <Shuffle className="w-5 h-5 mr-2" />
                          Criar e Adicionar Participantes
                        </>
                      )}
                    </Button>

                    <button
                      type="button"
                      onClick={() => setShowWizard(false)}
                      className="w-full text-sm text-muted-foreground hover:text-foreground transition-colors"
                    >
                      Cancelar
                    </button>
                  </form>
                </div>
              </motion.div>
            )}

            <p className="text-xs text-muted-foreground">
              100% gratuito • Sem anúncios • Seus dados protegidos
            </p>
          </motion.div>
        </motion.div>

        {/* Scroll Indicator */}
        <motion.div
          animate={{ y: [0, 10, 0] }}
          transition={{ duration: 2, repeat: Infinity }}
          className="absolute bottom-8 left-1/2 -translate-x-1/2"
        >
          <div className="w-6 h-10 rounded-full border-2 border-muted-foreground/30 flex items-start justify-center p-2">
            <motion.div
              animate={{ y: [0, 12, 0] }}
              transition={{ duration: 2, repeat: Infinity }}
              className="w-1 h-3 bg-primary rounded-full"
            />
          </div>
        </motion.div>
      </section>

      {/* Features Grid */}
      <section id="features" className="py-32 px-4 relative">
        <div className="max-w-7xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            className="text-center mb-20"
          >
            <Badge className="mb-4">
              <TreePine className="w-4 h-4 mr-2" />
              Como Funciona
            </Badge>
            <h2 className="text-4xl md:text-6xl font-bold mb-6">
              Simples.{" "}
              <span className="bg-gradient-to-r from-red-500 to-green-500 bg-clip-text text-transparent">
                Rápido. Divertido.
              </span>
            </h2>
            <p className="text-xl text-muted-foreground max-w-3xl mx-auto">
              Tudo que você precisa para organizar o amigo secreto perfeito.
            </p>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-8">
            {features.map((feature, index) => (
              <motion.div
                key={index}
                initial={{ opacity: 0, y: 40 }}
                whileInView={{ opacity: 1, y: 0 }}
                viewport={{ once: true }}
                transition={{ duration: 0.5, delay: index * 0.1 }}
                whileHover={{ y: -8, scale: 1.02 }}
                className="group relative p-8 rounded-3xl bg-card border border-border/50 hover:border-border transition-all duration-300 hover:shadow-2xl"
              >
                <div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${feature.gradient} p-0.5 mb-6`}>
                  <div className="w-full h-full rounded-2xl bg-background flex items-center justify-center">
                    <feature.icon className={`w-8 h-8 bg-gradient-to-br ${feature.gradient} bg-clip-text text-transparent`} />
                  </div>
                </div>

                <h3 className="text-2xl font-bold mb-4 group-hover:text-primary transition-colors">
                  {feature.title}
                </h3>
                <p className="text-muted-foreground leading-relaxed">
                  {feature.description}
                </p>

                <div className={`absolute inset-0 rounded-3xl bg-gradient-to-br ${feature.gradient} opacity-0 group-hover:opacity-5 transition-opacity duration-300 -z-10`} />
              </motion.div>
            ))}
          </div>
        </div>
      </section>

      {/* Footer */}
      <Footer />
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaMyResult.tsx
============================================================
import { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Badge } from "@/components/ui/badge";
import { ArrowLeft, Gift, Eye, EyeOff, Sparkles } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";

export default function SecretSantaMyResult() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { toast } = useToast();
  const { user } = useAuth();

  const [loading, setLoading] = useState(true);
  const [receiverInfo, setReceiverInfo] = useState<{
    user_id: string;
    display_name: string;
    avatar_url?: string;
    wishlist_text?: string;
    wishlist_link?: string;
  } | null>(null);
  const [revealed, setRevealed] = useState(false);

  useEffect(() => {
    if (!user || !eventId) return;
    loadMyPair();
  }, [user, eventId]);

  const loadMyPair = async () => {
    if (!user || !eventId) return;

    setLoading(true);
    try {
      // Buscar configuração do Amigo Secreto
      const { data: secretSantaData, error: secretSantaError } = await supabase
        .from("event_secret_santa")
        .select("id, has_drawn")
        .eq("event_id", Number(eventId))
        .maybeSingle();

      if (secretSantaError) throw secretSantaError;

      if (!secretSantaData) {
        toast({
          title: "Amigo Secreto não encontrado",
          description: "Este evento não possui Amigo Secreto configurado.",
          variant: "destructive",
        });
        navigate(`/app?event=${eventId}`);
        return;
      }

      if (!secretSantaData.has_drawn) {
        toast({
          title: "Sorteio ainda não realizado",
          description: "O sorteio ainda não foi feito. Aguarde o organizador.",
          variant: "destructive",
        });
        navigate(`/app?event=${eventId}`);
        return;
      }

      // Buscar meu par
      const { data: pairData, error: pairError } = await supabase
        .from("event_secret_santa_pairs")
        .select("receiver_id")
        .eq("secret_santa_id", secretSantaData.id)
        .eq("giver_id", user.id)
        .maybeSingle();

      if (pairError) throw pairError;

      if (!pairData) {
        toast({
          title: "Par não encontrado",
          description: "Você não está participando deste Amigo Secreto.",
          variant: "destructive",
        });
        navigate(`/app?event=${eventId}`);
        return;
      }

      // Buscar informações do receiver
      const { data: profileData, error: profileError } = await supabase
        .from("profiles")
        .select("id, display_name, avatar_url")
        .eq("id", pairData.receiver_id)
        .maybeSingle();

      if (profileError) throw profileError;

      // Buscar wishlist
      const { data: wishlistData } = await supabase
        .from("event_secret_santa_participants")
        .select("wishlist_text, wishlist_link")
        .eq("secret_santa_id", secretSantaData.id)
        .eq("user_id", pairData.receiver_id)
        .maybeSingle();

      setReceiverInfo({
        user_id: pairData.receiver_id,
        display_name: profileData?.display_name || "Participante",
        avatar_url: profileData?.avatar_url,
        wishlist_text: wishlistData?.wishlist_text,
        wishlist_link: wishlistData?.wishlist_link,
      });
    } catch (err: any) {
      console.error("Erro ao carregar par:", err);
      toast({
        title: "Erro ao carregar",
        description: err.message || "Não foi possível carregar seu par.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <div className="text-center">
          <Gift className="w-12 h-12 mx-auto mb-4 text-primary animate-bounce" />
          <p className="text-muted-foreground">Carregando seu amigo secreto...</p>
        </div>
      </div>
    );
  }

  if (!receiverInfo) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <p className="text-muted-foreground">Amigo secreto não encontrado.</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary/5 via-background to-primary/10 p-4 md:p-8">
      <div className="max-w-2xl mx-auto space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        {/* Aviso de segredo */}
        <Card className="border-2 border-primary/20 bg-primary/5">
          <CardContent className="pt-6">
            <div className="flex items-center gap-3 text-sm">
              <EyeOff className="w-5 h-5 text-primary" />
              <p className="font-medium text-primary">
                🤫 Este resultado é secreto. Apenas você pode ver quem você tirou!
              </p>
            </div>
          </CardContent>
        </Card>

        {/* Card de revelação */}
        <Card className="border-2 border-primary/30 shadow-xl">
          <CardHeader className="text-center">
            <div className="flex items-center justify-center gap-2 mb-2">
              <Gift className="w-6 h-6 text-primary" />
              <Sparkles className="w-5 h-5 text-primary animate-pulse" />
            </div>
            <CardTitle className="text-2xl">Seu Amigo Secreto</CardTitle>
            <CardDescription>
              Clique no botão abaixo para revelar quem você tirou
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            {!revealed ? (
              <div className="text-center py-8">
                <div className="relative inline-block">
                  <div className="absolute inset-0 bg-primary/20 blur-xl rounded-full animate-pulse" />
                  <Button
                    onClick={() => setRevealed(true)}
                    size="lg"
                    className="relative gap-2 text-lg px-8 py-6"
                  >
                    <Eye className="w-5 h-5" />
                    Revelar Amigo Secreto
                  </Button>
                </div>
              </div>
            ) : (
              <div className="space-y-6 animate-in fade-in duration-500">
                {/* Avatar e nome */}
                <div className="flex flex-col items-center gap-4 p-6 bg-gradient-to-br from-primary/10 to-primary/5 rounded-lg border-2 border-primary/20">
                  <Avatar className="w-32 h-32 border-4 border-primary/20">
                    <AvatarImage src={receiverInfo.avatar_url} />
                    <AvatarFallback className="text-3xl">
                      {receiverInfo.display_name[0]}
                    </AvatarFallback>
                  </Avatar>
                  <div className="text-center">
                    <h3 className="text-3xl font-bold mb-2">{receiverInfo.display_name}</h3>
                    <Badge variant="default" className="text-sm">
                      Seu Amigo Secreto 🎁
                    </Badge>
                  </div>
                </div>

                {/* Wishlist */}
                {(receiverInfo.wishlist_text || receiverInfo.wishlist_link) && (
                  <Card className="bg-muted/50">
                    <CardHeader>
                      <CardTitle className="text-lg flex items-center gap-2">
                        <Sparkles className="w-5 h-5 text-primary" />
                        Lista de Desejos
                      </CardTitle>
                    </CardHeader>
                    <CardContent className="space-y-3">
                      {receiverInfo.wishlist_text && (
                        <div>
                          <p className="text-sm text-muted-foreground mb-1">O que gostaria de ganhar:</p>
                          <p className="text-base">{receiverInfo.wishlist_text}</p>
                        </div>
                      )}
                      {receiverInfo.wishlist_link && (
                        <div>
                          <p className="text-sm text-muted-foreground mb-1">Link sugerido:</p>
                          <a
                            href={receiverInfo.wishlist_link}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="text-primary hover:underline break-all"
                          >
                            {receiverInfo.wishlist_link}
                          </a>
                        </div>
                      )}
                    </CardContent>
                  </Card>
                )}

                {/* Botão para wishlist própria */}
                <Button
                  onClick={() => navigate(`/event/${eventId}/secret-santa/wishlist`)}
                  variant="outline"
                  className="w-full"
                  size="lg"
                >
                  Editar Minha Lista de Desejos
                </Button>
              </div>
            )}
          </CardContent>
        </Card>

        {/* Dicas */}
        <Card className="bg-muted/50">
          <CardContent className="pt-6">
            <div className="space-y-2 text-sm text-muted-foreground">
              <p>💡 <strong>Dica:</strong> Mantenha o segredo! Não revele para ninguém quem você tirou.</p>
              <p>🎁 <strong>Lembre-se:</strong> Cada presente deve ser escolhido com carinho.</p>
              {receiverInfo.wishlist_text || receiverInfo.wishlist_link ? (
                <p>✨ <strong>Sugestão:</strong> Use a lista de desejos como inspiração!</p>
              ) : (
                <p>📝 <strong>Atenção:</strong> A pessoa não preencheu uma lista de desejos ainda.</p>
              )}
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaParticipants.tsx
============================================================
import { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Badge } from "@/components/ui/badge";
import { ArrowLeft, UserPlus, Users, Shuffle, Mail, Loader2, Trash2 } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";

interface Participant {
  id: string;
  user_id: string;
  status: "pending" | "confirmed";
  display_name?: string | null;
  avatar_url?: string | null;
  email?: string | null;
}

interface PendingInvitation {
  id: string;
  email: string;
  name: string;
  status: string;
}

interface EventInvitation {
  participant_email: string;
  participant_name: string;
  status: string;
}

export default function SecretSantaParticipants() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { toast } = useToast();
  const { user } = useAuth();

  const [secretSantaId, setSecretSantaId] = useState<string | null>(null);
  const [participants, setParticipants] = useState<Participant[]>([]);
  const [pendingInvitations, setPendingInvitations] = useState<PendingInvitation[]>([]);
  const [eventInvitations, setEventInvitations] = useState<EventInvitation[]>([]);
  const [newParticipantEmail, setNewParticipantEmail] = useState("");
  const [loading, setLoading] = useState(true);
  const [adding, setAdding] = useState(false);
  const [confirming, setConfirming] = useState(false);
  const [drawing, setDrawing] = useState(false);
  const [eventData, setEventData] = useState<{ title: string; event_date: string; event_time: string } | null>(null);

  useEffect(() => {
    if (!eventId) return;
    loadData();
  }, [eventId]);

  const loadData = async () => {
    if (!eventId) return;

    setLoading(true);
    try {
      // Buscar dados do evento
      const { data: event, error: eventError } = await supabase
        .from("table_reune")
        .select("title, event_date, event_time")
        .eq("id", Number(eventId))
        .single();

      if (eventError) throw eventError;
      setEventData(event);

      // Buscar configuração do Amigo Secreto
      const { data: secretSantaData, error: secretSantaError } = await supabase
        .from("event_secret_santa")
        .select("*")
        .eq("event_id", Number(eventId))
        .maybeSingle();

      if (secretSantaError) throw secretSantaError;

      if (!secretSantaData) {
        toast({
          title: "Amigo Secreto não encontrado",
          description: "Configure o Amigo Secreto primeiro.",
          variant: "destructive",
        });
        navigate(`/event/${eventId}/secret-santa/setup`);
        return;
      }

      setSecretSantaId(secretSantaData.id);

      // Buscar participantes já adicionados ao Amigo Secreto (agora com display_name e email)
      const { data: participantsData, error: participantsError } = await supabase
        .from("event_secret_santa_participants")
        .select(`
          id,
          user_id,
          status,
          display_name,
          email
        `)
        .eq("secret_santa_id", secretSantaData.id);

      if (participantsError) throw participantsError;

      if (participantsData && participantsData.length > 0) {
        const userIds = participantsData.map(p => p.user_id);

        // Buscar perfis para avatar
        const { data: profilesData } = await supabase
          .from("profiles")
          .select("id, display_name, avatar_url")
          .in("id", userIds);

        const participantsWithInfo: Participant[] = participantsData.map(p => {
          const profile = profilesData?.find(prof => prof.id === p.user_id);
          return {
            ...p,
            status: p.status as "pending" | "confirmed",
            // Usar display_name do participante ou do perfil
            display_name: p.display_name || profile?.display_name,
            avatar_url: profile?.avatar_url,
            // Email já está no registro do participante
            email: p.email,
          };
        });

        setParticipants(participantsWithInfo);
      } else {
        setParticipants([]);
      }

      // Buscar convites pendentes para o amigo secreto (não-cadastrados)
      const { data: pendingData, error: pendingError } = await supabase
        .from("event_invitations")
        .select("id, participant_email, participant_name, status")
        .eq("event_id", Number(eventId))
        .eq("status", "pending_secret_santa");

      if (!pendingError && pendingData) {
        setPendingInvitations(pendingData.map(inv => ({
          id: inv.id,
          email: inv.participant_email,
          name: inv.participant_name || inv.participant_email.split("@")[0],
          status: inv.status || "pending",
        })));
      }

      // Buscar convidados aceitos do evento (para importar)
      const { data: invitationsData, error: invitationsError } = await supabase
        .from("event_invitations")
        .select("participant_email, participant_name, status")
        .eq("event_id", Number(eventId))
        .eq("status", "accepted");

      if (invitationsError) throw invitationsError;
      setEventInvitations(invitationsData || []);

    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao carregar",
        description: err.message || "Não foi possível carregar os dados.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const handleAddParticipant = async (email: string) => {
    if (!secretSantaId || !eventId || !eventData) return;

    const trimmedEmail = email.trim().toLowerCase();

    // Validar formato de email
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!emailRegex.test(trimmedEmail)) {
      toast({
        title: "Email inválido",
        description: "Por favor, insira um email válido.",
        variant: "destructive",
      });
      return;
    }

    setAdding(true);
    try {
      // Buscar usuário pelo email usando a função RPC (agora com LEFT JOIN)
      const { data: userData, error: userError } = await supabase
        .rpc("search_user_by_identifier", {
          _identifier: trimmedEmail
        });

      if (userError) {
        // Error handling
      }

      // Se usuário existe no sistema
      if (userData && userData.length > 0) {
        const foundUser = userData[0];
        const userId = foundUser.id;

        // Verificar se já é participante
        const existingParticipant = participants.find(p => p.user_id === userId);
        if (existingParticipant) {
          toast({
            title: "Participante já adicionado",
            description: "Este usuário já está na lista de participantes.",
            variant: "destructive",
          });
          return;
        }

        // Adicionar participante com display_name e email
        const { error: insertError } = await supabase
          .from("event_secret_santa_participants")
          .insert({
            secret_santa_id: secretSantaId,
            user_id: userId,
            status: "confirmed",
            display_name: foundUser.display_name || null,
            email: trimmedEmail,
          });

        if (insertError) {
          if (insertError.code === "23505") {
            toast({
              title: "Participante já adicionado",
              description: "Este usuário já está na lista de participantes.",
              variant: "destructive",
            });
          } else {
            throw insertError;
          }
          return;
        }

        const displayText = foundUser.display_name
          ? `${foundUser.display_name} (${trimmedEmail})`
          : trimmedEmail;

        toast({
          title: "Participante adicionado!",
          description: `${displayText} foi adicionado ao Amigo Secreto.`,
        });

        setNewParticipantEmail("");
        loadData();
      } else {
        // Usuário NÃO existe - criar convite por email
        await handleInviteNonRegisteredUser(trimmedEmail);
      }
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao adicionar",
        description: err.message || "Não foi possível adicionar o participante.",
        variant: "destructive",
      });
    } finally {
      setAdding(false);
    }
  };

  const handleInviteNonRegisteredUser = async (email: string) => {
    if (!eventId || !eventData) return;

    // Verificar se já existe um convite pendente para este email
    const existingInvitation = pendingInvitations.find(inv => inv.email.toLowerCase() === email.toLowerCase());
    if (existingInvitation) {
      toast({
        title: "Convite já enviado",
        description: "Já existe um convite pendente para este email.",
        variant: "destructive",
      });
      return;
    }

    try {
      // Gerar nome a partir do email
      const name = email.split("@")[0];

      // Criar registro de convite no banco
      const { data: invitation, error: inviteError } = await supabase
        .from("event_invitations")
        .insert({
          event_id: Number(eventId),
          participant_email: email,
          participant_name: name,
          status: "pending_secret_santa",
        })
        .select()
        .single();

      if (inviteError) {
        if (inviteError.code === "23505") {
          toast({
            title: "Email já convidado",
            description: "Este email já possui um convite para o evento.",
            variant: "destructive",
          });
          return;
        }
        throw inviteError;
      }

      // Enviar email de convite
      const { error: emailError } = await supabase.functions.invoke("send-invitation-email", {
        body: {
          invitee_email: email,
          invitee_name: name,
          event_title: `Amigo Secreto: ${eventData.title}`,
          event_date: eventData.event_date,
          event_time: eventData.event_time,
          is_organizer: false,
          invitation_token: invitation.invitation_token,
        },
      });

      // Captura discreta de email para early adopters (lead nurturing)
      try {
        await fetch('/functions/v1/waitlist', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            email: email.toLowerCase(),
            source_url: window.location.href
          })
        });
        console.log('Email capturado para benefícios futuros:', email);
      } catch (error) {
        console.error('Erro ao capturar email:', error);
      }

      if (emailError) {
        // Error handling
        toast({
          title: "Convite criado",
          description: "O convite foi criado mas houve um erro ao enviar o email. O participante pode ser adicionado manualmente depois.",
          variant: "default",
        });
      } else {
        toast({
          title: "Convite enviado!",
          description: `Um email foi enviado para ${email} convidando para participar do Amigo Secreto.`,
        });
      }

      setNewParticipantEmail("");
      loadData();
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao enviar convite",
        description: err.message || "Não foi possível enviar o convite.",
        variant: "destructive",
      });
    }
  };

  const handleAddEventInvitations = async () => {
    if (!secretSantaId || !eventInvitations.length) return;

    setConfirming(true);
    let addedCount = 0;

    try {
      for (const invitation of eventInvitations) {
        try {
          const { data } = await supabase.rpc("search_user_by_identifier", {
            _identifier: invitation.participant_email
          });

          if (data && data.length > 0) {
            const foundUser = data[0];

            // Adicionar participante com info
            const { error } = await supabase
              .from("event_secret_santa_participants")
              .insert({
                secret_santa_id: secretSantaId,
                user_id: foundUser.id,
                status: "confirmed",
                display_name: foundUser.display_name || null,
                email: invitation.participant_email,
              });

            if (!error) addedCount++;
          }
        } catch (err) {
          // Error handling
        }
      }

      if (addedCount > 0) {
        toast({
          title: "Participantes adicionados!",
          description: `${addedCount} participante(s) foram adicionados ao Amigo Secreto.`,
        });
      } else {
        toast({
          title: "Nenhum participante adicionado",
          description: "Os convidados podem já estar na lista ou não estão cadastrados.",
          variant: "default",
        });
      }

      loadData();
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao confirmar",
        description: err.message || "Não foi possível confirmar os participantes.",
        variant: "destructive",
      });
    } finally {
      setConfirming(false);
    }
  };

  const handleDrawPairs = async () => {
    if (!secretSantaId || participants.length < 2) {
      toast({
        title: "Participantes insuficientes",
        description: "É necessário pelo menos 2 participantes cadastrados para realizar o sorteio.",
        variant: "destructive",
      });
      return;
    }

    setDrawing(true);
    try {
      const { performSecretSantaDraw, validateParticipants } = await import(
        "@/utils/secretSantaDraw"
      );

      const validation = validateParticipants(participants);
      if (!validation.valid) {
        throw new Error(validation.error);
      }

      const pairs = performSecretSantaDraw(participants);

      const pairsToInsert = pairs.map((pair) => ({
        secret_santa_id: secretSantaId,
        giver_id: pair.giver_id,
        receiver_id: pair.receiver_id,
      }));

      const { error: pairsError } = await supabase
        .from("event_secret_santa_pairs")
        .insert(pairsToInsert);

      if (pairsError) throw pairsError;

      const { error: updateError } = await supabase
        .from("event_secret_santa")
        .update({ has_drawn: true })
        .eq("id", secretSantaId);

      if (updateError) throw updateError;

      // Criar notificações in-app para todos os participantes
      const participantUserIds = participants.map((p) => p.user_id);
      try {
        await supabase.rpc("notify_secret_santa_draw", {
          _event_id: Number(eventId),
          _secret_santa_id: secretSantaId,
          _participant_user_ids: participantUserIds,
        });
      } catch (notifErr) {
        // Error handling
      }

      // Enviar emails para todos os participantes
      try {
        const participantsWithEmail = participants.map((p) => ({
          email: p.email || "",
          displayName: p.display_name || "Participante",
        }));

        await supabase.functions.invoke("send-secret-santa-notification", {
          body: {
            eventId: Number(eventId),
            eventTitle: eventData?.title || "Evento",
            eventDate: eventData?.event_date || new Date().toISOString(),
            secretSantaId,
            participants: participantsWithEmail,
          },
        });
        // Emails de notificação enviados
      } catch (emailErr) {
        // Error handling
        // Não bloquear o fluxo se emails falharem
      }

      toast({
        title: "Sorteio realizado!",
        description: "Os pares foram sorteados e os participantes foram notificados por email.",
      });

      navigate(`/event/${eventId}/secret-santa/results`);
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao sortear",
        description: err.message || "Não foi possível realizar o sorteio.",
        variant: "destructive",
      });
    } finally {
      setDrawing(false);
    }
  };

  const handleRemoveParticipant = async (participantId: string) => {
    try {
      const { error } = await supabase
        .from("event_secret_santa_participants")
        .delete()
        .eq("id", participantId);

      if (error) throw error;

      toast({
        title: "Participante removido",
        description: "O participante foi removido do Amigo Secreto.",
      });

      setParticipants(prev => prev.filter(p => p.id !== participantId));
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao remover",
        description: err.message || "Não foi possível remover o participante.",
        variant: "destructive",
      });
    }
  };

  const handleRemovePendingInvitation = async (invitationId: string) => {
    try {
      const { error } = await supabase
        .from("event_invitations")
        .delete()
        .eq("id", invitationId);

      if (error) throw error;

      toast({
        title: "Convite removido",
        description: "O convite pendente foi removido.",
      });

      setPendingInvitations(prev => prev.filter(inv => inv.id !== invitationId));
    } catch (err: any) {
      // Error handling
      toast({
        title: "Erro ao remover",
        description: err.message || "Não foi possível remover o convite.",
        variant: "destructive",
      });
    }
  };

  // Função para obter o texto de exibição do participante
  const getParticipantDisplayName = (participant: Participant): string => {
    if (participant.display_name) {
      return participant.display_name;
    }
    if (participant.email) {
      return participant.email;
    }
    return "Participante";
  };

  // Função para obter as iniciais do participante
  const getParticipantInitials = (participant: Participant): string => {
    if (participant.display_name) {
      return participant.display_name[0].toUpperCase();
    }
    if (participant.email) {
      return participant.email[0].toUpperCase();
    }
    return "P";
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <Loader2 className="w-6 h-6 animate-spin text-muted-foreground" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background p-4 md:p-8">
      <div className="max-w-4xl mx-auto space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        <Card>
          <CardHeader>
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="p-2 bg-primary/10 rounded-lg">
                  <Users className="w-6 h-6 text-primary" />
                </div>
                <div>
                  <CardTitle>Participantes do Amigo Secreto</CardTitle>
                  <CardDescription>
                    Gerencie os participantes do Amigo Secreto
                  </CardDescription>
                </div>
              </div>
            </div>
          </CardHeader>
          <CardContent className="space-y-6">
            {/* Adicionar novo participante */}
            <div className="flex gap-2">
              <Input
                placeholder="Digite o email do participante"
                value={newParticipantEmail}
                onChange={(e) => setNewParticipantEmail(e.target.value)}
                onKeyDown={(e) => {
                  if (e.key === "Enter" && newParticipantEmail.trim() && !adding) {
                    handleAddParticipant(newParticipantEmail);
                  }
                }}
                disabled={adding}
              />
              <Button
                onClick={() => handleAddParticipant(newParticipantEmail)}
                disabled={!newParticipantEmail.trim() || adding}
              >
                {adding ? (
                  <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                ) : (
                  <UserPlus className="w-4 h-4 mr-2" />
                )}
                {adding ? "Adicionando..." : "Adicionar"}
              </Button>
            </div>

            <p className="text-sm text-muted-foreground">
              Adicione emails de participantes. Se não estiverem cadastrados, receberão um convite para se registrar no ReUNE.
            </p>

            {/* Botão para adicionar todos os convidados do evento */}
            {eventInvitations.length > 0 && (
              <Button
                onClick={handleAddEventInvitations}
                disabled={confirming}
                variant="outline"
                className="w-full"
              >
                {confirming ? (
                  <>
                    <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                    Adicionando...
                  </>
                ) : (
                  `Importar ${eventInvitations.length} convidado(s) confirmado(s) do evento`
                )}
              </Button>
            )}

            {/* Lista de participantes confirmados */}
            <div className="space-y-3">
              <h3 className="font-semibold">Participantes Cadastrados ({participants.length})</h3>
              {participants.length === 0 ? (
                <p className="text-sm text-muted-foreground">
                  Nenhum participante cadastrado ainda.
                </p>
              ) : (
                <div className="space-y-2">
                  {participants.map((participant) => (
                    <div
                      key={participant.id}
                      className="flex items-center justify-between p-3 bg-muted rounded-lg"
                    >
                      <div className="flex items-center gap-3">
                        <Avatar>
                          <AvatarImage src={participant.avatar_url || undefined} />
                          <AvatarFallback>
                            {getParticipantInitials(participant)}
                          </AvatarFallback>
                        </Avatar>
                        <div>
                          <p className="font-medium">
                            {getParticipantDisplayName(participant)}
                            {participant.user_id === user?.id && (
                              <span className="text-muted-foreground text-sm ml-2">(você)</span>
                            )}
                          </p>
                          {/* Mostrar email se houver display_name diferente do email */}
                          {participant.display_name && participant.email && (
                            <p className="text-sm text-muted-foreground">
                              {participant.email}
                            </p>
                          )}
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <Badge variant="default">
                          Confirmado
                        </Badge>
                        <Button
                          variant="ghost"
                          size="icon"
                          className="h-8 w-8 text-muted-foreground hover:text-destructive"
                          onClick={() => handleRemoveParticipant(participant.id)}
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* Lista de convites pendentes (não cadastrados) */}
            {pendingInvitations.length > 0 && (
              <div className="space-y-3">
                <h3 className="font-semibold">Convites Pendentes ({pendingInvitations.length})</h3>
                <p className="text-sm text-muted-foreground">
                  Estas pessoas ainda não se cadastraram no ReUNE.
                </p>
                <div className="space-y-2">
                  {pendingInvitations.map((invitation) => (
                    <div
                      key={invitation.id}
                      className="flex items-center justify-between p-3 bg-muted/50 rounded-lg border border-dashed"
                    >
                      <div className="flex items-center gap-3">
                        <div className="w-10 h-10 rounded-full bg-muted flex items-center justify-center">
                          <Mail className="w-5 h-5 text-muted-foreground" />
                        </div>
                        <div>
                          <p className="font-medium text-muted-foreground">
                            {invitation.email}
                          </p>
                        </div>
                      </div>
                      <div className="flex items-center gap-2">
                        <Badge variant="secondary">
                          Aguardando cadastro
                        </Badge>
                        <Button
                          variant="ghost"
                          size="icon"
                          className="h-8 w-8 text-muted-foreground hover:text-destructive"
                          onClick={() => handleRemovePendingInvitation(invitation.id)}
                        >
                          <Trash2 className="h-4 w-4" />
                        </Button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {/* Aviso sobre convites pendentes */}
            {pendingInvitations.length > 0 && (
              <div className="p-4 bg-amber-500/10 border border-amber-500/20 rounded-lg">
                <p className="text-sm text-amber-700 dark:text-amber-400">
                  <strong>Atenção:</strong> Os convites pendentes não participarão do sorteio até que se cadastrem no ReUNE.
                  Aguarde todos se registrarem ou realize o sorteio apenas com os participantes confirmados.
                </p>
              </div>
            )}

            {/* Botões de ação */}
            <div className="flex gap-3">
              <Button
                onClick={handleDrawPairs}
                disabled={drawing || participants.length < 2}
                className="flex-1"
                size="lg"
              >
                {drawing ? (
                  <Loader2 className="w-4 h-4 mr-2 animate-spin" />
                ) : (
                  <Shuffle className="w-4 h-4 mr-2" />
                )}
                {drawing ? "Sorteando..." : `Realizar Sorteio (${participants.length} participantes)`}
              </Button>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaResults.tsx
============================================================
import { useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Gift, Sparkles, ArrowLeft } from "lucide-react";

export default function SecretSantaResults() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();

  useEffect(() => {
    // Redirecionar automaticamente para a página de resultado individual
    const timer = setTimeout(() => {
      navigate(`/event/${eventId}/secret-santa/my-result`);
    }, 2000);

    return () => clearTimeout(timer);
  }, [eventId, navigate]);

  return (
    <div className="min-h-screen bg-gradient-to-br from-primary/5 via-background to-primary/10 p-4 md:p-8 flex items-center justify-center">
      <div className="max-w-md w-full space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        <Card className="border-2 border-primary/30 shadow-xl text-center">
          <CardHeader>
            <div className="flex items-center justify-center gap-2 mb-4">
              <Gift className="w-12 h-12 text-primary animate-bounce" />
              <Sparkles className="w-8 h-8 text-primary animate-pulse" />
            </div>
            <CardTitle className="text-3xl">Sorteio Realizado!</CardTitle>
            <CardDescription className="text-base mt-2">
              O Amigo Secreto foi sorteado com sucesso
            </CardDescription>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="p-4 bg-primary/5 rounded-lg border border-primary/20">
              <p className="text-sm text-muted-foreground">
                Redirecionando para ver seu resultado...
              </p>
              <div className="mt-4 flex justify-center">
                <div className="animate-spin h-6 w-6 border-2 border-primary border-t-transparent rounded-full" />
              </div>
            </div>

            <Button
              onClick={() => navigate(`/event/${eventId}/secret-santa/my-result`)}
              className="w-full"
              size="lg"
            >
              Ver Meu Resultado Agora
            </Button>

            <div className="text-xs text-muted-foreground space-y-1">
              <p>🎁 Cada participante pode ver apenas seu próprio par</p>
              <p>🤫 Mantenha o segredo!</p>
            </div>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaSetup.tsx
============================================================
import { useState } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Switch } from "@/components/ui/switch";
import { Calendar } from "@/components/ui/calendar";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { ArrowLeft, Calendar as CalendarIcon, Gift } from "lucide-react";
import { format } from "date-fns";
import { ptBR } from "date-fns/locale";
import { useToast } from "@/hooks/use-toast";
import { supabase } from "@/integrations/supabase/client";
import { cn } from "@/lib/utils";

export default function SecretSantaSetup() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { toast } = useToast();

  const [minValue, setMinValue] = useState<number>(0);
  const [maxValue, setMaxValue] = useState<number>(0);
  const [drawDate, setDrawDate] = useState<Date>();
  const [preventRepeat, setPreventRepeat] = useState(false);
  const [loading, setLoading] = useState(false);

  const handleCreateSecretSanta = async () => {
    if (!eventId) return;
    
    if (minValue < 0 || maxValue < 0) {
      toast({
        title: "Valores inválidos",
        description: "Os valores mínimo e máximo devem ser positivos.",
        variant: "destructive",
      });
      return;
    }

    if (maxValue > 0 && minValue > maxValue) {
      toast({
        title: "Valores inválidos",
        description: "O valor mínimo não pode ser maior que o valor máximo.",
        variant: "destructive",
      });
      return;
    }

    setLoading(true);
    try {
      // Primeiro, criar a dinâmica
      const { data: dynamicData, error: dynamicError } = await supabase
        .from("event_dynamics")
        .insert({
          event_id: Number(eventId),
          type: "secret_santa",
        })
        .select()
        .single();

      if (dynamicError) throw dynamicError;

      // Criar configuração do Amigo Secreto
      const { error: secretSantaError } = await supabase
        .from("event_secret_santa")
        .insert({
          event_id: Number(eventId),
          min_value: minValue || null,
          max_value: maxValue || null,
          draw_date: drawDate ? drawDate.toISOString() : null,
          rules_json: { prevent_repeat: preventRepeat },
        });

      if (secretSantaError) throw secretSantaError;

      toast({
        title: "Amigo Secreto criado!",
        description: "Configure agora os participantes.",
      });

      navigate(`/event/${eventId}/secret-santa/participants`);
    } catch (err: any) {
      console.error("Erro ao criar Amigo Secreto:", err);
      toast({
        title: "Erro ao criar",
        description: err.message || "Não foi possível criar o Amigo Secreto.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-background p-4 md:p-8">
      <div className="max-w-2xl mx-auto space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        <Card>
          <CardHeader>
            <div className="flex items-center gap-3">
              <div className="p-2 bg-primary/10 rounded-lg">
                <Gift className="w-6 h-6 text-primary" />
              </div>
              <div>
                <CardTitle>Configurar Amigo Secreto</CardTitle>
                <CardDescription>
                  Defina as regras para o Amigo Secreto do evento
                </CardDescription>
              </div>
            </div>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="space-y-2">
                <Label htmlFor="minValue">Valor Mínimo (R$)</Label>
                <Input
                  id="minValue"
                  type="number"
                  min="0"
                  step="0.01"
                  value={minValue || ""}
                  onChange={(e) => setMinValue(Number(e.target.value))}
                  placeholder="0.00"
                />
              </div>
              <div className="space-y-2">
                <Label htmlFor="maxValue">Valor Máximo (R$)</Label>
                <Input
                  id="maxValue"
                  type="number"
                  min="0"
                  step="0.01"
                  value={maxValue || ""}
                  onChange={(e) => setMaxValue(Number(e.target.value))}
                  placeholder="0.00"
                />
              </div>
            </div>

            <div className="space-y-2">
              <Label>Data do Sorteio</Label>
              <Popover>
                <PopoverTrigger asChild>
                  <Button
                    variant="outline"
                    className={cn(
                      "w-full justify-start text-left font-normal",
                      !drawDate && "text-muted-foreground"
                    )}
                  >
                    <CalendarIcon className="mr-2 h-4 w-4" />
                    {drawDate ? format(drawDate, "PPP", { locale: ptBR }) : "Selecione a data"}
                  </Button>
                </PopoverTrigger>
                <PopoverContent className="w-auto p-0">
                  <Calendar
                    mode="single"
                    selected={drawDate}
                    onSelect={setDrawDate}
                    locale={ptBR}
                    initialFocus
                  />
                </PopoverContent>
              </Popover>
            </div>

            <div className="flex items-center justify-between space-x-2 p-4 bg-muted rounded-lg">
              <div className="space-y-0.5">
                <Label htmlFor="preventRepeat">Impedir repetições</Label>
                <p className="text-sm text-muted-foreground">
                  Participantes não podem sortear a mesma pessoa em sorteios futuros
                </p>
              </div>
              <Switch
                id="preventRepeat"
                checked={preventRepeat}
                onCheckedChange={setPreventRepeat}
              />
            </div>

            <Button
              onClick={handleCreateSecretSanta}
              disabled={loading}
              className="w-full"
              size="lg"
            >
              {loading ? "Criando..." : "Criar Amigo Secreto"}
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\SecretSantaWishlist.tsx
============================================================
import { useState, useEffect } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { ArrowLeft, Sparkles, Save } from "lucide-react";
import { useToast } from "@/hooks/use-toast";
import { supabase } from "@/integrations/supabase/client";
import { useAuth } from "@/hooks/useAuth";

export default function SecretSantaWishlist() {
  const { id: eventId } = useParams<{ id: string }>();
  const navigate = useNavigate();
  const { toast } = useToast();
  const { user } = useAuth();

  const [wishlistText, setWishlistText] = useState("");
  const [wishlistLink, setWishlistLink] = useState("");
  const [loading, setLoading] = useState(true);
  const [saving, setSaving] = useState(false);
  const [secretSantaId, setSecretSantaId] = useState<string | null>(null);

  useEffect(() => {
    if (!user || !eventId) return;
    loadWishlist();
  }, [user, eventId]);

  const loadWishlist = async () => {
    if (!user || !eventId) return;

    setLoading(true);
    try {
      // Buscar configuração do Amigo Secreto
      const { data: secretSantaData, error: secretSantaError } = await supabase
        .from("event_secret_santa")
        .select("id")
        .eq("event_id", Number(eventId))
        .maybeSingle();

      if (secretSantaError) throw secretSantaError;

      if (!secretSantaData) {
        toast({
          title: "Amigo Secreto não encontrado",
          description: "Este evento não possui Amigo Secreto configurado.",
          variant: "destructive",
        });
        navigate(`/app?event=${eventId}`);
        return;
      }

      setSecretSantaId(secretSantaData.id);

      // Buscar wishlist existente
      const { data: wishlistData } = await supabase
        .from("event_secret_santa_participants")
        .select("wishlist_text, wishlist_link")
        .eq("secret_santa_id", secretSantaData.id)
        .eq("user_id", user.id)
        .maybeSingle();

      if (wishlistData) {
        setWishlistText(wishlistData.wishlist_text || "");
        setWishlistLink(wishlistData.wishlist_link || "");
      }
    } catch (err: any) {
      console.error("Erro ao carregar wishlist:", err);
      toast({
        title: "Erro ao carregar",
        description: err.message || "Não foi possível carregar sua lista de desejos.",
        variant: "destructive",
      });
    } finally {
      setLoading(false);
    }
  };

  const handleSave = async () => {
    if (!user || !secretSantaId) return;

    if (!wishlistText.trim() && !wishlistLink.trim()) {
      toast({
        title: "Campos vazios",
        description: "Preencha pelo menos um dos campos para salvar.",
        variant: "destructive",
      });
      return;
    }

    setSaving(true);
    try {
      const { error } = await supabase
        .from("event_secret_santa_participants")
        .upsert(
          {
            secret_santa_id: secretSantaId,
            user_id: user.id,
            wishlist_text: wishlistText.trim() || null,
            wishlist_link: wishlistLink.trim() || null,
            status: "confirmed",
          },
          {
            onConflict: "secret_santa_id,user_id",
          }
        );

      if (error) throw error;

      toast({
        title: "Lista salva!",
        description: "Sua lista de desejos foi salva com sucesso.",
      });

      navigate(`/app?event=${eventId}`);
    } catch (err: any) {
      console.error("Erro ao salvar wishlist:", err);
      toast({
        title: "Erro ao salvar",
        description: err.message || "Não foi possível salvar sua lista de desejos.",
        variant: "destructive",
      });
    } finally {
      setSaving(false);
    }
  };

  if (loading) {
    return (
      <div className="min-h-screen bg-background flex items-center justify-center">
        <p className="text-muted-foreground">Carregando...</p>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-background p-4 md:p-8">
      <div className="max-w-2xl mx-auto space-y-6">
        <Button
          variant="ghost"
          onClick={() => navigate(`/app?event=${eventId}`)}
          className="mb-4"
        >
          <ArrowLeft className="w-4 h-4 mr-2" />
          Voltar para o evento
        </Button>

        <Card>
          <CardHeader>
            <div className="flex items-center gap-3">
              <div className="p-2 bg-primary/10 rounded-lg">
                <Sparkles className="w-6 h-6 text-primary" />
              </div>
              <div>
                <CardTitle>Minha Lista de Desejos</CardTitle>
                <CardDescription>
                  Conte o que você gostaria de ganhar no Amigo Secreto
                </CardDescription>
              </div>
            </div>
          </CardHeader>
          <CardContent className="space-y-6">
            <div className="space-y-2">
              <Label htmlFor="wishlistText">O que você gostaria de ganhar?</Label>
              <Textarea
                id="wishlistText"
                value={wishlistText}
                onChange={(e) => setWishlistText(e.target.value)}
                placeholder="Ex: Livros de ficção científica, itens de cozinha, jogos de tabuleiro..."
                rows={5}
                className="resize-none"
              />
              <p className="text-xs text-muted-foreground">
                Seja específico para ajudar seu amigo secreto a escolher o presente perfeito!
              </p>
            </div>

            <div className="space-y-2">
              <Label htmlFor="wishlistLink">Link de algum produto (opcional)</Label>
              <Input
                id="wishlistLink"
                type="url"
                value={wishlistLink}
                onChange={(e) => setWishlistLink(e.target.value)}
                placeholder="https://exemplo.com/produto"
              />
              <p className="text-xs text-muted-foreground">
                Cole o link de um produto específico que você gostaria de receber
              </p>
            </div>

            <div className="p-4 bg-muted/50 rounded-lg border">
              <p className="text-sm text-muted-foreground">
                💡 <strong>Dica:</strong> Sua lista de desejos será visível apenas para a pessoa que te tirou no sorteio.
              </p>
            </div>

            <Button onClick={handleSave} disabled={saving} className="w-full" size="lg">
              <Save className="w-4 h-4 mr-2" />
              {saving ? "Salvando..." : "Salvar Lista de Desejos"}
            </Button>
          </CardContent>
        </Card>
      </div>
    </div>
  );
}


============================================================
FILE PATH: .\src\pages\TermsOfService.tsx
============================================================
import { ArrowLeft } from "lucide-react";
import { Link } from "react-router-dom";
import { Button } from "@/components/ui/button";

export default function TermsOfService() {
  return (
    <div className="min-h-screen bg-gradient-to-b from-background via-background to-accent/5">
      {/* Header */}
      <header className="border-b border-border/40 bg-background/80 backdrop-blur-sm sticky top-0 z-50">
        <div className="container mx-auto px-4 py-4">
          <Link to="/">
            <Button variant="ghost" size="sm">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Voltar ao site
            </Button>
          </Link>
        </div>
      </header>

      {/* Main Content */}
      <main className="container mx-auto px-4 py-12 max-w-4xl">
        <div className="prose prose-slate dark:prose-invert max-w-none">
          <h1 className="text-4xl font-bold mb-2 bg-gradient-to-r from-amber-500 to-purple-500 bg-clip-text text-transparent">
            Termos de Uso
          </h1>
          <p className="text-muted-foreground mb-8">
            Última atualização: {new Date().toLocaleDateString('pt-BR')}
          </p>

          <div className="bg-card/50 backdrop-blur-sm border border-border/50 rounded-2xl p-8 space-y-8">
            <section>
              <h2 className="text-2xl font-bold mb-4">1. Aceitação dos Termos</h2>
              <p>
                Bem-vindo ao ReUNE! Ao acessar ou usar nosso aplicativo, você concorda em cumprir e estar vinculado
                a estes Termos de Uso. Se você não concordar com qualquer parte destes termos, não use nossos serviços.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">2. Descrição do Serviço</h2>
              <p className="mb-4">
                O ReUNE é uma plataforma que facilita a organização de eventos, reuniões e celebrações entre amigos.
                Nossos serviços incluem:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Criação e gestão de eventos</li>
                <li>Convites digitais e confirmação de presença</li>
                <li>Chat e interação entre participantes</li>
                <li>Compartilhamento de fotos e memórias</li>
                <li>Organização de Amigo Secreto</li>
                <li>Divisão de despesas e contribuições</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">3. Elegibilidade</h2>
              <p>
                Para usar o ReUNE, você deve:
              </p>
              <ul className="list-disc pl-6 space-y-2 mt-4">
                <li>Ter pelo menos 13 anos de idade</li>
                <li>Fornecer informações verdadeiras e completas ao se cadastrar</li>
                <li>Manter suas credenciais de acesso seguras e confidenciais</li>
                <li>Notificar-nos imediatamente sobre qualquer uso não autorizado de sua conta</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">4. Conta do Usuário</h2>
              <p className="mb-4">
                Ao criar uma conta no ReUNE, você concorda em:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Fornecer informações precisas, atuais e completas</li>
                <li>Manter e atualizar prontamente suas informações</li>
                <li>Ser responsável por todas as atividades realizadas em sua conta</li>
                <li>Não compartilhar suas credenciais de acesso</li>
                <li>Notificar-nos imediatamente sobre qualquer violação de segurança</li>
              </ul>
              <p className="mt-4">
                Reservamos o direito de suspender ou encerrar contas que violem estes termos.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">5. Conduta do Usuário</h2>
              <p className="mb-4">
                Você concorda em NÃO:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Usar o serviço para fins ilegais ou não autorizados</li>
                <li>Publicar conteúdo ofensivo, difamatório, obsceno ou discriminatório</li>
                <li>Assediar, intimidar ou ameaçar outros usuários</li>
                <li>Violar direitos de propriedade intelectual de terceiros</li>
                <li>Tentar obter acesso não autorizado ao sistema</li>
                <li>Transmitir vírus, malware ou código malicioso</li>
                <li>Fazer scraping, crawling ou uso automatizado do serviço</li>
                <li>Personificar outra pessoa ou entidade</li>
                <li>Usar o serviço para spam ou publicidade não solicitada</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">6. Conteúdo do Usuário</h2>
              <p className="mb-4">
                Você retém todos os direitos sobre o conteúdo que publica no ReUNE. Ao publicar conteúdo, você nos concede
                uma licença mundial, não exclusiva, isenta de royalties para:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Usar, reproduzir, modificar e exibir seu conteúdo dentro do serviço</li>
                <li>Armazenar e fazer backup de seu conteúdo</li>
                <li>Distribuir seu conteúdo para outros participantes dos eventos</li>
              </ul>
              <p className="mt-4">
                Você é responsável pelo conteúdo que publica e garante que possui todos os direitos necessários.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">7. Propriedade Intelectual</h2>
              <p>
                O ReUNE e todo seu conteúdo (textos, gráficos, logos, ícones, imagens, código) são propriedade da
                ReUNE ou de seus licenciadores e estão protegidos por leis de direitos autorais, marcas registradas
                e outras leis de propriedade intelectual.
              </p>
              <p className="mt-4">
                Você não pode copiar, modificar, distribuir, vender ou alugar qualquer parte de nossos serviços
                sem permissão expressa por escrito.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">8. Funcionalidades Premium</h2>
              <p className="mb-4">
                O ReUNE pode oferecer funcionalidades premium mediante pagamento. Ao adquirir recursos pagos:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Os preços estão sujeitos a alterações, mas mudanças não afetarão compras já realizadas</li>
                <li>O pagamento é processado por terceiros seguros (Stripe, PayPal, etc.)</li>
                <li>Assinaturas renovam automaticamente, salvo se canceladas</li>
                <li>Cancelamentos podem ser feitos a qualquer momento através do app</li>
                <li>Reembolsos seguem nossa política de reembolso disponível no app</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">9. Limitação de Responsabilidade</h2>
              <p>
                O ReUNE é fornecido "como está" e "conforme disponível". Não garantimos que o serviço será
                ininterrupto, seguro ou livre de erros. Na máxima extensão permitida por lei:
              </p>
              <ul className="list-disc pl-6 space-y-2 mt-4">
                <li>Não nos responsabilizamos por danos diretos, indiretos, incidentais ou consequenciais</li>
                <li>Não garantimos a precisão ou confiabilidade do conteúdo gerado por usuários</li>
                <li>Não somos responsáveis por interações entre usuários fora do aplicativo</li>
                <li>Nossa responsabilidade total não excederá o valor pago por você nos últimos 12 meses</li>
              </ul>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">10. Rescisão</h2>
              <p className="mb-4">
                Você pode encerrar sua conta a qualquer momento através das configurações do aplicativo.
                Podemos suspender ou encerrar sua conta se:
              </p>
              <ul className="list-disc pl-6 space-y-2">
                <li>Você violar estes Termos de Uso</li>
                <li>Seu uso causar riscos legais ou de segurança</li>
                <li>Houver suspeita de fraude ou uso indevido</li>
                <li>Deixarmos de oferecer o serviço</li>
              </ul>
              <p className="mt-4">
                Após o encerramento, você perderá o acesso à sua conta e todo conteúdo associado.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">11. Lei Aplicável e Jurisdição</h2>
              <p>
                Estes Termos são regidos pelas leis da República Federativa do Brasil. Quaisquer disputas
                serão resolvidas no foro da comarca de [CIDADE], com exclusão de qualquer outro, por mais
                privilegiado que seja.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">12. Alterações nos Termos</h2>
              <p>
                Reservamos o direito de modificar estes termos a qualquer momento. Notificaremos sobre
                mudanças significativas por email ou aviso no aplicativo. O uso continuado após as alterações
                constitui aceitação dos novos termos.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">13. Disposições Gerais</h2>
              <p className="mb-4">
                <strong>Acordo Integral:</strong> Estes termos constituem o acordo integral entre você e o ReUNE.
              </p>
              <p className="mb-4">
                <strong>Renúncia:</strong> Nossa falha em fazer cumprir qualquer direito não constitui renúncia.
              </p>
              <p className="mb-4">
                <strong>Divisibilidade:</strong> Se qualquer disposição for considerada inválida, as demais permanecerão em vigor.
              </p>
            </section>

            <section>
              <h2 className="text-2xl font-bold mb-4">14. Contato</h2>
              <p className="mb-4">
                Para dúvidas sobre estes Termos de Uso:
              </p>
              <ul className="list-none space-y-2">
                <li><strong>Email:</strong> contato@reuneapp.com.br</li>
                <li><strong>Suporte:</strong> Disponível dentro do aplicativo</li>
              </ul>
            </section>

            <div className="bg-amber-500/10 border border-amber-500/20 rounded-xl p-6 mt-8">
              <p className="text-sm">
                <strong>Ao usar o ReUNE, você confirma que leu, entendeu e concordou com estes Termos de Uso
                e nossa Política de Privacidade.</strong>
              </p>
            </div>
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t border-border/40 mt-16">
        <div className="container mx-auto px-4 py-8 text-center text-muted-foreground">
          <p>&copy; {new Date().getFullYear()} ReUNE. Todos os direitos reservados.</p>
        </div>
      </footer>
    </div>
  );
}


============================================================
FILE PATH: .\src\profiles\churrasco.ts
============================================================
import { Item } from "@/types/domain";

// Itens sugeridos antes de serem associados a um evento específico.
type SuggestedItem = Omit<Item, 'id' | 'evento_id'>;

// Coeficientes por pessoa para o cálculo dos itens.
const meatPerPerson = 0.4; // kg
const sausagePerPerson = 0.15; // kg
const breadPerPerson = 2; // unidades (pão de alho)
const beerPerPerson = 1.5; // litros
const sodaPerPerson = 0.5; // litros
const charcoalPerKgOfMeat = 1.5; // kg de carvão por kg de carne/linguiça

/**
 * Perfil para eventos do tipo "churrasco".
 * Contém a lógica para estimar a lista de itens necessários.
 */
export const churrascoProfile = {
  /**
   * Estima a quantidade de itens para um churrasco com base no número de pessoas.
   * @param qtd_pessoas - A quantidade de pessoas no evento.
   * @returns Uma lista de itens sugeridos com quantidades calculadas.
   */
  estimate: (qtd_pessoas: number): SuggestedItem[] => {
    const totalMeat = qtd_pessoas * meatPerPerson;
    const totalSausage = qtd_pessoas * sausagePerPerson;

    const items: SuggestedItem[] = [
      {
        nome_item: "Picanha",
        quantidade: totalMeat * 0.4,
        unidade: "kg",
        categoria: "Carnes",
        prioridade: 'A',
        valor_estimado: 0,
      },
      {
        nome_item: "Linguiça Toscana",
        quantidade: totalSausage,
        unidade: "kg",
        categoria: "Carnes",
        prioridade: 'A',
        valor_estimado: 0,
      },
      {
        nome_item: "Asa de Frango",
        quantidade: totalMeat * 0.3,
        unidade: "kg",
        categoria: "Carnes",
        prioridade: 'B',
        valor_estimado: 0,
      },
      {
        nome_item: "Pão de Alho",
        quantidade: qtd_pessoas * breadPerPerson,
        unidade: "un",
        categoria: "Acompanhamentos",
        prioridade: 'B',
        valor_estimado: 0,
      },
      {
        nome_item: "Queijo Coalho",
        quantidade: qtd_pessoas * 1,
        unidade: "un",
        categoria: "Acompanhamentos",
        prioridade: 'B',
        valor_estimado: 0,
      },
      {
        nome_item: "Cerveja",
        quantidade: qtd_pessoas * beerPerPerson,
        unidade: "L",
        categoria: "Bebidas",
        prioridade: 'A',
        valor_estimado: 0,
      },
      {
        nome_item: "Refrigerante",
        quantidade: qtd_pessoas * sodaPerPerson,
        unidade: "L",
        categoria: "Bebidas",
        prioridade: 'B',
        valor_estimado: 0,
      },
      {
        nome_item: "Água",
        quantidade: qtd_pessoas * 0.5,
        unidade: "L",
        categoria: "Bebidas",
        prioridade: 'A',
        valor_estimado: 0,
      },
      {
        nome_item: "Carvão",
        quantidade: (totalMeat + totalSausage) * charcoalPerKgOfMeat,
        unidade: "kg",
        categoria: "Utensílios",
        prioridade: 'A',
        valor_estimado: 0,
      },
      {
        nome_item: "Sal Grosso",
        quantidade: 1,
        unidade: "kg",
        categoria: "Temperos",
        prioridade: 'C',
        valor_estimado: 0,
      },
    ];

    // Arredonda as quantidades para cima para fins práticos.
    return items.map(item => ({
      ...item,
      quantidade: Math.ceil(item.quantidade),
    }));
  },
};

============================================================
FILE PATH: .\src\profiles\pizza.ts
============================================================
import { AiProfile } from '@/types/domain';

export const pizzaProfile: AiProfile = {
  id: 'pizza',
  name: 'Pizza Night',
  description: 'Perfil para noite de pizza',
  tags: ['pizza', 'noite de pizza', 'pizzada'],
};

============================================================
FILE PATH: .\src\services\groqService.ts
============================================================
/**
 * Servico de IA usando Groq API
 * Baseado no metodo do Kliper, adaptado para UNE.AI
 */

import { LlmMessage } from '@/types/llm';
import { Event, Item, UUID, EventStatus } from '@/types/domain';
import { rpc } from '@/api/rpc';
import { upsertEvent, setEventStatus } from '@/core/orchestrator/eventManager';
import { isValidFutureDate, parseToIsoDate } from '@/core/nlp/date-parser';
import { PlannerEnvelope, plannerEnvelopeSchema } from '@/api/llm/plannerSchemas';
import { systemResponses } from '@/core/orchestrator/systemResponses';


/**
 * Interface para acoes que o chatbot pode executar
 */
interface ActionData {
  action: 'create_event' | 'generate_items' | 'confirm_event' | 'update_event';
  data: {
    tipo_evento?: string;
    categoria_evento?: string;
    subtipo_evento?: string;
    event_name?: string;        // Para capturar o que a IA envia no log
    event_description?: string; // Para capturar o que a IA envia no log
    qtd_pessoas?: number;
    data_evento?: string;
    menu?: string;
    finalidade_evento?: string;
    descricao?: string;
    evento_id?: string;
  };
}

/**
 * Contexto atual do evento (para passar ao prompt)
 */
interface EventContext {
  evento?: {
    id?: string;
    tipo_evento?: string;
    categoria_evento?: string;
    subtipo_evento?: string;
    qtd_pessoas?: number;
    data_evento?: string;
    menu?: string;
    status?: string;
  };
  hasItems?: boolean;
  hasParticipants?: boolean;
  collectedData?: Record<string, unknown>;
}

/**
 * Gera o system prompt completo para o UNE.AI
 */
function buildSystemPrompt(context?: EventContext): string {
  const todayIso = new Date().toISOString().slice(0, 10);
  const basePrompt = `Voce e o UNE.AI, um assistente especializado em planejamento de eventos sociais.
Data atual: ${todayIso}.

**Sua Personalidade:**
- Voce e acolhedor, natural e direto na comunicacao
- Usa linguagem simples e cotidiana, sem jargoes tecnicos
- Mantem frases curtas e objetivas, com ritmo de conversa natural
- E empatico e atento as necessidades do usuario
- Demonstra entusiasmo equilibrado (nem frio, nem exagerado)

**Seu Tom de Voz:**
- Casual mas respeitoso
- Usa expressoes naturais como "otimo", "perfeito", "vamos la"
- Evita ser formal demais ou usar linguagem robotica
- Mantem coerencia emocional conforme o contexto da conversa

**Estrutura Hierarquica de Eventos:**
- categoria_evento: forma social (almoco, jantar, lanche, piquenique, cafe da manha, brunch)
- subtipo_evento: estilo culinario (churrasco, feijoada, pizza, fondue, lasanha, sushi)
- menu: prato principal especifico (lasanha, carnes, massas, frutos do mar)

**Intencoes Possiveis:**
- criar_evento: Criar um novo evento do zero
- confirmar_evento: Confirmar e finalizar um evento
- editar_evento: Alterar informacoes de um evento existente
- mostrar_itens: Mostrar lista de itens do evento
- reiniciar_conversa: Limpar tudo e comecar do zero
- encerrar_conversa: Finalizar a conversa

**Regras de Extracao:**
1. "churrasco" e subtipo_evento; categoria_evento deve ser inferida (geralmente "almoco")
2. "jantar" e categoria_evento, nao subtipo
3. Se mencionar apenas prato (ex: "lasanha"), classifique como menu
4. Datas aceitas: dd/mm/yyyy, dd/mm, "dia X de mes", ou formato ISO
5. Quantidade de pessoas: numeros seguidos de palavras como "pessoas" ou "convidados"

**Quando Executar Acoes:**
Voce deve retornar JSON APENAS quando tiver informacoes suficientes para executar uma acao. Formato do JSON:

{
  "action": "create_event" | "generate_items" | "confirm_event" | "update_event",
  "data": {
    "tipo_evento": "string",
    "categoria_evento": "string (opcional)",
    "subtipo_evento": "string (opcional)",
    "qtd_pessoas": number,
    "data_evento": "string (formato ISO: YYYY-MM-DD)",
    "menu": "string (opcional)",
    "evento_id": "string (apenas para update_event e confirm_event)"
  }
}

**Acoes Disponiveis:**
- create_event: Quando tiver tipo_evento E qtd_pessoas
- generate_items: Quando evento ja existe e precisa gerar lista de itens
- confirm_event: Quando usuario confirmar lista de itens
- update_event: Quando usuario quiser alterar dados do evento

**IMPORTANTE:**
- evento_id deve ser o ID numerico do evento quando existir
- Use os dados coletados e nao pergunte novamente o que ja foi informado
- Se retornar JSON, NAO escreva nada alem do JSON puro (sem markdown, sem explicacoes)
- Se nao tiver informacoes suficientes, continue a conversa normalmente perguntando o que falta
- Seja objetivo e nao divague
- **INTELIGÊNCIA TEMPORAL:** Se o contexto já tiver uma data definida (ex: vinda do banco de dados para feriados), USE essa data. Não invente datas nem pergunte novamente se já estiver no contexto.`;

  if (context?.evento) {
    const evento = context.evento;
    const contextInfo = `
**Contexto Atual do Evento:**
- ID: ${evento.id || 'N/A'}
- Tipo: ${evento.tipo_evento || 'Nao definido'}
- Pessoas: ${evento.qtd_pessoas || 'Nao definido'}
- Data: ${evento.data_evento || 'Nao definida'}
- Menu: ${evento.menu || 'Nao definido'}
- Status: ${evento.status || 'N/A'}
- Itens gerados: ${context.hasItems ? 'Sim' : 'Nao'}
- Participantes: ${context.hasParticipants ? 'Sim' : 'Nao'}

Use essas informacoes como referencia, mas nao repita tudo que ja foi dito.`;

    return basePrompt + contextInfo;
  }

  if (context?.collectedData && Object.keys(context.collectedData).length > 0) {
    const collected = context.collectedData as Record<string, unknown>;
    const parts: string[] = ['\n**Dados coletados ate agora:**'];
    if (collected.categoria_evento) parts.push(`- Tipo de evento: ${collected.categoria_evento}`);
    if (collected.subtipo_evento) parts.push(`- Subtipo: ${collected.subtipo_evento}`);
    if (collected.qtd_pessoas) parts.push(`- Pessoas: ${collected.qtd_pessoas}`);
    if (collected.menu) parts.push(`- Menu: ${collected.menu}`);
    if (collected.data_evento) parts.push(`- Data: ${collected.data_evento}`);
    return basePrompt + parts.join('\n');
  }

  return basePrompt;
}

// --- 1. PROMPT PADRONIZADO (Substituir o buildPlannerPrompt ou similar) ---

const PLANNER_SYSTEM_PROMPT = `
Você é o Orquestrador Logístico do ReUNE.
Sua missão é extrair dados estruturados para organizar eventos.

REGRAS RÍGIDAS DE JSON (Sua resposta deve ser APENAS JSON):
1. Use SEMPRE a chave "tipo_evento" para o nome do evento (ex: "Festa Junina", "Jantar", "Churrasco").
2. Use SEMPRE a chave "qtd_pessoas" para o número de convidados (número puro).
3. Use SEMPRE a chave "data_evento" para datas (YYYY-MM-DD).
4. Use SEMPRE a chave "menu" para o prato ou comida que será servida (ex: "Massas", "Pizza", "Japonês").

INTENÇÕES:
- "create_event": Quando o usuário quer marcar algo novo.
- "generate_items": APENAS se você já tiver "tipo_evento" E "qtd_pessoas".
- "update_event": Para alterar dados.
- "confirm_event": Quando o usuário confirmar a lista, disser "ok", "tá bom" ou "pode ser".

Exemplo de Resposta Válida:
{
  "intent": "create_event",
  "payload": {
    "tipo_evento": "Festa Junina",
    "qtd_pessoas": 20,
    "categoria_evento": "festa"
  }
}
`;

function buildPlannerPrompt(context?: EventContext): string {
  const contextPayload = {
    today: new Date().toISOString().slice(0, 10),
    evento: context?.evento || null,
    collected_data: context?.collectedData || {},
  };

  return `${PLANNER_SYSTEM_PROMPT}

Contexto (JSON):
${JSON.stringify(contextPayload)}
`;
}

// --- 2. FUNÇÕES AUXILIARES DE LIMPEZA ---

function cleanGroqResponse(text: string): string {
  // Remove markdown (```json ... ```) e espaços extras
  return text.replace(/```json/g, '').replace(/```/g, '').trim();
}

function parsePlannerEnvelope(content: string) {
  try {
    const cleaned = cleanGroqResponse(content);
    const parsed = JSON.parse(cleaned);
    const validated = plannerEnvelopeSchema.safeParse(parsed);
    if (!validated.success) {
      const msg = validated.error.issues.map((i) => `${i.path.join('.')}: ${i.message}`).join('; ');
      return { ok: false as const, error: msg };
    }
    return { ok: true as const, data: validated.data };
  } catch (error) {
    return { ok: false as const, error: error instanceof Error ? error.message : 'json invalido' };
  }
}

function plannerToAction(plan: PlannerEnvelope): ActionData | null {
  if (
    plan.intent === 'create_event'
    || plan.intent === 'generate_items'
    || plan.intent === 'update_event'
    || plan.intent === 'confirm_event'
  ) {
    return {
      action: plan.intent,
      data: plan.payload as ActionData['data'],
    };
  }
  return null;
}

/**
 * Chama a Edge Function (llm-chat) que usa Groq server-side.
 */
async function callGroqAPI(
  systemPrompt: string,
  messages: LlmMessage[],
  temperature = 0.7
): Promise<string> {
  const { supabase } = await import('@/integrations/supabase/client');

  console.log('[GroqService] invoking llm-chat', {
    messagesCount: messages.length,
    temperature,
    systemPromptPreview: systemPrompt.slice(0, 120),
  });

  const { data, error } = await supabase.functions.invoke('llm-chat', {
    body: {
      systemPrompt,
      messages,
      temperature,
    },
  });

  if (error) {
    throw new Error(error.message || 'Erro ao chamar llm-chat');
  }

  const content = (data as any)?.content;
  if (!content) {
    throw new Error('Resposta vazia da llm-chat');
  }

  console.log('[GroqService] llm-chat response', {
    contentPreview: String(content).slice(0, 160),
  });

  return content as string;
}

/**
 * Detecta e extrai JSON de acao na resposta
 */
function detectActionJSON(content: string): ActionData | null {
  try {
    const cleaned = cleanGroqResponse(content);
    const jsonMatch = cleaned.match(/\{[\s\S]*\}/);
    if (!jsonMatch) return null;

    const jsonStr = jsonMatch[0];
    const parsed = JSON.parse(jsonStr);

    if (parsed.action && parsed.data) {
      return parsed as ActionData;
    }
  } catch {
    return null;
  }

  return null;
}

/**
 * Fallback para gerar itens basicos quando LLM falhar
 */
function generateFallbackItems(tipo_evento: string, qtd_pessoas: number): Partial<Item>[] {
  const isChurrasco = tipo_evento.toLowerCase().includes('churrasco');

  const baseItems = isChurrasco
    ? [
      { nome: 'Carne bovina', unidade: 'kg', categoria: 'comida', quantidade: Math.max(0.4 * qtd_pessoas, 1) },
      { nome: 'Linguica', unidade: 'kg', categoria: 'comida', quantidade: Math.max(0.2 * qtd_pessoas, 0.5) },
      { nome: 'Pao de alho', unidade: 'un', categoria: 'comida', quantidade: Math.max(2 * qtd_pessoas, 10) },
      { nome: 'Cerveja', unidade: 'L', categoria: 'bebida', quantidade: Math.max(2 * qtd_pessoas, 6) },
      { nome: 'Refrigerante', unidade: 'L', categoria: 'bebida', quantidade: Math.max(1 * qtd_pessoas, 3) },
      { nome: 'Carvao', unidade: 'kg', categoria: 'combustivel', quantidade: Math.max(1 * qtd_pessoas, 3) },
    ]
    : [
      { nome: 'Comida', unidade: 'kg', categoria: 'comida', quantidade: Math.max(0.3 * qtd_pessoas, 1) },
      { nome: 'Bebida', unidade: 'L', categoria: 'bebida', quantidade: Math.max(1 * qtd_pessoas, 2) },
    ];

  return baseItems.map(item => ({
    nome_item: item.nome,
    quantidade: Math.round(item.quantidade * 100) / 100,
    unidade: item.unidade,
    valor_estimado: 0,
    categoria: item.categoria,
    prioridade: 'B' as const,
  }));
}

/**
 * Gera lista de itens usando Groq diretamente
 */

/**
 * Gera lista de itens usando Groq diretamente
 */
async function generateItemsWithGroqLocal(params: {
  tipo_evento: string;
  qtd_pessoas: number;
  menu?: string;
  finalidade_evento?: string;  // Ex: "Páscoa", "Natal", "Reveillon"
  excluir_alcool?: boolean;    // Excluir bebidas alcoólicas por padrão
}): Promise<Partial<Item>[]> {

  // Montar perfil do evento
  const perfilEvento = params.finalidade_evento
    ? `${params.tipo_evento} de ${params.finalidade_evento}`
    : params.tipo_evento;

  // Regra de álcool: excluir por padrão
  const excluirAlcool = params.excluir_alcool !== false;

  // MUDANÇA AQUI: Prompt com contexto cultural e regras de cálculo
  const systemPrompt = `
  ROLE:
  Você é um organizador de eventos brasileiro experiente (Party Planner), especializado em calcular quantidades exatas de comida e bebida para evitar desperdícios ou falta.

  TASK:
  Crie uma lista de compras detalhada e culturalmente adequada para o evento abaixo.

  CONTEXTO DO EVENTO:
  - Tipo/Perfil: "${perfilEvento}"
  - Quantidade de pessoas: ${params.qtd_pessoas}
  ${params.menu ? `- Menu/Prato Principal: "${params.menu}"` : ''}
  ${params.finalidade_evento ? `- Ocasião especial: "${params.finalidade_evento}" (adapte para essa celebração no Brasil)` : ''}

  DIRETRIZES DE INTELIGÊNCIA CULTURAL E COERÊNCIA (CRÍTICO):
  1. ADAPTAÇÃO INTELIGENTE AO TEMA:
     - Use seu conhecimento sobre a cultura brasileira para selecionar itens TÍPICOS e COERENTES com o evento.
     - A lista deve "ter a cara" do evento. Evite sugestões genéricas ou sofisticadas demais se o evento for tradicional/rústico.
     - Analise a "vibe" do evento: um "Churrasco na laje" é diferente de um "Jantar de Gala". Adapte os itens.

  2. EXEMPLOS DE PADRÕES ESPERADOS (Use como referência de raciocínio):
     - Exemplo "Festa Junina": Espera-se Paçoca, Quentão, Milho, Canjica, Cachorro-quente. (Evite itens de churrasco como Picanha ou Linguiça, a menos que explicitamente pedido Espetinho).
     - Exemplo "Churrasco": Espera-se Picanha, Linguiça, Pão de Alho, Farofa.
     - Exemplo "Natal/Ceia": Espera-se Peru/Chester, Rabanada, Frutas Secas.
     -> APLIQUE ESSE MESMO NÍVEL DE COERÊNCIA PARA QUALQUER OUTRO TEMA SOLICITADO.
     -> CASO O TEMA NÃO ESTEJA NOS EXEMPLOS (ex: "Aniversário Infantil", "Bodas", "Reunião", "Festa"): Use sua inteligência para sugerir itens clássicos e adequados a esse tipo específico de evento. NÃO use os exemplos acima se não fizerem sentido.

  3. CÁLCULO DE QUANTIDADES (HEURÍSTICA):
     - Considere um evento de 4 a 5 horas.
     - Comida (Refeição): Calcule aprox. 400g a 500g de carne/massa por pessoa.
     - Comida (Coquetel): Calcule 12 a 15 salgados por pessoa.
     - Bebida: Calcule com sobra (ex: 2 a 3 garrafas de 600ml de cerveja por pessoa se for churrasco).

  4. RESTRIÇÕES E REGRAS:
     - NÃO sugira "Bolo de aniversário" se o evento NÃO for um aniversário.
     - NÃO encha a lista apenas de descartáveis. A prioridade é a COMIDA e BEBIDA.
     - Use nomes de produtos comuns no Brasil (ex: "Alcatra" em vez de "Carne bovina", "Refrigerante 2L" em vez de "Bebida gasosa").
     - "valor_estimado": Use preços médios de mercado em Reais (R$).
     ${excluirAlcool ? '- NÃO inclua bebidas alcoólicas (cerveja, vinho, etc.) na lista. Apenas refrigerantes, sucos e água.' : ''}

  FORMATO DE SAÍDA (JSON array puro, sem markdown):
  [
    {
      "nome_item": "Picanha (ou carne principal)",
      "quantidade": 0,
      "unidade": "kg",
      "valor_estimado": 0,
      "categoria": "comida", 
      "prioridade": "A"
    }
  ]
  (Categorias permitidas: "comida", "bebida", "descartaveis", "decoracao", "combustivel", "outros")
  (Prioridades: "A" = Essencial, "B" = Importante, "C" = Opcional)

  IMPORTANTE:
  - Responda APENAS o JSON.
  - Sem texto introdutório.
  - Sem markdown (\`\`\`json).
  `;

  const userPrompt = `Gere a lista para o evento "${perfilEvento}" com ${params.qtd_pessoas} pessoas.
Siga as diretrizes culturais. Se for um evento temático, respeite as tradições. Se for um evento comum (aniversário, reunião), sugira itens adequados ao público e ocasião.`;

  try {
    // Mantive a temperature em 0.3 para manter consistência, mas com o novo prompt ele será mais criativo nos itens
    const aiResponse = await callGroqAPI(systemPrompt, [{ role: 'user', content: userPrompt }], 0.3);

    if (!aiResponse) {
      console.warn('[GroqService] Groq nao retornou resposta, usando fallback');
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }

    const { parseLlmItemsResponse } = await import('@/core/orchestrator/itemAdapter');
    try {
      const items = parseLlmItemsResponse(aiResponse);
      console.info('[GroqService] Itens gerados pela Groq:', items.length);
      return items;
    } catch (adapterError) {
      console.error('[GroqService] Erro no adapter, usando fallback:', adapterError);
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }
  } catch (error) {
    console.error('[GroqService] Erro ao gerar itens com Groq:', error);
    return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
  }
}



/*async function generateItemsWithGroqLocal(params: {
  tipo_evento: string;
  qtd_pessoas: number;
  menu?: string;
}): Promise<Partial<Item>[]> {
  const systemPrompt = `Voce e um especialista em planejamento e organizacao de eventos sociais e corporativos.

Sua funcao e montar uma lista estruturada de itens e quantidades necessarios para o evento descrito abaixo.

EVENTO:
- Tipo: "${params.tipo_evento}"
- Quantidade de pessoas: ${params.qtd_pessoas}${params.menu ? `\n- Menu: "${params.menu}"` : ''}

Regras de geracao:
1. Pense de forma pratica e realista, considerando proporcoes adequadas a quantidade de pessoas.
2. Priorize itens realmente necessarios para a boa execucao do evento.
3. Inclua comidas, bebidas, descartaveis, combustiveis e decoracao apenas se forem adequados ao tipo de evento.
4. Mantenha as quantidades coerentes com o publico informado (nao exagere nem reduza demais).
5. Se o tipo de evento nao for totalmente claro, assuma um cenario generico e seguro.

Formato de saida:
Retorne APENAS um array JSON valido (sem markdown, texto adicional ou comentarios).
Cada item deve seguir EXATAMENTE esta estrutura:
[
  {
    "nome_item": string,
    "quantidade": number,
    "unidade": string,
    "valor_estimado": number,
    "categoria": "comida" | "bebida" | "descartaveis" | "decoracao" | "combustivel" | "outros",
    "prioridade": "A" | "B" | "C"
  }
]

Importante:
- NAO use markdown.
- NAO adicione texto explicativo antes ou depois do JSON.
- O retorno deve ser apenas o JSON puro.`;

  const userPrompt = `Evento: ${params.tipo_evento}, Pessoas: ${params.qtd_pessoas}`;

  try {
    const aiResponse = await callGroqAPI(systemPrompt, [{ role: 'user', content: userPrompt }], 0.3);

    if (!aiResponse) {
      console.warn('[GroqService] Groq nao retornou resposta, usando fallback');
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }

    const { parseLlmItemsResponse } = await import('@/core/orchestrator/itemAdapter');
    try {
      const items = parseLlmItemsResponse(aiResponse);
      console.info('[GroqService] Itens gerados pela Groq:', items.length);
      return items;
    } catch (adapterError) {
      console.error('[GroqService] Erro no adapter, usando fallback:', adapterError);
      return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
    }
  } catch (error) {
    console.error('[GroqService] Erro ao gerar itens com Groq:', error);
    return generateFallbackItems(params.tipo_evento, params.qtd_pessoas);
  }
}*/

/**
 * Resultado da execucao de acao
 */
interface ExecuteActionResult {
  message: string;
  eventoId?: string;
  actionExecuted?: ActionData;
  extractedData?: Record<string, any>;
}

// HIERARQUIA DE DADOS: Prioridade absoluta para a especificidade
// HIERARQUIA DE DADOS: Prioridade absoluta para a especificidade
// Função antiga removida por obsolescência: resolveEventoId
// Função antiga removida por obsolescência: resolveEventType

function normalizePeopleCount(value: unknown): number | undefined {
  if (value === null || value === undefined) return undefined;
  const parsed = typeof value === 'number' ? value : Number(value);
  if (!Number.isFinite(parsed) || parsed <= 0) return undefined;
  return Math.round(parsed);
}

function buildMissingEventDataMessage(tipo?: string, qtd?: number): string {
  if (tipo && !qtd) return `Legal, ${tipo}! E para quantas pessoas seria?`;
  if (!tipo && qtd) return `Entendido, para ${qtd} pessoas. E qual é o tipo do evento (ex: Churrasco, Jantar)?`;
  return "Para começar, qual o tipo de evento e quantas pessoas?";
}

function formatDateForName(isoDate?: string): string | undefined {
  if (!isoDate) return undefined;
  const match = isoDate.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if (!match) return undefined;
  return `${match[3]}/${match[2]}/${match[1]}`;
}

function capitalizeWord(value?: string): string {
  if (!value) return 'Evento';
  return value.charAt(0).toUpperCase() + value.slice(1);
}

function buildEventName(tipo?: string, dataIso?: string): string {
  const base = capitalizeWord(tipo);
  const dateLabel = formatDateForName(dataIso);
  if (dateLabel) {
    return `${base} - ${dateLabel}`;
  }
  return base;
}

// --- 3. EXECUÇÃO SIMPLIFICADA (Substituir o executeAction atual) ---

async function executeAction(actionData: ActionData, userId: UUID, context?: any): Promise<any> {
  const { action, data } = actionData;

  // MERGE DE CONTEXTO: O que veio agora sobrescreve o antigo
  const merged = { ...(context?.collectedData || {}), ...data };

  // LEITURA DIRETA (Sem funções complexas de resolução)
  // A IA foi instruída a usar 'tipo_evento', então lemos 'tipo_evento'.
  let tipo = merged.tipo_evento;
  let qtd = merged.qtd_pessoas;
  let eventoIdCandidate = merged.evento_id || context?.evento?.id;

  // CONTEXT HYGIENE: Se o usuário quer criar um evento novo, mas estamos num contexto avançado,
  // devemos zerar o ID para não sobrescrever o evento antigo e poluir os dados.
  if (action === 'create_event') {
    const currentStatus = context?.evento?.status;
    const isAdvancedStatus = ['itens_pendentes_confirmacao', 'finalizado', 'active'].includes(currentStatus || '');

    if (isAdvancedStatus) {
      console.log('[GroqService] Detectado início de NOVA thread de evento. Ignorando contexto anterior.');
      eventoIdCandidate = undefined;
      // Limpar dados herdados que podem poluir o novo evento (ex: finalidade_evento antiga)
      // Mas mantemos o que veio no 'data' atual
      merged.finalidade_evento = data.finalidade_evento;
      merged.categoria_evento = data.categoria_evento;
      merged.subtipo_evento = data.subtipo_evento;
      merged.menu = data.menu;

      // Re-ler variáveis limpas
      tipo = data.tipo_evento; // Garante que lê apenas do novo
      qtd = data.qtd_pessoas;
    }
  }

  // LOG DE DEBUG (Para vermos se a IA obedeceu)
  console.log('[GroqService] Dados Identificados:', { tipo, qtd, raw: data });

  switch (action) {
    case 'create_event':
    case 'generate_items': {
      // GUARDIÃO DE DADOS (The Guardrail)
      // Se a IA tentou gerar itens, mas falta dado, rebaixamos para criação
      if ((!tipo || !qtd) && action === 'generate_items') {
        console.log('[GroqService] Falta dados para gerar itens. Pedindo mais detalhes...');
        // Segue o fluxo abaixo para retornar a pergunta
      }

      // Se a IA usou chaves erradas para o menu (common hallucination fix)
      if (!merged.menu) {
        // Tenta pegar de campos que a IA costuma inventar
        const dataAny = data as any;
        const menuCandidate = dataAny.sugestao_prato || dataAny.prato || dataAny.comida || dataAny.cardapio;
        if (menuCandidate) {
          merged.menu = menuCandidate;
          console.log('[GroqService] Recuperado menu de chave alternativa:', menuCandidate);
        }
      }

      // Se ainda falta algo, retornamos a pergunta amigável
      if (!tipo || !qtd) {
        return {
          message: buildMissingEventDataMessage(tipo, qtd ? Number(qtd) : undefined),
          extractedData: merged
        };
      }

      // Se chegou aqui, TEMOS TIPO E QTD. Sucesso!

      // Validação de feriado (Inteligência Cultural)
      const holidayData = await rpc.get_holiday_date_by_name(tipo);
      let dataFinal = merged.data_evento;

      if (holidayData && !dataFinal) {
        dataFinal = holidayData.date; // Ex: 2026-06-24
      }

      // NOVO: Verificação de Menu para Eventos Genéricos e DATA
      // Se for um evento genérico (Jantar, Almoço) e não tiver menu definido,
      // interrompemos o fluxo AUTOMÁTICO e perguntamos o cardápio.
      // E TAMBÉM: Se não tem data, perguntamos a data.

      const GENERIC_TYPES = ['jantar', 'almoco', 'almoço', 'ceia', 'lanche', 'cafe da manha', 'brunch', 'refeição', 'refeicao'];
      const isGeneric = GENERIC_TYPES.some(t => tipo?.toLowerCase().includes(t));
      const hasMenu = !!merged.menu;
      const hasDate = !!dataFinal;

      // Definição de Status Inteligente
      let initialStatus: EventStatus = 'collecting_core';
      let missingFieldMessage = '';

      if (!hasDate && isGeneric && !hasMenu) {
        initialStatus = 'aguardando_data'; // Prioridade para data, mas pediremos ambos
        missingFieldMessage = `Combinado, um ${tipo} para ${qtd} pessoas. \n\n**Para quando é o evento e o que você pensa em servir?**`;
      } else if (!hasDate) {
        initialStatus = 'aguardando_data';
        missingFieldMessage = `Combinado, um ${tipo} para ${qtd} pessoas. \n\n**Para qual data devo agendar?**`;
      } else if (isGeneric && !hasMenu) {
        initialStatus = 'aguardando_preferencia_menu';
        missingFieldMessage = `Combinado, um ${tipo} para ${qtd} pessoas no dia ${formatDateForName(dataFinal)}. \n\nPara eu montar a lista certa: **O que você pensa em servir?**`;
      }

      // Criar ou Atualizar Evento
      const eventPayload = {
        usuario_id: userId,
        nome_evento: tipo,
        tipo_evento: tipo,
        qtd_pessoas: Number(qtd),
        data_evento: dataFinal,
        status: initialStatus,
        // Preserva o ID se já existir no contexto
        id: eventoIdCandidate
      };

      try {
        console.log('[GroqService] Tentando criar/atualizar evento:', {
          payload: eventPayload,
          initialStatus,
          missingFieldMessage
        });

        const newEvent = await upsertEvent(eventPayload);

        console.log('[GroqService] Evento criado/atualizado com sucesso:', {
          eventId: newEvent.id,
          tipo: newEvent.tipo_evento,
          data: newEvent.data_evento
        });

        // Se estamos aguardando algo, retornamos a pergunta agora
        if (initialStatus !== 'collecting_core' && missingFieldMessage) {
          return {
            message: missingFieldMessage,
            eventoId: newEvent.id,
            extractedData: merged
          };
        }

        // Se a ação era gerar itens, fazemos agora
        if (action === 'generate_items' || (tipo && qtd && dataFinal)) {
          const itensGerados = await generateItemsWithGroqLocal({
            tipo_evento: String(tipo),
            qtd_pessoas: Number(qtd),
            menu: merged.menu as string | undefined,
            finalidade_evento: (merged.finalidade_evento || merged.subtipo_evento || merged.categoria_evento || merged.descricao) as string | undefined,
          });

          const itensComIds = itensGerados.map(item => ({
            ...item,
            id: item.id || crypto.randomUUID(),
            evento_id: String(newEvent.id),
            nome_item: item.nome_item || '',
            quantidade: item.quantidade || 0,
            unidade: item.unidade || 'un',
            valor_estimado: item.valor_estimado || 0,
            categoria: item.categoria || 'geral',
            prioridade: (item.prioridade || 'B') as 'A' | 'B' | 'C',
          })) as Item[];

          await rpc.items_replace_for_event(String(newEvent.id), itensComIds);
          await setEventStatus(String(newEvent.id), 'itens_pendentes_confirmacao');

          return {
            message: `Criei sua lista para o ${tipo} (${qtd} pessoas). Quer dar uma olhada?`,
            eventoId: newEvent.id,
            extractedData: merged
          };
        }

        return {
          message: `Evento "${tipo}" criado! Data sugerida: ${dataFinal || 'a definir'}. Posso gerar a lista de itens?`,
          eventoId: newEvent.id,
          extractedData: merged
        };

      } catch (error) {
        console.error('[GroqService] Erro ao salvar evento:', error);
        // Em caso de erro de permissão ou outro, limpamos o ID para tentar criar um novo na próxima
        return {
          message: "Tive um pequeno problema técnico ao salvar. Podemos tentar de novo?",
          extractedData: { ...merged, evento_id: undefined }
        };
      }
    }

    case 'confirm_event': {
      if (!eventoIdCandidate) return { message: 'Nao encontrei o evento para confirmar.' };
      await setEventStatus(eventoIdCandidate, 'finalizado');
      return {
        message: 'Perfeito! Seu evento foi confirmado e finalizado.',
        eventoId: eventoIdCandidate,
      };
    }

    case 'update_event': {
      if (!eventoIdCandidate) return { message: 'Nao encontrei o evento para atualizar.' };

      const updateData: Partial<Event> = { usuario_id: userId };
      if (merged.tipo_evento) updateData.tipo_evento = merged.tipo_evento;
      if (merged.qtd_pessoas) updateData.qtd_pessoas = Number(merged.qtd_pessoas);
      if (merged.data_evento) updateData.data_evento = merged.data_evento;

      await upsertEvent({ ...updateData, id: eventoIdCandidate } as any);
      return { message: 'Evento atualizado!', eventoId: eventoIdCandidate };
    }

    default:
      return { message: 'Acao nao reconhecida.' };
  }
}

/**
 * Resultado do processamento de mensagem
 */
export interface ProcessMessageResult {
  response: string;
  actionExecuted?: {
    type: ActionData['action'];
    eventoId?: string;
    extractedData?: Record<string, any>;
  };
}

/**
 * Processa uma mensagem do usuario usando Groq
 */
export async function processMessage(
  userMessage: string,
  history: LlmMessage[],
  userId: UUID,
  context?: EventContext
): Promise<ProcessMessageResult> {
  try {
    const systemPrompt = buildSystemPrompt(context);
    const conversationMessages = history.filter(msg => msg.role !== 'system');
    conversationMessages.push({ role: 'user', content: userMessage });

    // Planner-first (create/generate/update/confirm)
    let plannerResult: ReturnType<typeof parsePlannerEnvelope> | null = null;
    try {
      const plannerPrompt = buildPlannerPrompt(context);
      const plannerResponse = await callGroqAPI(
        plannerPrompt,
        [{ role: 'user', content: userMessage }],
        0.1
      );
      plannerResult = parsePlannerEnvelope(plannerResponse);
      if (plannerResult.ok) {
        const plannedAction = plannerToAction(plannerResult.data);
        if (plannedAction) {
          const actionResult = await executeAction(plannedAction, userId, context);
          return {
            response: actionResult.message,
            actionExecuted: {
              type: plannedAction.action,
              eventoId: actionResult.eventoId,
              extractedData: actionResult.extractedData, // Propaga dados parciais
            },
          };
        }

        // small_talk/unknown ficam no fluxo legado para manter UX atual
      }
    } catch {
      plannerResult = { ok: false as const, error: 'planner falhou' };
    }

    // Fallback: fluxo antigo quando o planner falhar ou nao cobrir o caso.
    const aiResponse = await callGroqAPI(systemPrompt, conversationMessages);

    const action = detectActionJSON(aiResponse);
    if (action) {
      const actionResult = await executeAction(action, userId, context);
      return {
        response: actionResult.message,
        actionExecuted: {
          type: action.action,
          eventoId: actionResult.eventoId,
          extractedData: actionResult.extractedData, // Propaga dados parciais
        },
      };
    }

    return { response: aiResponse || systemResponses.plannerInvalid };
  } catch (error) {
    console.error('[GroqService] Erro ao processar mensagem:', error);
    if (error instanceof Error) {
      if (error.message.includes('GROQ_API_KEY')) {
        return { response: 'Erro de configuracao: Chave da API Groq nao encontrada.' };
      }
      return { response: `Erro ao conectar com a IA: ${error.message}` };
    }
    return { response: 'Erro ao conectar com a IA.' };
  }
}

/**
 * Gera lista de itens usando Groq diretamente (versao exportada)
 */
export async function generateItemsWithGroq(params: {
  tipo_evento: string;
  qtd_pessoas: number;
  menu?: string;
}): Promise<Partial<Item>[]> {
  return generateItemsWithGroqLocal(params);
}

/**
 * Servico Groq exportado
 */
export const GroqService = {
  processMessage,
  generateItemsWithGroq,
};


============================================================
FILE PATH: .\src\types\admin.ts
============================================================
// Tipos para o Admin Email Center

export interface Lead {
  id: string;
  email: string;
  name?: string | null;
  origin: string;
  welcome_email_sent: boolean;
  welcome_email_sent_at?: string | null;
  created_at: string;
}

export interface RegisteredUser {
  id: string;
  email: string;
  name?: string | null;
  is_founder?: boolean;
  founder_since?: string | null;
  premium_until?: string | null;
  storage_multiplier?: number;
  welcome_email_sent?: boolean;
  welcome_email_sent_at?: string | null;
  created_at: string;
}

export interface EmailTemplate {
  id: string;
  name: string;
  subject: string;
  html_content: string;
  description?: string | null;
  variables: string[];
  is_active: boolean;
  created_at: string;
  updated_at: string;
}

export interface EmailLog {
  id: string;
  lead_id?: string | null;
  lead_email: string;
  template_name: string;
  sent_at: string;
  status: 'success' | 'failed' | 'pending';
  error_message?: string | null;
  metadata: {
    resend_message_id?: string;
    variables?: Record<string, string>;
    [key: string]: any;
  };
  created_at: string;
}

export interface AdminSettings {
  id: string;
  key: string;
  value: any;
  description?: string | null;
  updated_at: string;
  created_at: string;
}

export interface EmailStats {
  total: number;
  success: number;
  failed: number;
  pending: number;
}

export interface AdminData {
  waitlist: Lead[];
  users: RegisteredUser[];
  events: any[];
  templates: EmailTemplate[];
  settings: AdminSettings[];
  emailStats: EmailStats;
  leadsWithoutWelcome: number;
}

export interface SendEmailRequest {
  lead_ids: string[];
  template_name: string;
  variables?: Record<string, string>;
  password: string;
}

export interface SendEmailResponse {
  success: boolean;
  message: string;
  results: Array<{
    lead_id: string;
    lead_email?: string;
    status: 'success' | 'failed';
    message_id?: string;
    error?: string;
  }>;
}


============================================================
FILE PATH: .\src\types\domain.ts
============================================================
// Tipos base do domínio UNE.Ai / ReUNE

export type UUID = string;

export type EventStatus =
  | 'collecting_core'
  | 'itens_pendentes_confirmacao'
  | 'distrib_pendente_confirmacao'
  | 'finalizado'
  | 'aguardando_data'
  | 'aguardando_decisao_data'
  | 'aguardando_confirmacao_data'
  | 'aguardando_preferencia_menu'
  | 'active'
  | 'criado'
  | 'criado_sem_data';

export interface Event {
  id: UUID;
  usuario_id: UUID;
  nome_evento: string;
  tipo_evento: string;
  categoria_evento?: string; // almoço, jantar, lanche, piquenique
  subtipo_evento?: string; // churrasco, feijoada, pizza, fondue
  finalidade_evento?: string; // aniversário, encontro de amigos, confraternização
  menu?: string; // prato principal
  data_evento: string; // ISO date-time
  hora_evento?: string; // horário do evento
  qtd_pessoas: number;
  inclui_bebidas?: boolean;
  inclui_entradas?: boolean;
  orcamento_total?: number | null;
  status: EventStatus;
  created_at?: string;
  updated_at?: string;
}

export interface Item {
  id: UUID;
  evento_id: UUID;
  nome_item: string;
  quantidade: number;
  unidade: string;
  valor_estimado: number;
  categoria: string;
  prioridade: 'A' | 'B' | 'C';
  created_at?: string;
  updated_at?: string;
}

export interface Participant {
  id: UUID;
  evento_id: UUID;
  nome_participante: string;
  contato?: string | null;
  status_convite: 'pendente' | 'confirmado' | 'recusado';
  preferencias?: Record<string, unknown> | null;
  valor_responsavel?: number | null;
  created_at?: string;
  updated_at?: string;
}

export interface DistributionRow {
  id: UUID;
  item_id: UUID;
  participante_id: UUID;
  quantidade_atribuida: number;
  valor_rateado: number;
  observacoes?: string | null;
  created_at?: string;
  updated_at?: string;
}

export interface Message {
  role: 'user' | 'assistant' | 'system';
  content: string;
  timestamp?: number;
  id?: string;
}

export interface ConversationState {
  conversationId: string;
  context?: Record<string, unknown>;
  history: Message[];
  lastUpdated: number;
}

export interface AiProfile {
  id: string;
  name: string;
  description?: string;
  tags?: string[];
  defaults?: AiProfileDefaults;
}

export type ApiResult<T> = {
  data?: T;
  error?: string;
};

// Itens sugeridos pelos perfis de IA (baseline, não persistidos diretamente)
export interface SuggestedItem {
  id: string;
  name: string;
  quantity: number;
  unit: string;
  category?: string;
  priority?: 'A' | 'B' | 'C';
  estimated_cost?: number;
}

export interface AiProfileDefaults {
  suggestedItems?: SuggestedItem[];
}

export interface EventSnapshot {
  evento: Event;
  itens: Item[];
  participantes: Participant[];
  distribuicao: DistributionRow[];
  mensagem?: string;
}

export interface ChatUiPayload {
  estado: EventStatus;
  evento_id: string | null;
  mensagem: string;
  snapshot?: any; // EventSnapshot is used but to avoid circular deps or complexity just keep it flexible or use EventSnapshot if possible
  showItems: boolean;
  suggestedReplies?: string[];
  closeChat?: boolean;
  toast?: string;
}

============================================================
FILE PATH: .\src\types\llm.ts
============================================================
// Tipos centrais para integração com LLM

export type LlmMessage = {
  role: 'system' | 'user' | 'assistant' | 'tool';
  content: string;
};

// Evitar any explícito
export type LlmToolCall = { name: string; arguments: Record<string, unknown> | unknown[] };
// Evitar any explícito
export type SafeLlmToolCall = { name: string; arguments: Record<string, unknown> | unknown[] };

export type LlmChatResponse = {
  provider: string;
  model: string;
  content: string;
  toolCalls?: Array<SafeLlmToolCall>;
};

============================================================
FILE PATH: .\src\types\tools.ts
============================================================
// Tipos para function-calling de ferramentas do UNE.Ai

export type ToolCall = { name: string; arguments: Record<string, unknown> | unknown[] };

export type ToolName =
  | 'generateItemList'
  | 'confirmItems'
  | 'computeCostSplit'
  | 'addParticipants'
  | 'getPlan';

export type GenerateItemListArgs = {
  evento_id: string;
  tipo_evento: string;
  qtd_pessoas: number;
  preferencias?: Record<string, unknown> | undefined;
};

export type ConfirmItemsArgs = {
  evento_id: string;
  itens_editados?: unknown[]; // manter flexível; validação via schemas zod
};

export type ComputeCostSplitArgs = {
  evento_id: string;
};

export type AddParticipantsArgs = {
  evento_id: string;
  participantes: unknown[]; // manter flexível; validação via schemas zod
};

export type GetPlanArgs = {
  evento_id: string;
};

============================================================
FILE PATH: .\src\utils\idempotency.ts
============================================================
// Utilitário de Idempotência para requisições/ações no cliente
// Permite evitar duplicação de efeitos, usando header `Idempotency-Key` e cache leve

export type StorageKind = 'memory' | 'local' | 'session';

export interface IdempotencyOptions {
  key?: string;
  ttlMs?: number; // tempo de validade do cache
  storage?: StorageKind;
}

const memoryCache = new Map<string, { expiresAt: number; value: unknown }>();

export const generateIdempotencyKey = (): string => {
  const randomUUIDFn = typeof globalThis.crypto?.randomUUID === 'function' ? globalThis.crypto.randomUUID : undefined;
  if (randomUUIDFn) return randomUUIDFn();
  return `idemp_${Date.now()}_${Math.random().toString(36).slice(2)}`;
};

const getStore = (kind: StorageKind) => {
  if (kind === 'local') return globalThis.localStorage;
  if (kind === 'session') return globalThis.sessionStorage;
  return undefined; // memory
};

const getCacheKey = (key: string) => `UNEAI_IDEMP_${key}`;

export async function withIdempotent<T>(fn: () => Promise<T>, options: IdempotencyOptions = {}): Promise<T> {
  const {
    key = generateIdempotencyKey(),
    ttlMs = 30_000,
    storage = 'memory',
  } = options;

  const store = getStore(storage);
  const k = getCacheKey(key);

  // Tentativa de recuperar valor no cache
  try {
    if (store) {
      const raw = store.getItem(k);
      if (raw) {
        const parsed = JSON.parse(raw) as { expiresAt: number; value: unknown };
        if (Date.now() < parsed.expiresAt) return parsed.value as T;
        store.removeItem(k);
      }
    } else if (memoryCache.has(k)) {
      const entry = memoryCache.get(k)!;
      if (Date.now() < entry.expiresAt) return entry.value as T;
      memoryCache.delete(k);
    }
  } catch {
    // ignora erros de storage
  }

  // Executa função e armazena
  const result = await fn();
  const payload = { expiresAt: Date.now() + ttlMs, value: result };
  try {
    if (store) store.setItem(k, JSON.stringify(payload));
    else memoryCache.set(k, payload);
  } catch {
    // storage pode falhar por quota
  }
  return result;
}

export interface IdempotentFetchOptions extends IdempotencyOptions {
  method?: 'GET' | 'POST' | 'PUT' | 'PATCH' | 'DELETE';
  body?: unknown;
  headers?: Record<string, string>;
}

// Helper para fetch com cabeçalho Idempotency-Key
export async function idempotentFetch<T = unknown>(url: string, opts: IdempotentFetchOptions = {}): Promise<T> {
  const { key = generateIdempotencyKey(), ttlMs, storage, method = 'POST', body, headers } = opts;
  const fingerprintBase = `${method}:${url}:${body ? JSON.stringify(body) : ''}`;
  const cacheKey = `${key}:${fingerprintBase}`;

  return withIdempotent(async () => {
    const res = await fetch(url, {
      method,
      headers: {
        'Content-Type': 'application/json',
        'Idempotency-Key': key,
        ...(headers || {}),
      },
      body: body != null && method !== 'GET' ? JSON.stringify(body) : undefined,
    });

    if (!res.ok) {
      const text = await res.text().catch(() => '');
      throw new Error(`idempotentFetch error ${res.status}: ${text || res.statusText}`);
    }

    const contentType = res.headers.get('content-type') || '';
    if (contentType.includes('application/json')) {
      return (await res.json()) as T;
    }
    return (await res.text()) as unknown as T;
  }, { key: cacheKey, ttlMs, storage });
}

============================================================
FILE PATH: .\src\utils\secretSantaDraw.ts
============================================================
/**
 * Algoritmo de sorteio de Amigo Secreto
 * Garante que ninguém tire a si mesmo
 */

interface Participant {
  user_id: string;
}

interface DrawResult {
  giver_id: string;
  receiver_id: string;
}

export function validateParticipants(participants: Participant[]): {
  valid: boolean;
  error?: string;
} {
  if (participants.length < 2) {
    return {
      valid: false,
      error: "É necessário pelo menos 2 participantes para realizar o sorteio.",
    };
  }

  // Verificar se há participantes duplicados (mesmo user_id repetido)
  const uniqueUserIds = new Set(participants.map((p) => p.user_id));
  if (uniqueUserIds.size !== participants.length) {
    return {
      valid: false,
      error: "Há participantes duplicados. Remova as duplicatas antes de sortear.",
    };
  }

  if (participants.length === 2) {
    // Com apenas 2 pessoas, o sorteio é trivial mas válido
    return { valid: true };
  }

  return { valid: true };
}

/**
 * Realiza o sorteio usando algoritmo de embaralhamento Fisher-Yates
 * com garantia de que ninguém tira a si mesmo
 */
export function performSecretSantaDraw(
  participants: Participant[],
  previousPairs?: DrawResult[]
): DrawResult[] {
  const validation = validateParticipants(participants);
  if (!validation.valid) {
    throw new Error(validation.error);
  }

  const n = participants.length;
  const givers = [...participants];
  const receivers = [...participants];

  // Algoritmo de desarranjo (derangement)
  // Garante que nenhum elemento fique na sua posição original
  let attempts = 0;
  const maxAttempts = 100;

  while (attempts < maxAttempts) {
    attempts++;

    // Embaralhar receivers usando Fisher-Yates
    for (let i = receivers.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [receivers[i], receivers[j]] = [receivers[j], receivers[i]];
    }

    // Verificar se ninguém tirou a si mesmo
    let isValid = true;
    for (let i = 0; i < n; i++) {
      if (givers[i].user_id === receivers[i].user_id) {
        isValid = false;
        break;
      }
    }

    if (isValid) {
      // Verificar restrições de repetição (se fornecidas)
      if (previousPairs && previousPairs.length > 0) {
        let hasRepeat = false;
        for (let i = 0; i < n; i++) {
          const pair = previousPairs.find(
            (p) =>
              p.giver_id === givers[i].user_id &&
              p.receiver_id === receivers[i].user_id
          );
          if (pair) {
            hasRepeat = true;
            break;
          }
        }

        if (!hasRepeat) {
          // Sorteio válido sem repetições
          return givers.map((giver, index) => ({
            giver_id: giver.user_id,
            receiver_id: receivers[index].user_id,
          }));
        }
      } else {
        // Sorteio válido sem verificação de repetições
        return givers.map((giver, index) => ({
          giver_id: giver.user_id,
          receiver_id: receivers[index].user_id,
        }));
      }
    }
  }

  // Se não conseguiu em maxAttempts, retornar resultado básico
  // (isso é extremamente raro, praticamente impossível com mais de 3 participantes)
  throw new Error(
    "Não foi possível encontrar um sorteio válido após várias tentativas. Tente novamente."
  );
}

/**
 * Testa o algoritmo de sorteio
 */
export function testSecretSantaDraw() {
  console.log("🧪 Testando algoritmo de Amigo Secreto...\n");

  // Teste 1: 2 participantes
  console.log("Teste 1: 2 participantes");
  const test1 = [
    { user_id: "user-1" },
    { user_id: "user-2" },
  ];
  try {
    const result1 = performSecretSantaDraw(test1);
    console.log("✅ Resultado:", result1);
    console.assert(
      result1[0].giver_id !== result1[0].receiver_id,
      "Erro: giver 1 tirou a si mesmo"
    );
    console.assert(
      result1[1].giver_id !== result1[1].receiver_id,
      "Erro: giver 2 tirou a si mesmo"
    );
    console.log("✅ Ninguém tirou a si mesmo\n");
  } catch (err) {
    console.error("❌ Erro:", err);
  }

  // Teste 2: 3 participantes
  console.log("Teste 2: 3 participantes");
  const test2 = [
    { user_id: "user-1" },
    { user_id: "user-2" },
    { user_id: "user-3" },
  ];
  try {
    const result2 = performSecretSantaDraw(test2);
    console.log("✅ Resultado:", result2);
    result2.forEach((pair, index) => {
      console.assert(
        pair.giver_id !== pair.receiver_id,
        `Erro: giver ${index} tirou a si mesmo`
      );
    });
    console.log("✅ Ninguém tirou a si mesmo\n");
  } catch (err) {
    console.error("❌ Erro:", err);
  }

  // Teste 3: 5 participantes
  console.log("Teste 3: 5 participantes");
  const test3 = [
    { user_id: "user-1" },
    { user_id: "user-2" },
    { user_id: "user-3" },
    { user_id: "user-4" },
    { user_id: "user-5" },
  ];
  try {
    const result3 = performSecretSantaDraw(test3);
    console.log("✅ Resultado:", result3);
    result3.forEach((pair, index) => {
      console.assert(
        pair.giver_id !== pair.receiver_id,
        `Erro: giver ${index} tirou a si mesmo`
      );
    });
    console.log("✅ Ninguém tirou a si mesmo\n");
  } catch (err) {
    console.error("❌ Erro:", err);
  }

  // Teste 4: Validação com apenas 1 participante
  console.log("Teste 4: 1 participante (deve falhar)");
  const test4 = [{ user_id: "user-1" }];
  try {
    const result4 = performSecretSantaDraw(test4);
    console.error("❌ Erro: deveria ter falhado");
  } catch (err) {
    console.log("✅ Erro esperado:", (err as Error).message, "\n");
  }

  // Teste 5: Participantes duplicados (deve falhar)
  console.log("Teste 5: Participantes duplicados (deve falhar)");
  const test5 = [
    { user_id: "user-1" },
    { user_id: "user-1" },
  ];
  try {
    const result5 = performSecretSantaDraw(test5);
    console.error("❌ Erro: deveria ter falhado");
  } catch (err) {
    console.log("✅ Erro esperado:", (err as Error).message, "\n");
  }

  console.log("🎉 Todos os testes concluídos!");
}


============================================================
FILE PATH: .\src\utils\testSecretSanta.ts
============================================================
import { testSecretSantaDraw } from "./secretSantaDraw";

// Executar testes na console do browser
console.log("=".repeat(60));
console.log("INICIANDO TESTES DO AMIGO SECRETO");
console.log("=".repeat(60));

testSecretSantaDraw();

console.log("\n" + "=".repeat(60));
console.log("TESTES CONCLUÍDOS");
console.log("=".repeat(60));

